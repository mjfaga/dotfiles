"use strict";var Ob=Object.create;var ks=Object.defineProperty;var Lb=Object.getOwnPropertyDescriptor;var Mb=Object.getOwnPropertyNames;var Nb=Object.getPrototypeOf,Ab=Object.prototype.hasOwnProperty;var x=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),$b=(r,e)=>{for(var t in e)ks(r,t,{get:e[t],enumerable:!0})},Af=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Mb(e))!Ab.call(r,i)&&i!==t&&ks(r,i,{get:()=>e[i],enumerable:!(n=Lb(e,i))||n.enumerable});return r};var Z=(r,e,t)=>(t=r!=null?Ob(Nb(r)):{},Af(e||!r||!r.__esModule?ks(t,"default",{value:r,enumerable:!0}):t,r)),jb=r=>Af(ks({},"__esModule",{value:!0}),r);var hn=x(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.asPromise=tt.thenable=tt.typedArray=tt.stringArray=tt.array=tt.func=tt.error=tt.number=tt.string=tt.boolean=void 0;function Ub(r){return r===!0||r===!1}tt.boolean=Ub;function $f(r){return typeof r=="string"||r instanceof String}tt.string=$f;function Wb(r){return typeof r=="number"||r instanceof Number}tt.number=Wb;function Hb(r){return r instanceof Error}tt.error=Hb;function jf(r){return typeof r=="function"}tt.func=jf;function Uf(r){return Array.isArray(r)}tt.array=Uf;function Kb(r){return Uf(r)&&r.every(e=>$f(e))}tt.stringArray=Kb;function Vb(r,e){return Array.isArray(r)&&r.every(e)}tt.typedArray=Vb;function Wf(r){return r&&jf(r.then)}tt.thenable=Wf;function zb(r){return r instanceof Promise?r:Wf(r)?new Promise((e,t)=>{r.then(n=>e(n),n=>t(n))}):Promise.resolve(r)}tt.asPromise=zb});var ei=x(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.stringArray=Tt.array=Tt.func=Tt.error=Tt.number=Tt.string=Tt.boolean=void 0;function Bb(r){return r===!0||r===!1}Tt.boolean=Bb;function Hf(r){return typeof r=="string"||r instanceof String}Tt.string=Hf;function Gb(r){return typeof r=="number"||r instanceof Number}Tt.number=Gb;function Xb(r){return r instanceof Error}Tt.error=Xb;function Qb(r){return typeof r=="function"}Tt.func=Qb;function Kf(r){return Array.isArray(r)}Tt.array=Kf;function Jb(r){return Kf(r)&&r.every(e=>Hf(e))}Tt.stringArray=Jb});var pc=x(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.Message=Y.NotificationType9=Y.NotificationType8=Y.NotificationType7=Y.NotificationType6=Y.NotificationType5=Y.NotificationType4=Y.NotificationType3=Y.NotificationType2=Y.NotificationType1=Y.NotificationType0=Y.NotificationType=Y.RequestType9=Y.RequestType8=Y.RequestType7=Y.RequestType6=Y.RequestType5=Y.RequestType4=Y.RequestType3=Y.RequestType2=Y.RequestType1=Y.RequestType=Y.RequestType0=Y.AbstractMessageSignature=Y.ParameterStructures=Y.ResponseError=Y.ErrorCodes=void 0;var Mr=ei(),Ka;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(Ka||(Y.ErrorCodes=Ka={}));var Va=class r extends Error{constructor(e,t,n){super(t),this.code=Mr.number(e)?e:Ka.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};Y.ResponseError=Va;var Kt=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};Y.ParameterStructures=Kt;Kt.auto=new Kt("auto");Kt.byPosition=new Kt("byPosition");Kt.byName=new Kt("byName");var Ue=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return Kt.auto}};Y.AbstractMessageSignature=Ue;var za=class extends Ue{constructor(e){super(e,0)}};Y.RequestType0=za;var Ba=class extends Ue{constructor(e,t=Kt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.RequestType=Ba;var Ga=class extends Ue{constructor(e,t=Kt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.RequestType1=Ga;var Xa=class extends Ue{constructor(e){super(e,2)}};Y.RequestType2=Xa;var Qa=class extends Ue{constructor(e){super(e,3)}};Y.RequestType3=Qa;var Ja=class extends Ue{constructor(e){super(e,4)}};Y.RequestType4=Ja;var Ya=class extends Ue{constructor(e){super(e,5)}};Y.RequestType5=Ya;var Za=class extends Ue{constructor(e){super(e,6)}};Y.RequestType6=Za;var ec=class extends Ue{constructor(e){super(e,7)}};Y.RequestType7=ec;var tc=class extends Ue{constructor(e){super(e,8)}};Y.RequestType8=tc;var nc=class extends Ue{constructor(e){super(e,9)}};Y.RequestType9=nc;var rc=class extends Ue{constructor(e,t=Kt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.NotificationType=rc;var ic=class extends Ue{constructor(e){super(e,0)}};Y.NotificationType0=ic;var sc=class extends Ue{constructor(e,t=Kt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.NotificationType1=sc;var oc=class extends Ue{constructor(e){super(e,2)}};Y.NotificationType2=oc;var ac=class extends Ue{constructor(e){super(e,3)}};Y.NotificationType3=ac;var cc=class extends Ue{constructor(e){super(e,4)}};Y.NotificationType4=cc;var uc=class extends Ue{constructor(e){super(e,5)}};Y.NotificationType5=uc;var dc=class extends Ue{constructor(e){super(e,6)}};Y.NotificationType6=dc;var lc=class extends Ue{constructor(e){super(e,7)}};Y.NotificationType7=lc;var fc=class extends Ue{constructor(e){super(e,8)}};Y.NotificationType8=fc;var hc=class extends Ue{constructor(e){super(e,9)}};Y.NotificationType9=hc;var Vf;(function(r){function e(i){let s=i;return s&&Mr.string(s.method)&&(Mr.string(s.id)||Mr.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&Mr.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(Mr.string(s.id)||Mr.number(s.id)||s.id===null)}r.isResponse=n})(Vf||(Y.Message=Vf={}))});var mc=x(gr=>{"use strict";var zf;Object.defineProperty(gr,"__esModule",{value:!0});gr.LRUCache=gr.LinkedMap=gr.Touch=void 0;var Pt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Pt||(gr.Touch=Pt={}));var Es=class{constructor(){this[zf]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Pt.None){let n=this._map.get(e);if(n)return t!==Pt.None&&this.touch(n,t),n.value}set(e,t,n=Pt.None){let i=this._map.get(e);if(i)i.value=t,n!==Pt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Pt.None:this.addItemLast(i);break;case Pt.First:this.addItemFirst(i);break;case Pt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(zf=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Pt.First&&t!==Pt.Last)){if(t===Pt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Pt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};gr.LinkedMap=Es;var gc=class extends Es{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Pt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Pt.None)}set(e,t){return super.set(e,t,Pt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};gr.LRUCache=gc});var Gf=x(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});xs.Disposable=void 0;var Bf;(function(r){function e(t){return{dispose:t}}r.create=e})(Bf||(xs.Disposable=Bf={}))});var mr=x(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});var vc;function yc(){if(vc===void 0)throw new Error("No runtime abstraction layer installed");return vc}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");vc=t}r.install=e})(yc||(yc={}));bc.default=yc});var ni=x(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.Emitter=ti.Event=void 0;var Yb=mr(),Xf;(function(r){let e={dispose(){}};r.None=function(){return e}})(Xf||(ti.Event=Xf={}));var wc=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,Yb.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Is=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new wc),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ti.Emitter=Is;Is._noop=function(){}});var Os=x(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.CancellationTokenSource=ri.CancellationToken=void 0;var Zb=mr(),ew=ei(),Cc=ni(),qs;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Cc.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Cc.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||ew.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(qs||(ri.CancellationToken=qs={}));var tw=Object.freeze(function(r,e){let t=(0,Zb.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),Fs=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?tw:(this._emitter||(this._emitter=new Cc.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Rc=class{get token(){return this._token||(this._token=new Fs),this._token}cancel(){this._token?this._token.cancel():this._token=qs.Cancelled}dispose(){this._token?this._token instanceof Fs&&this._token.dispose():this._token=qs.None}};ri.CancellationTokenSource=Rc});var Qf=x(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.SharedArrayReceiverStrategy=ii.SharedArraySenderStrategy=void 0;var nw=Os(),Ni;(function(r){r.Continue=0,r.Cancelled=1})(Ni||(Ni={}));var Sc=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=Ni.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,Ni.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};ii.SharedArraySenderStrategy=Sc;var Dc=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Ni.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},_c=class{constructor(e){this.token=new Dc(e)}cancel(){}dispose(){}},Tc=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new nw.CancellationTokenSource:new _c(t)}};ii.SharedArrayReceiverStrategy=Tc});var kc=x(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.Semaphore=void 0;var rw=mr(),Pc=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,rw.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ls.Semaphore=Pc});var Yf=x(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.ReadableStreamMessageReader=vr.AbstractMessageReader=vr.MessageReader=void 0;var xc=mr(),si=ei(),Ec=ni(),iw=kc(),Jf;(function(r){function e(t){let n=t;return n&&si.func(n.listen)&&si.func(n.dispose)&&si.func(n.onError)&&si.func(n.onClose)&&si.func(n.onPartialMessage)}r.is=e})(Jf||(vr.MessageReader=Jf={}));var Ms=class{constructor(){this.errorEmitter=new Ec.Emitter,this.closeEmitter=new Ec.Emitter,this.partialMessageEmitter=new Ec.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${si.string(e.message)?e.message:"unknown"}`)}};vr.AbstractMessageReader=Ms;var Ic;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,xc.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Ic||(Ic={}));var qc=class extends Ms{constructor(e,t){super(),this.readable=e,this.options=Ic.fromOptions(t),this.buffer=(0,xc.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new iw.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,xc.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};vr.ReadableStreamMessageReader=qc});var rh=x(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.WriteableStreamMessageWriter=yr.AbstractMessageWriter=yr.MessageWriter=void 0;var Zf=mr(),Ai=ei(),sw=kc(),eh=ni(),ow="Content-Length: ",th=`\r
`,nh;(function(r){function e(t){let n=t;return n&&Ai.func(n.dispose)&&Ai.func(n.onClose)&&Ai.func(n.onError)&&Ai.func(n.write)}r.is=e})(nh||(yr.MessageWriter=nh={}));var Ns=class{constructor(){this.errorEmitter=new eh.Emitter,this.closeEmitter=new eh.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Ai.string(e.message)?e.message:"unknown"}`)}};yr.AbstractMessageWriter=Ns;var Fc;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,Zf.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,Zf.default)().applicationJson.encoder}}r.fromOptions=e})(Fc||(Fc={}));var Oc=class extends Ns{constructor(e,t){super(),this.writable=e,this.options=Fc.fromOptions(t),this.errorCount=0,this.writeSemaphore=new sw.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(ow,n.byteLength.toString(),th),i.push(th),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};yr.WriteableStreamMessageWriter=Oc});var ih=x(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.AbstractMessageBuffer=void 0;var aw=13,cw=10,uw=`\r
`,Lc=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case aw:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case cw:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(uw);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let p=c[d],m=p.indexOf(":");if(m===-1)throw new Error(`Message header must separate key and value using ':'
${p}`);let g=p.substr(0,m),R=p.substr(m+1).trim();a.set(e?g.toLowerCase():g,R)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};As.AbstractMessageBuffer=Lc});var uh=x(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.createMessageConnection=oe.ConnectionOptions=oe.MessageStrategy=oe.CancellationStrategy=oe.CancellationSenderStrategy=oe.CancellationReceiverStrategy=oe.RequestCancellationReceiverStrategy=oe.IdCancellationReceiverStrategy=oe.ConnectionStrategy=oe.ConnectionError=oe.ConnectionErrors=oe.LogTraceNotification=oe.SetTraceNotification=oe.TraceFormat=oe.TraceValues=oe.Trace=oe.NullLogger=oe.ProgressType=oe.ProgressToken=void 0;var sh=mr(),Ge=ei(),ee=pc(),oh=mc(),$i=ni(),Mc=Os(),Wi;(function(r){r.type=new ee.NotificationType("$/cancelRequest")})(Wi||(Wi={}));var Nc;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Nc||(oe.ProgressToken=Nc={}));var ji;(function(r){r.type=new ee.NotificationType("$/progress")})(ji||(ji={}));var Ac=class{constructor(){}};oe.ProgressType=Ac;var $c;(function(r){function e(t){return Ge.func(t)}r.is=e})($c||($c={}));oe.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var _e;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(_e||(oe.Trace=_e={}));var ah;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(ah||(oe.TraceValues=ah={}));(function(r){function e(n){if(!Ge.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(_e||(oe.Trace=_e={}));var nn;(function(r){r.Text="text",r.JSON="json"})(nn||(oe.TraceFormat=nn={}));(function(r){function e(t){return Ge.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(nn||(oe.TraceFormat=nn={}));var jc;(function(r){r.type=new ee.NotificationType("$/setTrace")})(jc||(oe.SetTraceNotification=jc={}));var $s;(function(r){r.type=new ee.NotificationType("$/logTrace")})($s||(oe.LogTraceNotification=$s={}));var Ui;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(Ui||(oe.ConnectionErrors=Ui={}));var oi=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};oe.ConnectionError=oi;var Uc;(function(r){function e(t){let n=t;return n&&Ge.func(n.cancelUndispatched)}r.is=e})(Uc||(oe.ConnectionStrategy=Uc={}));var js;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&Ge.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ge.func(n.dispose))}r.is=e})(js||(oe.IdCancellationReceiverStrategy=js={}));var Wc;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&Ge.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ge.func(n.dispose))}r.is=e})(Wc||(oe.RequestCancellationReceiverStrategy=Wc={}));var Us;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Mc.CancellationTokenSource}});function e(t){return js.is(t)||Wc.is(t)}r.is=e})(Us||(oe.CancellationReceiverStrategy=Us={}));var Ws;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(Wi.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&Ge.func(n.sendCancellation)&&Ge.func(n.cleanup)}r.is=e})(Ws||(oe.CancellationSenderStrategy=Ws={}));var Hs;(function(r){r.Message=Object.freeze({receiver:Us.Message,sender:Ws.Message});function e(t){let n=t;return n&&Us.is(n.receiver)&&Ws.is(n.sender)}r.is=e})(Hs||(oe.CancellationStrategy=Hs={}));var Ks;(function(r){function e(t){let n=t;return n&&Ge.func(n.handleMessage)}r.is=e})(Ks||(oe.MessageStrategy=Ks={}));var ch;(function(r){function e(t){let n=t;return n&&(Hs.is(n.cancellationStrategy)||Uc.is(n.connectionStrategy)||Ks.is(n.messageStrategy))}r.is=e})(ch||(oe.ConnectionOptions=ch={}));var Pn;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(Pn||(Pn={}));function dw(r,e,t,n){let i=t!==void 0?t:oe.NullLogger,s=0,o=0,a=0,c="2.0",d,p=new Map,m,g=new Map,R=new Map,y,P=new oh.LinkedMap,k=new Map,M=new Set,N=new Map,A=_e.Off,W=nn.Text,J,pe=Pn.New,X=new $i.Emitter,ne=new $i.Emitter,le=new $i.Emitter,it=new $i.Emitter,Ze=new $i.Emitter,at=n&&n.cancellationStrategy?n.cancellationStrategy:Hs.Message;function dn(w){if(w===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+w.toString()}function Ot(w){return w===null?"res-unknown-"+(++a).toString():"res-"+w.toString()}function bt(){return"not-"+(++o).toString()}function wt(w,q){ee.Message.isRequest(q)?w.set(dn(q.id),q):ee.Message.isResponse(q)?w.set(Ot(q.id),q):w.set(bt(),q)}function Cn(w){}function On(){return pe===Pn.Listening}function Ae(){return pe===Pn.Closed}function Ut(){return pe===Pn.Disposed}function Lt(){(pe===Pn.New||pe===Pn.Listening)&&(pe=Pn.Closed,ne.fire(void 0))}function Ct(w){X.fire([w,void 0,void 0])}function dr(w){X.fire(w)}r.onClose(Lt),r.onError(Ct),e.onClose(Lt),e.onError(dr);function Ln(){y||P.size===0||(y=(0,sh.default)().timer.setImmediate(()=>{y=void 0,Jn()}))}function Mn(w){ee.Message.isRequest(w)?Nn(w):ee.Message.isNotification(w)?Sn(w):ee.Message.isResponse(w)?Rn(w):An(w)}function Jn(){if(P.size===0)return;let w=P.shift();try{let q=n?.messageStrategy;Ks.is(q)?q.handleMessage(w,Mn):Mn(w)}finally{Ln()}}let lr=w=>{try{if(ee.Message.isNotification(w)&&w.method===Wi.type.method){let q=w.params.id,U=dn(q),K=P.get(U);if(ee.Message.isRequest(K)){let be=n?.connectionStrategy,Pe=be&&be.cancelUndispatched?be.cancelUndispatched(K,Cn):void 0;if(Pe&&(Pe.error!==void 0||Pe.result!==void 0)){P.delete(U),N.delete(q),Pe.id=K.id,ln(Pe,w.method,Date.now()),e.write(Pe).catch(()=>i.error("Sending response for canceled message failed."));return}}let Ce=N.get(q);if(Ce!==void 0){Ce.cancel(),fn(w);return}else M.add(q)}wt(P,w)}finally{Ln()}};function Nn(w){if(Ut())return;function q(ue,Se,ge){let Fe={jsonrpc:c,id:w.id};ue instanceof ee.ResponseError?Fe.error=ue.toJson():Fe.result=ue===void 0?null:ue,ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}function U(ue,Se,ge){let Fe={jsonrpc:c,id:w.id,error:ue.toJson()};ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}function K(ue,Se,ge){ue===void 0&&(ue=null);let Fe={jsonrpc:c,id:w.id,result:ue};ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}fr(w);let Ce=p.get(w.method),be,Pe;Ce&&(be=Ce.type,Pe=Ce.handler);let qe=Date.now();if(Pe||d){let ue=w.id??String(Date.now()),Se=js.is(at.receiver)?at.receiver.createCancellationTokenSource(ue):at.receiver.createCancellationTokenSource(w);w.id!==null&&M.has(w.id)&&Se.cancel(),w.id!==null&&N.set(ue,Se);try{let ge;if(Pe)if(w.params===void 0){if(be!==void 0&&be.numberOfParams!==0){U(new ee.ResponseError(ee.ErrorCodes.InvalidParams,`Request ${w.method} defines ${be.numberOfParams} params but received none.`),w.method,qe);return}ge=Pe(Se.token)}else if(Array.isArray(w.params)){if(be!==void 0&&be.parameterStructures===ee.ParameterStructures.byName){U(new ee.ResponseError(ee.ErrorCodes.InvalidParams,`Request ${w.method} defines parameters by name but received parameters by position`),w.method,qe);return}ge=Pe(...w.params,Se.token)}else{if(be!==void 0&&be.parameterStructures===ee.ParameterStructures.byPosition){U(new ee.ResponseError(ee.ErrorCodes.InvalidParams,`Request ${w.method} defines parameters by position but received parameters by name`),w.method,qe);return}ge=Pe(w.params,Se.token)}else d&&(ge=d(w.method,w.params,Se.token));let Fe=ge;ge?Fe.then?Fe.then(et=>{N.delete(ue),q(et,w.method,qe)},et=>{N.delete(ue),et instanceof ee.ResponseError?U(et,w.method,qe):et&&Ge.string(et.message)?U(new ee.ResponseError(ee.ErrorCodes.InternalError,`Request ${w.method} failed with message: ${et.message}`),w.method,qe):U(new ee.ResponseError(ee.ErrorCodes.InternalError,`Request ${w.method} failed unexpectedly without providing any details.`),w.method,qe)}):(N.delete(ue),q(ge,w.method,qe)):(N.delete(ue),K(ge,w.method,qe))}catch(ge){N.delete(ue),ge instanceof ee.ResponseError?q(ge,w.method,qe):ge&&Ge.string(ge.message)?U(new ee.ResponseError(ee.ErrorCodes.InternalError,`Request ${w.method} failed with message: ${ge.message}`),w.method,qe):U(new ee.ResponseError(ee.ErrorCodes.InternalError,`Request ${w.method} failed unexpectedly without providing any details.`),w.method,qe)}}else U(new ee.ResponseError(ee.ErrorCodes.MethodNotFound,`Unhandled method ${w.method}`),w.method,qe)}function Rn(w){if(!Ut())if(w.id===null)w.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(w.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let q=w.id,U=k.get(q);if($n(w,U),U!==void 0){k.delete(q);try{if(w.error){let K=w.error;U.reject(new ee.ResponseError(K.code,K.message,K.data))}else if(w.result!==void 0)U.resolve(w.result);else throw new Error("Should never happen.")}catch(K){K.message?i.error(`Response handler '${U.method}' failed with message: ${K.message}`):i.error(`Response handler '${U.method}' failed unexpectedly.`)}}}}function Sn(w){if(Ut())return;let q,U;if(w.method===Wi.type.method){let K=w.params.id;M.delete(K),fn(w);return}else{let K=g.get(w.method);K&&(U=K.handler,q=K.type)}if(U||m)try{if(fn(w),U)if(w.params===void 0)q!==void 0&&q.numberOfParams!==0&&q.parameterStructures!==ee.ParameterStructures.byName&&i.error(`Notification ${w.method} defines ${q.numberOfParams} params but received none.`),U();else if(Array.isArray(w.params)){let K=w.params;w.method===ji.type.method&&K.length===2&&Nc.is(K[0])?U({token:K[0],value:K[1]}):(q!==void 0&&(q.parameterStructures===ee.ParameterStructures.byName&&i.error(`Notification ${w.method} defines parameters by name but received parameters by position`),q.numberOfParams!==w.params.length&&i.error(`Notification ${w.method} defines ${q.numberOfParams} params but received ${K.length} arguments`)),U(...K))}else q!==void 0&&q.parameterStructures===ee.ParameterStructures.byPosition&&i.error(`Notification ${w.method} defines parameters by position but received parameters by name`),U(w.params);else m&&m(w.method,w.params)}catch(K){K.message?i.error(`Notification handler '${w.method}' failed with message: ${K.message}`):i.error(`Notification handler '${w.method}' failed unexpectedly.`)}else le.fire(w)}function An(w){if(!w){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(w,null,4)}`);let q=w;if(Ge.string(q.id)||Ge.number(q.id)){let U=q.id,K=k.get(U);K&&K.reject(new Error("The received response has neither a result nor an error property."))}}function ct(w){if(w!=null)switch(A){case _e.Verbose:return JSON.stringify(w,null,4);case _e.Compact:return JSON.stringify(w);default:return}}function Yn(w){if(!(A===_e.Off||!J))if(W===nn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&w.params&&(q=`Params: ${ct(w.params)}

`),J.log(`Sending request '${w.method} - (${w.id})'.`,q)}else st("send-request",w)}function Dn(w){if(!(A===_e.Off||!J))if(W===nn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&(w.params?q=`Params: ${ct(w.params)}

`:q=`No parameters provided.

`),J.log(`Sending notification '${w.method}'.`,q)}else st("send-notification",w)}function ln(w,q,U){if(!(A===_e.Off||!J))if(W===nn.Text){let K;(A===_e.Verbose||A===_e.Compact)&&(w.error&&w.error.data?K=`Error data: ${ct(w.error.data)}

`:w.result?K=`Result: ${ct(w.result)}

`:w.error===void 0&&(K=`No result returned.

`)),J.log(`Sending response '${q} - (${w.id})'. Processing request took ${Date.now()-U}ms`,K)}else st("send-response",w)}function fr(w){if(!(A===_e.Off||!J))if(W===nn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&w.params&&(q=`Params: ${ct(w.params)}

`),J.log(`Received request '${w.method} - (${w.id})'.`,q)}else st("receive-request",w)}function fn(w){if(!(A===_e.Off||!J||w.method===$s.type.method))if(W===nn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&(w.params?q=`Params: ${ct(w.params)}

`:q=`No parameters provided.

`),J.log(`Received notification '${w.method}'.`,q)}else st("receive-notification",w)}function $n(w,q){if(!(A===_e.Off||!J))if(W===nn.Text){let U;if((A===_e.Verbose||A===_e.Compact)&&(w.error&&w.error.data?U=`Error data: ${ct(w.error.data)}

`:w.result?U=`Result: ${ct(w.result)}

`:w.error===void 0&&(U=`No result returned.

`)),q){let K=w.error?` Request failed: ${w.error.message} (${w.error.code}).`:"";J.log(`Received response '${q.method} - (${w.id})' in ${Date.now()-q.timerStart}ms.${K}`,U)}else J.log(`Received response ${w.id} without active response promise.`,U)}else st("receive-response",w)}function st(w,q){if(!J||A===_e.Off)return;let U={isLSPMessage:!0,type:w,message:q,timestamp:Date.now()};J.log(U)}function _t(){if(Ae())throw new oi(Ui.Closed,"Connection is closed.");if(Ut())throw new oi(Ui.Disposed,"Connection is disposed.")}function Rt(){if(On())throw new oi(Ui.AlreadyListening,"Connection is already listening")}function en(){if(!On())throw new Error("Call listen() first.")}function Wt(w){return w===void 0?null:w}function jn(w){if(w!==null)return w}function Zn(w){return w!=null&&!Array.isArray(w)&&typeof w=="object"}function _n(w,q){switch(w){case ee.ParameterStructures.auto:return Zn(q)?jn(q):[Wt(q)];case ee.ParameterStructures.byName:if(!Zn(q))throw new Error("Received parameters by name but param is not an object literal.");return jn(q);case ee.ParameterStructures.byPosition:return[Wt(q)];default:throw new Error(`Unknown parameter structure ${w.toString()}`)}}function er(w,q){let U,K=w.numberOfParams;switch(K){case 0:U=void 0;break;case 1:U=_n(w.parameterStructures,q[0]);break;default:U=[];for(let Ce=0;Ce<q.length&&Ce<K;Ce++)U.push(Wt(q[Ce]));if(q.length<K)for(let Ce=q.length;Ce<K;Ce++)U.push(null);break}return U}let Mt={sendNotification:(w,...q)=>{_t();let U,K;if(Ge.string(w)){U=w;let be=q[0],Pe=0,qe=ee.ParameterStructures.auto;ee.ParameterStructures.is(be)&&(Pe=1,qe=be);let ue=q.length,Se=ue-Pe;switch(Se){case 0:K=void 0;break;case 1:K=_n(qe,q[Pe]);break;default:if(qe===ee.ParameterStructures.byName)throw new Error(`Received ${Se} parameters for 'by Name' notification parameter structure.`);K=q.slice(Pe,ue).map(ge=>Wt(ge));break}}else{let be=q;U=w.method,K=er(w,be)}let Ce={jsonrpc:c,method:U,params:K};return Dn(Ce),e.write(Ce).catch(be=>{throw i.error("Sending notification failed."),be})},onNotification:(w,q)=>{_t();let U;return Ge.func(w)?m=w:q&&(Ge.string(w)?(U=w,g.set(w,{type:void 0,handler:q})):(U=w.method,g.set(w.method,{type:w,handler:q}))),{dispose:()=>{U!==void 0?g.delete(U):m=void 0}}},onProgress:(w,q,U)=>{if(R.has(q))throw new Error(`Progress handler for token ${q} already registered`);return R.set(q,U),{dispose:()=>{R.delete(q)}}},sendProgress:(w,q,U)=>Mt.sendNotification(ji.type,{token:q,value:U}),onUnhandledProgress:it.event,sendRequest:(w,...q)=>{_t(),en();let U,K,Ce;if(Ge.string(w)){U=w;let ue=q[0],Se=q[q.length-1],ge=0,Fe=ee.ParameterStructures.auto;ee.ParameterStructures.is(ue)&&(ge=1,Fe=ue);let et=q.length;Mc.CancellationToken.is(Se)&&(et=et-1,Ce=Se);let ht=et-ge;switch(ht){case 0:K=void 0;break;case 1:K=_n(Fe,q[ge]);break;default:if(Fe===ee.ParameterStructures.byName)throw new Error(`Received ${ht} parameters for 'by Name' request parameter structure.`);K=q.slice(ge,et).map(hr=>Wt(hr));break}}else{let ue=q;U=w.method,K=er(w,ue);let Se=w.numberOfParams;Ce=Mc.CancellationToken.is(ue[Se])?ue[Se]:void 0}let be=s++,Pe;Ce&&(Pe=Ce.onCancellationRequested(()=>{let ue=at.sender.sendCancellation(Mt,be);return ue===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${be}`),Promise.resolve()):ue.catch(()=>{i.log(`Sending cancellation messages for id ${be} failed`)})}));let qe={jsonrpc:c,id:be,method:U,params:K};return Yn(qe),typeof at.sender.enableCancellation=="function"&&at.sender.enableCancellation(qe),new Promise(async(ue,Se)=>{let ge=ht=>{ue(ht),at.sender.cleanup(be),Pe?.dispose()},Fe=ht=>{Se(ht),at.sender.cleanup(be),Pe?.dispose()},et={method:U,timerStart:Date.now(),resolve:ge,reject:Fe};try{await e.write(qe),k.set(be,et)}catch(ht){throw i.error("Sending request failed."),et.reject(new ee.ResponseError(ee.ErrorCodes.MessageWriteError,ht.message?ht.message:"Unknown reason")),ht}})},onRequest:(w,q)=>{_t();let U=null;return $c.is(w)?(U=void 0,d=w):Ge.string(w)?(U=null,q!==void 0&&(U=w,p.set(w,{handler:q,type:void 0}))):q!==void 0&&(U=w.method,p.set(w.method,{type:w,handler:q})),{dispose:()=>{U!==null&&(U!==void 0?p.delete(U):d=void 0)}}},hasPendingResponse:()=>k.size>0,trace:async(w,q,U)=>{let K=!1,Ce=nn.Text;U!==void 0&&(Ge.boolean(U)?K=U:(K=U.sendNotification||!1,Ce=U.traceFormat||nn.Text)),A=w,W=Ce,A===_e.Off?J=void 0:J=q,K&&!Ae()&&!Ut()&&await Mt.sendNotification(jc.type,{value:_e.toString(w)})},onError:X.event,onClose:ne.event,onUnhandledNotification:le.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(Ut())return;pe=Pn.Disposed,Ze.fire(void 0);let w=new ee.ResponseError(ee.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let q of k.values())q.reject(w);k=new Map,N=new Map,M=new Set,P=new oh.LinkedMap,Ge.func(e.dispose)&&e.dispose(),Ge.func(r.dispose)&&r.dispose()},listen:()=>{_t(),Rt(),pe=Pn.Listening,r.listen(lr)},inspect:()=>{(0,sh.default)().console.log("inspect")}};return Mt.onNotification($s.type,w=>{if(A===_e.Off||!J)return;let q=A===_e.Verbose||A===_e.Compact;J.log(w.message,q?w.verbose:void 0)}),Mt.onNotification(ji.type,w=>{let q=R.get(w.token);q?q(w.value):it.fire(w)}),Mt}oe.createMessageConnection=dw});var Vs=x(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.ProgressType=I.ProgressToken=I.createMessageConnection=I.NullLogger=I.ConnectionOptions=I.ConnectionStrategy=I.AbstractMessageBuffer=I.WriteableStreamMessageWriter=I.AbstractMessageWriter=I.MessageWriter=I.ReadableStreamMessageReader=I.AbstractMessageReader=I.MessageReader=I.SharedArrayReceiverStrategy=I.SharedArraySenderStrategy=I.CancellationToken=I.CancellationTokenSource=I.Emitter=I.Event=I.Disposable=I.LRUCache=I.Touch=I.LinkedMap=I.ParameterStructures=I.NotificationType9=I.NotificationType8=I.NotificationType7=I.NotificationType6=I.NotificationType5=I.NotificationType4=I.NotificationType3=I.NotificationType2=I.NotificationType1=I.NotificationType0=I.NotificationType=I.ErrorCodes=I.ResponseError=I.RequestType9=I.RequestType8=I.RequestType7=I.RequestType6=I.RequestType5=I.RequestType4=I.RequestType3=I.RequestType2=I.RequestType1=I.RequestType0=I.RequestType=I.Message=I.RAL=void 0;I.MessageStrategy=I.CancellationStrategy=I.CancellationSenderStrategy=I.CancellationReceiverStrategy=I.ConnectionError=I.ConnectionErrors=I.LogTraceNotification=I.SetTraceNotification=I.TraceFormat=I.TraceValues=I.Trace=void 0;var $e=pc();Object.defineProperty(I,"Message",{enumerable:!0,get:function(){return $e.Message}});Object.defineProperty(I,"RequestType",{enumerable:!0,get:function(){return $e.RequestType}});Object.defineProperty(I,"RequestType0",{enumerable:!0,get:function(){return $e.RequestType0}});Object.defineProperty(I,"RequestType1",{enumerable:!0,get:function(){return $e.RequestType1}});Object.defineProperty(I,"RequestType2",{enumerable:!0,get:function(){return $e.RequestType2}});Object.defineProperty(I,"RequestType3",{enumerable:!0,get:function(){return $e.RequestType3}});Object.defineProperty(I,"RequestType4",{enumerable:!0,get:function(){return $e.RequestType4}});Object.defineProperty(I,"RequestType5",{enumerable:!0,get:function(){return $e.RequestType5}});Object.defineProperty(I,"RequestType6",{enumerable:!0,get:function(){return $e.RequestType6}});Object.defineProperty(I,"RequestType7",{enumerable:!0,get:function(){return $e.RequestType7}});Object.defineProperty(I,"RequestType8",{enumerable:!0,get:function(){return $e.RequestType8}});Object.defineProperty(I,"RequestType9",{enumerable:!0,get:function(){return $e.RequestType9}});Object.defineProperty(I,"ResponseError",{enumerable:!0,get:function(){return $e.ResponseError}});Object.defineProperty(I,"ErrorCodes",{enumerable:!0,get:function(){return $e.ErrorCodes}});Object.defineProperty(I,"NotificationType",{enumerable:!0,get:function(){return $e.NotificationType}});Object.defineProperty(I,"NotificationType0",{enumerable:!0,get:function(){return $e.NotificationType0}});Object.defineProperty(I,"NotificationType1",{enumerable:!0,get:function(){return $e.NotificationType1}});Object.defineProperty(I,"NotificationType2",{enumerable:!0,get:function(){return $e.NotificationType2}});Object.defineProperty(I,"NotificationType3",{enumerable:!0,get:function(){return $e.NotificationType3}});Object.defineProperty(I,"NotificationType4",{enumerable:!0,get:function(){return $e.NotificationType4}});Object.defineProperty(I,"NotificationType5",{enumerable:!0,get:function(){return $e.NotificationType5}});Object.defineProperty(I,"NotificationType6",{enumerable:!0,get:function(){return $e.NotificationType6}});Object.defineProperty(I,"NotificationType7",{enumerable:!0,get:function(){return $e.NotificationType7}});Object.defineProperty(I,"NotificationType8",{enumerable:!0,get:function(){return $e.NotificationType8}});Object.defineProperty(I,"NotificationType9",{enumerable:!0,get:function(){return $e.NotificationType9}});Object.defineProperty(I,"ParameterStructures",{enumerable:!0,get:function(){return $e.ParameterStructures}});var Hc=mc();Object.defineProperty(I,"LinkedMap",{enumerable:!0,get:function(){return Hc.LinkedMap}});Object.defineProperty(I,"LRUCache",{enumerable:!0,get:function(){return Hc.LRUCache}});Object.defineProperty(I,"Touch",{enumerable:!0,get:function(){return Hc.Touch}});var lw=Gf();Object.defineProperty(I,"Disposable",{enumerable:!0,get:function(){return lw.Disposable}});var dh=ni();Object.defineProperty(I,"Event",{enumerable:!0,get:function(){return dh.Event}});Object.defineProperty(I,"Emitter",{enumerable:!0,get:function(){return dh.Emitter}});var lh=Os();Object.defineProperty(I,"CancellationTokenSource",{enumerable:!0,get:function(){return lh.CancellationTokenSource}});Object.defineProperty(I,"CancellationToken",{enumerable:!0,get:function(){return lh.CancellationToken}});var fh=Qf();Object.defineProperty(I,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return fh.SharedArraySenderStrategy}});Object.defineProperty(I,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return fh.SharedArrayReceiverStrategy}});var Kc=Yf();Object.defineProperty(I,"MessageReader",{enumerable:!0,get:function(){return Kc.MessageReader}});Object.defineProperty(I,"AbstractMessageReader",{enumerable:!0,get:function(){return Kc.AbstractMessageReader}});Object.defineProperty(I,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Kc.ReadableStreamMessageReader}});var Vc=rh();Object.defineProperty(I,"MessageWriter",{enumerable:!0,get:function(){return Vc.MessageWriter}});Object.defineProperty(I,"AbstractMessageWriter",{enumerable:!0,get:function(){return Vc.AbstractMessageWriter}});Object.defineProperty(I,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Vc.WriteableStreamMessageWriter}});var fw=ih();Object.defineProperty(I,"AbstractMessageBuffer",{enumerable:!0,get:function(){return fw.AbstractMessageBuffer}});var Dt=uh();Object.defineProperty(I,"ConnectionStrategy",{enumerable:!0,get:function(){return Dt.ConnectionStrategy}});Object.defineProperty(I,"ConnectionOptions",{enumerable:!0,get:function(){return Dt.ConnectionOptions}});Object.defineProperty(I,"NullLogger",{enumerable:!0,get:function(){return Dt.NullLogger}});Object.defineProperty(I,"createMessageConnection",{enumerable:!0,get:function(){return Dt.createMessageConnection}});Object.defineProperty(I,"ProgressToken",{enumerable:!0,get:function(){return Dt.ProgressToken}});Object.defineProperty(I,"ProgressType",{enumerable:!0,get:function(){return Dt.ProgressType}});Object.defineProperty(I,"Trace",{enumerable:!0,get:function(){return Dt.Trace}});Object.defineProperty(I,"TraceValues",{enumerable:!0,get:function(){return Dt.TraceValues}});Object.defineProperty(I,"TraceFormat",{enumerable:!0,get:function(){return Dt.TraceFormat}});Object.defineProperty(I,"SetTraceNotification",{enumerable:!0,get:function(){return Dt.SetTraceNotification}});Object.defineProperty(I,"LogTraceNotification",{enumerable:!0,get:function(){return Dt.LogTraceNotification}});Object.defineProperty(I,"ConnectionErrors",{enumerable:!0,get:function(){return Dt.ConnectionErrors}});Object.defineProperty(I,"ConnectionError",{enumerable:!0,get:function(){return Dt.ConnectionError}});Object.defineProperty(I,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Dt.CancellationReceiverStrategy}});Object.defineProperty(I,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Dt.CancellationSenderStrategy}});Object.defineProperty(I,"CancellationStrategy",{enumerable:!0,get:function(){return Dt.CancellationStrategy}});Object.defineProperty(I,"MessageStrategy",{enumerable:!0,get:function(){return Dt.MessageStrategy}});var hw=mr();I.RAL=hw.default});var gh=x(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});var hh=require("util"),tr=Vs(),zs=class r extends tr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new hh.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};zs.emptyBuffer=Buffer.allocUnsafe(0);var zc=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),tr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),tr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),tr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),tr.Disposable.create(()=>this.stream.off("data",e))}},Bc=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),tr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),tr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),tr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},ph=Object.freeze({messageBuffer:Object.freeze({create:r=>new zs(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new hh.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new zc(r),asWritableStream:r=>new Bc(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function Gc(){return ph}(function(r){function e(){tr.RAL.install(ph)}r.install=e})(Gc||(Gc={}));Xc.default=Gc});var $r=x(ye=>{"use strict";var pw=ye&&ye.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),gw=ye&&ye.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&pw(e,r,t)};Object.defineProperty(ye,"__esModule",{value:!0});ye.createMessageConnection=ye.createServerSocketTransport=ye.createClientSocketTransport=ye.createServerPipeTransport=ye.createClientPipeTransport=ye.generateRandomPipeName=ye.StreamMessageWriter=ye.StreamMessageReader=ye.SocketMessageWriter=ye.SocketMessageReader=ye.PortMessageWriter=ye.PortMessageReader=ye.IPCMessageWriter=ye.IPCMessageReader=void 0;var ai=gh();ai.default.install();var mh=require("path"),mw=require("os"),vw=require("crypto"),Xs=require("net"),rn=Vs();gw(Vs(),ye);var Qc=class extends rn.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),rn.Disposable.create(()=>this.process.off("message",e))}};ye.IPCMessageReader=Qc;var Jc=class extends rn.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};ye.IPCMessageWriter=Jc;var Yc=class extends rn.AbstractMessageReader{constructor(e){super(),this.onData=new rn.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};ye.PortMessageReader=Yc;var Zc=class extends rn.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};ye.PortMessageWriter=Zc;var Nr=class extends rn.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,ai.default)().stream.asReadableStream(e),t)}};ye.SocketMessageReader=Nr;var Ar=class extends rn.WriteableStreamMessageWriter{constructor(e,t){super((0,ai.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};ye.SocketMessageWriter=Ar;var Bs=class extends rn.ReadableStreamMessageReader{constructor(e,t){super((0,ai.default)().stream.asReadableStream(e),t)}};ye.StreamMessageReader=Bs;var Gs=class extends rn.WriteableStreamMessageWriter{constructor(e,t){super((0,ai.default)().stream.asWritableStream(e),t)}};ye.StreamMessageWriter=Gs;var vh=process.env.XDG_RUNTIME_DIR,yw=new Map([["linux",107],["darwin",103]]);function bw(){let r=(0,vw.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;vh?e=mh.join(vh,`vscode-ipc-${r}.sock`):e=mh.join(mw.tmpdir(),`vscode-${r}.sock`);let t=yw.get(process.platform);return t!==void 0&&e.length>t&&(0,ai.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}ye.generateRandomPipeName=bw;function ww(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Xs.createServer)(a=>{o.close(),t([new Nr(a,e),new Ar(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}ye.createClientPipeTransport=ww;function Cw(r,e="utf-8"){let t=(0,Xs.createConnection)(r);return[new Nr(t,e),new Ar(t,e)]}ye.createServerPipeTransport=Cw;function Rw(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Xs.createServer)(a=>{o.close(),t([new Nr(a,e),new Ar(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}ye.createClientSocketTransport=Rw;function Sw(r,e="utf-8"){let t=(0,Xs.createConnection)(r,"127.0.0.1");return[new Nr(t,e),new Ar(t,e)]}ye.createServerSocketTransport=Sw;function Dw(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function _w(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function Tw(r,e,t,n){t||(t=rn.NullLogger);let i=Dw(r)?new Bs(r):r,s=_w(e)?new Gs(e):e;return rn.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,rn.createMessageConnection)(i,s,t,n)}ye.createMessageConnection=Tw});var eu=x((R_,yh)=>{"use strict";yh.exports=$r()});var Js=x((bh,Qs)=>{(function(r){if(typeof Qs=="object"&&typeof Qs.exports=="object"){var e=r(require,bh);e!==void 0&&(Qs.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlineCompletionContext=e.SelectedCompletionInfo=e.InlineCompletionTriggerKind=e.InlineCompletionList=e.InlineCompletionItem=e.StringValue=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(h){function C(S){return typeof S=="string"}h.is=C})(t||(e.DocumentUri=t={}));var n;(function(h){function C(S){return typeof S=="string"}h.is=C})(n||(e.URI=n={}));var i;(function(h){h.MIN_VALUE=-2147483648,h.MAX_VALUE=2147483647;function C(S){return typeof S=="number"&&h.MIN_VALUE<=S&&S<=h.MAX_VALUE}h.is=C})(i||(e.integer=i={}));var s;(function(h){h.MIN_VALUE=0,h.MAX_VALUE=2147483647;function C(S){return typeof S=="number"&&h.MIN_VALUE<=S&&S<=h.MAX_VALUE}h.is=C})(s||(e.uinteger=s={}));var o;(function(h){function C(v,l){return v===Number.MAX_VALUE&&(v=s.MAX_VALUE),l===Number.MAX_VALUE&&(l=s.MAX_VALUE),{line:v,character:l}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&_.uinteger(l.line)&&_.uinteger(l.character)}h.is=S})(o||(e.Position=o={}));var a;(function(h){function C(v,l,T,F){if(_.uinteger(v)&&_.uinteger(l)&&_.uinteger(T)&&_.uinteger(F))return{start:o.create(v,l),end:o.create(T,F)};if(o.is(v)&&o.is(l))return{start:v,end:l};throw new Error("Range#create called with invalid arguments[".concat(v,", ").concat(l,", ").concat(T,", ").concat(F,"]"))}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&o.is(l.start)&&o.is(l.end)}h.is=S})(a||(e.Range=a={}));var c;(function(h){function C(v,l){return{uri:v,range:l}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&(_.string(l.uri)||_.undefined(l.uri))}h.is=S})(c||(e.Location=c={}));var d;(function(h){function C(v,l,T,F){return{targetUri:v,targetRange:l,targetSelectionRange:T,originSelectionRange:F}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&a.is(l.targetRange)&&_.string(l.targetUri)&&a.is(l.targetSelectionRange)&&(a.is(l.originSelectionRange)||_.undefined(l.originSelectionRange))}h.is=S})(d||(e.LocationLink=d={}));var p;(function(h){function C(v,l,T,F){return{red:v,green:l,blue:T,alpha:F}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&_.numberRange(l.red,0,1)&&_.numberRange(l.green,0,1)&&_.numberRange(l.blue,0,1)&&_.numberRange(l.alpha,0,1)}h.is=S})(p||(e.Color=p={}));var m;(function(h){function C(v,l){return{range:v,color:l}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&p.is(l.color)}h.is=S})(m||(e.ColorInformation=m={}));var g;(function(h){function C(v,l,T){return{label:v,textEdit:l,additionalTextEdits:T}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&_.string(l.label)&&(_.undefined(l.textEdit)||J.is(l))&&(_.undefined(l.additionalTextEdits)||_.typedArray(l.additionalTextEdits,J.is))}h.is=S})(g||(e.ColorPresentation=g={}));var R;(function(h){h.Comment="comment",h.Imports="imports",h.Region="region"})(R||(e.FoldingRangeKind=R={}));var y;(function(h){function C(v,l,T,F,re,He){var Oe={startLine:v,endLine:l};return _.defined(T)&&(Oe.startCharacter=T),_.defined(F)&&(Oe.endCharacter=F),_.defined(re)&&(Oe.kind=re),_.defined(He)&&(Oe.collapsedText=He),Oe}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&_.uinteger(l.startLine)&&_.uinteger(l.startLine)&&(_.undefined(l.startCharacter)||_.uinteger(l.startCharacter))&&(_.undefined(l.endCharacter)||_.uinteger(l.endCharacter))&&(_.undefined(l.kind)||_.string(l.kind))}h.is=S})(y||(e.FoldingRange=y={}));var P;(function(h){function C(v,l){return{location:v,message:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&c.is(l.location)&&_.string(l.message)}h.is=S})(P||(e.DiagnosticRelatedInformation=P={}));var k;(function(h){h.Error=1,h.Warning=2,h.Information=3,h.Hint=4})(k||(e.DiagnosticSeverity=k={}));var M;(function(h){h.Unnecessary=1,h.Deprecated=2})(M||(e.DiagnosticTag=M={}));var N;(function(h){function C(S){var v=S;return _.objectLiteral(v)&&_.string(v.href)}h.is=C})(N||(e.CodeDescription=N={}));var A;(function(h){function C(v,l,T,F,re,He){var Oe={range:v,message:l};return _.defined(T)&&(Oe.severity=T),_.defined(F)&&(Oe.code=F),_.defined(re)&&(Oe.source=re),_.defined(He)&&(Oe.relatedInformation=He),Oe}h.create=C;function S(v){var l,T=v;return _.defined(T)&&a.is(T.range)&&_.string(T.message)&&(_.number(T.severity)||_.undefined(T.severity))&&(_.integer(T.code)||_.string(T.code)||_.undefined(T.code))&&(_.undefined(T.codeDescription)||_.string((l=T.codeDescription)===null||l===void 0?void 0:l.href))&&(_.string(T.source)||_.undefined(T.source))&&(_.undefined(T.relatedInformation)||_.typedArray(T.relatedInformation,P.is))}h.is=S})(A||(e.Diagnostic=A={}));var W;(function(h){function C(v,l){for(var T=[],F=2;F<arguments.length;F++)T[F-2]=arguments[F];var re={title:v,command:l};return _.defined(T)&&T.length>0&&(re.arguments=T),re}h.create=C;function S(v){var l=v;return _.defined(l)&&_.string(l.title)&&_.string(l.command)}h.is=S})(W||(e.Command=W={}));var J;(function(h){function C(T,F){return{range:T,newText:F}}h.replace=C;function S(T,F){return{range:{start:T,end:T},newText:F}}h.insert=S;function v(T){return{range:T,newText:""}}h.del=v;function l(T){var F=T;return _.objectLiteral(F)&&_.string(F.newText)&&a.is(F.range)}h.is=l})(J||(e.TextEdit=J={}));var pe;(function(h){function C(v,l,T){var F={label:v};return l!==void 0&&(F.needsConfirmation=l),T!==void 0&&(F.description=T),F}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&_.string(l.label)&&(_.boolean(l.needsConfirmation)||l.needsConfirmation===void 0)&&(_.string(l.description)||l.description===void 0)}h.is=S})(pe||(e.ChangeAnnotation=pe={}));var X;(function(h){function C(S){var v=S;return _.string(v)}h.is=C})(X||(e.ChangeAnnotationIdentifier=X={}));var ne;(function(h){function C(T,F,re){return{range:T,newText:F,annotationId:re}}h.replace=C;function S(T,F,re){return{range:{start:T,end:T},newText:F,annotationId:re}}h.insert=S;function v(T,F){return{range:T,newText:"",annotationId:F}}h.del=v;function l(T){var F=T;return J.is(F)&&(pe.is(F.annotationId)||X.is(F.annotationId))}h.is=l})(ne||(e.AnnotatedTextEdit=ne={}));var le;(function(h){function C(v,l){return{textDocument:v,edits:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&Ae.is(l.textDocument)&&Array.isArray(l.edits)}h.is=S})(le||(e.TextDocumentEdit=le={}));var it;(function(h){function C(v,l,T){var F={kind:"create",uri:v};return l!==void 0&&(l.overwrite!==void 0||l.ignoreIfExists!==void 0)&&(F.options=l),T!==void 0&&(F.annotationId=T),F}h.create=C;function S(v){var l=v;return l&&l.kind==="create"&&_.string(l.uri)&&(l.options===void 0||(l.options.overwrite===void 0||_.boolean(l.options.overwrite))&&(l.options.ignoreIfExists===void 0||_.boolean(l.options.ignoreIfExists)))&&(l.annotationId===void 0||X.is(l.annotationId))}h.is=S})(it||(e.CreateFile=it={}));var Ze;(function(h){function C(v,l,T,F){var re={kind:"rename",oldUri:v,newUri:l};return T!==void 0&&(T.overwrite!==void 0||T.ignoreIfExists!==void 0)&&(re.options=T),F!==void 0&&(re.annotationId=F),re}h.create=C;function S(v){var l=v;return l&&l.kind==="rename"&&_.string(l.oldUri)&&_.string(l.newUri)&&(l.options===void 0||(l.options.overwrite===void 0||_.boolean(l.options.overwrite))&&(l.options.ignoreIfExists===void 0||_.boolean(l.options.ignoreIfExists)))&&(l.annotationId===void 0||X.is(l.annotationId))}h.is=S})(Ze||(e.RenameFile=Ze={}));var at;(function(h){function C(v,l,T){var F={kind:"delete",uri:v};return l!==void 0&&(l.recursive!==void 0||l.ignoreIfNotExists!==void 0)&&(F.options=l),T!==void 0&&(F.annotationId=T),F}h.create=C;function S(v){var l=v;return l&&l.kind==="delete"&&_.string(l.uri)&&(l.options===void 0||(l.options.recursive===void 0||_.boolean(l.options.recursive))&&(l.options.ignoreIfNotExists===void 0||_.boolean(l.options.ignoreIfNotExists)))&&(l.annotationId===void 0||X.is(l.annotationId))}h.is=S})(at||(e.DeleteFile=at={}));var dn;(function(h){function C(S){var v=S;return v&&(v.changes!==void 0||v.documentChanges!==void 0)&&(v.documentChanges===void 0||v.documentChanges.every(function(l){return _.string(l.kind)?it.is(l)||Ze.is(l)||at.is(l):le.is(l)}))}h.is=C})(dn||(e.WorkspaceEdit=dn={}));var Ot=function(){function h(C,S){this.edits=C,this.changeAnnotations=S}return h.prototype.insert=function(C,S,v){var l,T;if(v===void 0?l=J.insert(C,S):X.is(v)?(T=v,l=ne.insert(C,S,v)):(this.assertChangeAnnotations(this.changeAnnotations),T=this.changeAnnotations.manage(v),l=ne.insert(C,S,T)),this.edits.push(l),T!==void 0)return T},h.prototype.replace=function(C,S,v){var l,T;if(v===void 0?l=J.replace(C,S):X.is(v)?(T=v,l=ne.replace(C,S,v)):(this.assertChangeAnnotations(this.changeAnnotations),T=this.changeAnnotations.manage(v),l=ne.replace(C,S,T)),this.edits.push(l),T!==void 0)return T},h.prototype.delete=function(C,S){var v,l;if(S===void 0?v=J.del(C):X.is(S)?(l=S,v=ne.del(C,S)):(this.assertChangeAnnotations(this.changeAnnotations),l=this.changeAnnotations.manage(S),v=ne.del(C,l)),this.edits.push(v),l!==void 0)return l},h.prototype.add=function(C){this.edits.push(C)},h.prototype.all=function(){return this.edits},h.prototype.clear=function(){this.edits.splice(0,this.edits.length)},h.prototype.assertChangeAnnotations=function(C){if(C===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},h}(),bt=function(){function h(C){this._annotations=C===void 0?Object.create(null):C,this._counter=0,this._size=0}return h.prototype.all=function(){return this._annotations},Object.defineProperty(h.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),h.prototype.manage=function(C,S){var v;if(X.is(C)?v=C:(v=this.nextId(),S=C),this._annotations[v]!==void 0)throw new Error("Id ".concat(v," is already in use."));if(S===void 0)throw new Error("No annotation provided for id ".concat(v));return this._annotations[v]=S,this._size++,v},h.prototype.nextId=function(){return this._counter++,this._counter.toString()},h}(),wt=function(){function h(C){var S=this;this._textEditChanges=Object.create(null),C!==void 0?(this._workspaceEdit=C,C.documentChanges?(this._changeAnnotations=new bt(C.changeAnnotations),C.changeAnnotations=this._changeAnnotations.all(),C.documentChanges.forEach(function(v){if(le.is(v)){var l=new Ot(v.edits,S._changeAnnotations);S._textEditChanges[v.textDocument.uri]=l}})):C.changes&&Object.keys(C.changes).forEach(function(v){var l=new Ot(C.changes[v]);S._textEditChanges[v]=l})):this._workspaceEdit={}}return Object.defineProperty(h.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),h.prototype.getTextEditChange=function(C){if(Ae.is(C)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var S={uri:C.uri,version:C.version},v=this._textEditChanges[S.uri];if(!v){var l=[],T={textDocument:S,edits:l};this._workspaceEdit.documentChanges.push(T),v=new Ot(l,this._changeAnnotations),this._textEditChanges[S.uri]=v}return v}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var v=this._textEditChanges[C];if(!v){var l=[];this._workspaceEdit.changes[C]=l,v=new Ot(l),this._textEditChanges[C]=v}return v}},h.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new bt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},h.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},h.prototype.createFile=function(C,S,v){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var l;pe.is(S)||X.is(S)?l=S:v=S;var T,F;if(l===void 0?T=it.create(C,v):(F=X.is(l)?l:this._changeAnnotations.manage(l),T=it.create(C,v,F)),this._workspaceEdit.documentChanges.push(T),F!==void 0)return F},h.prototype.renameFile=function(C,S,v,l){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var T;pe.is(v)||X.is(v)?T=v:l=v;var F,re;if(T===void 0?F=Ze.create(C,S,l):(re=X.is(T)?T:this._changeAnnotations.manage(T),F=Ze.create(C,S,l,re)),this._workspaceEdit.documentChanges.push(F),re!==void 0)return re},h.prototype.deleteFile=function(C,S,v){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var l;pe.is(S)||X.is(S)?l=S:v=S;var T,F;if(l===void 0?T=at.create(C,v):(F=X.is(l)?l:this._changeAnnotations.manage(l),T=at.create(C,v,F)),this._workspaceEdit.documentChanges.push(T),F!==void 0)return F},h}();e.WorkspaceChange=wt;var Cn;(function(h){function C(v){return{uri:v}}h.create=C;function S(v){var l=v;return _.defined(l)&&_.string(l.uri)}h.is=S})(Cn||(e.TextDocumentIdentifier=Cn={}));var On;(function(h){function C(v,l){return{uri:v,version:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&_.string(l.uri)&&_.integer(l.version)}h.is=S})(On||(e.VersionedTextDocumentIdentifier=On={}));var Ae;(function(h){function C(v,l){return{uri:v,version:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&_.string(l.uri)&&(l.version===null||_.integer(l.version))}h.is=S})(Ae||(e.OptionalVersionedTextDocumentIdentifier=Ae={}));var Ut;(function(h){function C(v,l,T,F){return{uri:v,languageId:l,version:T,text:F}}h.create=C;function S(v){var l=v;return _.defined(l)&&_.string(l.uri)&&_.string(l.languageId)&&_.integer(l.version)&&_.string(l.text)}h.is=S})(Ut||(e.TextDocumentItem=Ut={}));var Lt;(function(h){h.PlainText="plaintext",h.Markdown="markdown";function C(S){var v=S;return v===h.PlainText||v===h.Markdown}h.is=C})(Lt||(e.MarkupKind=Lt={}));var Ct;(function(h){function C(S){var v=S;return _.objectLiteral(S)&&Lt.is(v.kind)&&_.string(v.value)}h.is=C})(Ct||(e.MarkupContent=Ct={}));var dr;(function(h){h.Text=1,h.Method=2,h.Function=3,h.Constructor=4,h.Field=5,h.Variable=6,h.Class=7,h.Interface=8,h.Module=9,h.Property=10,h.Unit=11,h.Value=12,h.Enum=13,h.Keyword=14,h.Snippet=15,h.Color=16,h.File=17,h.Reference=18,h.Folder=19,h.EnumMember=20,h.Constant=21,h.Struct=22,h.Event=23,h.Operator=24,h.TypeParameter=25})(dr||(e.CompletionItemKind=dr={}));var Ln;(function(h){h.PlainText=1,h.Snippet=2})(Ln||(e.InsertTextFormat=Ln={}));var Mn;(function(h){h.Deprecated=1})(Mn||(e.CompletionItemTag=Mn={}));var Jn;(function(h){function C(v,l,T){return{newText:v,insert:l,replace:T}}h.create=C;function S(v){var l=v;return l&&_.string(l.newText)&&a.is(l.insert)&&a.is(l.replace)}h.is=S})(Jn||(e.InsertReplaceEdit=Jn={}));var lr;(function(h){h.asIs=1,h.adjustIndentation=2})(lr||(e.InsertTextMode=lr={}));var Nn;(function(h){function C(S){var v=S;return v&&(_.string(v.detail)||v.detail===void 0)&&(_.string(v.description)||v.description===void 0)}h.is=C})(Nn||(e.CompletionItemLabelDetails=Nn={}));var Rn;(function(h){function C(S){return{label:S}}h.create=C})(Rn||(e.CompletionItem=Rn={}));var Sn;(function(h){function C(S,v){return{items:S||[],isIncomplete:!!v}}h.create=C})(Sn||(e.CompletionList=Sn={}));var An;(function(h){function C(v){return v.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}h.fromPlainText=C;function S(v){var l=v;return _.string(l)||_.objectLiteral(l)&&_.string(l.language)&&_.string(l.value)}h.is=S})(An||(e.MarkedString=An={}));var ct;(function(h){function C(S){var v=S;return!!v&&_.objectLiteral(v)&&(Ct.is(v.contents)||An.is(v.contents)||_.typedArray(v.contents,An.is))&&(S.range===void 0||a.is(S.range))}h.is=C})(ct||(e.Hover=ct={}));var Yn;(function(h){function C(S,v){return v?{label:S,documentation:v}:{label:S}}h.create=C})(Yn||(e.ParameterInformation=Yn={}));var Dn;(function(h){function C(S,v){for(var l=[],T=2;T<arguments.length;T++)l[T-2]=arguments[T];var F={label:S};return _.defined(v)&&(F.documentation=v),_.defined(l)?F.parameters=l:F.parameters=[],F}h.create=C})(Dn||(e.SignatureInformation=Dn={}));var ln;(function(h){h.Text=1,h.Read=2,h.Write=3})(ln||(e.DocumentHighlightKind=ln={}));var fr;(function(h){function C(S,v){var l={range:S};return _.number(v)&&(l.kind=v),l}h.create=C})(fr||(e.DocumentHighlight=fr={}));var fn;(function(h){h.File=1,h.Module=2,h.Namespace=3,h.Package=4,h.Class=5,h.Method=6,h.Property=7,h.Field=8,h.Constructor=9,h.Enum=10,h.Interface=11,h.Function=12,h.Variable=13,h.Constant=14,h.String=15,h.Number=16,h.Boolean=17,h.Array=18,h.Object=19,h.Key=20,h.Null=21,h.EnumMember=22,h.Struct=23,h.Event=24,h.Operator=25,h.TypeParameter=26})(fn||(e.SymbolKind=fn={}));var $n;(function(h){h.Deprecated=1})($n||(e.SymbolTag=$n={}));var st;(function(h){function C(S,v,l,T,F){var re={name:S,kind:v,location:{uri:T,range:l}};return F&&(re.containerName=F),re}h.create=C})(st||(e.SymbolInformation=st={}));var _t;(function(h){function C(S,v,l,T){return T!==void 0?{name:S,kind:v,location:{uri:l,range:T}}:{name:S,kind:v,location:{uri:l}}}h.create=C})(_t||(e.WorkspaceSymbol=_t={}));var Rt;(function(h){function C(v,l,T,F,re,He){var Oe={name:v,detail:l,kind:T,range:F,selectionRange:re};return He!==void 0&&(Oe.children=He),Oe}h.create=C;function S(v){var l=v;return l&&_.string(l.name)&&_.number(l.kind)&&a.is(l.range)&&a.is(l.selectionRange)&&(l.detail===void 0||_.string(l.detail))&&(l.deprecated===void 0||_.boolean(l.deprecated))&&(l.children===void 0||Array.isArray(l.children))&&(l.tags===void 0||Array.isArray(l.tags))}h.is=S})(Rt||(e.DocumentSymbol=Rt={}));var en;(function(h){h.Empty="",h.QuickFix="quickfix",h.Refactor="refactor",h.RefactorExtract="refactor.extract",h.RefactorInline="refactor.inline",h.RefactorRewrite="refactor.rewrite",h.Source="source",h.SourceOrganizeImports="source.organizeImports",h.SourceFixAll="source.fixAll"})(en||(e.CodeActionKind=en={}));var Wt;(function(h){h.Invoked=1,h.Automatic=2})(Wt||(e.CodeActionTriggerKind=Wt={}));var jn;(function(h){function C(v,l,T){var F={diagnostics:v};return l!=null&&(F.only=l),T!=null&&(F.triggerKind=T),F}h.create=C;function S(v){var l=v;return _.defined(l)&&_.typedArray(l.diagnostics,A.is)&&(l.only===void 0||_.typedArray(l.only,_.string))&&(l.triggerKind===void 0||l.triggerKind===Wt.Invoked||l.triggerKind===Wt.Automatic)}h.is=S})(jn||(e.CodeActionContext=jn={}));var Zn;(function(h){function C(v,l,T){var F={title:v},re=!0;return typeof l=="string"?(re=!1,F.kind=l):W.is(l)?F.command=l:F.edit=l,re&&T!==void 0&&(F.kind=T),F}h.create=C;function S(v){var l=v;return l&&_.string(l.title)&&(l.diagnostics===void 0||_.typedArray(l.diagnostics,A.is))&&(l.kind===void 0||_.string(l.kind))&&(l.edit!==void 0||l.command!==void 0)&&(l.command===void 0||W.is(l.command))&&(l.isPreferred===void 0||_.boolean(l.isPreferred))&&(l.edit===void 0||dn.is(l.edit))}h.is=S})(Zn||(e.CodeAction=Zn={}));var _n;(function(h){function C(v,l){var T={range:v};return _.defined(l)&&(T.data=l),T}h.create=C;function S(v){var l=v;return _.defined(l)&&a.is(l.range)&&(_.undefined(l.command)||W.is(l.command))}h.is=S})(_n||(e.CodeLens=_n={}));var er;(function(h){function C(v,l){return{tabSize:v,insertSpaces:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&_.uinteger(l.tabSize)&&_.boolean(l.insertSpaces)}h.is=S})(er||(e.FormattingOptions=er={}));var Mt;(function(h){function C(v,l,T){return{range:v,target:l,data:T}}h.create=C;function S(v){var l=v;return _.defined(l)&&a.is(l.range)&&(_.undefined(l.target)||_.string(l.target))}h.is=S})(Mt||(e.DocumentLink=Mt={}));var w;(function(h){function C(v,l){return{range:v,parent:l}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&(l.parent===void 0||h.is(l.parent))}h.is=S})(w||(e.SelectionRange=w={}));var q;(function(h){h.namespace="namespace",h.type="type",h.class="class",h.enum="enum",h.interface="interface",h.struct="struct",h.typeParameter="typeParameter",h.parameter="parameter",h.variable="variable",h.property="property",h.enumMember="enumMember",h.event="event",h.function="function",h.method="method",h.macro="macro",h.keyword="keyword",h.modifier="modifier",h.comment="comment",h.string="string",h.number="number",h.regexp="regexp",h.operator="operator",h.decorator="decorator"})(q||(e.SemanticTokenTypes=q={}));var U;(function(h){h.declaration="declaration",h.definition="definition",h.readonly="readonly",h.static="static",h.deprecated="deprecated",h.abstract="abstract",h.async="async",h.modification="modification",h.documentation="documentation",h.defaultLibrary="defaultLibrary"})(U||(e.SemanticTokenModifiers=U={}));var K;(function(h){function C(S){var v=S;return _.objectLiteral(v)&&(v.resultId===void 0||typeof v.resultId=="string")&&Array.isArray(v.data)&&(v.data.length===0||typeof v.data[0]=="number")}h.is=C})(K||(e.SemanticTokens=K={}));var Ce;(function(h){function C(v,l){return{range:v,text:l}}h.create=C;function S(v){var l=v;return l!=null&&a.is(l.range)&&_.string(l.text)}h.is=S})(Ce||(e.InlineValueText=Ce={}));var be;(function(h){function C(v,l,T){return{range:v,variableName:l,caseSensitiveLookup:T}}h.create=C;function S(v){var l=v;return l!=null&&a.is(l.range)&&_.boolean(l.caseSensitiveLookup)&&(_.string(l.variableName)||l.variableName===void 0)}h.is=S})(be||(e.InlineValueVariableLookup=be={}));var Pe;(function(h){function C(v,l){return{range:v,expression:l}}h.create=C;function S(v){var l=v;return l!=null&&a.is(l.range)&&(_.string(l.expression)||l.expression===void 0)}h.is=S})(Pe||(e.InlineValueEvaluatableExpression=Pe={}));var qe;(function(h){function C(v,l){return{frameId:v,stoppedLocation:l}}h.create=C;function S(v){var l=v;return _.defined(l)&&a.is(v.stoppedLocation)}h.is=S})(qe||(e.InlineValueContext=qe={}));var ue;(function(h){h.Type=1,h.Parameter=2;function C(S){return S===1||S===2}h.is=C})(ue||(e.InlayHintKind=ue={}));var Se;(function(h){function C(v){return{value:v}}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&(l.tooltip===void 0||_.string(l.tooltip)||Ct.is(l.tooltip))&&(l.location===void 0||c.is(l.location))&&(l.command===void 0||W.is(l.command))}h.is=S})(Se||(e.InlayHintLabelPart=Se={}));var ge;(function(h){function C(v,l,T){var F={position:v,label:l};return T!==void 0&&(F.kind=T),F}h.create=C;function S(v){var l=v;return _.objectLiteral(l)&&o.is(l.position)&&(_.string(l.label)||_.typedArray(l.label,Se.is))&&(l.kind===void 0||ue.is(l.kind))&&l.textEdits===void 0||_.typedArray(l.textEdits,J.is)&&(l.tooltip===void 0||_.string(l.tooltip)||Ct.is(l.tooltip))&&(l.paddingLeft===void 0||_.boolean(l.paddingLeft))&&(l.paddingRight===void 0||_.boolean(l.paddingRight))}h.is=S})(ge||(e.InlayHint=ge={}));var Fe;(function(h){function C(S){return{kind:"snippet",value:S}}h.createSnippet=C})(Fe||(e.StringValue=Fe={}));var et;(function(h){function C(S,v,l,T){return{insertText:S,filterText:v,range:l,command:T}}h.create=C})(et||(e.InlineCompletionItem=et={}));var ht;(function(h){function C(S){return{items:S}}h.create=C})(ht||(e.InlineCompletionList=ht={}));var hr;(function(h){h.Invoked=0,h.Automatic=1})(hr||(e.InlineCompletionTriggerKind=hr={}));var pr;(function(h){function C(S,v){return{range:S,text:v}}h.create=C})(pr||(e.SelectedCompletionInfo=pr={}));var f;(function(h){function C(S,v){return{triggerKind:S,selectedCompletionInfo:v}}h.create=C})(f||(e.InlineCompletionContext=f={}));var E;(function(h){function C(S){var v=S;return _.objectLiteral(v)&&n.is(v.uri)&&_.string(v.name)}h.is=C})(E||(e.WorkspaceFolder=E={})),e.EOL=[`
`,`\r
`,"\r"];var G;(function(h){function C(T,F,re,He){return new De(T,F,re,He)}h.create=C;function S(T){var F=T;return!!(_.defined(F)&&_.string(F.uri)&&(_.undefined(F.languageId)||_.string(F.languageId))&&_.uinteger(F.lineCount)&&_.func(F.getText)&&_.func(F.positionAt)&&_.func(F.offsetAt))}h.is=S;function v(T,F){for(var re=T.getText(),He=l(F,function(Un,u){var D=Un.range.start.line-u.range.start.line;return D===0?Un.range.start.character-u.range.start.character:D}),Oe=re.length,Ht=He.length-1;Ht>=0;Ht--){var tn=He[Ht],Tn=T.offsetAt(tn.range.start),he=T.offsetAt(tn.range.end);if(he<=Oe)re=re.substring(0,Tn)+tn.newText+re.substring(he,re.length);else throw new Error("Overlapping edit");Oe=Tn}return re}h.applyEdits=v;function l(T,F){if(T.length<=1)return T;var re=T.length/2|0,He=T.slice(0,re),Oe=T.slice(re);l(He,F),l(Oe,F);for(var Ht=0,tn=0,Tn=0;Ht<He.length&&tn<Oe.length;){var he=F(He[Ht],Oe[tn]);he<=0?T[Tn++]=He[Ht++]:T[Tn++]=Oe[tn++]}for(;Ht<He.length;)T[Tn++]=He[Ht++];for(;tn<Oe.length;)T[Tn++]=Oe[tn++];return T}})(G||(e.TextDocument=G={}));var De=function(){function h(C,S,v,l){this._uri=C,this._languageId=S,this._version=v,this._content=l,this._lineOffsets=void 0}return Object.defineProperty(h.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),h.prototype.getText=function(C){if(C){var S=this.offsetAt(C.start),v=this.offsetAt(C.end);return this._content.substring(S,v)}return this._content},h.prototype.update=function(C,S){this._content=C.text,this._version=S,this._lineOffsets=void 0},h.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var C=[],S=this._content,v=!0,l=0;l<S.length;l++){v&&(C.push(l),v=!1);var T=S.charAt(l);v=T==="\r"||T===`
`,T==="\r"&&l+1<S.length&&S.charAt(l+1)===`
`&&l++}v&&S.length>0&&C.push(S.length),this._lineOffsets=C}return this._lineOffsets},h.prototype.positionAt=function(C){C=Math.max(Math.min(C,this._content.length),0);var S=this.getLineOffsets(),v=0,l=S.length;if(l===0)return o.create(0,C);for(;v<l;){var T=Math.floor((v+l)/2);S[T]>C?l=T:v=T+1}var F=v-1;return o.create(F,C-S[F])},h.prototype.offsetAt=function(C){var S=this.getLineOffsets();if(C.line>=S.length)return this._content.length;if(C.line<0)return 0;var v=S[C.line],l=C.line+1<S.length?S[C.line+1]:this._content.length;return Math.max(Math.min(v+C.character,l),v)},Object.defineProperty(h.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),h}(),_;(function(h){var C=Object.prototype.toString;function S(he){return typeof he<"u"}h.defined=S;function v(he){return typeof he>"u"}h.undefined=v;function l(he){return he===!0||he===!1}h.boolean=l;function T(he){return C.call(he)==="[object String]"}h.string=T;function F(he){return C.call(he)==="[object Number]"}h.number=F;function re(he,Un,u){return C.call(he)==="[object Number]"&&Un<=he&&he<=u}h.numberRange=re;function He(he){return C.call(he)==="[object Number]"&&-2147483648<=he&&he<=2147483647}h.integer=He;function Oe(he){return C.call(he)==="[object Number]"&&0<=he&&he<=2147483647}h.uinteger=Oe;function Ht(he){return C.call(he)==="[object Function]"}h.func=Ht;function tn(he){return he!==null&&typeof he=="object"}h.objectLiteral=tn;function Tn(he,Un){return Array.isArray(he)&&he.every(Un)}h.typedArray=Tn})(_||(_={}))})});var Ke=x(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.ProtocolNotificationType=Vt.ProtocolNotificationType0=Vt.ProtocolRequestType=Vt.ProtocolRequestType0=Vt.RegistrationType=Vt.MessageDirection=void 0;var ci=$r(),wh;(function(r){r.clientToServer="clientToServer",r.serverToClient="serverToClient",r.both="both"})(wh||(Vt.MessageDirection=wh={}));var tu=class{constructor(e){this.method=e}};Vt.RegistrationType=tu;var nu=class extends ci.RequestType0{constructor(e){super(e)}};Vt.ProtocolRequestType0=nu;var ru=class extends ci.RequestType{constructor(e){super(e,ci.ParameterStructures.byName)}};Vt.ProtocolRequestType=ru;var iu=class extends ci.NotificationType0{constructor(e){super(e)}};Vt.ProtocolNotificationType0=iu;var su=class extends ci.NotificationType{constructor(e){super(e,ci.ParameterStructures.byName)}};Vt.ProtocolNotificationType=su});var Ys=x(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.objectLiteral=ut.typedArray=ut.stringArray=ut.array=ut.func=ut.error=ut.number=ut.string=ut.boolean=void 0;function Pw(r){return r===!0||r===!1}ut.boolean=Pw;function Ch(r){return typeof r=="string"||r instanceof String}ut.string=Ch;function kw(r){return typeof r=="number"||r instanceof Number}ut.number=kw;function Ew(r){return r instanceof Error}ut.error=Ew;function xw(r){return typeof r=="function"}ut.func=xw;function Rh(r){return Array.isArray(r)}ut.array=Rh;function Iw(r){return Rh(r)&&r.every(e=>Ch(e))}ut.stringArray=Iw;function qw(r,e){return Array.isArray(r)&&r.every(e)}ut.typedArray=qw;function Fw(r){return r!==null&&typeof r=="object"}ut.objectLiteral=Fw});var _h=x(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.ImplementationRequest=void 0;var Sh=Ke(),Dh;(function(r){r.method="textDocument/implementation",r.messageDirection=Sh.MessageDirection.clientToServer,r.type=new Sh.ProtocolRequestType(r.method)})(Dh||(Zs.ImplementationRequest=Dh={}))});var kh=x(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.TypeDefinitionRequest=void 0;var Th=Ke(),Ph;(function(r){r.method="textDocument/typeDefinition",r.messageDirection=Th.MessageDirection.clientToServer,r.type=new Th.ProtocolRequestType(r.method)})(Ph||(eo.TypeDefinitionRequest=Ph={}))});var Ih=x(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.DidChangeWorkspaceFoldersNotification=ui.WorkspaceFoldersRequest=void 0;var to=Ke(),Eh;(function(r){r.method="workspace/workspaceFolders",r.messageDirection=to.MessageDirection.serverToClient,r.type=new to.ProtocolRequestType0(r.method)})(Eh||(ui.WorkspaceFoldersRequest=Eh={}));var xh;(function(r){r.method="workspace/didChangeWorkspaceFolders",r.messageDirection=to.MessageDirection.clientToServer,r.type=new to.ProtocolNotificationType(r.method)})(xh||(ui.DidChangeWorkspaceFoldersNotification=xh={}))});var Oh=x(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.ConfigurationRequest=void 0;var qh=Ke(),Fh;(function(r){r.method="workspace/configuration",r.messageDirection=qh.MessageDirection.serverToClient,r.type=new qh.ProtocolRequestType(r.method)})(Fh||(no.ConfigurationRequest=Fh={}))});var Nh=x(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.ColorPresentationRequest=di.DocumentColorRequest=void 0;var ro=Ke(),Lh;(function(r){r.method="textDocument/documentColor",r.messageDirection=ro.MessageDirection.clientToServer,r.type=new ro.ProtocolRequestType(r.method)})(Lh||(di.DocumentColorRequest=Lh={}));var Mh;(function(r){r.method="textDocument/colorPresentation",r.messageDirection=ro.MessageDirection.clientToServer,r.type=new ro.ProtocolRequestType(r.method)})(Mh||(di.ColorPresentationRequest=Mh={}))});var jh=x(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.FoldingRangeRefreshRequest=li.FoldingRangeRequest=void 0;var io=Ke(),Ah;(function(r){r.method="textDocument/foldingRange",r.messageDirection=io.MessageDirection.clientToServer,r.type=new io.ProtocolRequestType(r.method)})(Ah||(li.FoldingRangeRequest=Ah={}));var $h;(function(r){r.method="workspace/foldingRange/refresh",r.messageDirection=io.MessageDirection.serverToClient,r.type=new io.ProtocolRequestType0(r.method)})($h||(li.FoldingRangeRefreshRequest=$h={}))});var Hh=x(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.DeclarationRequest=void 0;var Uh=Ke(),Wh;(function(r){r.method="textDocument/declaration",r.messageDirection=Uh.MessageDirection.clientToServer,r.type=new Uh.ProtocolRequestType(r.method)})(Wh||(so.DeclarationRequest=Wh={}))});var zh=x(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.SelectionRangeRequest=void 0;var Kh=Ke(),Vh;(function(r){r.method="textDocument/selectionRange",r.messageDirection=Kh.MessageDirection.clientToServer,r.type=new Kh.ProtocolRequestType(r.method)})(Vh||(oo.SelectionRangeRequest=Vh={}))});var Qh=x(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.WorkDoneProgressCancelNotification=br.WorkDoneProgressCreateRequest=br.WorkDoneProgress=void 0;var Ow=$r(),ao=Ke(),Bh;(function(r){r.type=new Ow.ProgressType;function e(t){return t===r.type}r.is=e})(Bh||(br.WorkDoneProgress=Bh={}));var Gh;(function(r){r.method="window/workDoneProgress/create",r.messageDirection=ao.MessageDirection.serverToClient,r.type=new ao.ProtocolRequestType(r.method)})(Gh||(br.WorkDoneProgressCreateRequest=Gh={}));var Xh;(function(r){r.method="window/workDoneProgress/cancel",r.messageDirection=ao.MessageDirection.clientToServer,r.type=new ao.ProtocolNotificationType(r.method)})(Xh||(br.WorkDoneProgressCancelNotification=Xh={}))});var ep=x(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.CallHierarchyOutgoingCallsRequest=wr.CallHierarchyIncomingCallsRequest=wr.CallHierarchyPrepareRequest=void 0;var fi=Ke(),Jh;(function(r){r.method="textDocument/prepareCallHierarchy",r.messageDirection=fi.MessageDirection.clientToServer,r.type=new fi.ProtocolRequestType(r.method)})(Jh||(wr.CallHierarchyPrepareRequest=Jh={}));var Yh;(function(r){r.method="callHierarchy/incomingCalls",r.messageDirection=fi.MessageDirection.clientToServer,r.type=new fi.ProtocolRequestType(r.method)})(Yh||(wr.CallHierarchyIncomingCallsRequest=Yh={}));var Zh;(function(r){r.method="callHierarchy/outgoingCalls",r.messageDirection=fi.MessageDirection.clientToServer,r.type=new fi.ProtocolRequestType(r.method)})(Zh||(wr.CallHierarchyOutgoingCallsRequest=Zh={}))});var op=x(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.SemanticTokensRefreshRequest=zt.SemanticTokensRangeRequest=zt.SemanticTokensDeltaRequest=zt.SemanticTokensRequest=zt.SemanticTokensRegistrationType=zt.TokenFormat=void 0;var nr=Ke(),tp;(function(r){r.Relative="relative"})(tp||(zt.TokenFormat=tp={}));var Hi;(function(r){r.method="textDocument/semanticTokens",r.type=new nr.RegistrationType(r.method)})(Hi||(zt.SemanticTokensRegistrationType=Hi={}));var np;(function(r){r.method="textDocument/semanticTokens/full",r.messageDirection=nr.MessageDirection.clientToServer,r.type=new nr.ProtocolRequestType(r.method),r.registrationMethod=Hi.method})(np||(zt.SemanticTokensRequest=np={}));var rp;(function(r){r.method="textDocument/semanticTokens/full/delta",r.messageDirection=nr.MessageDirection.clientToServer,r.type=new nr.ProtocolRequestType(r.method),r.registrationMethod=Hi.method})(rp||(zt.SemanticTokensDeltaRequest=rp={}));var ip;(function(r){r.method="textDocument/semanticTokens/range",r.messageDirection=nr.MessageDirection.clientToServer,r.type=new nr.ProtocolRequestType(r.method),r.registrationMethod=Hi.method})(ip||(zt.SemanticTokensRangeRequest=ip={}));var sp;(function(r){r.method="workspace/semanticTokens/refresh",r.messageDirection=nr.MessageDirection.serverToClient,r.type=new nr.ProtocolRequestType0(r.method)})(sp||(zt.SemanticTokensRefreshRequest=sp={}))});var up=x(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.ShowDocumentRequest=void 0;var ap=Ke(),cp;(function(r){r.method="window/showDocument",r.messageDirection=ap.MessageDirection.serverToClient,r.type=new ap.ProtocolRequestType(r.method)})(cp||(co.ShowDocumentRequest=cp={}))});var fp=x(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.LinkedEditingRangeRequest=void 0;var dp=Ke(),lp;(function(r){r.method="textDocument/linkedEditingRange",r.messageDirection=dp.MessageDirection.clientToServer,r.type=new dp.ProtocolRequestType(r.method)})(lp||(uo.LinkedEditingRangeRequest=lp={}))});var wp=x(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.WillDeleteFilesRequest=kt.DidDeleteFilesNotification=kt.DidRenameFilesNotification=kt.WillRenameFilesRequest=kt.DidCreateFilesNotification=kt.WillCreateFilesRequest=kt.FileOperationPatternKind=void 0;var pn=Ke(),hp;(function(r){r.file="file",r.folder="folder"})(hp||(kt.FileOperationPatternKind=hp={}));var pp;(function(r){r.method="workspace/willCreateFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(pp||(kt.WillCreateFilesRequest=pp={}));var gp;(function(r){r.method="workspace/didCreateFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(gp||(kt.DidCreateFilesNotification=gp={}));var mp;(function(r){r.method="workspace/willRenameFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(mp||(kt.WillRenameFilesRequest=mp={}));var vp;(function(r){r.method="workspace/didRenameFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(vp||(kt.DidRenameFilesNotification=vp={}));var yp;(function(r){r.method="workspace/didDeleteFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(yp||(kt.DidDeleteFilesNotification=yp={}));var bp;(function(r){r.method="workspace/willDeleteFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(bp||(kt.WillDeleteFilesRequest=bp={}))});var _p=x(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.MonikerRequest=Cr.MonikerKind=Cr.UniquenessLevel=void 0;var Cp=Ke(),Rp;(function(r){r.document="document",r.project="project",r.group="group",r.scheme="scheme",r.global="global"})(Rp||(Cr.UniquenessLevel=Rp={}));var Sp;(function(r){r.$import="import",r.$export="export",r.local="local"})(Sp||(Cr.MonikerKind=Sp={}));var Dp;(function(r){r.method="textDocument/moniker",r.messageDirection=Cp.MessageDirection.clientToServer,r.type=new Cp.ProtocolRequestType(r.method)})(Dp||(Cr.MonikerRequest=Dp={}))});var Ep=x(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.TypeHierarchySubtypesRequest=Rr.TypeHierarchySupertypesRequest=Rr.TypeHierarchyPrepareRequest=void 0;var hi=Ke(),Tp;(function(r){r.method="textDocument/prepareTypeHierarchy",r.messageDirection=hi.MessageDirection.clientToServer,r.type=new hi.ProtocolRequestType(r.method)})(Tp||(Rr.TypeHierarchyPrepareRequest=Tp={}));var Pp;(function(r){r.method="typeHierarchy/supertypes",r.messageDirection=hi.MessageDirection.clientToServer,r.type=new hi.ProtocolRequestType(r.method)})(Pp||(Rr.TypeHierarchySupertypesRequest=Pp={}));var kp;(function(r){r.method="typeHierarchy/subtypes",r.messageDirection=hi.MessageDirection.clientToServer,r.type=new hi.ProtocolRequestType(r.method)})(kp||(Rr.TypeHierarchySubtypesRequest=kp={}))});var qp=x(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.InlineValueRefreshRequest=pi.InlineValueRequest=void 0;var lo=Ke(),xp;(function(r){r.method="textDocument/inlineValue",r.messageDirection=lo.MessageDirection.clientToServer,r.type=new lo.ProtocolRequestType(r.method)})(xp||(pi.InlineValueRequest=xp={}));var Ip;(function(r){r.method="workspace/inlineValue/refresh",r.messageDirection=lo.MessageDirection.serverToClient,r.type=new lo.ProtocolRequestType0(r.method)})(Ip||(pi.InlineValueRefreshRequest=Ip={}))});var Mp=x(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.InlayHintRefreshRequest=Sr.InlayHintResolveRequest=Sr.InlayHintRequest=void 0;var gi=Ke(),Fp;(function(r){r.method="textDocument/inlayHint",r.messageDirection=gi.MessageDirection.clientToServer,r.type=new gi.ProtocolRequestType(r.method)})(Fp||(Sr.InlayHintRequest=Fp={}));var Op;(function(r){r.method="inlayHint/resolve",r.messageDirection=gi.MessageDirection.clientToServer,r.type=new gi.ProtocolRequestType(r.method)})(Op||(Sr.InlayHintResolveRequest=Op={}));var Lp;(function(r){r.method="workspace/inlayHint/refresh",r.messageDirection=gi.MessageDirection.serverToClient,r.type=new gi.ProtocolRequestType0(r.method)})(Lp||(Sr.InlayHintRefreshRequest=Lp={}))});var Hp=x(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.DiagnosticRefreshRequest=gn.WorkspaceDiagnosticRequest=gn.DocumentDiagnosticRequest=gn.DocumentDiagnosticReportKind=gn.DiagnosticServerCancellationData=void 0;var Wp=$r(),Lw=Ys(),mi=Ke(),Np;(function(r){function e(t){let n=t;return n&&Lw.boolean(n.retriggerRequest)}r.is=e})(Np||(gn.DiagnosticServerCancellationData=Np={}));var Ap;(function(r){r.Full="full",r.Unchanged="unchanged"})(Ap||(gn.DocumentDiagnosticReportKind=Ap={}));var $p;(function(r){r.method="textDocument/diagnostic",r.messageDirection=mi.MessageDirection.clientToServer,r.type=new mi.ProtocolRequestType(r.method),r.partialResult=new Wp.ProgressType})($p||(gn.DocumentDiagnosticRequest=$p={}));var jp;(function(r){r.method="workspace/diagnostic",r.messageDirection=mi.MessageDirection.clientToServer,r.type=new mi.ProtocolRequestType(r.method),r.partialResult=new Wp.ProgressType})(jp||(gn.WorkspaceDiagnosticRequest=jp={}));var Up;(function(r){r.method="workspace/diagnostic/refresh",r.messageDirection=mi.MessageDirection.serverToClient,r.type=new mi.ProtocolRequestType0(r.method)})(Up||(gn.DiagnosticRefreshRequest=Up={}))});var Qp=x(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.DidCloseNotebookDocumentNotification=nt.DidSaveNotebookDocumentNotification=nt.DidChangeNotebookDocumentNotification=nt.NotebookCellArrayChange=nt.DidOpenNotebookDocumentNotification=nt.NotebookDocumentSyncRegistrationType=nt.NotebookDocument=nt.NotebookCell=nt.ExecutionSummary=nt.NotebookCellKind=void 0;var Ki=Js(),kn=Ys(),Hn=Ke(),ou;(function(r){r.Markup=1,r.Code=2;function e(t){return t===1||t===2}r.is=e})(ou||(nt.NotebookCellKind=ou={}));var au;(function(r){function e(i,s){let o={executionOrder:i};return(s===!0||s===!1)&&(o.success=s),o}r.create=e;function t(i){let s=i;return kn.objectLiteral(s)&&Ki.uinteger.is(s.executionOrder)&&(s.success===void 0||kn.boolean(s.success))}r.is=t;function n(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}r.equals=n})(au||(nt.ExecutionSummary=au={}));var fo;(function(r){function e(s,o){return{kind:s,document:o}}r.create=e;function t(s){let o=s;return kn.objectLiteral(o)&&ou.is(o.kind)&&Ki.DocumentUri.is(o.document)&&(o.metadata===void 0||kn.objectLiteral(o.metadata))}r.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!i(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!au.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}r.diff=n;function i(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let d=0;d<s.length;d++)if(!i(s[d],o[d]))return!1}if(kn.objectLiteral(s)&&kn.objectLiteral(o)){let d=Object.keys(s),p=Object.keys(o);if(d.length!==p.length||(d.sort(),p.sort(),!i(d,p)))return!1;for(let m=0;m<d.length;m++){let g=d[m];if(!i(s[g],o[g]))return!1}}return!0}})(fo||(nt.NotebookCell=fo={}));var Kp;(function(r){function e(n,i,s,o){return{uri:n,notebookType:i,version:s,cells:o}}r.create=e;function t(n){let i=n;return kn.objectLiteral(i)&&kn.string(i.uri)&&Ki.integer.is(i.version)&&kn.typedArray(i.cells,fo.is)}r.is=t})(Kp||(nt.NotebookDocument=Kp={}));var vi;(function(r){r.method="notebookDocument/sync",r.messageDirection=Hn.MessageDirection.clientToServer,r.type=new Hn.RegistrationType(r.method)})(vi||(nt.NotebookDocumentSyncRegistrationType=vi={}));var Vp;(function(r){r.method="notebookDocument/didOpen",r.messageDirection=Hn.MessageDirection.clientToServer,r.type=new Hn.ProtocolNotificationType(r.method),r.registrationMethod=vi.method})(Vp||(nt.DidOpenNotebookDocumentNotification=Vp={}));var zp;(function(r){function e(n){let i=n;return kn.objectLiteral(i)&&Ki.uinteger.is(i.start)&&Ki.uinteger.is(i.deleteCount)&&(i.cells===void 0||kn.typedArray(i.cells,fo.is))}r.is=e;function t(n,i,s){let o={start:n,deleteCount:i};return s!==void 0&&(o.cells=s),o}r.create=t})(zp||(nt.NotebookCellArrayChange=zp={}));var Bp;(function(r){r.method="notebookDocument/didChange",r.messageDirection=Hn.MessageDirection.clientToServer,r.type=new Hn.ProtocolNotificationType(r.method),r.registrationMethod=vi.method})(Bp||(nt.DidChangeNotebookDocumentNotification=Bp={}));var Gp;(function(r){r.method="notebookDocument/didSave",r.messageDirection=Hn.MessageDirection.clientToServer,r.type=new Hn.ProtocolNotificationType(r.method),r.registrationMethod=vi.method})(Gp||(nt.DidSaveNotebookDocumentNotification=Gp={}));var Xp;(function(r){r.method="notebookDocument/didClose",r.messageDirection=Hn.MessageDirection.clientToServer,r.type=new Hn.ProtocolNotificationType(r.method),r.registrationMethod=vi.method})(Xp||(nt.DidCloseNotebookDocumentNotification=Xp={}))});var Zp=x(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.InlineCompletionRequest=void 0;var Jp=Ke(),Yp;(function(r){r.method="textDocument/inlineCompletion",r.messageDirection=Jp.MessageDirection.clientToServer,r.type=new Jp.ProtocolRequestType(r.method)})(Yp||(ho.InlineCompletionRequest=Yp={}))});var fm=x(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.WorkspaceSymbolRequest=b.CodeActionResolveRequest=b.CodeActionRequest=b.DocumentSymbolRequest=b.DocumentHighlightRequest=b.ReferencesRequest=b.DefinitionRequest=b.SignatureHelpRequest=b.SignatureHelpTriggerKind=b.HoverRequest=b.CompletionResolveRequest=b.CompletionRequest=b.CompletionTriggerKind=b.PublishDiagnosticsNotification=b.WatchKind=b.RelativePattern=b.FileChangeType=b.DidChangeWatchedFilesNotification=b.WillSaveTextDocumentWaitUntilRequest=b.WillSaveTextDocumentNotification=b.TextDocumentSaveReason=b.DidSaveTextDocumentNotification=b.DidCloseTextDocumentNotification=b.DidChangeTextDocumentNotification=b.TextDocumentContentChangeEvent=b.DidOpenTextDocumentNotification=b.TextDocumentSyncKind=b.TelemetryEventNotification=b.LogMessageNotification=b.ShowMessageRequest=b.ShowMessageNotification=b.MessageType=b.DidChangeConfigurationNotification=b.ExitNotification=b.ShutdownRequest=b.InitializedNotification=b.InitializeErrorCodes=b.InitializeRequest=b.WorkDoneProgressOptions=b.TextDocumentRegistrationOptions=b.StaticRegistrationOptions=b.PositionEncodingKind=b.FailureHandlingKind=b.ResourceOperationKind=b.UnregistrationRequest=b.RegistrationRequest=b.DocumentSelector=b.NotebookCellTextDocumentFilter=b.NotebookDocumentFilter=b.TextDocumentFilter=void 0;b.MonikerRequest=b.MonikerKind=b.UniquenessLevel=b.WillDeleteFilesRequest=b.DidDeleteFilesNotification=b.WillRenameFilesRequest=b.DidRenameFilesNotification=b.WillCreateFilesRequest=b.DidCreateFilesNotification=b.FileOperationPatternKind=b.LinkedEditingRangeRequest=b.ShowDocumentRequest=b.SemanticTokensRegistrationType=b.SemanticTokensRefreshRequest=b.SemanticTokensRangeRequest=b.SemanticTokensDeltaRequest=b.SemanticTokensRequest=b.TokenFormat=b.CallHierarchyPrepareRequest=b.CallHierarchyOutgoingCallsRequest=b.CallHierarchyIncomingCallsRequest=b.WorkDoneProgressCancelNotification=b.WorkDoneProgressCreateRequest=b.WorkDoneProgress=b.SelectionRangeRequest=b.DeclarationRequest=b.FoldingRangeRefreshRequest=b.FoldingRangeRequest=b.ColorPresentationRequest=b.DocumentColorRequest=b.ConfigurationRequest=b.DidChangeWorkspaceFoldersNotification=b.WorkspaceFoldersRequest=b.TypeDefinitionRequest=b.ImplementationRequest=b.ApplyWorkspaceEditRequest=b.ExecuteCommandRequest=b.PrepareRenameRequest=b.RenameRequest=b.PrepareSupportDefaultBehavior=b.DocumentOnTypeFormattingRequest=b.DocumentRangesFormattingRequest=b.DocumentRangeFormattingRequest=b.DocumentFormattingRequest=b.DocumentLinkResolveRequest=b.DocumentLinkRequest=b.CodeLensRefreshRequest=b.CodeLensResolveRequest=b.CodeLensRequest=b.WorkspaceSymbolResolveRequest=void 0;b.InlineCompletionRequest=b.DidCloseNotebookDocumentNotification=b.DidSaveNotebookDocumentNotification=b.DidChangeNotebookDocumentNotification=b.NotebookCellArrayChange=b.DidOpenNotebookDocumentNotification=b.NotebookDocumentSyncRegistrationType=b.NotebookDocument=b.NotebookCell=b.ExecutionSummary=b.NotebookCellKind=b.DiagnosticRefreshRequest=b.WorkspaceDiagnosticRequest=b.DocumentDiagnosticRequest=b.DocumentDiagnosticReportKind=b.DiagnosticServerCancellationData=b.InlayHintRefreshRequest=b.InlayHintResolveRequest=b.InlayHintRequest=b.InlineValueRefreshRequest=b.InlineValueRequest=b.TypeHierarchySupertypesRequest=b.TypeHierarchySubtypesRequest=b.TypeHierarchyPrepareRequest=void 0;var j=Ke(),eg=Js(),gt=Ys(),Mw=_h();Object.defineProperty(b,"ImplementationRequest",{enumerable:!0,get:function(){return Mw.ImplementationRequest}});var Nw=kh();Object.defineProperty(b,"TypeDefinitionRequest",{enumerable:!0,get:function(){return Nw.TypeDefinitionRequest}});var cm=Ih();Object.defineProperty(b,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return cm.WorkspaceFoldersRequest}});Object.defineProperty(b,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return cm.DidChangeWorkspaceFoldersNotification}});var Aw=Oh();Object.defineProperty(b,"ConfigurationRequest",{enumerable:!0,get:function(){return Aw.ConfigurationRequest}});var um=Nh();Object.defineProperty(b,"DocumentColorRequest",{enumerable:!0,get:function(){return um.DocumentColorRequest}});Object.defineProperty(b,"ColorPresentationRequest",{enumerable:!0,get:function(){return um.ColorPresentationRequest}});var dm=jh();Object.defineProperty(b,"FoldingRangeRequest",{enumerable:!0,get:function(){return dm.FoldingRangeRequest}});Object.defineProperty(b,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return dm.FoldingRangeRefreshRequest}});var $w=Hh();Object.defineProperty(b,"DeclarationRequest",{enumerable:!0,get:function(){return $w.DeclarationRequest}});var jw=zh();Object.defineProperty(b,"SelectionRangeRequest",{enumerable:!0,get:function(){return jw.SelectionRangeRequest}});var fu=Qh();Object.defineProperty(b,"WorkDoneProgress",{enumerable:!0,get:function(){return fu.WorkDoneProgress}});Object.defineProperty(b,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return fu.WorkDoneProgressCreateRequest}});Object.defineProperty(b,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return fu.WorkDoneProgressCancelNotification}});var hu=ep();Object.defineProperty(b,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return hu.CallHierarchyIncomingCallsRequest}});Object.defineProperty(b,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return hu.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(b,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return hu.CallHierarchyPrepareRequest}});var yi=op();Object.defineProperty(b,"TokenFormat",{enumerable:!0,get:function(){return yi.TokenFormat}});Object.defineProperty(b,"SemanticTokensRequest",{enumerable:!0,get:function(){return yi.SemanticTokensRequest}});Object.defineProperty(b,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return yi.SemanticTokensDeltaRequest}});Object.defineProperty(b,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return yi.SemanticTokensRangeRequest}});Object.defineProperty(b,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return yi.SemanticTokensRefreshRequest}});Object.defineProperty(b,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return yi.SemanticTokensRegistrationType}});var Uw=up();Object.defineProperty(b,"ShowDocumentRequest",{enumerable:!0,get:function(){return Uw.ShowDocumentRequest}});var Ww=fp();Object.defineProperty(b,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return Ww.LinkedEditingRangeRequest}});var jr=wp();Object.defineProperty(b,"FileOperationPatternKind",{enumerable:!0,get:function(){return jr.FileOperationPatternKind}});Object.defineProperty(b,"DidCreateFilesNotification",{enumerable:!0,get:function(){return jr.DidCreateFilesNotification}});Object.defineProperty(b,"WillCreateFilesRequest",{enumerable:!0,get:function(){return jr.WillCreateFilesRequest}});Object.defineProperty(b,"DidRenameFilesNotification",{enumerable:!0,get:function(){return jr.DidRenameFilesNotification}});Object.defineProperty(b,"WillRenameFilesRequest",{enumerable:!0,get:function(){return jr.WillRenameFilesRequest}});Object.defineProperty(b,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return jr.DidDeleteFilesNotification}});Object.defineProperty(b,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return jr.WillDeleteFilesRequest}});var pu=_p();Object.defineProperty(b,"UniquenessLevel",{enumerable:!0,get:function(){return pu.UniquenessLevel}});Object.defineProperty(b,"MonikerKind",{enumerable:!0,get:function(){return pu.MonikerKind}});Object.defineProperty(b,"MonikerRequest",{enumerable:!0,get:function(){return pu.MonikerRequest}});var gu=Ep();Object.defineProperty(b,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return gu.TypeHierarchyPrepareRequest}});Object.defineProperty(b,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return gu.TypeHierarchySubtypesRequest}});Object.defineProperty(b,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return gu.TypeHierarchySupertypesRequest}});var lm=qp();Object.defineProperty(b,"InlineValueRequest",{enumerable:!0,get:function(){return lm.InlineValueRequest}});Object.defineProperty(b,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return lm.InlineValueRefreshRequest}});var mu=Mp();Object.defineProperty(b,"InlayHintRequest",{enumerable:!0,get:function(){return mu.InlayHintRequest}});Object.defineProperty(b,"InlayHintResolveRequest",{enumerable:!0,get:function(){return mu.InlayHintResolveRequest}});Object.defineProperty(b,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return mu.InlayHintRefreshRequest}});var Vi=Hp();Object.defineProperty(b,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Vi.DiagnosticServerCancellationData}});Object.defineProperty(b,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Vi.DocumentDiagnosticReportKind}});Object.defineProperty(b,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Vi.DocumentDiagnosticRequest}});Object.defineProperty(b,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Vi.WorkspaceDiagnosticRequest}});Object.defineProperty(b,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Vi.DiagnosticRefreshRequest}});var Kn=Qp();Object.defineProperty(b,"NotebookCellKind",{enumerable:!0,get:function(){return Kn.NotebookCellKind}});Object.defineProperty(b,"ExecutionSummary",{enumerable:!0,get:function(){return Kn.ExecutionSummary}});Object.defineProperty(b,"NotebookCell",{enumerable:!0,get:function(){return Kn.NotebookCell}});Object.defineProperty(b,"NotebookDocument",{enumerable:!0,get:function(){return Kn.NotebookDocument}});Object.defineProperty(b,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return Kn.NotebookDocumentSyncRegistrationType}});Object.defineProperty(b,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return Kn.DidOpenNotebookDocumentNotification}});Object.defineProperty(b,"NotebookCellArrayChange",{enumerable:!0,get:function(){return Kn.NotebookCellArrayChange}});Object.defineProperty(b,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return Kn.DidChangeNotebookDocumentNotification}});Object.defineProperty(b,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return Kn.DidSaveNotebookDocumentNotification}});Object.defineProperty(b,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return Kn.DidCloseNotebookDocumentNotification}});var Hw=Zp();Object.defineProperty(b,"InlineCompletionRequest",{enumerable:!0,get:function(){return Hw.InlineCompletionRequest}});var cu;(function(r){function e(t){let n=t;return gt.string(n)||gt.string(n.language)||gt.string(n.scheme)||gt.string(n.pattern)}r.is=e})(cu||(b.TextDocumentFilter=cu={}));var uu;(function(r){function e(t){let n=t;return gt.objectLiteral(n)&&(gt.string(n.notebookType)||gt.string(n.scheme)||gt.string(n.pattern))}r.is=e})(uu||(b.NotebookDocumentFilter=uu={}));var du;(function(r){function e(t){let n=t;return gt.objectLiteral(n)&&(gt.string(n.notebook)||uu.is(n.notebook))&&(n.language===void 0||gt.string(n.language))}r.is=e})(du||(b.NotebookCellTextDocumentFilter=du={}));var lu;(function(r){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!gt.string(n)&&!cu.is(n)&&!du.is(n))return!1;return!0}r.is=e})(lu||(b.DocumentSelector=lu={}));var tg;(function(r){r.method="client/registerCapability",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(tg||(b.RegistrationRequest=tg={}));var ng;(function(r){r.method="client/unregisterCapability",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(ng||(b.UnregistrationRequest=ng={}));var rg;(function(r){r.Create="create",r.Rename="rename",r.Delete="delete"})(rg||(b.ResourceOperationKind=rg={}));var ig;(function(r){r.Abort="abort",r.Transactional="transactional",r.TextOnlyTransactional="textOnlyTransactional",r.Undo="undo"})(ig||(b.FailureHandlingKind=ig={}));var sg;(function(r){r.UTF8="utf-8",r.UTF16="utf-16",r.UTF32="utf-32"})(sg||(b.PositionEncodingKind=sg={}));var og;(function(r){function e(t){let n=t;return n&&gt.string(n.id)&&n.id.length>0}r.hasId=e})(og||(b.StaticRegistrationOptions=og={}));var ag;(function(r){function e(t){let n=t;return n&&(n.documentSelector===null||lu.is(n.documentSelector))}r.is=e})(ag||(b.TextDocumentRegistrationOptions=ag={}));var cg;(function(r){function e(n){let i=n;return gt.objectLiteral(i)&&(i.workDoneProgress===void 0||gt.boolean(i.workDoneProgress))}r.is=e;function t(n){let i=n;return i&&gt.boolean(i.workDoneProgress)}r.hasWorkDoneProgress=t})(cg||(b.WorkDoneProgressOptions=cg={}));var ug;(function(r){r.method="initialize",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(ug||(b.InitializeRequest=ug={}));var dg;(function(r){r.unknownProtocolVersion=1})(dg||(b.InitializeErrorCodes=dg={}));var lg;(function(r){r.method="initialized",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(lg||(b.InitializedNotification=lg={}));var fg;(function(r){r.method="shutdown",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType0(r.method)})(fg||(b.ShutdownRequest=fg={}));var hg;(function(r){r.method="exit",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType0(r.method)})(hg||(b.ExitNotification=hg={}));var pg;(function(r){r.method="workspace/didChangeConfiguration",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(pg||(b.DidChangeConfigurationNotification=pg={}));var gg;(function(r){r.Error=1,r.Warning=2,r.Info=3,r.Log=4,r.Debug=5})(gg||(b.MessageType=gg={}));var mg;(function(r){r.method="window/showMessage",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(mg||(b.ShowMessageNotification=mg={}));var vg;(function(r){r.method="window/showMessageRequest",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(vg||(b.ShowMessageRequest=vg={}));var yg;(function(r){r.method="window/logMessage",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(yg||(b.LogMessageNotification=yg={}));var bg;(function(r){r.method="telemetry/event",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(bg||(b.TelemetryEventNotification=bg={}));var wg;(function(r){r.None=0,r.Full=1,r.Incremental=2})(wg||(b.TextDocumentSyncKind=wg={}));var Cg;(function(r){r.method="textDocument/didOpen",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Cg||(b.DidOpenTextDocumentNotification=Cg={}));var Rg;(function(r){function e(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}r.isIncremental=e;function t(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}r.isFull=t})(Rg||(b.TextDocumentContentChangeEvent=Rg={}));var Sg;(function(r){r.method="textDocument/didChange",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Sg||(b.DidChangeTextDocumentNotification=Sg={}));var Dg;(function(r){r.method="textDocument/didClose",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Dg||(b.DidCloseTextDocumentNotification=Dg={}));var _g;(function(r){r.method="textDocument/didSave",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(_g||(b.DidSaveTextDocumentNotification=_g={}));var Tg;(function(r){r.Manual=1,r.AfterDelay=2,r.FocusOut=3})(Tg||(b.TextDocumentSaveReason=Tg={}));var Pg;(function(r){r.method="textDocument/willSave",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Pg||(b.WillSaveTextDocumentNotification=Pg={}));var kg;(function(r){r.method="textDocument/willSaveWaitUntil",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(kg||(b.WillSaveTextDocumentWaitUntilRequest=kg={}));var Eg;(function(r){r.method="workspace/didChangeWatchedFiles",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Eg||(b.DidChangeWatchedFilesNotification=Eg={}));var xg;(function(r){r.Created=1,r.Changed=2,r.Deleted=3})(xg||(b.FileChangeType=xg={}));var Ig;(function(r){function e(t){let n=t;return gt.objectLiteral(n)&&(eg.URI.is(n.baseUri)||eg.WorkspaceFolder.is(n.baseUri))&&gt.string(n.pattern)}r.is=e})(Ig||(b.RelativePattern=Ig={}));var qg;(function(r){r.Create=1,r.Change=2,r.Delete=4})(qg||(b.WatchKind=qg={}));var Fg;(function(r){r.method="textDocument/publishDiagnostics",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(Fg||(b.PublishDiagnosticsNotification=Fg={}));var Og;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.TriggerForIncompleteCompletions=3})(Og||(b.CompletionTriggerKind=Og={}));var Lg;(function(r){r.method="textDocument/completion",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Lg||(b.CompletionRequest=Lg={}));var Mg;(function(r){r.method="completionItem/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Mg||(b.CompletionResolveRequest=Mg={}));var Ng;(function(r){r.method="textDocument/hover",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Ng||(b.HoverRequest=Ng={}));var Ag;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.ContentChange=3})(Ag||(b.SignatureHelpTriggerKind=Ag={}));var $g;(function(r){r.method="textDocument/signatureHelp",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})($g||(b.SignatureHelpRequest=$g={}));var jg;(function(r){r.method="textDocument/definition",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(jg||(b.DefinitionRequest=jg={}));var Ug;(function(r){r.method="textDocument/references",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Ug||(b.ReferencesRequest=Ug={}));var Wg;(function(r){r.method="textDocument/documentHighlight",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Wg||(b.DocumentHighlightRequest=Wg={}));var Hg;(function(r){r.method="textDocument/documentSymbol",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Hg||(b.DocumentSymbolRequest=Hg={}));var Kg;(function(r){r.method="textDocument/codeAction",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Kg||(b.CodeActionRequest=Kg={}));var Vg;(function(r){r.method="codeAction/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Vg||(b.CodeActionResolveRequest=Vg={}));var zg;(function(r){r.method="workspace/symbol",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(zg||(b.WorkspaceSymbolRequest=zg={}));var Bg;(function(r){r.method="workspaceSymbol/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Bg||(b.WorkspaceSymbolResolveRequest=Bg={}));var Gg;(function(r){r.method="textDocument/codeLens",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Gg||(b.CodeLensRequest=Gg={}));var Xg;(function(r){r.method="codeLens/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Xg||(b.CodeLensResolveRequest=Xg={}));var Qg;(function(r){r.method="workspace/codeLens/refresh",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType0(r.method)})(Qg||(b.CodeLensRefreshRequest=Qg={}));var Jg;(function(r){r.method="textDocument/documentLink",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Jg||(b.DocumentLinkRequest=Jg={}));var Yg;(function(r){r.method="documentLink/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Yg||(b.DocumentLinkResolveRequest=Yg={}));var Zg;(function(r){r.method="textDocument/formatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Zg||(b.DocumentFormattingRequest=Zg={}));var em;(function(r){r.method="textDocument/rangeFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(em||(b.DocumentRangeFormattingRequest=em={}));var tm;(function(r){r.method="textDocument/rangesFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(tm||(b.DocumentRangesFormattingRequest=tm={}));var nm;(function(r){r.method="textDocument/onTypeFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(nm||(b.DocumentOnTypeFormattingRequest=nm={}));var rm;(function(r){r.Identifier=1})(rm||(b.PrepareSupportDefaultBehavior=rm={}));var im;(function(r){r.method="textDocument/rename",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(im||(b.RenameRequest=im={}));var sm;(function(r){r.method="textDocument/prepareRename",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(sm||(b.PrepareRenameRequest=sm={}));var om;(function(r){r.method="workspace/executeCommand",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(om||(b.ExecuteCommandRequest=om={}));var am;(function(r){r.method="workspace/applyEdit",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType("workspace/applyEdit")})(am||(b.ApplyWorkspaceEditRequest=am={}))});var pm=x(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.createProtocolConnection=void 0;var hm=$r();function Kw(r,e,t,n){return hm.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,hm.createMessageConnection)(r,e,t,n)}po.createProtocolConnection=Kw});var mm=x(Bt=>{"use strict";var Vw=Bt&&Bt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),go=Bt&&Bt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Vw(e,r,t)};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.LSPErrorCodes=Bt.createProtocolConnection=void 0;go($r(),Bt);go(Js(),Bt);go(Ke(),Bt);go(fm(),Bt);var zw=pm();Object.defineProperty(Bt,"createProtocolConnection",{enumerable:!0,get:function(){return zw.createProtocolConnection}});var gm;(function(r){r.lspReservedErrorRangeStart=-32899,r.RequestFailed=-32803,r.ServerCancelled=-32802,r.ContentModified=-32801,r.RequestCancelled=-32800,r.lspReservedErrorRangeEnd=-32800})(gm||(Bt.LSPErrorCodes=gm={}))});var ie=x(Vn=>{"use strict";var Bw=Vn&&Vn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vm=Vn&&Vn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Bw(e,r,t)};Object.defineProperty(Vn,"__esModule",{value:!0});Vn.createProtocolConnection=void 0;var Gw=eu();vm(eu(),Vn);vm(mm(),Vn);function Xw(r,e,t,n){return(0,Gw.createMessageConnection)(r,e,t,n)}Vn.createProtocolConnection=Xw});var mo=x(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.forEach=Et.mapAsync=Et.map=Et.clearTestMode=Et.setTestMode=Et.Semaphore=Et.Delayer=void 0;var Bi=ie(),vu=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,Bi.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};Et.Delayer=vu;var yu=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Bi.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Et.Semaphore=yu;var bu=!1;function Qw(){bu=!0}Et.setTestMode=Qw;function Jw(){bu=!1}Et.clearTestMode=Jw;var ym=15,zi=class{constructor(e=ym){this.yieldAfter=bu===!0?Math.max(e,2):Math.max(e,ym),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function Yw(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new zi(n?.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=e(r[d]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Bi.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Et.map=Yw;async function Zw(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new zi(n?.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=await e(r[d],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Bi.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Et.mapAsync=Zw;async function eC(r,e,t,n){if(r.length===0)return;let i=new zi(n?.yieldAfter);function s(a){i.start();for(let c=a;c<r.length;c++)if(e(r[c]),i.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,Bi.RAL)().timer.setImmediate(()=>{a(s(o))})})}Et.forEach=eC});var Ru=x(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});var tC=require("vscode"),wu=class extends tC.CompletionItem{constructor(e){super(e)}};Cu.default=wu});var _u=x(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});var nC=require("vscode"),Su=class extends nC.CodeLens{constructor(e){super(e)}};Du.default=Su});var ku=x(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});var rC=require("vscode"),Tu=class extends rC.DocumentLink{constructor(e,t){super(e,t)}};Pu.default=Tu});var Iu=x(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});var iC=require("vscode"),Eu=class extends iC.CodeAction{constructor(e,t){super(e),this.data=t}};xu.default=Eu});var Ou=x(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.ProtocolDiagnostic=bi.DiagnosticCode=void 0;var sC=require("vscode"),qu=hn(),bm;(function(r){function e(t){let n=t;return n!=null&&(qu.number(n.value)||qu.string(n.value))&&qu.string(n.target)}r.is=e})(bm||(bi.DiagnosticCode=bm={}));var Fu=class extends sC.Diagnostic{constructor(e,t,n,i){super(e,t,n),this.data=i,this.hasDiagnosticCode=!1}};bi.ProtocolDiagnostic=Fu});var Nu=x(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});var oC=require("vscode"),Lu=class extends oC.CallHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Mu.default=Lu});var ju=x($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});var aC=require("vscode"),Au=class extends aC.TypeHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};$u.default=Au});var Hu=x(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});var vo=require("vscode"),Uu=class extends vo.SymbolInformation{constructor(e,t,n,i,s){let o=!(i instanceof vo.Uri);super(e,t,n,o?i:new vo.Location(i,new vo.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};Wu.default=Uu});var zu=x(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});var cC=require("vscode"),Ku=class extends cC.InlayHint{constructor(e,t,n){super(e,t,n)}};Vu.default=Ku});var Sm=x(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.createConverter=void 0;var dt=require("vscode"),se=ie(),Ur=hn(),wm=mo(),uC=Ru(),dC=_u(),lC=ku(),Cm=Iu(),Rm=Ou(),fC=Nu(),hC=ju(),pC=Hu(),gC=zu(),Bu;(function(r){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}r.is=e})(Bu||(Bu={}));function mC(r){let t=r||(f=>f.toString());function n(f){return t(f)}function i(f){return{uri:t(f.uri)}}function s(f){return{uri:t(f.uri),languageId:f.languageId,version:f.version,text:f.getText()}}function o(f){return{uri:t(f.uri),version:f.version}}function a(f){return{textDocument:s(f)}}function c(f){let E=f;return!!E.document&&!!E.contentChanges}function d(f){let E=f;return!!E.uri&&!!E.version}function p(f,E,G){if(d(f))return{textDocument:{uri:t(f.uri),version:f.version},contentChanges:[{text:f.getText()}]};if(c(f)){let De=E,_=G;return{textDocument:{uri:t(De),version:_},contentChanges:f.contentChanges.map(C=>{let S=C.range;return{range:{start:{line:S.start.line,character:S.start.character},end:{line:S.end.line,character:S.end.character}},rangeLength:C.rangeLength,text:C.text}})}}else throw Error("Unsupported text document change parameter")}function m(f){return{textDocument:i(f)}}function g(f,E=!1){let G={textDocument:i(f)};return E&&(G.text=f.getText()),G}function R(f){switch(f){case dt.TextDocumentSaveReason.Manual:return se.TextDocumentSaveReason.Manual;case dt.TextDocumentSaveReason.AfterDelay:return se.TextDocumentSaveReason.AfterDelay;case dt.TextDocumentSaveReason.FocusOut:return se.TextDocumentSaveReason.FocusOut}return se.TextDocumentSaveReason.Manual}function y(f){return{textDocument:i(f.document),reason:R(f.reason)}}function P(f){return{files:f.files.map(E=>({uri:t(E)}))}}function k(f){return{files:f.files.map(E=>({oldUri:t(E.oldUri),newUri:t(E.newUri)}))}}function M(f){return{files:f.files.map(E=>({uri:t(E)}))}}function N(f){return{files:f.files.map(E=>({uri:t(E)}))}}function A(f){return{files:f.files.map(E=>({oldUri:t(E.oldUri),newUri:t(E.newUri)}))}}function W(f){return{files:f.files.map(E=>({uri:t(E)}))}}function J(f,E){return{textDocument:i(f),position:bt(E)}}function pe(f){switch(f){case dt.CompletionTriggerKind.TriggerCharacter:return se.CompletionTriggerKind.TriggerCharacter;case dt.CompletionTriggerKind.TriggerForIncompleteCompletions:return se.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return se.CompletionTriggerKind.Invoked}}function X(f,E,G){return{textDocument:i(f),position:bt(E),context:{triggerKind:pe(G.triggerKind),triggerCharacter:G.triggerCharacter}}}function ne(f){switch(f){case dt.SignatureHelpTriggerKind.Invoke:return se.SignatureHelpTriggerKind.Invoked;case dt.SignatureHelpTriggerKind.TriggerCharacter:return se.SignatureHelpTriggerKind.TriggerCharacter;case dt.SignatureHelpTriggerKind.ContentChange:return se.SignatureHelpTriggerKind.ContentChange}}function le(f){return{label:f.label}}function it(f){return f.map(le)}function Ze(f){return{label:f.label,parameters:it(f.parameters)}}function at(f){return f.map(Ze)}function dn(f){return f===void 0?f:{signatures:at(f.signatures),activeSignature:f.activeSignature,activeParameter:f.activeParameter}}function Ot(f,E,G){return{textDocument:i(f),position:bt(E),context:{isRetrigger:G.isRetrigger,triggerCharacter:G.triggerCharacter,triggerKind:ne(G.triggerKind),activeSignatureHelp:dn(G.activeSignatureHelp)}}}function bt(f){return{line:f.line,character:f.character}}function wt(f){return f==null?f:{line:f.line>se.uinteger.MAX_VALUE?se.uinteger.MAX_VALUE:f.line,character:f.character>se.uinteger.MAX_VALUE?se.uinteger.MAX_VALUE:f.character}}function Cn(f,E){return wm.map(f,wt,E)}function On(f){return f.map(wt)}function Ae(f){return f==null?f:{start:wt(f.start),end:wt(f.end)}}function Ut(f){return f.map(Ae)}function Lt(f){return f==null?f:se.Location.create(n(f.uri),Ae(f.range))}function Ct(f){switch(f){case dt.DiagnosticSeverity.Error:return se.DiagnosticSeverity.Error;case dt.DiagnosticSeverity.Warning:return se.DiagnosticSeverity.Warning;case dt.DiagnosticSeverity.Information:return se.DiagnosticSeverity.Information;case dt.DiagnosticSeverity.Hint:return se.DiagnosticSeverity.Hint}}function dr(f){if(!f)return;let E=[];for(let G of f){let De=Ln(G);De!==void 0&&E.push(De)}return E.length>0?E:void 0}function Ln(f){switch(f){case dt.DiagnosticTag.Unnecessary:return se.DiagnosticTag.Unnecessary;case dt.DiagnosticTag.Deprecated:return se.DiagnosticTag.Deprecated;default:return}}function Mn(f){return{message:f.message,location:Lt(f.location)}}function Jn(f){return f.map(Mn)}function lr(f){if(f!=null)return Ur.number(f)||Ur.string(f)?f:{value:f.value,target:n(f.target)}}function Nn(f){let E=se.Diagnostic.create(Ae(f.range),f.message),G=f instanceof Rm.ProtocolDiagnostic?f:void 0;G!==void 0&&G.data!==void 0&&(E.data=G.data);let De=lr(f.code);return Rm.DiagnosticCode.is(De)?G!==void 0&&G.hasDiagnosticCode?E.code=De:(E.code=De.value,E.codeDescription={href:De.target}):E.code=De,Ur.number(f.severity)&&(E.severity=Ct(f.severity)),Array.isArray(f.tags)&&(E.tags=dr(f.tags)),f.relatedInformation&&(E.relatedInformation=Jn(f.relatedInformation)),f.source&&(E.source=f.source),E}function Rn(f,E){return f==null?f:wm.map(f,Nn,E)}function Sn(f){return f==null?f:f.map(Nn)}function An(f,E){switch(f){case"$string":return E;case se.MarkupKind.PlainText:return{kind:f,value:E};case se.MarkupKind.Markdown:return{kind:f,value:E.value};default:return`Unsupported Markup content received. Kind is: ${f}`}}function ct(f){switch(f){case dt.CompletionItemTag.Deprecated:return se.CompletionItemTag.Deprecated}}function Yn(f){if(f===void 0)return f;let E=[];for(let G of f){let De=ct(G);De!==void 0&&E.push(De)}return E}function Dn(f,E){return E!==void 0?E:f+1}function ln(f,E=!1){let G,De;Ur.string(f.label)?G=f.label:(G=f.label.label,E&&(f.label.detail!==void 0||f.label.description!==void 0)&&(De={detail:f.label.detail,description:f.label.description}));let _={label:G};De!==void 0&&(_.labelDetails=De);let h=f instanceof uC.default?f:void 0;f.detail&&(_.detail=f.detail),f.documentation&&(!h||h.documentationFormat==="$string"?_.documentation=f.documentation:_.documentation=An(h.documentationFormat,f.documentation)),f.filterText&&(_.filterText=f.filterText),fr(_,f),Ur.number(f.kind)&&(_.kind=Dn(f.kind,h&&h.originalItemKind)),f.sortText&&(_.sortText=f.sortText),f.additionalTextEdits&&(_.additionalTextEdits=st(f.additionalTextEdits)),f.commitCharacters&&(_.commitCharacters=f.commitCharacters.slice()),f.command&&(_.command=K(f.command)),(f.preselect===!0||f.preselect===!1)&&(_.preselect=f.preselect);let C=Yn(f.tags);if(h){if(h.data!==void 0&&(_.data=h.data),h.deprecated===!0||h.deprecated===!1){if(h.deprecated===!0&&C!==void 0&&C.length>0){let S=C.indexOf(dt.CompletionItemTag.Deprecated);S!==-1&&C.splice(S,1)}_.deprecated=h.deprecated}h.insertTextMode!==void 0&&(_.insertTextMode=h.insertTextMode)}return C!==void 0&&C.length>0&&(_.tags=C),_.insertTextMode===void 0&&f.keepWhitespace===!0&&(_.insertTextMode=se.InsertTextMode.adjustIndentation),_}function fr(f,E){let G=se.InsertTextFormat.PlainText,De,_;E.textEdit?(De=E.textEdit.newText,_=E.textEdit.range):E.insertText instanceof dt.SnippetString?(G=se.InsertTextFormat.Snippet,De=E.insertText.value):De=E.insertText,E.range&&(_=E.range),f.insertTextFormat=G,E.fromEdit&&De!==void 0&&_!==void 0?f.textEdit=fn(De,_):f.insertText=De}function fn(f,E){return Bu.is(E)?se.InsertReplaceEdit.create(f,Ae(E.inserting),Ae(E.replacing)):{newText:f,range:Ae(E)}}function $n(f){return{range:Ae(f.range),newText:f.newText}}function st(f){return f==null?f:f.map($n)}function _t(f){return f<=dt.SymbolKind.TypeParameter?f+1:se.SymbolKind.Property}function Rt(f){return f}function en(f){return f.map(Rt)}function Wt(f,E,G){return{textDocument:i(f),position:bt(E),context:{includeDeclaration:G.includeDeclaration}}}async function jn(f,E){let G=se.CodeAction.create(f.title);if(f instanceof Cm.default&&f.data!==void 0&&(G.data=f.data),f.kind!==void 0&&(G.kind=w(f.kind)),f.diagnostics!==void 0&&(G.diagnostics=await Rn(f.diagnostics,E)),f.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return f.command!==void 0&&(G.command=K(f.command)),f.isPreferred!==void 0&&(G.isPreferred=f.isPreferred),f.disabled!==void 0&&(G.disabled={reason:f.disabled.reason}),G}function Zn(f){let E=se.CodeAction.create(f.title);if(f instanceof Cm.default&&f.data!==void 0&&(E.data=f.data),f.kind!==void 0&&(E.kind=w(f.kind)),f.diagnostics!==void 0&&(E.diagnostics=Sn(f.diagnostics)),f.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return f.command!==void 0&&(E.command=K(f.command)),f.isPreferred!==void 0&&(E.isPreferred=f.isPreferred),f.disabled!==void 0&&(E.disabled={reason:f.disabled.reason}),E}async function _n(f,E){if(f==null)return f;let G;return f.only&&Ur.string(f.only.value)&&(G=[f.only.value]),se.CodeActionContext.create(await Rn(f.diagnostics,E),G,Mt(f.triggerKind))}function er(f){if(f==null)return f;let E;return f.only&&Ur.string(f.only.value)&&(E=[f.only.value]),se.CodeActionContext.create(Sn(f.diagnostics),E,Mt(f.triggerKind))}function Mt(f){switch(f){case dt.CodeActionTriggerKind.Invoke:return se.CodeActionTriggerKind.Invoked;case dt.CodeActionTriggerKind.Automatic:return se.CodeActionTriggerKind.Automatic;default:return}}function w(f){if(f!=null)return f.value}function q(f){return f==null?f:se.InlineValueContext.create(f.frameId,Ae(f.stoppedLocation))}function U(f,E,G){return{context:se.InlineCompletionContext.create(G.triggerKind,G.selectedCompletionInfo),textDocument:i(f),position:wt(E)}}function K(f){let E=se.Command.create(f.title,f.command);return f.arguments&&(E.arguments=f.arguments),E}function Ce(f){let E=se.CodeLens.create(Ae(f.range));return f.command&&(E.command=K(f.command)),f instanceof dC.default&&f.data&&(E.data=f.data),E}function be(f,E){let G={tabSize:f.tabSize,insertSpaces:f.insertSpaces};return E.trimTrailingWhitespace&&(G.trimTrailingWhitespace=!0),E.trimFinalNewlines&&(G.trimFinalNewlines=!0),E.insertFinalNewline&&(G.insertFinalNewline=!0),G}function Pe(f){return{textDocument:i(f)}}function qe(f){return{textDocument:i(f)}}function ue(f){let E=se.DocumentLink.create(Ae(f.range));f.target&&(E.target=n(f.target)),f.tooltip!==void 0&&(E.tooltip=f.tooltip);let G=f instanceof lC.default?f:void 0;return G&&G.data&&(E.data=G.data),E}function Se(f){return{textDocument:i(f)}}function ge(f){let E={name:f.name,kind:_t(f.kind),uri:n(f.uri),range:Ae(f.range),selectionRange:Ae(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(E.detail=f.detail),f.tags!==void 0&&(E.tags=en(f.tags)),f instanceof fC.default&&f.data!==void 0&&(E.data=f.data),E}function Fe(f){let E={name:f.name,kind:_t(f.kind),uri:n(f.uri),range:Ae(f.range),selectionRange:Ae(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(E.detail=f.detail),f.tags!==void 0&&(E.tags=en(f.tags)),f instanceof hC.default&&f.data!==void 0&&(E.data=f.data),E}function et(f){let E=f instanceof pC.default?{name:f.name,kind:_t(f.kind),location:f.hasRange?Lt(f.location):{uri:t(f.location.uri)},data:f.data}:{name:f.name,kind:_t(f.kind),location:Lt(f.location)};return f.tags!==void 0&&(E.tags=en(f.tags)),f.containerName!==""&&(E.containerName=f.containerName),E}function ht(f){let E=typeof f.label=="string"?f.label:f.label.map(hr),G=se.InlayHint.create(wt(f.position),E);return f.kind!==void 0&&(G.kind=f.kind),f.textEdits!==void 0&&(G.textEdits=st(f.textEdits)),f.tooltip!==void 0&&(G.tooltip=pr(f.tooltip)),f.paddingLeft!==void 0&&(G.paddingLeft=f.paddingLeft),f.paddingRight!==void 0&&(G.paddingRight=f.paddingRight),f instanceof gC.default&&f.data!==void 0&&(G.data=f.data),G}function hr(f){let E=se.InlayHintLabelPart.create(f.value);return f.location!==void 0&&(E.location=Lt(f.location)),f.command!==void 0&&(E.command=K(f.command)),f.tooltip!==void 0&&(E.tooltip=pr(f.tooltip)),E}function pr(f){return typeof f=="string"?f:{kind:se.MarkupKind.Markdown,value:f.value}}return{asUri:n,asTextDocumentIdentifier:i,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:p,asCloseTextDocumentParams:m,asSaveTextDocumentParams:g,asWillSaveTextDocumentParams:y,asDidCreateFilesParams:P,asDidRenameFilesParams:k,asDidDeleteFilesParams:M,asWillCreateFilesParams:N,asWillRenameFilesParams:A,asWillDeleteFilesParams:W,asTextDocumentPositionParams:J,asCompletionParams:X,asSignatureHelpParams:Ot,asWorkerPosition:bt,asRange:Ae,asRanges:Ut,asPosition:wt,asPositions:Cn,asPositionsSync:On,asLocation:Lt,asDiagnosticSeverity:Ct,asDiagnosticTag:Ln,asDiagnostic:Nn,asDiagnostics:Rn,asDiagnosticsSync:Sn,asCompletionItem:ln,asTextEdit:$n,asSymbolKind:_t,asSymbolTag:Rt,asSymbolTags:en,asReferenceParams:Wt,asCodeAction:jn,asCodeActionSync:Zn,asCodeActionContext:_n,asCodeActionContextSync:er,asInlineValueContext:q,asCommand:K,asCodeLens:Ce,asFormattingOptions:be,asDocumentSymbolParams:Pe,asCodeLensParams:qe,asDocumentLink:ue,asDocumentLinkParams:Se,asCallHierarchyItem:ge,asTypeHierarchyItem:Fe,asInlayHint:ht,asWorkspaceSymbol:et,asInlineCompletionParams:U}}yo.createConverter=mC});var Tm=x(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.createConverter=void 0;var H=require("vscode"),te=ie(),mn=hn(),Re=mo(),vC=Ru(),yC=_u(),bC=ku(),wC=Iu(),Dm=Ou(),CC=Nu(),RC=ju(),SC=Hu(),DC=zu(),_m=ie(),bo;(function(r){function e(t){let n=t;return n&&mn.string(n.language)&&mn.string(n.value)}r.is=e})(bo||(bo={}));function _C(r,e,t){let i=r||(u=>H.Uri.parse(u));function s(u){return i(u)}function o(u){let D=[];for(let O of u)if(typeof O=="string")D.push(O);else if(_m.NotebookCellTextDocumentFilter.is(O))if(typeof O.notebook=="string")D.push({notebookType:O.notebook,language:O.language});else{let Q=O.notebook.notebookType??"*";D.push({notebookType:Q,scheme:O.notebook.scheme,pattern:O.notebook.pattern,language:O.language})}else _m.TextDocumentFilter.is(O)&&D.push({language:O.language,scheme:O.scheme,pattern:O.pattern});return D}async function a(u,D){return Re.map(u,d,D)}function c(u){let D=new Array(u.length);for(let O=0;O<u.length;O++)D[O]=d(u[O]);return D}function d(u){let D=new Dm.ProtocolDiagnostic(y(u.range),u.message,k(u.severity),u.data);if(u.code!==void 0){if(typeof u.code=="string"||typeof u.code=="number")te.CodeDescription.is(u.codeDescription)?D.code={value:u.code,target:s(u.codeDescription.href)}:D.code=u.code;else if(Dm.DiagnosticCode.is(u.code)){D.hasDiagnosticCode=!0;let O=u.code;D.code={value:O.value,target:s(O.target)}}}return u.source&&(D.source=u.source),u.relatedInformation&&(D.relatedInformation=p(u.relatedInformation)),Array.isArray(u.tags)&&(D.tags=m(u.tags)),D}function p(u){let D=new Array(u.length);for(let O=0;O<u.length;O++){let Q=u[O];D[O]=new H.DiagnosticRelatedInformation(Ct(Q.location),Q.message)}return D}function m(u){if(!u)return;let D=[];for(let O of u){let Q=g(O);Q!==void 0&&D.push(Q)}return D.length>0?D:void 0}function g(u){switch(u){case te.DiagnosticTag.Unnecessary:return H.DiagnosticTag.Unnecessary;case te.DiagnosticTag.Deprecated:return H.DiagnosticTag.Deprecated;default:return}}function R(u){return u?new H.Position(u.line,u.character):void 0}function y(u){return u?new H.Range(u.start.line,u.start.character,u.end.line,u.end.character):void 0}async function P(u,D){return Re.map(u,O=>new H.Range(O.start.line,O.start.character,O.end.line,O.end.character),D)}function k(u){if(u==null)return H.DiagnosticSeverity.Error;switch(u){case te.DiagnosticSeverity.Error:return H.DiagnosticSeverity.Error;case te.DiagnosticSeverity.Warning:return H.DiagnosticSeverity.Warning;case te.DiagnosticSeverity.Information:return H.DiagnosticSeverity.Information;case te.DiagnosticSeverity.Hint:return H.DiagnosticSeverity.Hint}return H.DiagnosticSeverity.Error}function M(u){if(mn.string(u))return A(u);if(bo.is(u))return A().appendCodeblock(u.value,u.language);if(Array.isArray(u)){let D=[];for(let O of u){let Q=A();bo.is(O)?Q.appendCodeblock(O.value,O.language):Q.appendMarkdown(O),D.push(Q)}return D}else return A(u)}function N(u){if(mn.string(u))return u;switch(u.kind){case te.MarkupKind.Markdown:return A(u.value);case te.MarkupKind.PlainText:return u.value;default:return`Unsupported Markup content received. Kind is: ${u.kind}`}}function A(u){let D;if(u===void 0||typeof u=="string")D=new H.MarkdownString(u);else switch(u.kind){case te.MarkupKind.Markdown:D=new H.MarkdownString(u.value);break;case te.MarkupKind.PlainText:D=new H.MarkdownString,D.appendText(u.value);break;default:D=new H.MarkdownString,D.appendText(`Unsupported Markup content received. Kind is: ${u.kind}`);break}return D.isTrusted=e,D.supportHtml=t,D}function W(u){if(u)return new H.Hover(M(u.contents),y(u.range))}async function J(u,D,O){if(!u)return;if(Array.isArray(u))return Re.map(u,Wn=>it(Wn,D),O);let Q=u,{defaultRange:pt,commitCharacters:St}=pe(Q,D),xe=await Re.map(Q.items,Wn=>it(Wn,St,pt,Q.itemDefaults?.insertTextMode,Q.itemDefaults?.insertTextFormat,Q.itemDefaults?.data),O);return new H.CompletionList(xe,Q.isIncomplete)}function pe(u,D){let O=u.itemDefaults?.editRange,Q=u.itemDefaults?.commitCharacters??D;return te.Range.is(O)?{defaultRange:y(O),commitCharacters:Q}:O!==void 0?{defaultRange:{inserting:y(O.insert),replacing:y(O.replace)},commitCharacters:Q}:{defaultRange:void 0,commitCharacters:Q}}function X(u){return te.CompletionItemKind.Text<=u&&u<=te.CompletionItemKind.TypeParameter?[u-1,void 0]:[H.CompletionItemKind.Text,u]}function ne(u){switch(u){case te.CompletionItemTag.Deprecated:return H.CompletionItemTag.Deprecated}}function le(u){if(u==null)return[];let D=[];for(let O of u){let Q=ne(O);Q!==void 0&&D.push(Q)}return D}function it(u,D,O,Q,pt,St){let xe=le(u.tags),Wn=Ze(u),Me=new vC.default(Wn);u.detail&&(Me.detail=u.detail),u.documentation&&(Me.documentation=N(u.documentation),Me.documentationFormat=mn.string(u.documentation)?"$string":u.documentation.kind),u.filterText&&(Me.filterText=u.filterText);let Ps=at(u,O,pt);if(Ps&&(Me.insertText=Ps.text,Me.range=Ps.range,Me.fromEdit=Ps.fromEdit),mn.number(u.kind)){let[Fb,Nf]=X(u.kind);Me.kind=Fb,Nf&&(Me.originalItemKind=Nf)}u.sortText&&(Me.sortText=u.sortText),u.additionalTextEdits&&(Me.additionalTextEdits=wt(u.additionalTextEdits));let Lf=u.commitCharacters!==void 0?mn.stringArray(u.commitCharacters)?u.commitCharacters:void 0:D;Lf&&(Me.commitCharacters=Lf.slice()),u.command&&(Me.command=st(u.command)),(u.deprecated===!0||u.deprecated===!1)&&(Me.deprecated=u.deprecated,u.deprecated===!0&&xe.push(H.CompletionItemTag.Deprecated)),(u.preselect===!0||u.preselect===!1)&&(Me.preselect=u.preselect);let Mf=u.data??St;Mf!==void 0&&(Me.data=Mf),xe.length>0&&(Me.tags=xe);let Ha=u.insertTextMode??Q;return Ha!==void 0&&(Me.insertTextMode=Ha,Ha===te.InsertTextMode.asIs&&(Me.keepWhitespace=!0)),Me}function Ze(u){return te.CompletionItemLabelDetails.is(u.labelDetails)?{label:u.label,detail:u.labelDetails.detail,description:u.labelDetails.description}:u.label}function at(u,D,O){let Q=u.insertTextFormat??O;if(u.textEdit!==void 0||D!==void 0){let[pt,St]=u.textEdit!==void 0?dn(u.textEdit):[D,u.textEditText??u.label];return Q===te.InsertTextFormat.Snippet?{text:new H.SnippetString(St),range:pt,fromEdit:!0}:{text:St,range:pt,fromEdit:!0}}else return u.insertText?Q===te.InsertTextFormat.Snippet?{text:new H.SnippetString(u.insertText),fromEdit:!1}:{text:u.insertText,fromEdit:!1}:void 0}function dn(u){return te.InsertReplaceEdit.is(u)?[{inserting:y(u.insert),replacing:y(u.replace)},u.newText]:[y(u.range),u.newText]}function Ot(u){if(u)return new H.TextEdit(y(u.range),u.newText)}async function bt(u,D){if(u)return Re.map(u,Ot,D)}function wt(u){if(!u)return;let D=new Array(u.length);for(let O=0;O<u.length;O++)D[O]=Ot(u[O]);return D}async function Cn(u,D){if(!u)return;let O=new H.SignatureHelp;return mn.number(u.activeSignature)?O.activeSignature=u.activeSignature:O.activeSignature=0,mn.number(u.activeParameter)?O.activeParameter=u.activeParameter:O.activeParameter=0,u.signatures&&(O.signatures=await On(u.signatures,D)),O}async function On(u,D){return Re.mapAsync(u,Ae,D)}async function Ae(u,D){let O=new H.SignatureInformation(u.label);return u.documentation!==void 0&&(O.documentation=N(u.documentation)),u.parameters!==void 0&&(O.parameters=await Ut(u.parameters,D)),u.activeParameter!==void 0&&(O.activeParameter=u.activeParameter),O}function Ut(u,D){return Re.map(u,Lt,D)}function Lt(u){let D=new H.ParameterInformation(u.label);return u.documentation&&(D.documentation=N(u.documentation)),D}function Ct(u){return u?new H.Location(i(u.uri),y(u.range)):void 0}async function dr(u,D){if(u)return Jn(u,D)}async function Ln(u,D){if(u)return Jn(u,D)}function Mn(u){if(!u)return;let D={targetUri:i(u.targetUri),targetRange:y(u.targetRange),originSelectionRange:y(u.originSelectionRange),targetSelectionRange:y(u.targetSelectionRange)};if(!D.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return D}async function Jn(u,D){if(u)if(mn.array(u)){if(u.length===0)return[];if(te.LocationLink.is(u[0])){let O=u;return Re.map(O,Mn,D)}else{let O=u;return Re.map(O,Ct,D)}}else return te.LocationLink.is(u)?[Mn(u)]:Ct(u)}async function lr(u,D){if(u)return Re.map(u,Ct,D)}async function Nn(u,D){if(u)return Re.map(u,Rn,D)}function Rn(u){let D=new H.DocumentHighlight(y(u.range));return mn.number(u.kind)&&(D.kind=Sn(u.kind)),D}function Sn(u){switch(u){case te.DocumentHighlightKind.Text:return H.DocumentHighlightKind.Text;case te.DocumentHighlightKind.Read:return H.DocumentHighlightKind.Read;case te.DocumentHighlightKind.Write:return H.DocumentHighlightKind.Write}return H.DocumentHighlightKind.Text}async function An(u,D){if(u)return Re.map(u,ln,D)}function ct(u){return u<=te.SymbolKind.TypeParameter?u-1:H.SymbolKind.Property}function Yn(u){switch(u){case te.SymbolTag.Deprecated:return H.SymbolTag.Deprecated;default:return}}function Dn(u){if(u==null)return;let D=[];for(let O of u){let Q=Yn(O);Q!==void 0&&D.push(Q)}return D.length===0?void 0:D}function ln(u){let D=u.data,O=u.location,Q=O.range===void 0||D!==void 0?new SC.default(u.name,ct(u.kind),u.containerName??"",O.range===void 0?i(O.uri):new H.Location(i(u.location.uri),y(O.range)),D):new H.SymbolInformation(u.name,ct(u.kind),u.containerName??"",new H.Location(i(u.location.uri),y(O.range)));return $n(Q,u),Q}async function fr(u,D){if(u!=null)return Re.map(u,fn,D)}function fn(u){let D=new H.DocumentSymbol(u.name,u.detail||"",ct(u.kind),y(u.range),y(u.selectionRange));if($n(D,u),u.children!==void 0&&u.children.length>0){let O=[];for(let Q of u.children)O.push(fn(Q));D.children=O}return D}function $n(u,D){u.tags=Dn(D.tags),D.deprecated&&(u.tags?u.tags.includes(H.SymbolTag.Deprecated)||(u.tags=u.tags.concat(H.SymbolTag.Deprecated)):u.tags=[H.SymbolTag.Deprecated])}function st(u){let D={title:u.title,command:u.command};return u.arguments&&(D.arguments=u.arguments),D}async function _t(u,D){if(u)return Re.map(u,st,D)}let Rt=new Map;Rt.set(te.CodeActionKind.Empty,H.CodeActionKind.Empty),Rt.set(te.CodeActionKind.QuickFix,H.CodeActionKind.QuickFix),Rt.set(te.CodeActionKind.Refactor,H.CodeActionKind.Refactor),Rt.set(te.CodeActionKind.RefactorExtract,H.CodeActionKind.RefactorExtract),Rt.set(te.CodeActionKind.RefactorInline,H.CodeActionKind.RefactorInline),Rt.set(te.CodeActionKind.RefactorRewrite,H.CodeActionKind.RefactorRewrite),Rt.set(te.CodeActionKind.Source,H.CodeActionKind.Source),Rt.set(te.CodeActionKind.SourceOrganizeImports,H.CodeActionKind.SourceOrganizeImports);function en(u){if(u==null)return;let D=Rt.get(u);if(D)return D;let O=u.split(".");D=H.CodeActionKind.Empty;for(let Q of O)D=D.append(Q);return D}function Wt(u){if(u!=null)return u.map(D=>en(D))}async function jn(u,D){if(u==null)return;let O=new wC.default(u.title,u.data);return u.kind!==void 0&&(O.kind=en(u.kind)),u.diagnostics!==void 0&&(O.diagnostics=c(u.diagnostics)),u.edit!==void 0&&(O.edit=await Mt(u.edit,D)),u.command!==void 0&&(O.command=st(u.command)),u.isPreferred!==void 0&&(O.isPreferred=u.isPreferred),u.disabled!==void 0&&(O.disabled={reason:u.disabled.reason}),O}function Zn(u,D){return Re.mapAsync(u,async O=>te.Command.is(O)?st(O):jn(O,D),D)}function _n(u){if(!u)return;let D=new yC.default(y(u.range));return u.command&&(D.command=st(u.command)),u.data!==void 0&&u.data!==null&&(D.data=u.data),D}async function er(u,D){if(u)return Re.map(u,_n,D)}async function Mt(u,D){if(!u)return;let O=new Map;if(u.changeAnnotations!==void 0){let St=u.changeAnnotations;await Re.forEach(Object.keys(St),xe=>{let Wn=w(St[xe]);O.set(xe,Wn)},D)}let Q=St=>{if(St!==void 0)return O.get(St)},pt=new H.WorkspaceEdit;if(u.documentChanges){let St=u.documentChanges;await Re.forEach(St,xe=>{if(te.CreateFile.is(xe))pt.createFile(i(xe.uri),xe.options,Q(xe.annotationId));else if(te.RenameFile.is(xe))pt.renameFile(i(xe.oldUri),i(xe.newUri),xe.options,Q(xe.annotationId));else if(te.DeleteFile.is(xe))pt.deleteFile(i(xe.uri),xe.options,Q(xe.annotationId));else if(te.TextDocumentEdit.is(xe)){let Wn=i(xe.textDocument.uri);for(let Me of xe.edits)te.AnnotatedTextEdit.is(Me)?pt.replace(Wn,y(Me.range),Me.newText,Q(Me.annotationId)):pt.replace(Wn,y(Me.range),Me.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(xe,void 0,4)}`)},D)}else if(u.changes){let St=u.changes;await Re.forEach(Object.keys(St),xe=>{pt.set(i(xe),wt(St[xe]))},D)}return pt}function w(u){if(u!==void 0)return{label:u.label,needsConfirmation:!!u.needsConfirmation,description:u.description}}function q(u){let D=y(u.range),O=u.target?s(u.target):void 0,Q=new bC.default(D,O);return u.tooltip!==void 0&&(Q.tooltip=u.tooltip),u.data!==void 0&&u.data!==null&&(Q.data=u.data),Q}async function U(u,D){if(u)return Re.map(u,q,D)}function K(u){return new H.Color(u.red,u.green,u.blue,u.alpha)}function Ce(u){return new H.ColorInformation(y(u.range),K(u.color))}async function be(u,D){if(u)return Re.map(u,Ce,D)}function Pe(u){let D=new H.ColorPresentation(u.label);return D.additionalTextEdits=wt(u.additionalTextEdits),u.textEdit&&(D.textEdit=Ot(u.textEdit)),D}async function qe(u,D){if(u)return Re.map(u,Pe,D)}function ue(u){if(u)switch(u){case te.FoldingRangeKind.Comment:return H.FoldingRangeKind.Comment;case te.FoldingRangeKind.Imports:return H.FoldingRangeKind.Imports;case te.FoldingRangeKind.Region:return H.FoldingRangeKind.Region}}function Se(u){return new H.FoldingRange(u.startLine,u.endLine,ue(u.kind))}async function ge(u,D){if(u)return Re.map(u,Se,D)}function Fe(u){return new H.SelectionRange(y(u.range),u.parent?Fe(u.parent):void 0)}async function et(u,D){return Array.isArray(u)?Re.map(u,Fe,D):[]}function ht(u){return te.InlineValueText.is(u)?new H.InlineValueText(y(u.range),u.text):te.InlineValueVariableLookup.is(u)?new H.InlineValueVariableLookup(y(u.range),u.variableName,u.caseSensitiveLookup):new H.InlineValueEvaluatableExpression(y(u.range),u.expression)}async function hr(u,D){return Array.isArray(u)?Re.map(u,ht,D):[]}async function pr(u,D){let O=typeof u.label=="string"?u.label:await Re.map(u.label,f,D),Q=new DC.default(R(u.position),O);return u.kind!==void 0&&(Q.kind=u.kind),u.textEdits!==void 0&&(Q.textEdits=await bt(u.textEdits,D)),u.tooltip!==void 0&&(Q.tooltip=E(u.tooltip)),u.paddingLeft!==void 0&&(Q.paddingLeft=u.paddingLeft),u.paddingRight!==void 0&&(Q.paddingRight=u.paddingRight),u.data!==void 0&&(Q.data=u.data),Q}function f(u){let D=new H.InlayHintLabelPart(u.value);return u.location!==void 0&&(D.location=Ct(u.location)),u.tooltip!==void 0&&(D.tooltip=E(u.tooltip)),u.command!==void 0&&(D.command=st(u.command)),D}function E(u){return typeof u=="string"?u:A(u)}async function G(u,D){if(Array.isArray(u))return Re.mapAsync(u,pr,D)}function De(u){if(u===null)return;let D=new CC.default(ct(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(D.tags=Dn(u.tags)),D}async function _(u,D){if(u!==null)return Re.map(u,De,D)}async function h(u,D){return new H.CallHierarchyIncomingCall(De(u.from),await P(u.fromRanges,D))}async function C(u,D){if(u!==null)return Re.mapAsync(u,h,D)}async function S(u,D){return new H.CallHierarchyOutgoingCall(De(u.to),await P(u.fromRanges,D))}async function v(u,D){if(u!==null)return Re.mapAsync(u,S,D)}async function l(u,D){if(u!=null)return new H.SemanticTokens(new Uint32Array(u.data),u.resultId)}function T(u){return new H.SemanticTokensEdit(u.start,u.deleteCount,u.data!==void 0?new Uint32Array(u.data):void 0)}async function F(u,D){if(u!=null)return new H.SemanticTokensEdits(u.edits.map(T),u.resultId)}function re(u){return u}async function He(u,D){if(u!=null)return new H.LinkedEditingRanges(await P(u.ranges,D),Oe(u.wordPattern))}function Oe(u){if(u!=null)return new RegExp(u)}function Ht(u){if(u===null)return;let D=new RC.default(ct(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(D.tags=Dn(u.tags)),D}async function tn(u,D){if(u!==null)return Re.map(u,Ht,D)}function Tn(u){if(mn.string(u))return u;if(te.RelativePattern.is(u)){if(te.URI.is(u.baseUri))return new H.RelativePattern(s(u.baseUri),u.pattern);if(te.WorkspaceFolder.is(u.baseUri)){let D=H.workspace.getWorkspaceFolder(s(u.baseUri.uri));return D!==void 0?new H.RelativePattern(D,u.pattern):void 0}}}async function he(u,D){if(!u)return;if(Array.isArray(u))return Re.map(u,pt=>Un(pt),D);let O=u,Q=await Re.map(O.items,pt=>Un(pt),D);return new H.InlineCompletionList(Q)}function Un(u){let D;typeof u.insertText=="string"?D=u.insertText:D=new H.SnippetString(u.insertText.value);let O;u.command&&(O=st(u.command));let Q=new H.InlineCompletionItem(D,y(u.range),O);return u.filterText&&(Q.filterText=u.filterText),Q}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:y,asRanges:P,asPosition:R,asDiagnosticSeverity:k,asDiagnosticTag:g,asHover:W,asCompletionResult:J,asCompletionItem:it,asTextEdit:Ot,asTextEdits:bt,asSignatureHelp:Cn,asSignatureInformations:On,asSignatureInformation:Ae,asParameterInformations:Ut,asParameterInformation:Lt,asDeclarationResult:dr,asDefinitionResult:Ln,asLocation:Ct,asReferences:lr,asDocumentHighlights:Nn,asDocumentHighlight:Rn,asDocumentHighlightKind:Sn,asSymbolKind:ct,asSymbolTag:Yn,asSymbolTags:Dn,asSymbolInformations:An,asSymbolInformation:ln,asDocumentSymbols:fr,asDocumentSymbol:fn,asCommand:st,asCommands:_t,asCodeAction:jn,asCodeActionKind:en,asCodeActionKinds:Wt,asCodeActionResult:Zn,asCodeLens:_n,asCodeLenses:er,asWorkspaceEdit:Mt,asDocumentLink:q,asDocumentLinks:U,asFoldingRangeKind:ue,asFoldingRange:Se,asFoldingRanges:ge,asColor:K,asColorInformation:Ce,asColorInformations:be,asColorPresentation:Pe,asColorPresentations:qe,asSelectionRange:Fe,asSelectionRanges:et,asInlineValue:ht,asInlineValues:hr,asInlayHint:pr,asInlayHints:G,asSemanticTokensLegend:re,asSemanticTokens:l,asSemanticTokensEdit:T,asSemanticTokensEdits:F,asCallHierarchyItem:De,asCallHierarchyItems:_,asCallHierarchyIncomingCall:h,asCallHierarchyIncomingCalls:C,asCallHierarchyOutgoingCall:S,asCallHierarchyOutgoingCalls:v,asLinkedEditingRanges:He,asTypeHierarchyItem:Ht,asTypeHierarchyItems:tn,asGlobPattern:Tn,asInlineCompletionResult:he,asInlineCompletionItem:Un}}wo.createConverter=_C});var Ve=x(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.generateUuid=vn.parse=vn.isUUID=vn.v4=vn.empty=void 0;var Gi=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Xi=class r extends Gi{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}};Xi._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Xi._timeHighBits=["8","9","a","b"];vn.empty=new Gi("00000000-0000-0000-0000-000000000000");function Pm(){return new Xi}vn.v4=Pm;var TC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function km(r){return TC.test(r)}vn.isUUID=km;function PC(r){if(!km(r))throw new Error("invalid uuid");return new Gi(r)}vn.parse=PC;function kC(){return Pm().asHex()}vn.generateUuid=kC});var Xu=x(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.ProgressPart=void 0;var Em=require("vscode"),xm=ie(),Im=hn(),Gu=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(xm.WorkDoneProgress.type,this._token,i=>{switch(i.kind){case"begin":this.begin(i);break;case"report":this.report(i);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&Em.window.withProgress({location:Em.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(xm.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((i,s)=>{this._resolve=i,this._reject=s})})}report(e){if(this._infinite&&Im.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(Im.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};Co.ProgressPart=Gu});var we=x(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.WorkspaceFeature=mt.TextDocumentLanguageFeature=mt.TextDocumentEventFeature=mt.DynamicDocumentFeature=mt.DynamicFeature=mt.StaticFeature=mt.ensure=mt.LSPCancellationError=void 0;var Wr=require("vscode"),Qu=ie(),Nt=hn(),qm=Ve(),Ju=class extends Wr.CancellationError{constructor(e){super(),this.data=e}};mt.LSPCancellationError=Ju;function EC(r,e){return r[e]===void 0&&(r[e]={}),r[e]}mt.ensure=EC;var Fm;(function(r){function e(t){let n=t;return n!=null&&Nt.func(n.fillClientCapabilities)&&Nt.func(n.initialize)&&Nt.func(n.getState)&&Nt.func(n.clear)&&(n.fillInitializeParams===void 0||Nt.func(n.fillInitializeParams))}r.is=e})(Fm||(mt.StaticFeature=Fm={}));var Om;(function(r){function e(t){let n=t;return n!=null&&Nt.func(n.fillClientCapabilities)&&Nt.func(n.initialize)&&Nt.func(n.getState)&&Nt.func(n.clear)&&(n.fillInitializeParams===void 0||Nt.func(n.fillInitializeParams))&&Nt.func(n.register)&&Nt.func(n.unregister)&&n.registrationType!==void 0}r.is=e})(Om||(mt.DynamicFeature=Om={}));var Qi=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let i of e){t++;for(let s of Wr.workspace.textDocuments)if(Wr.languages.match(i,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};mt.DynamicDocumentFeature=Qi;var Yu=class extends Qi{static textDocumentFilter(e,t){for(let n of e)if(Wr.languages.match(n,t)>0)return!0;return!1}constructor(e,t,n,i,s,o,a){super(e),this._event=t,this._type=n,this._middleware=i,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new Wr.EventEmitter}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let i=this._createParams(n);await this._client.sendNotification(this._type,i),this.notificationSent(this.getTextDocument(n),this._type,i)};if(this.matches(e)){let n=this._middleware();return n?n(e,i=>t(i)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(Wr.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};mt.TextDocumentEventFeature=Yu;var Zu=class extends Qi{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(Qu.TextDocumentRegistrationOptions.is(t)){let n=Qu.StaticRegistrationOptions.hasId(t)?t.id:qm.generateUuid(),i=t.documentSelector??e;if(i)return[n,Object.assign({},t,{documentSelector:i})]}else if(Nt.boolean(t)&&t===!0||Qu.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=Nt.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[qm.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return Nt.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&Wr.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};mt.TextDocumentLanguageFeature=Zu;var ed=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};mt.WorkspaceFeature=ed});var Mm=x((lT,Lm)=>{var xC=typeof process=="object"&&process&&process.platform==="win32";Lm.exports=xC?{sep:"\\"}:{sep:"/"}});var Um=x((fT,jm)=>{"use strict";jm.exports=Am;function Am(r,e,t){r instanceof RegExp&&(r=Nm(r,t)),e instanceof RegExp&&(e=Nm(e,t));var n=$m(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function Nm(r,e){var t=e.match(r);return t?t[0]:null}Am.range=$m;function $m(r,e,t){var n,i,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),p=c;if(c>=0&&d>0){if(r===e)return[c,d];for(n=[],s=t.length;p>=0&&!a;)p==c?(n.push(p),c=t.indexOf(r,p+1)):n.length==1?a=[n.pop(),d]:(i=n.pop(),i<s&&(s=i,o=d),d=t.indexOf(e,p+1)),p=c<d&&c>=0?c:d;n.length&&(a=[s,o])}return a}});var Xm=x((hT,Gm)=>{var Wm=Um();Gm.exports=FC;var Hm="\0SLASH"+Math.random()+"\0",Km="\0OPEN"+Math.random()+"\0",nd="\0CLOSE"+Math.random()+"\0",Vm="\0COMMA"+Math.random()+"\0",zm="\0PERIOD"+Math.random()+"\0";function td(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function IC(r){return r.split("\\\\").join(Hm).split("\\{").join(Km).split("\\}").join(nd).split("\\,").join(Vm).split("\\.").join(zm)}function qC(r){return r.split(Hm).join("\\").split(Km).join("{").split(nd).join("}").split(Vm).join(",").split(zm).join(".")}function Bm(r){if(!r)return[""];var e=[],t=Wm("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=Bm(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function FC(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Ji(IC(r),!0).map(qC)):[]}function OC(r){return"{"+r+"}"}function LC(r){return/^-?0\d/.test(r)}function MC(r,e){return r<=e}function NC(r,e){return r>=e}function Ji(r,e){var t=[],n=Wm("{","}",r);if(!n)return[r];var i=n.pre,s=n.post.length?Ji(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=i+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),p=c||d,m=n.body.indexOf(",")>=0;if(!p&&!m)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+nd+n.post,Ji(r)):[r];var g;if(p)g=n.body.split(/\.\./);else if(g=Bm(n.body),g.length===1&&(g=Ji(g[0],!1).map(OC),g.length===1))return s.map(function(it){return n.pre+g[0]+it});var R;if(p){var y=td(g[0]),P=td(g[1]),k=Math.max(g[0].length,g[1].length),M=g.length==3?Math.abs(td(g[2])):1,N=MC,A=P<y;A&&(M*=-1,N=NC);var W=g.some(LC);R=[];for(var J=y;N(J,P);J+=M){var pe;if(d)pe=String.fromCharCode(J),pe==="\\"&&(pe="");else if(pe=String(J),W){var X=k-pe.length;if(X>0){var ne=new Array(X+1).join("0");J<0?pe="-"+ne+pe.slice(1):pe=ne+pe}}R.push(pe)}}else{R=[];for(var le=0;le<g.length;le++)R.push.apply(R,Ji(g[le],!1))}for(var le=0;le<R.length;le++)for(var o=0;o<s.length;o++){var a=i+R[le]+s[o];(!e||p||a)&&t.push(a)}}return t}});var So=x((gT,ad)=>{var sn=ad.exports=(r,e,t={})=>(Ro(e),!t.nocomment&&e.charAt(0)==="#"?!1:new wi(e,t).match(r));ad.exports=sn;var sd=Mm();sn.sep=sd.sep;var En=Symbol("globstar **");sn.GLOBSTAR=En;var AC=Xm(),Qm={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},od="[^/]",rd=od+"*?",$C="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",jC="(?:(?!(?:\\/|^)\\.).)*?",Zm=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),Jm=Zm("().*{}+?[]^$\\!"),UC=Zm("[.("),Ym=/\/+/;sn.filter=(r,e={})=>(t,n,i)=>sn(t,r,e);var Dr=(r,e={})=>{let t={};return Object.keys(r).forEach(n=>t[n]=r[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};sn.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return sn;let e=sn,t=(n,i,s)=>e(n,i,Dr(r,s));return t.Minimatch=class extends e.Minimatch{constructor(i,s){super(i,Dr(r,s))}},t.Minimatch.defaults=n=>e.defaults(Dr(r,n)).Minimatch,t.filter=(n,i)=>e.filter(n,Dr(r,i)),t.defaults=n=>e.defaults(Dr(r,n)),t.makeRe=(n,i)=>e.makeRe(n,Dr(r,i)),t.braceExpand=(n,i)=>e.braceExpand(n,Dr(r,i)),t.match=(n,i,s)=>e.match(n,i,Dr(r,s)),t};sn.braceExpand=(r,e)=>ev(r,e);var ev=(r,e={})=>(Ro(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:AC(r)),WC=1024*64,Ro=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>WC)throw new TypeError("pattern is too long")},id=Symbol("subparse");sn.makeRe=(r,e)=>new wi(r,e||{}).makeRe();sn.match=(r,e,t={})=>{let n=new wi(e,t);return r=r.filter(i=>n.match(i)),n.options.nonull&&!r.length&&r.push(e),r};var HC=r=>r.replace(/\\(.)/g,"$1"),KC=r=>r.replace(/\\([^-\]])/g,"$1"),VC=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),zC=r=>r.replace(/[[\]\\]/g,"\\$&"),wi=class{constructor(e,t){Ro(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,n),n=this.globParts=n.map(i=>i.split(Ym)),this.debug(this.pattern,n),n=n.map((i,s,o)=>i.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(i=>i.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],p=e[s];if(this.debug(t,d,p),d===!1)return!1;if(d===En){this.debug("GLOBSTAR",[t,d,p]);var m=s,g=o+1;if(g===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!i.dot&&e[s].charAt(0)===".")return!1;return!0}for(;m<a;){var R=e[m];if(this.debug(`
globstar while`,e,m,t,g,R),this.matchOne(e.slice(m),t.slice(g),n))return this.debug("globstar found match!",m,a,R),!0;if(R==="."||R===".."||!i.dot&&R.charAt(0)==="."){this.debug("dot detected!",e,m,t,g);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,m,t,g),m===a))}var y;if(typeof d=="string"?(y=p===d,this.debug("string match",d,p,y)):(y=p.match(d),this.debug("pattern match",d,p,y)),!y)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return ev(this.pattern,this.options)}parse(e,t){Ro(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return En;if(e==="")return"";let i="",s=!1,o=!1,a=[],c=[],d,p=!1,m=-1,g=-1,R,y,P,k=e.charAt(0)===".",M=n.dot||k,N=()=>k?"":M?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",A=X=>X.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",W=()=>{if(d){switch(d){case"*":i+=rd,s=!0;break;case"?":i+=od,s=!0;break;default:i+="\\"+d;break}this.debug("clearStateChar %j %j",d,i),d=!1}};for(let X=0,ne;X<e.length&&(ne=e.charAt(X));X++){if(this.debug("%s	%s %s %j",e,X,i,ne),o){if(ne==="/")return!1;Jm[ne]&&(i+="\\"),i+=ne,o=!1;continue}switch(ne){case"/":return!1;case"\\":if(p&&e.charAt(X+1)==="-"){i+=ne;continue}W(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,X,i,ne),p){this.debug("  in class"),ne==="!"&&X===g+1&&(ne="^"),i+=ne;continue}this.debug("call clearStateChar %j",d),W(),d=ne,n.noext&&W();continue;case"(":{if(p){i+="(";continue}if(!d){i+="\\(";continue}let le={type:d,start:X-1,reStart:i.length,open:Qm[d].open,close:Qm[d].close};this.debug(this.pattern,"	",le),a.push(le),i+=le.open,le.start===0&&le.type!=="!"&&(k=!0,i+=A(e.slice(X+1))),this.debug("plType %j %j",d,i),d=!1;continue}case")":{let le=a[a.length-1];if(p||!le){i+="\\)";continue}a.pop(),W(),s=!0,y=le,i+=y.close,y.type==="!"&&c.push(Object.assign(y,{reEnd:i.length}));continue}case"|":{let le=a[a.length-1];if(p||!le){i+="\\|";continue}W(),i+="|",le.start===0&&le.type!=="!"&&(k=!0,i+=A(e.slice(X+1)));continue}case"[":if(W(),p){i+="\\"+ne;continue}p=!0,g=X,m=i.length,i+=ne;continue;case"]":if(X===g+1||!p){i+="\\"+ne;continue}R=e.substring(g+1,X);try{RegExp("["+zC(KC(R))+"]"),i+=ne}catch{i=i.substring(0,m)+"(?:$.)"}s=!0,p=!1;continue;default:W(),Jm[ne]&&!(ne==="^"&&p)&&(i+="\\"),i+=ne;break}}for(p&&(R=e.slice(g+1),P=this.parse(R,id),i=i.substring(0,m)+"\\["+P[0],s=s||P[1]),y=a.pop();y;y=a.pop()){let X;X=i.slice(y.reStart+y.open.length),this.debug("setting tail",i,y),X=X.replace(/((?:\\{2}){0,64})(\\?)\|/g,(le,it,Ze)=>(Ze||(Ze="\\"),it+it+Ze+"|")),this.debug(`tail=%j
   %s`,X,X,y,i);let ne=y.type==="*"?rd:y.type==="?"?od:"\\"+y.type;s=!0,i=i.slice(0,y.reStart)+ne+"\\("+X}W(),o&&(i+="\\\\");let J=UC[i.charAt(0)];for(let X=c.length-1;X>-1;X--){let ne=c[X],le=i.slice(0,ne.reStart),it=i.slice(ne.reStart,ne.reEnd-8),Ze=i.slice(ne.reEnd),at=i.slice(ne.reEnd-8,ne.reEnd)+Ze,dn=le.split(")").length,Ot=le.split("(").length-dn,bt=Ze;for(let Cn=0;Cn<Ot;Cn++)bt=bt.replace(/\)[+*?]?/,"");Ze=bt;let wt=Ze===""&&t!==id?"(?:$|\\/)":"";i=le+it+Ze+wt+at}if(i!==""&&s&&(i="(?=.)"+i),J&&(i=N()+i),t===id)return[i,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return HC(e);let pe=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",pe),{_glob:e,_src:i})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?rd:t.dot?$C:jC,i=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?VC(a):a===En?En:a._src).reduce((a,c)=>(a[a.length-1]===En&&c===En||a.push(c),a),[]),o.forEach((a,c)=>{a!==En||o[c-1]===En||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=En))}),o.filter(a=>a!==En).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,i)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;sd.sep!=="/"&&(e=e.split(sd.sep).join("/")),e=e.split(Ym),this.debug(this.pattern,"split",e);let i=this.set;this.debug(this.pattern,"set",i);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<i.length;o++){let a=i[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return sn.defaults(e).Minimatch}};sn.Minimatch=wi});var gd=x(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.DiagnosticFeature=_r.DiagnosticPullMode=_r.vsdiag=void 0;var BC=So(),me=require("vscode"),rt=ie(),GC=Ve(),cd=we();function Do(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var yn;(function(r){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={}))})(yn||(_r.vsdiag=yn={}));var _o;(function(r){r.onType="onType",r.onSave="onSave"})(_o||(_r.DiagnosticPullMode=_o={}));var xt;(function(r){r.active="open",r.reschedule="reschedule",r.outDated="drop"})(xt||(xt={}));var ud=class r{constructor(){this.open=new Set,this._onOpen=new me.EventEmitter,this._onClose=new me.EventEmitter,r.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,i=new Set;r.fillTabResources(i);let s=new Set,o=new Set(i);for(let a of n.values())i.has(a)?o.delete(a):s.add(a);if(this.open=i,s.size>0){let a=new Set;for(let c of s)a.add(me.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(me.Uri.parse(c));this._onOpen.fire(a)}};me.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=me.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof me.Uri?me.window.activeTextEditor?.document.uri===e:me.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof me.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return r.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let i of me.window.tabGroups.all)for(let s of i.tabs){let o=s.input,a;o instanceof me.TabInputText?a=o.uri:o instanceof me.TabInputTextDiff?a=o.modified:o instanceof me.TabInputCustom&&(a=o.uri),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},ft;(function(r){r[r.document=1]="document",r[r.workspace=2]="workspace"})(ft||(ft={}));var rr;(function(r){function e(t){return t instanceof me.Uri?t.toString():t.uri.toString()}r.asKey=e})(rr||(rr={}));var dd=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let i=e===ft.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof me.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=i.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},i.set(s,c)),c}update(e,t,n,i){let s=e===ft.document?this.documentPullStates:this.workspacePullStates,[o,a,c,d]=t instanceof me.Uri?[t.toString(),t,n,i]:[t.uri.toString(),t.uri,t.version,n],p=s.get(o);p===void 0?(p={document:a,pulledVersion:c,resultId:d},s.set(o,p)):(p.pulledVersion=c,p.resultId=d)}unTrack(e,t){let n=rr.asKey(t);(e===ft.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=rr.asKey(t);return(e===ft.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=rr.asKey(t);return(e===ft.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},ld=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new me.EventEmitter,this.provider=this.createProvider(),this.diagnostics=me.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new dd,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof me.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof me.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},i=>{this.client.error(`Document pull failed for text document ${n.toString()}`,i,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof me.Uri,i=n?e:e.uri,s=i.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(ft.document,e,t):this.documentStates.track(ft.document,e);if(o===void 0){let c=new me.CancellationTokenSource;this.openRequests.set(s,{state:xt.active,document:e,version:t,tokenSource:c});let d,p;try{d=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:yn.DocumentDiagnosticReportKind.full,items:[]}}catch(m){if(m instanceof cd.LSPCancellationError&&rt.DiagnosticServerCancellationData.is(m.data)&&m.data.retriggerRequest===!1&&(p={state:xt.outDated,document:e}),p===void 0&&m instanceof me.CancellationError)p={state:xt.reschedule,document:e};else throw m}if(p=p??this.openRequests.get(s),p===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(i);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(ft.document,e);return}if(p.state===xt.outDated)return;d!==void 0&&(d.kind===yn.DocumentDiagnosticReportKind.full&&this.diagnostics.set(i,d.items),a.pulledVersion=t,a.resultId=d.resultId),p.state===xt.reschedule&&this.pull(e)}else o.state===xt.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:xt.reschedule,document:o.document})):o.state===xt.outDated&&this.openRequests.set(s,{state:xt.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof me.Uri?e:e.uri,n=t.toString(),i=this.openRequests.get(n);this.options.workspaceDiagnostics?i!==void 0?this.openRequests.set(n,{state:xt.reschedule,document:e}):this.pull(e,()=>{this.forget(ft.document,e)}):(i!==void 0&&(i.state===xt.active&&i.tokenSource.cancel(),this.openRequests.set(n,{state:xt.outDated,document:e})),this.diagnostics.delete(t),this.forget(ft.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,rt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof cd.LSPCancellationError)&&!rt.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,rt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new me.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===yn.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(ft.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(ft.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,i)=>{let s=(a,c,d)=>{let p={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof me.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:yn.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(rt.DocumentDiagnosticRequest.type,p,d).then(async m=>m==null||this.isDisposed||d.isCancellationRequested?{kind:yn.DocumentDiagnosticReportKind.full,items:[]}:m.kind===rt.DocumentDiagnosticReportKind.Full?{kind:yn.DocumentDiagnosticReportKind.full,resultId:m.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(m.items,d)}:{kind:yn.DocumentDiagnosticReportKind.unChanged,resultId:m.resultId},m=>this.client.handleFailedRequest(rt.DocumentDiagnosticRequest.type,d,m,{kind:yn.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,i,s):s(t,n,i)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,i)=>{let s=async d=>d.kind===rt.DocumentDiagnosticReportKind.Full?{kind:yn.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version,items:await this.client.protocol2CodeConverter.asDiagnostics(d.items,n)}:{kind:yn.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version},o=d=>{let p=[];for(let m of d)p.push({uri:this.client.code2ProtocolConverter.asUri(m.uri),value:m.value});return p},a=(d,p)=>{let m=(0,GC.generateUuid)(),g=this.client.onProgress(rt.WorkspaceDiagnosticRequest.partialResult,m,async y=>{if(y==null){i(null);return}let P={items:[]};for(let k of y.items)try{P.items.push(await s(k))}catch(M){this.client.error("Converting workspace diagnostics failed.",M)}i(P)}),R={identifier:this.options.identifier,previousResultIds:o(d),partialResultToken:m};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(rt.WorkspaceDiagnosticRequest.type,R,p).then(async y=>{if(p.isCancellationRequested)return{items:[]};let P={items:[]};for(let k of y.items)P.items.push(await s(k));return g.dispose(),i(P),{items:[]}},y=>(g.dispose(),this.client.handleFailedRequest(rt.DocumentDiagnosticRequest.type,p,y,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,i,a):a(t,n,i)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===xt.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:xt.outDated,document:t.document});this.diagnostics.dispose()}},fd=class{constructor(e){this.diagnosticRequestor=e,this.documents=new rt.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=rr.asKey(e);this.documents.has(t)||(this.documents.set(t,e,rt.Touch.Last),this.trigger())}remove(e){let t=rr.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,rt.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=rr.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,rt.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?rr.asKey(this.endDocument):void 0}},hd=class{constructor(e,t,n){let i=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=y=>{let P=n.documentSelector;if(i.match!==void 0)return i.match(P,y);for(let k of P)if(rt.TextDocumentFilter.is(k)){if(typeof k=="string"||k.language!==void 0&&k.language!=="*"||k.scheme!==void 0&&k.scheme!=="*"&&k.scheme!==y.scheme)return!1;if(k.pattern!==void 0){let M=new BC.Minimatch(k.pattern,{noext:!0});if(!M.makeRe()||!M.match(y.fsPath))return!1}}return!0},c=y=>y instanceof me.Uri?a(y):me.languages.match(s,y)>0&&t.isVisible(y),d=y=>y instanceof me.Uri?this.activeTextDocument?.uri.toString()===y.toString():this.activeTextDocument===y;this.diagnosticRequestor=new ld(e,t,n),this.backgroundScheduler=new fd(this.diagnosticRequestor);let p=y=>{!c(y)||!n.interFileDependencies||d(y)||this.backgroundScheduler.add(y)};this.activeTextDocument=me.window.activeTextEditor?.document,me.window.onDidChangeActiveTextEditor(y=>{let P=this.activeTextDocument;this.activeTextDocument=y?.document,P!==void 0&&p(P),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let m=e.getFeature(rt.DidOpenTextDocumentNotification.method);o.push(m.onNotificationSent(y=>{let P=y.textDocument;this.diagnosticRequestor.knows(ft.document,P)||c(P)&&this.diagnosticRequestor.pull(P,()=>{p(P)})})),o.push(t.onOpen(y=>{for(let P of y){if(this.diagnosticRequestor.knows(ft.document,P))continue;let k=P.toString(),M;for(let N of me.workspace.textDocuments)if(k===N.uri.toString()){M=N;break}M!==void 0&&c(M)&&this.diagnosticRequestor.pull(M,()=>{p(M)})}}));let g=new Set;for(let y of me.workspace.textDocuments)c(y)&&(this.diagnosticRequestor.pull(y,()=>{p(y)}),g.add(y.uri.toString()));if(i.onTabs===!0)for(let y of t.getTabResources())!g.has(y.toString())&&c(y)&&this.diagnosticRequestor.pull(y,()=>{p(y)});if(i.onChange===!0){let y=e.getFeature(rt.DidChangeTextDocumentNotification.method);o.push(y.onNotificationSent(async P=>{let k=P.textDocument;(i.filter===void 0||!i.filter(k,_o.onType))&&this.diagnosticRequestor.knows(ft.document,k)&&this.diagnosticRequestor.pull(k,()=>{this.backgroundScheduler.trigger()})}))}if(i.onSave===!0){let y=e.getFeature(rt.DidSaveTextDocumentNotification.method);o.push(y.onNotificationSent(P=>{let k=P.textDocument;(i.filter===void 0||!i.filter(k,_o.onSave))&&this.diagnosticRequestor.knows(ft.document,k)&&this.diagnosticRequestor.pull(P.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let R=e.getFeature(rt.DidCloseTextDocumentNotification.method);o.push(R.onNotificationSent(y=>{this.cleanUpDocument(y.textDocument)})),t.onClose(y=>{for(let P of y)this.cleanUpDocument(P)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let y of me.workspace.textDocuments)c(y)&&this.diagnosticRequestor.pull(y)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=me.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(ft.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},pd=class extends cd.TextDocumentLanguageFeature{constructor(e){super(e,rt.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=Do(Do(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,Do(Do(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(rt.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[i,s]=this.getRegistration(t,e.diagnosticProvider);!i||!s||this.register({id:i,registerOptions:s})}clear(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.clear()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new ud);let t=new hd(this._client,this.tabs,e);return[t.disposable,t]}};_r.DiagnosticFeature=pd});var rv=x(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.NotebookDocumentSyncFeature=void 0;var It=require("vscode"),XC=So(),ir=ie(),QC=Ve(),tv=hn();function nv(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Ci;(function(r){let e;(function(t){function n(g,R){return{version:g.version,uri:R.asUri(g.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function i(g,R,y){let P=ir.NotebookDocument.create(y.asUri(g.uri),g.notebookType,g.version,s(R,y));return Object.keys(g.metadata).length>0&&(P.metadata=o(g.metadata)),P}t.asNotebookDocument=i;function s(g,R){return g.map(y=>a(y,R))}t.asNotebookCells=s;function o(g){return d(new Set,g)}t.asMetadata=o;function a(g,R){let y=ir.NotebookCell.create(c(g.kind),R.asUri(g.document.uri));return Object.keys(g.metadata).length>0&&(y.metadata=o(g.metadata)),g.executionSummary!==void 0&&tv.number(g.executionSummary.executionOrder)&&tv.boolean(g.executionSummary.success)&&(y.executionSummary={executionOrder:g.executionSummary.executionOrder,success:g.executionSummary.success}),y}t.asNotebookCell=a;function c(g){switch(g){case It.NotebookCellKind.Markup:return ir.NotebookCellKind.Markup;case It.NotebookCellKind.Code:return ir.NotebookCellKind.Code}}function d(g,R){if(g.has(R))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(R)){let y=[];for(let P of R)if(P!==null&&typeof P=="object"||Array.isArray(P))y.push(d(g,P));else{if(P instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");y.push(P)}return y}else{let y=Object.keys(R),P=Object.create(null);for(let k of y){let M=R[k];if(M!==null&&typeof M=="object"||Array.isArray(M))P[k]=d(g,M);else{if(M instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");P[k]=M}}return P}}function p(g,R){let y=R.asChangeTextDocumentParams(g,g.document.uri,g.document.version);return{document:y.textDocument,changes:y.contentChanges}}t.asTextContentChange=p;function m(g,R){let y=Object.create(null);if(g.metadata&&(y.metadata=r.c2p.asMetadata(g.metadata)),g.cells!==void 0){let P=Object.create(null),k=g.cells;k.structure&&(P.structure={array:{start:k.structure.array.start,deleteCount:k.structure.array.deleteCount,cells:k.structure.array.cells!==void 0?k.structure.array.cells.map(M=>r.c2p.asNotebookCell(M,R)):void 0},didOpen:k.structure.didOpen!==void 0?k.structure.didOpen.map(M=>R.asOpenTextDocumentParams(M.document).textDocument):void 0,didClose:k.structure.didClose!==void 0?k.structure.didClose.map(M=>R.asCloseTextDocumentParams(M.document).textDocument):void 0}),k.data!==void 0&&(P.data=k.data.map(M=>r.c2p.asNotebookCell(M,R))),k.textContent!==void 0&&(P.textContent=k.textContent.map(M=>r.c2p.asTextContentChange(M,R))),Object.keys(P).length>0&&(y.cells=P)}return y}t.asNotebookDocumentChangeEvent=m})(e=r.c2p||(r.c2p={}))})(Ci||(Ci={}));var md;(function(r){function e(a,c,d){let p=a.length,m=c.length,g=0;for(;g<m&&g<p&&t(a[g],c[g],d);)g++;if(g<m&&g<p){let R=p-1,y=m-1;for(;R>=0&&y>=0&&t(a[R],c[y],d);)R--,y--;let P=R+1-g,k=g===y+1?void 0:c.slice(g,y+1);return k!==void 0?{start:g,deleteCount:P,cells:k}:{start:g,deleteCount:P}}else return g<m?{start:g,deleteCount:0,cells:c.slice(g)}:g<p?{start:g,deleteCount:p-g}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&i(a.timing,c.timing)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let d=Array.isArray(a),p=Array.isArray(c);if(d!==p)return!1;if(d&&p){if(a.length!==c.length)return!1;for(let m=0;m<a.length;m++)if(!s(a[m],c[m]))return!1}if(o(a)&&o(c)){let m=Object.keys(a),g=Object.keys(c);if(m.length!==g.length||(m.sort(),g.sort(),!s(m,g)))return!1;for(let R=0;R<m.length;R++){let y=m[R];if(!s(a[y],c[y]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(md||(md={}));var vd;(function(r){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let i=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&i.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new XC.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(i.fsPath))return!1}return!0}r.matchNotebook=e})(vd||(vd={}));var To;(function(r){function e(n){let i=n.notebookSelector,s=[];for(let o of i){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,d=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let p of o.cells)s.push(t(a,c,d,p.language));else s.push(t(a,c,d,void 0))}return s}r.asDocumentSelector=e;function t(n,i,s,o){return i===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:i,pattern:s},language:o}}})(To||(To={}));var Po;(function(r){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}r.create=e})(Po||(Po={}));var Ri=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(To.asDocumentSelector(t)),It.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of It.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);It.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&It.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),It.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of It.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return It.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(It.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),i=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(i&&s||!i&&!s)return;if(i){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else i&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){It.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let i=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===i.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let i=this.asNotebookDocumentChangeEvent(e,void 0,n,t);i!==void 0&&this.doSendChange(i,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let i=this.getMatchingCells(t);if(i===void 0)return;this.didOpen(t,i,n)}else{let i=this.getMatchingCells(t);if(i===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,i);s!==void 0&&this.doSendChange(s,i).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(i=>t.uris.has(i.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=Ci.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(d=>this.client.code2ProtocolConverter.asTextDocumentItem(d.document));try{await this.client.sendNotification(ir.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(d){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",d),d}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),Po.create(t)),i?.didOpen!==void 0?i.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(ir.DidChangeNotebookDocumentNotification.type,{notebookDocument:Ci.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:Ci.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},i=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),Po.create(t??[])),i?.didChange!==void 0?i?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async i=>{try{await this.client.sendNotification(ir.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(i.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(ir.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),i?.didClose!==void 0?i.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,i){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=Ci.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(i.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&i!==void 0){let a=n.cells,c=i,d=md.computeDiff(a,c,!1),p,m;if(d!==void 0){p=d.cells===void 0?new Map:new Map(d.cells.map(y=>[y.document.uri.toString(),y])),m=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(y=>[y.document.uri.toString(),y]));for(let y of Array.from(m.keys()))p.has(y)&&(m.delete(y),p.delete(y));s.cells=s.cells??{};let g=[],R=[];if(p.size>0||m.size>0){for(let y of p.values())g.push(y);for(let y of m.values())R.push(y)}s.cells.structure={array:d,didOpen:g,didClose:R}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||vd.matchNotebook(n.notebook,e)){let i=this.filterCells(e,t,n.cells);return i.length===0?void 0:i}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let i=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some(a=>a.language==="*"||o===a.language)}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,i):i}},ko=class r{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=ir.NotebookDocumentSyncRegistrationType.type,It.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Ri&&s.didOpenNotebookCellTextDocument(n,i)}),It.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==r.CellScheme)return;let[i]=this.findNotebookDocumentAndCell(n);if(i!==void 0)for(let s of this.registrations.values())s instanceof Ri&&s.didChangeNotebookCellTextDocument(i,t)}),It.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Ri&&s.didCloseNotebookCellTextDocument(n,i)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=nv(nv(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(To.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??QC.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new Ri(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}clear(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==r.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&It.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of It.workspace.notebookDocuments)for(let i of n.getCells())if(i.document.uri.toString()===t)return[n,i];return[void 0,void 0]}};Eo.NotebookDocumentSyncFeature=ko;ko.CellScheme="vscode-notebook-cell"});var sv=x(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.SyncConfigurationFeature=Tr.toJSONObject=Tr.ConfigurationFeature=void 0;var Si=require("vscode"),Yi=ie(),JC=hn(),YC=Ve(),iv=we(),yd=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Yi.ConfigurationRequest.type,(t,n)=>{let i=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,i):i(t,n)})}getConfiguration(e,t){let n=null;if(t){let i=t.lastIndexOf(".");if(i===-1)n=Hr(Si.workspace.getConfiguration(void 0,e).get(t));else{let s=Si.workspace.getConfiguration(t.substr(0,i),e);s&&(n=Hr(s.get(t.substr(i+1))))}}else{let i=Si.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(i))i.has(s)&&(n[s]=Hr(i.get(s)))}return n===void 0&&(n=null),n}clear(){}};Tr.ConfigurationFeature=yd;function Hr(r){if(r){if(Array.isArray(r))return r.map(Hr);if(typeof r=="object"){let e=Object.create(null);for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=Hr(r[t]));return e}}return r}Tr.toJSONObject=Hr;var bd=class{constructor(e){this._client=e,this.isCleared=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Yi.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,iv.ensure)((0,iv.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){this.isCleared=!1;let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:YC.generateUuid(),registerOptions:{section:e}})}register(e){let t=Si.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isCleared=!0}onDidChangeConfiguration(e,t){if(this.isCleared)return;let n;if(JC.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let i=async o=>o===void 0?this._client.sendNotification(Yi.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Yi.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,i):i(n)).catch(o=>{this._client.error(`Sending notification ${Yi.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,i=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=Si.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=Si.workspace.getConfiguration(void 0,n).get(o),c){let d=e[s].split(".");t(i,d)[d[d.length-1]]=Hr(c)}}return i}};Tr.SyncConfigurationFeature=bd});var ov=x(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.DidSaveTextDocumentFeature=Gt.WillSaveWaitUntilFeature=Gt.WillSaveFeature=Gt.DidChangeTextDocumentFeature=Gt.DidCloseTextDocumentFeature=Gt.DidOpenTextDocumentFeature=void 0;var on=require("vscode"),Ne=ie(),Xe=we(),Di=Ve(),wd=class extends Xe.TextDocumentEventFeature{constructor(e,t){super(e,on.workspace.onDidOpenTextDocument,Ne.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,Xe.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Di.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Ne.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);on.workspace.textDocuments.forEach(n=>{let i=n.uri.toString();if(!this._syncedDocuments.has(i)&&on.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(i,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};Gt.DidOpenTextDocumentFeature=wd;var Cd=class extends Xe.TextDocumentEventFeature{constructor(e,t,n){super(e,on.workspace.onDidCloseTextDocument,Ne.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,i=>e.code2ProtocolConverter.asCloseTextDocumentParams(i),i=>i,Xe.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return Ne.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Di.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(i=>{if(on.languages.match(t,i)>0&&!this._selectorFilter(n,i)&&!this._client.hasDedicatedTextSynchronizationFeature(i)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(i.uri.toString()),(s.didClose?s.didClose(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};Gt.DidCloseTextDocumentFeature=Cd;var Rd=class extends Xe.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new on.EventEmitter,this._onPendingChangeAdded=new on.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Ne.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Ne.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==Ne.TextDocumentSyncKind.None&&this.register({id:Di.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=on.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,i=[];for(let s of this._changeData.values())if(on.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===Ne.TextDocumentSyncKind.Incremental){let a=async c=>{let d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification(Ne.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Ne.DidChangeTextDocumentNotification.type,d)};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Ne.TextDocumentSyncKind.Full){let a=async c=>{let d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(i).then(void 0,s=>{throw this._client.error(`Sending document notification ${Ne.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Ne.TextDocumentSyncKind.None;else{this._syncKind=Ne.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Ne.TextDocumentSyncKind.Full)break}}clear(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Ne.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(on.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==Ne.TextDocumentSyncKind.Full)switch(e){case Ne.TextDocumentSyncKind.Full:this._syncKind=e;break;case Ne.TextDocumentSyncKind.Incremental:this._syncKind===Ne.TextDocumentSyncKind.None&&(this._syncKind=Ne.TextDocumentSyncKind.Incremental);break}}};Gt.DidChangeTextDocumentFeature=Rd;var Sd=class extends Xe.TextDocumentEventFeature{constructor(e){super(e,on.workspace.onWillSaveTextDocument,Ne.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>Xe.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return Ne.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:Di.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};Gt.WillSaveFeature=Sd;var Dd=class extends Xe.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Ne.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:Di.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=on.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(Xe.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=i=>this._client.sendRequest(Ne.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(i)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};Gt.WillSaveWaitUntilFeature=Dd;var _d=class extends Xe.TextDocumentEventFeature{constructor(e){super(e,on.workspace.onDidSaveTextDocument,Ne.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,Xe.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Ne.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let i=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:Di.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},i)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};Gt.DidSaveTextDocumentFeature=_d});var av=x(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.CompletionItemFeature=void 0;var ZC=require("vscode"),ve=ie(),Td=we(),eR=Ve(),tR=[ve.CompletionItemKind.Text,ve.CompletionItemKind.Method,ve.CompletionItemKind.Function,ve.CompletionItemKind.Constructor,ve.CompletionItemKind.Field,ve.CompletionItemKind.Variable,ve.CompletionItemKind.Class,ve.CompletionItemKind.Interface,ve.CompletionItemKind.Module,ve.CompletionItemKind.Property,ve.CompletionItemKind.Unit,ve.CompletionItemKind.Value,ve.CompletionItemKind.Enum,ve.CompletionItemKind.Keyword,ve.CompletionItemKind.Snippet,ve.CompletionItemKind.Color,ve.CompletionItemKind.File,ve.CompletionItemKind.Reference,ve.CompletionItemKind.Folder,ve.CompletionItemKind.EnumMember,ve.CompletionItemKind.Constant,ve.CompletionItemKind.Struct,ve.CompletionItemKind.Event,ve.CompletionItemKind.Operator,ve.CompletionItemKind.TypeParameter],Pd=class extends Td.TextDocumentLanguageFeature{constructor(e){super(e,ve.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,Td.ensure)((0,Td.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ve.MarkupKind.Markdown,ve.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ve.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ve.InsertTextMode.asIs,ve.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ve.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:tR},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:eR.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],i=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,d,p)=>{let m=this._client,g=this._client.middleware,R=(y,P,k,M)=>m.sendRequest(ve.CompletionRequest.type,m.code2ProtocolConverter.asCompletionParams(y,P,k),M).then(N=>M.isCancellationRequested?null:m.protocol2CodeConverter.asCompletionResult(N,i,M),N=>m.handleFailedRequest(ve.CompletionRequest.type,M,N,null));return g.provideCompletionItem?g.provideCompletionItem(a,c,p,d,R):R(a,c,p,d)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let d=this._client,p=this._client.middleware,m=(g,R)=>d.sendRequest(ve.CompletionResolveRequest.type,d.code2ProtocolConverter.asCompletionItem(g,!!this.labelDetailsSupport.get(t)),R).then(y=>R.isCancellationRequested?null:d.protocol2CodeConverter.asCompletionItem(y),y=>d.handleFailedRequest(ve.CompletionResolveRequest.type,R,y,g));return p.resolveCompletionItem?p.resolveCompletionItem(a,c,m):m(a,c)}:void 0};return[ZC.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};xo.CompletionItemFeature=Pd});var cv=x(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.HoverFeature=void 0;var nR=require("vscode"),Zi=ie(),kd=we(),rR=Ve(),Ed=class extends kd.TextDocumentLanguageFeature{constructor(e){super(e,Zi.HoverRequest.type)}fillClientCapabilities(e){let t=(0,kd.ensure)((0,kd.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[Zi.MarkupKind.Markdown,Zi.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:rR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Zi.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asHover(R),R=>a.handleFailedRequest(Zi.HoverRequest.type,g,R,null)),d=a.middleware;return d.provideHover?d.provideHover(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return nR.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Io.HoverFeature=Ed});var uv=x(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.DefinitionFeature=void 0;var iR=require("vscode"),xd=ie(),Id=we(),sR=Ve(),qd=class extends Id.TextDocumentLanguageFeature{constructor(e){super(e,xd.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,Id.ensure)((0,Id.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:sR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(xd.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(R,g),R=>a.handleFailedRequest(xd.DefinitionRequest.type,g,R,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return iR.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};qo.DefinitionFeature=qd});var lv=x(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.SignatureHelpFeature=void 0;var dv=require("vscode"),es=ie(),Fd=we(),oR=Ve(),Od=class extends Fd.TextDocumentLanguageFeature{constructor(e){super(e,es.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,Fd.ensure)((0,Fd.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[es.MarkupKind.Markdown,es.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:oR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,i,s,o)=>{let a=this._client,c=(p,m,g,R)=>a.sendRequest(es.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(p,m,g),R).then(y=>R.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(y,R),y=>a.handleFailedRequest(es.SignatureHelpRequest.type,R,y,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(n,i,o,s,c):c(n,i,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let i=e.triggerCharacters||[];return dv.languages.registerSignatureHelpProvider(n,t,...i)}else{let i={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return dv.languages.registerSignatureHelpProvider(n,t,i)}}};Fo.SignatureHelpFeature=Od});var fv=x(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.DocumentHighlightFeature=void 0;var aR=require("vscode"),Ld=ie(),Md=we(),cR=Ve(),Nd=class extends Md.TextDocumentLanguageFeature{constructor(e){super(e,Ld.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,Md.ensure)((0,Md.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:cR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Ld.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(R,g),R=>a.handleFailedRequest(Ld.DocumentHighlightRequest.type,g,R,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(i,s,o,c):c(i,s,o)}};return[aR.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Oo.DocumentHighlightFeature=Nd});var jd=x(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.DocumentSymbolFeature=zn.SupportedSymbolTags=zn.SupportedSymbolKinds=void 0;var uR=require("vscode"),Te=ie(),Ad=we(),dR=Ve();zn.SupportedSymbolKinds=[Te.SymbolKind.File,Te.SymbolKind.Module,Te.SymbolKind.Namespace,Te.SymbolKind.Package,Te.SymbolKind.Class,Te.SymbolKind.Method,Te.SymbolKind.Property,Te.SymbolKind.Field,Te.SymbolKind.Constructor,Te.SymbolKind.Enum,Te.SymbolKind.Interface,Te.SymbolKind.Function,Te.SymbolKind.Variable,Te.SymbolKind.Constant,Te.SymbolKind.String,Te.SymbolKind.Number,Te.SymbolKind.Boolean,Te.SymbolKind.Array,Te.SymbolKind.Object,Te.SymbolKind.Key,Te.SymbolKind.Null,Te.SymbolKind.EnumMember,Te.SymbolKind.Struct,Te.SymbolKind.Event,Te.SymbolKind.Operator,Te.SymbolKind.TypeParameter];zn.SupportedSymbolTags=[Te.SymbolTag.Deprecated];var $d=class extends Ad.TextDocumentLanguageFeature{constructor(e){super(e,Te.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Ad.ensure)((0,Ad.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:zn.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:zn.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:dR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(Te.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(p),m);if(m.isCancellationRequested||g===void 0||g===null)return null;if(g.length===0)return[];{let R=g[0];return Te.DocumentSymbol.is(R)?await a.protocol2CodeConverter.asDocumentSymbols(g,m):await a.protocol2CodeConverter.asSymbolInformations(g,m)}}catch(g){return a.handleFailedRequest(Te.DocumentSymbolRequest.type,m,g,null)}},d=a.middleware;return d.provideDocumentSymbols?d.provideDocumentSymbols(s,o,c):c(s,o)}},i=e.label!==void 0?{label:e.label}:void 0;return[uR.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,i),n]}};zn.DocumentSymbolFeature=$d});var pv=x(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.WorkspaceSymbolFeature=void 0;var lR=require("vscode"),ts=ie(),Ud=we(),hv=jd(),fR=Ve(),Wd=class extends Ud.WorkspaceFeature{constructor(e){super(e,ts.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Ud.ensure)((0,Ud.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:hv.SupportedSymbolKinds},t.tagSupport={valueSet:hv.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:fR.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(ts.WorkspaceSymbolRequest.type,{query:c},d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(p,d),p=>s.handleFailedRequest(ts.WorkspaceSymbolRequest.type,d,p,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,i,o):o(n,i)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(ts.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(p),p=>s.handleFailedRequest(ts.WorkspaceSymbolResolveRequest.type,d,p,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,i,o):o(n,i)}:void 0};return[lR.languages.registerWorkspaceSymbolProvider(t),t]}};Lo.WorkspaceSymbolFeature=Wd});var gv=x(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.ReferencesFeature=void 0;var hR=require("vscode"),Hd=ie(),Kd=we(),pR=Ve(),Vd=class extends Kd.TextDocumentLanguageFeature{constructor(e){super(e,Hd.ReferencesRequest.type)}fillClientCapabilities(e){(0,Kd.ensure)((0,Kd.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:pR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(i,s,o,a)=>{let c=this._client,d=(m,g,R,y)=>c.sendRequest(Hd.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(m,g,R),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(P,y),P=>c.handleFailedRequest(Hd.ReferencesRequest.type,y,P,null)),p=c.middleware;return p.provideReferences?p.provideReferences(i,s,o,a,d):d(i,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return hR.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Mo.ReferencesFeature=Vd});var mv=x(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.CodeActionFeature=void 0;var gR=require("vscode"),an=ie(),mR=Ve(),zd=we(),Bd=class extends zd.TextDocumentLanguageFeature{constructor(e){super(e,an.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,zd.ensure)((0,zd.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[an.CodeActionKind.Empty,an.CodeActionKind.QuickFix,an.CodeActionKind.Refactor,an.CodeActionKind.RefactorExtract,an.CodeActionKind.RefactorInline,an.CodeActionKind.RefactorRewrite,an.CodeActionKind.Source,an.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:mR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(i,s,o,a)=>{let c=this._client,d=async(m,g,R,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),context:c.code2ProtocolConverter.asCodeActionContextSync(R)};return c.sendRequest(an.CodeActionRequest.type,P,y).then(k=>y.isCancellationRequested||k===null||k===void 0?null:c.protocol2CodeConverter.asCodeActionResult(k,y),k=>c.handleFailedRequest(an.CodeActionRequest.type,y,k,null))},p=c.middleware;return p.provideCodeActions?p.provideCodeActions(i,s,o,a,d):d(i,s,o,a)},resolveCodeAction:e.resolveProvider?(i,s)=>{let o=this._client,a=this._client.middleware,c=async(d,p)=>o.sendRequest(an.CodeActionResolveRequest.type,o.code2ProtocolConverter.asCodeActionSync(d),p).then(m=>p.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(m,p),m=>o.handleFailedRequest(an.CodeActionResolveRequest.type,p,m,d));return a.resolveCodeAction?a.resolveCodeAction(i,s,c):c(i,s)}:void 0};return[gR.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};No.CodeActionFeature=Bd});var yv=x(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.CodeLensFeature=void 0;var vv=require("vscode"),_i=ie(),vR=Ve(),ns=we(),Gd=class extends ns.TextDocumentLanguageFeature{constructor(e){super(e,_i.CodeLensRequest.type)}fillClientCapabilities(e){(0,ns.ensure)((0,ns.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,ns.ensure)((0,ns.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(_i.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let i=this.getRegistrationOptions(t,e.codeLensProvider);i&&this.register({id:vR.generateUuid(),registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new vv.EventEmitter,i={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(_i.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(p),m).then(g=>m.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(g,m),g=>a.handleFailedRequest(_i.CodeLensRequest.type,m,g,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(_i.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(p),m).then(g=>m.isCancellationRequested?p:a.protocol2CodeConverter.asCodeLens(g),g=>a.handleFailedRequest(_i.CodeLensResolveRequest.type,m,g,p)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[vv.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeCodeLensEmitter:n}]}};Ao.CodeLensFeature=Gd});var bv=x(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.DocumentOnTypeFormattingFeature=Pr.DocumentRangeFormattingFeature=Pr.DocumentFormattingFeature=void 0;var $o=require("vscode"),xn=ie(),Yd=Ve(),sr=we(),Ti;(function(r){function e(t){let n=$o.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}r.fromConfiguration=e})(Ti||(Ti={}));var Xd=class extends sr.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,sr.ensure)((0,sr.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:Yd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let R={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),options:a.code2ProtocolConverter.asFormattingOptions(m,Ti.fromConfiguration(p))};return a.sendRequest(xn.DocumentFormattingRequest.type,R,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(y,g),y=>a.handleFailedRequest(xn.DocumentFormattingRequest.type,g,y,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(i,s,o,c):c(i,s,o)}};return[$o.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Pr.DocumentFormattingFeature=Xd;var Qd=class extends sr.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){let t=(0,sr.ensure)((0,sr.ensure)(e,"textDocument"),"rangeFormatting");t.dynamicRegistration=!0,t.rangesSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:Yd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(i,s,o,a)=>{let c=this._client,d=(m,g,R,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),options:c.code2ProtocolConverter.asFormattingOptions(R,Ti.fromConfiguration(m))};return c.sendRequest(xn.DocumentRangeFormattingRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(k,y),k=>c.handleFailedRequest(xn.DocumentRangeFormattingRequest.type,y,k,null))},p=c.middleware;return p.provideDocumentRangeFormattingEdits?p.provideDocumentRangeFormattingEdits(i,s,o,a,d):d(i,s,o,a)}};return e.rangesSupport&&(n.provideDocumentRangesFormattingEdits=(i,s,o,a)=>{let c=this._client,d=(m,g,R,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),ranges:c.code2ProtocolConverter.asRanges(g),options:c.code2ProtocolConverter.asFormattingOptions(R,Ti.fromConfiguration(m))};return c.sendRequest(xn.DocumentRangesFormattingRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(k,y),k=>c.handleFailedRequest(xn.DocumentRangesFormattingRequest.type,y,k,null))},p=c.middleware;return p.provideDocumentRangesFormattingEdits?p.provideDocumentRangesFormattingEdits(i,s,o,a,d):d(i,s,o,a)}),[$o.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Pr.DocumentRangeFormattingFeature=Qd;var Jd=class extends sr.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,sr.ensure)((0,sr.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:Yd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{let p=this._client,m=(R,y,P,k,M)=>{let N={textDocument:p.code2ProtocolConverter.asTextDocumentIdentifier(R),position:p.code2ProtocolConverter.asPosition(y),ch:P,options:p.code2ProtocolConverter.asFormattingOptions(k,Ti.fromConfiguration(R))};return p.sendRequest(xn.DocumentOnTypeFormattingRequest.type,N,M).then(A=>M.isCancellationRequested?null:p.protocol2CodeConverter.asTextEdits(A,M),A=>p.handleFailedRequest(xn.DocumentOnTypeFormattingRequest.type,M,A,null))},g=p.middleware;return g.provideOnTypeFormattingEdits?g.provideOnTypeFormattingEdits(s,o,a,c,d,m):m(s,o,a,c,d)}},i=e.moreTriggerCharacter||[];return[$o.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...i),n]}};Pr.DocumentOnTypeFormattingFeature=Jd});var Cv=x(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.RenameFeature=void 0;var yR=require("vscode"),Kr=ie(),bR=Ve(),wv=hn(),Zd=we(),el=class extends Zd.TextDocumentLanguageFeature{constructor(e){super(e,Kr.RenameRequest.type)}fillClientCapabilities(e){let t=(0,Zd.ensure)((0,Zd.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=Kr.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&(wv.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:bR.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(i,s,o,a)=>{let c=this._client,d=(m,g,R,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),position:c.code2ProtocolConverter.asPosition(g),newName:R};return c.sendRequest(Kr.RenameRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(k,y),k=>c.handleFailedRequest(Kr.RenameRequest.type,y,k,null,!1))},p=c.middleware;return p.provideRenameEdits?p.provideRenameEdits(i,s,o,a,d):d(i,s,o,a)},prepareRename:e.prepareProvider?(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let R={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),position:a.code2ProtocolConverter.asPosition(m)};return a.sendRequest(Kr.PrepareRenameRequest.type,R,g).then(y=>g.isCancellationRequested?null:Kr.Range.is(y)?a.protocol2CodeConverter.asRange(y):this.isDefaultBehavior(y)?y.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):y&&Kr.Range.is(y.range)?{range:a.protocol2CodeConverter.asRange(y.range),placeholder:y.placeholder}:Promise.reject(new Error("The element can't be renamed.")),y=>{throw typeof y.message=="string"?new Error(y.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(i,s,o,c):c(i,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return yR.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&wv.boolean(t.defaultBehavior)}};jo.RenameFeature=el});var Rv=x(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.DocumentLinkFeature=void 0;var wR=require("vscode"),rs=ie(),tl=we(),CR=Ve(),nl=class extends tl.TextDocumentLanguageFeature{constructor(e){super(e,rs.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,tl.ensure)((0,tl.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:CR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(rs.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),p).then(m=>p.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(m,p),m=>o.handleFailedRequest(rs.DocumentLinkRequest.type,p,m,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(i,s,a):a(i,s)},resolveDocumentLink:e.resolveProvider?(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(rs.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),p).then(m=>p.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(m),m=>o.handleFailedRequest(rs.DocumentLinkResolveRequest.type,p,m,d)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(i,s,a):a(i,s)}:void 0};return[wR.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Uo.DocumentLinkFeature=nl});var Dv=x(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.ExecuteCommandFeature=void 0;var RR=require("vscode"),rl=ie(),SR=Ve(),Sv=we(),il=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return rl.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,Sv.ensure)((0,Sv.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:SR.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,i=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(rl.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(rl.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(RR.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,i):i(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}clear(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};Wo.ExecuteCommandFeature=il});var _v=x(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.FileSystemWatcherFeature=void 0;var DR=require("vscode"),Vr=ie(),Ho=we(),sl=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return Vr.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,Ho.ensure)((0,Ho.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,Ho.ensure)((0,Ho.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let i=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(i===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&Vr.WatchKind.Create)!==0,o=(n.kind&Vr.WatchKind.Change)!==0,a=(n.kind&Vr.WatchKind.Delete)!==0);let c=DR.workspace.createFileSystemWatcher(i,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let i of t)this.hookListeners(i,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,i,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Vr.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Vr.FileChangeType.Changed}),null,s),i&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Vr.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}clear(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};Ko.FileSystemWatcherFeature=sl});var Tv=x(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.ColorProviderFeature=void 0;var _R=require("vscode"),is=ie(),ol=we(),al=class extends ol.TextDocumentLanguageFeature{constructor(e){super(e,is.DocumentColorRequest.type)}fillClientCapabilities(e){(0,ol.ensure)((0,ol.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.colorProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let R={color:p,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(m.document),range:a.code2ProtocolConverter.asRange(m.range)};return a.sendRequest(is.ColorPresentationRequest.type,R,g).then(y=>g.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(y,g),y=>a.handleFailedRequest(is.ColorPresentationRequest.type,g,y,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(i,s,o,c):c(i,s,o)},provideDocumentColors:(i,s)=>{let o=this._client,a=(d,p)=>{let m={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest(is.DocumentColorRequest.type,m,p).then(g=>p.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(g,p),g=>o.handleFailedRequest(is.DocumentColorRequest.type,p,g,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(i,s,a):a(i,s)}};return[_R.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Vo.ColorProviderFeature=al});var Pv=x(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.ImplementationFeature=void 0;var TR=require("vscode"),cl=ie(),ul=we(),dl=class extends ul.TextDocumentLanguageFeature{constructor(e){super(e,cl.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,ul.ensure)((0,ul.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.implementationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(cl.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(R,g),R=>a.handleFailedRequest(cl.ImplementationRequest.type,g,R,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return TR.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};zo.ImplementationFeature=dl});var kv=x(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.TypeDefinitionFeature=void 0;var PR=require("vscode"),ll=ie(),ss=we(),fl=class extends ss.TextDocumentLanguageFeature{constructor(e){super(e,ll.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,ss.ensure)((0,ss.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,ss.ensure)((0,ss.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeDefinitionProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ll.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(R,g),R=>a.handleFailedRequest(ll.TypeDefinitionRequest.type,g,R,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return PR.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Bo.TypeDefinitionFeature=fl});var Ev=x(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.WorkspaceFoldersFeature=Pi.arrayDiff=void 0;var kR=Ve(),Go=require("vscode"),os=ie();function hl(r,e){if(r!=null)return r[e]}function pl(r,e){return r.filter(t=>e.indexOf(t)<0)}Pi.arrayDiff=pl;var gl=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return os.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Go.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest(os.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Go.workspace.workspaceFolders;return c===void 0?null:c.map(p=>this.asProtocol(p))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=hl(hl(hl(e,"workspace"),"workspaceFolders"),"changeNotifications"),i;typeof n=="string"?i=n:n===!0&&(i=kR.generateUuid()),i&&this.register({id:i,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=pl(this._initialFolders,e),i=pl(e,this._initialFolders);(i.length>0||n.length>0)&&(t=this.doSendEvent(i,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${os.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(i=>this.asProtocol(i)),removed:t.map(i=>this.asProtocol(i))}};return this._client.sendNotification(os.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,i=Go.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${os.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,i),this.sendInitialEvent(Go.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};Pi.WorkspaceFoldersFeature=gl});var Iv=x(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.FoldingRangeFeature=void 0;var xv=require("vscode"),zr=ie(),as=we(),ml=class extends as.TextDocumentLanguageFeature{constructor(e){super(e,zr.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,as.ensure)((0,as.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[zr.FoldingRangeKind.Comment,zr.FoldingRangeKind.Imports,zr.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1},(0,as.ensure)((0,as.ensure)(e,"workspace"),"foldingRange").refreshSupport=!0}initialize(e,t){this._client.onRequest(zr.FoldingRangeRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeFoldingRange.fire()});let[n,i]=this.getRegistration(t,e.foldingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new xv.EventEmitter,i={onDidChangeFoldingRanges:n.event,provideFoldingRanges:(s,o,a)=>{let c=this._client,d=(m,g,R)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m)};return c.sendRequest(zr.FoldingRangeRequest.type,y,R).then(P=>R.isCancellationRequested?null:c.protocol2CodeConverter.asFoldingRanges(P,R),P=>c.handleFailedRequest(zr.FoldingRangeRequest.type,R,P,null))},p=c.middleware;return p.provideFoldingRanges?p.provideFoldingRanges(s,o,a,d):d(s,o,a)}};return[xv.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeFoldingRange:n}]}};Xo.FoldingRangeFeature=ml});var qv=x(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.DeclarationFeature=void 0;var ER=require("vscode"),vl=ie(),yl=we(),bl=class extends yl.TextDocumentLanguageFeature{constructor(e){super(e,vl.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,yl.ensure)((0,yl.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.declarationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(vl.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(R,g),R=>a.handleFailedRequest(vl.DeclarationRequest.type,g,R,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return ER.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Qo.DeclarationFeature=bl});var Fv=x(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.SelectionRangeFeature=void 0;var xR=require("vscode"),wl=ie(),Cl=we(),Rl=class extends Cl.TextDocumentLanguageFeature{constructor(e){super(e,wl.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,Cl.ensure)((0,Cl.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.selectionRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(i,s,o)=>{let a=this._client,c=async(p,m,g)=>{let R={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),positions:a.code2ProtocolConverter.asPositionsSync(m,g)};return a.sendRequest(wl.SelectionRangeRequest.type,R,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(y,g),y=>a.handleFailedRequest(wl.SelectionRangeRequest.type,g,y,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return xR.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Jo.SelectionRangeFeature=Rl});var Lv=x(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.ProgressFeature=void 0;var Ov=ie(),IR=Xu();function qR(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}var Sl=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:Ov.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){qR(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=i=>{this.activeParts.delete(i)},n=i=>{this.activeParts.add(new IR.ProgressPart(this._client,i.token,t))};e.onRequest(Ov.WorkDoneProgressCreateRequest.type,n)}clear(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};Yo.ProgressFeature=Sl});var Mv=x(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.CallHierarchyFeature=void 0;var FR=require("vscode"),Br=ie(),Dl=we(),_l=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(Br.CallHierarchyPrepareRequest.type,p,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyItems(m,d),m=>i.handleFailedRequest(Br.CallHierarchyPrepareRequest.type,d,m,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Br.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>n.handleFailedRequest(Br.CallHierarchyIncomingCallsRequest.type,a,d,null))};return i.provideCallHierarchyIncomingCalls?i.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Br.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>n.handleFailedRequest(Br.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return i.provideCallHierarchyOutgoingCalls?i.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},Tl=class extends Dl.TextDocumentLanguageFeature{constructor(e){super(e,Br.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Dl.ensure)((0,Dl.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.callHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new _l(t);return[FR.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};Zo.CallHierarchyFeature=Tl});var Nv=x(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.SemanticTokensFeature=void 0;var ea=require("vscode"),ae=ie(),cs=we(),OR=hn(),Pl=class extends cs.TextDocumentLanguageFeature{constructor(e){super(e,ae.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,cs.ensure)((0,cs.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[ae.SemanticTokenTypes.namespace,ae.SemanticTokenTypes.type,ae.SemanticTokenTypes.class,ae.SemanticTokenTypes.enum,ae.SemanticTokenTypes.interface,ae.SemanticTokenTypes.struct,ae.SemanticTokenTypes.typeParameter,ae.SemanticTokenTypes.parameter,ae.SemanticTokenTypes.variable,ae.SemanticTokenTypes.property,ae.SemanticTokenTypes.enumMember,ae.SemanticTokenTypes.event,ae.SemanticTokenTypes.function,ae.SemanticTokenTypes.method,ae.SemanticTokenTypes.macro,ae.SemanticTokenTypes.keyword,ae.SemanticTokenTypes.modifier,ae.SemanticTokenTypes.comment,ae.SemanticTokenTypes.string,ae.SemanticTokenTypes.number,ae.SemanticTokenTypes.regexp,ae.SemanticTokenTypes.operator,ae.SemanticTokenTypes.decorator],t.tokenModifiers=[ae.SemanticTokenModifiers.declaration,ae.SemanticTokenModifiers.definition,ae.SemanticTokenModifiers.readonly,ae.SemanticTokenModifiers.static,ae.SemanticTokenModifiers.deprecated,ae.SemanticTokenModifiers.abstract,ae.SemanticTokenModifiers.async,ae.SemanticTokenModifiers.modification,ae.SemanticTokenModifiers.documentation,ae.SemanticTokenModifiers.defaultLibrary],t.formats=[ae.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,cs.ensure)((0,cs.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(ae.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[i,s]=this.getRegistration(t,e.semanticTokensProvider);!i||!s||this.register({id:i,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=OR.boolean(e.full)?e.full:e.full!==void 0,i=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new ea.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(R,y)=>{let P=this._client,k=P.middleware,M=(N,A)=>{let W={textDocument:P.code2ProtocolConverter.asTextDocumentIdentifier(N)};return P.sendRequest(ae.SemanticTokensRequest.type,W,A).then(J=>A.isCancellationRequested?null:P.protocol2CodeConverter.asSemanticTokens(J,A),J=>P.handleFailedRequest(ae.SemanticTokensRequest.type,A,J,null))};return k.provideDocumentSemanticTokens?k.provideDocumentSemanticTokens(R,y,M):M(R,y)},provideDocumentSemanticTokensEdits:i?(R,y,P)=>{let k=this._client,M=k.middleware,N=(A,W,J)=>{let pe={textDocument:k.code2ProtocolConverter.asTextDocumentIdentifier(A),previousResultId:W};return k.sendRequest(ae.SemanticTokensDeltaRequest.type,pe,J).then(async X=>J.isCancellationRequested?null:ae.SemanticTokens.is(X)?await k.protocol2CodeConverter.asSemanticTokens(X,J):await k.protocol2CodeConverter.asSemanticTokensEdits(X,J),X=>k.handleFailedRequest(ae.SemanticTokensDeltaRequest.type,J,X,null))};return M.provideDocumentSemanticTokensEdits?M.provideDocumentSemanticTokensEdits(R,y,P,N):N(R,y,P)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(R,y,P)=>{let k=this._client,M=k.middleware,N=(A,W,J)=>{let pe={textDocument:k.code2ProtocolConverter.asTextDocumentIdentifier(A),range:k.code2ProtocolConverter.asRange(W)};return k.sendRequest(ae.SemanticTokensRangeRequest.type,pe,J).then(X=>J.isCancellationRequested?null:k.protocol2CodeConverter.asSemanticTokens(X,J),X=>k.handleFailedRequest(ae.SemanticTokensRangeRequest.type,J,X,null))};return M.provideDocumentRangeSemanticTokens?M.provideDocumentRangeSemanticTokens(R,y,P,N):N(R,y,P)}}:void 0,d=[],p=this._client,m=p.protocol2CodeConverter.asSemanticTokensLegend(e.legend),g=p.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push(ea.languages.registerDocumentSemanticTokensProvider(g,o,m)),c!==void 0&&d.push(ea.languages.registerDocumentRangeSemanticTokensProvider(g,c,m)),[new ea.Disposable(()=>d.forEach(R=>R.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};ta.SemanticTokensFeature=Pl});var jv=x(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.WillDeleteFilesFeature=Xt.WillRenameFilesFeature=Xt.WillCreateFilesFeature=Xt.DidDeleteFilesFeature=Xt.DidRenameFilesFeature=Xt.DidCreateFilesFeature=void 0;var bn=require("vscode"),LR=So(),or=ie(),MR=Ve();function Av(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function NR(r,e){return r[e]}function $v(r,e,t){r[e]=t}var us=class r{constructor(e,t,n,i,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=i,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=Av(Av(e,"workspace"),"fileOperations");$v(t,"dynamicRegistration",!0),$v(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?NR(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:MR.generateUuid(),registerOptions:{filters:n.filters}})}catch(i){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${i}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let i=new LR.Minimatch(n.pattern.glob,r.asMinimatchOptions(n.pattern.options));if(!i.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:i,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return r.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;let p=await this.getFileType(o);if(p===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(p===bn.FileType.File&&d.kind===or.FileOperationPatternKind.file||p===bn.FileType.Directory&&d.kind===or.FileOperationPatternKind.folder)return!0}else if(d.kind===or.FileOperationPatternKind.folder&&await r.getFileType(o)===bn.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),i=e.files.filter((s,o)=>n[o]);return{...e,files:i}}static async getFileType(e){try{return(await bn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){let t={dot:!0};return e?.ignoreCase===!0&&(t.nocase=!0),t}},na=class extends us{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async i=>this._client.sendNotification(this._notificationType,this._createParams(i));return this.doSend(t,n)}}},ra=class extends na{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await us.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}clear(){super.clear(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},kl=class extends na{constructor(e){super(e,bn.workspace.onDidCreateFiles,or.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};Xt.DidCreateFilesFeature=kl;var El=class extends ra{constructor(e){super(e,bn.workspace.onDidRenameFiles,or.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=bn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};Xt.DidRenameFilesFeature=El;var xl=class extends ra{constructor(e){super(e,bn.workspace.onDidDeleteFiles,or.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=bn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};Xt.DidDeleteFilesFeature=xl;var ds=class extends us{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=i=>this._client.sendRequest(this._requestType,this._createParams(i),i.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},Il=class extends ds{constructor(e){super(e,bn.workspace.onWillCreateFiles,or.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};Xt.WillCreateFilesFeature=Il;var ql=class extends ds{constructor(e){super(e,bn.workspace.onWillRenameFiles,or.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};Xt.WillRenameFilesFeature=ql;var Fl=class extends ds{constructor(e){super(e,bn.workspace.onWillDeleteFiles,or.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};Xt.WillDeleteFilesFeature=Fl});var Uv=x(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.LinkedEditingFeature=void 0;var AR=require("vscode"),Ol=ie(),Ll=we(),Ml=class extends Ll.TextDocumentLanguageFeature{constructor(e){super(e,Ol.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Ll.ensure)((0,Ll.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Ol.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(R=>g.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(R,g),R=>a.handleFailedRequest(Ol.LinkedEditingRangeRequest.type,g,R,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return AR.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ia.LinkedEditingFeature=Ml});var Wv=x(sa=>{"use strict";Object.defineProperty(sa,"__esModule",{value:!0});sa.TypeHierarchyFeature=void 0;var $R=require("vscode"),Gr=ie(),Nl=we(),Al=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(Gr.TypeHierarchyPrepareRequest.type,p,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(m,d),m=>i.handleFailedRequest(Gr.TypeHierarchyPrepareRequest.type,d,m,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(Gr.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(Gr.TypeHierarchySupertypesRequest.type,a,d,null))};return i.provideTypeHierarchySupertypes?i.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(Gr.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(Gr.TypeHierarchySubtypesRequest.type,a,d,null))};return i.provideTypeHierarchySubtypes?i.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},$l=class extends Nl.TextDocumentLanguageFeature{constructor(e){super(e,Gr.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,Nl.ensure)((0,Nl.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Al(t);return[$R.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};sa.TypeHierarchyFeature=$l});var Kv=x(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.InlineValueFeature=void 0;var Hv=require("vscode"),oa=ie(),ls=we(),jl=class extends ls.TextDocumentLanguageFeature{constructor(e){super(e,oa.InlineValueRequest.type)}fillClientCapabilities(e){(0,ls.ensure)((0,ls.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,ls.ensure)((0,ls.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(oa.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,i]=this.getRegistration(t,e.inlineValueProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Hv.EventEmitter,i={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let d=this._client,p=(g,R,y,P)=>{let k={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(g),range:d.code2ProtocolConverter.asRange(R),context:d.code2ProtocolConverter.asInlineValueContext(y)};return d.sendRequest(oa.InlineValueRequest.type,k,P).then(M=>P.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues(M,P),M=>d.handleFailedRequest(oa.InlineValueRequest.type,P,M,null))},m=d.middleware;return m.provideInlineValues?m.provideInlineValues(s,o,a,c,p):p(s,o,a,c)}};return[this.registerProvider(t,i),{provider:i,onDidChangeInlineValues:n}]}registerProvider(e,t){return Hv.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};aa.InlineValueFeature=jl});var zv=x(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.InlayHintsFeature=void 0;var Vv=require("vscode"),ki=ie(),fs=we(),Ul=class extends fs.TextDocumentLanguageFeature{constructor(e){super(e,ki.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,fs.ensure)((0,fs.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,fs.ensure)((0,fs.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(ki.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,i]=this.getRegistration(t,e.inlayHintProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Vv.EventEmitter,i={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,d=async(m,g,R)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g)};try{let P=await c.sendRequest(ki.InlayHintRequest.type,y,R);return R.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(P,R)}catch(P){return c.handleFailedRequest(ki.InlayHintRequest.type,R,P,null)}},p=c.middleware;return p.provideInlayHints?p.provideInlayHints(s,o,a,d):d(s,o,a)}};return i.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(ki.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(p),m);if(m.isCancellationRequested)return null;let R=a.protocol2CodeConverter.asInlayHint(g,m);return m.isCancellationRequested?null:R}catch(g){return a.handleFailedRequest(ki.InlayHintResolveRequest.type,m,g,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,i),{provider:i,onDidChangeInlayHints:n}]}registerProvider(e,t){return Vv.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ca.InlayHintsFeature=Ul});var Bv=x(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.InlineCompletionItemFeature=void 0;var jR=require("vscode"),Wl=ie(),Hl=we(),UR=Ve(),Kl=class extends Hl.TextDocumentLanguageFeature{constructor(e){super(e,Wl.InlineCompletionRequest.type)}fillClientCapabilities(e){let t=(0,Hl.ensure)((0,Hl.ensure)(e,"textDocument"),"inlineCompletion");t.dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.inlineCompletionProvider);n&&this.register({id:UR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideInlineCompletionItems:(i,s,o,a)=>{let c=this._client,d=this._client.middleware,p=(m,g,R,y)=>c.sendRequest(Wl.InlineCompletionRequest.type,c.code2ProtocolConverter.asInlineCompletionParams(m,g,R),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asInlineCompletionResult(P,y),P=>c.handleFailedRequest(Wl.InlineCompletionRequest.type,y,P,null));return d.provideInlineCompletionItems?d.provideInlineCompletionItems(i,s,o,a,p):p(i,s,o,a)}};return[jR.languages.registerInlineCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};ua.InlineCompletionItemFeature=Kl});var Ql=x(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.ProposedFeatures=vt.BaseLanguageClient=vt.MessageTransports=vt.SuspendMode=vt.State=vt.CloseAction=vt.ErrorAction=vt.RevealOutputChannelOn=void 0;var ke=require("vscode"),$=ie(),WR=Sm(),HR=Tm(),qn=hn(),da=mo(),Gv=Ve(),KR=Xu(),In=we(),VR=gd(),Xv=rv(),Qv=sv(),Ei=ov(),zR=av(),BR=cv(),GR=uv(),XR=lv(),QR=fv(),JR=jd(),YR=pv(),ZR=gv(),eS=mv(),tS=yv(),Vl=bv(),nS=Cv(),rS=Rv(),iS=Dv(),sS=_v(),oS=Tv(),aS=Pv(),cS=kv(),uS=Ev(),dS=Iv(),lS=qv(),fS=Fv(),hS=Lv(),pS=Mv(),gS=Nv(),xi=jv(),mS=Uv(),vS=Wv(),yS=Kv(),bS=zv(),wS=Bv(),Xr;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Never=4]="Never"})(Xr||(vt.RevealOutputChannelOn=Xr={}));var ps;(function(r){r[r.Continue=1]="Continue",r[r.Shutdown=2]="Shutdown"})(ps||(vt.ErrorAction=ps={}));var kr;(function(r){r[r.DoNotRestart=1]="DoNotRestart",r[r.Restart=2]="Restart"})(kr||(vt.CloseAction=kr={}));var hs;(function(r){r[r.Stopped=1]="Stopped",r[r.Starting=3]="Starting",r[r.Running=2]="Running"})(hs||(vt.State=hs={}));var Jv;(function(r){r.off="off",r.on="on"})(Jv||(vt.SuspendMode=Jv={}));var zl;(function(r){function e(t){return t==null?!1:typeof t=="boolean"||typeof t=="object"&&t!==null&&qn.stringArray(t.enabledCommands)?t:!1}r.sanitizeIsTrusted=e})(zl||(zl={}));var Bl=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:ps.Continue}:{action:ps.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:kr.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=3*60*1e3?{action:kr.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:kr.Restart})}},fe;(function(r){r.Initial="initial",r.Starting="starting",r.StartFailed="startFailed",r.Running="running",r.Stopping="stopping",r.Stopped="stopped"})(fe||(fe={}));var Yv;(function(r){function e(t){return t&&$.MessageReader.is(t.reader)&&$.MessageWriter.is(t.writer)}r.is=e})(Yv||(vt.MessageTransports=Yv={}));var gs=class r{constructor(e,t,n){this._traceFormat=$.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new da.Semaphore(1),this._id=e,this._name=t,n=n||{};let i={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(i.isTrusted=zl.sanitizeIsTrusted(n.markdown.isTrusted),i.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??Xr.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:i,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=fe.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new da.Semaphore(1),this._pendingChangeDelayer=new da.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new da.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new $.Emitter,this._stateChangeEmitter=new $.Emitter,this._trace=$.Trace.Off,this._tracer={log:(s,o)=>{qn.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=WR.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=HR.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=ke.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case fe.Starting:return hs.Starting;case fe.Running:return hs.Running;default:return hs.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();this._didChangeTextDocumentFeature.syncKind===$.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n);let i=this._clientOptions.middleware?.sendRequest;if(i!==void 0){let s,o;return t.length===1?$.CancellationToken.is(t[0])?o=t[0]:s=t[0]:t.length===2&&(s=t[0],o=t[1]),i(e,s,o,(a,c,d)=>{let p=[];return c!==void 0&&p.push(c),d!==void 0&&p.push(d),n.sendRequest(a,...p)})}else return n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._requestDisposables.set(n,i.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===$.TextDocumentSyncKind.Full,i;n&&typeof e!="string"&&e.method===$.DidOpenTextDocumentNotification.method&&(i=t?.textDocument.uri,this._pendingOpenNotifications.add(i));let s=await this.$start();n&&await this.sendPendingFullTextDocumentChanges(s),i!==void 0&&this._pendingOpenNotifications.delete(i);let o=this._clientOptions.middleware?.sendNotification;return o?o(e,s.sendNotification.bind(s),t):s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._notificationDisposables.set(n,i.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(i){throw this.error(`Sending progress for token ${t} failed.`,i),i}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let i=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=$.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return i!==void 0?(this._progressDisposables.set(t,i.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new Bl(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof $.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?qn.string(e.stack)?e.stack:e.message:qn.string(e)?e:e.toString()}debug(e,t,n=!0){this.logOutputMessage($.MessageType.Debug,Xr.Debug,"Debug",e,t,n)}info(e,t,n=!0){this.logOutputMessage($.MessageType.Info,Xr.Info,"Info",e,t,n)}warn(e,t,n=!0){this.logOutputMessage($.MessageType.Warning,Xr.Warn,"Warn",e,t,n)}error(e,t,n=!0){this.logOutputMessage($.MessageType.Error,Xr.Error,"Error",e,t,n)}logOutputMessage(e,t,n,i,s,o){this.outputChannel.appendLine(`[${n.padEnd(5)} - ${new Date().toLocaleTimeString()}] ${i}`),s!=null&&this.outputChannel.appendLine(this.data2String(s)),(o==="force"||o&&this._clientOptions.revealOutputChannelOn<=t)&&this.showNotificationMessage(e,i)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===$.MessageType.Error?ke.window.showErrorMessage:e===$.MessageType.Warning?ke.window.showWarningMessage:ke.window.showInformationMessage)(t,"Go to output").then(i=>{i!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===fe.Initial||this.$state===fe.Stopping||this.$state===fe.Stopped}needsStop(){return this.$state===fe.Starting||this.$state===fe.Running}activeConnection(){return this.$state===fe.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===fe.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===fe.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?ke.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):ke.languages.createDiagnosticCollection());for(let[i,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(i)||this._pendingNotificationHandlers.set(i,s);for(let[i,s]of this._requestHandlers)this._pendingRequestHandlers.has(i)||this._pendingRequestHandlers.set(i,s);for(let[i,s]of this._progressHandlers)this._pendingProgressHandlers.has(i)||this._pendingProgressHandlers.set(i,s);this.$state=fe.Starting;try{let i=await this.createConnection();i.onNotification($.LogMessageNotification.type,s=>{switch(s.type){case $.MessageType.Error:this.error(s.message,void 0,!1);break;case $.MessageType.Warning:this.warn(s.message,void 0,!1);break;case $.MessageType.Info:this.info(s.message,void 0,!1);break;case $.MessageType.Debug:this.debug(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),i.onNotification($.ShowMessageNotification.type,s=>{switch(s.type){case $.MessageType.Error:ke.window.showErrorMessage(s.message);break;case $.MessageType.Warning:ke.window.showWarningMessage(s.message);break;case $.MessageType.Info:ke.window.showInformationMessage(s.message);break;default:ke.window.showInformationMessage(s.message)}}),i.onRequest($.ShowMessageRequest.type,s=>{let o;switch(s.type){case $.MessageType.Error:o=ke.window.showErrorMessage;break;case $.MessageType.Warning:o=ke.window.showWarningMessage;break;case $.MessageType.Info:o=ke.window.showInformationMessage;break;default:o=ke.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),i.onNotification($.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),i.onRequest($.ShowDocumentRequest.type,async s=>{let o=async c=>{let d=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await ke.env.openExternal(d)};{let p={};return c.selection!==void 0&&(p.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?p.preserveFocus=!0:c.takeFocus===!0&&(p.preserveFocus=!1),await ke.window.showTextDocument(d,p),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),i.listen(),await this.initialize(i),t()}catch(i){this.$state=fe.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,i,"force"),n(i)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((i,s)=>{e=i,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,i]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:ke.env.appName,version:ke.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(ke.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:qn.func(t)?t():t,trace:$.Trace.toString(this._trace),workspaceFolders:i};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=Gv.generateUuid(),a=new KR.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==$.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=fe.Running;let i;qn.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===$.TextDocumentSyncKind.None?i={openClose:!1,change:$.TextDocumentSyncKind.None,save:void 0}:i={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(i=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:i}),e.onNotification($.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest($.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest($.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest($.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification($.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof $.ResponseError&&n.data&&n.data.retry?ke.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(i=>{i&&i.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&ke.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=ke.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===fe.Stopped||this.$state===fe.Initial)return;if(this.$state===fe.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==fe.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=fe.Stopping,this.cleanUp(e);let i=new Promise(o=>{(0,$.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([i,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=fe.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(i=>i[1]).reverse())n.clear();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification($.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let i=this.clientOptions.middleware?.workspace;(i?.didChangeWatchedFile?i.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let i=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification($.DidChangeTextDocumentNotification.type,i),this._didChangeTextDocumentFeature.notificationSent(n,$.DidChangeTextDocumentNotification.type,i)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,$.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let i=new ke.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:i},this._p2c.asDiagnostics(n,i.token).then(s=>{if(!i.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,d)=>this.setDiagnostics(c,d)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return ke.env.language}async $start(){if(this.$state===fe.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(i,s,o)=>{this.handleConnectionError(i,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(i=>this.error("Handling connection close failed",i))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=CS(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===fe.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:kr.DoNotRestart};if(this.$state!==fe.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===kr.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===fe.Starting?this.$state=fe.StartFailed:this.$state=fe.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===kr.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=fe.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let i=await this._clientOptions.errorHandler.error(e,t,n);i.action===ps.Shutdown?(this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}
Shutting down server.`,void 0,i.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)})):this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}`,void 0,i.handled===!0?!1:"force")}hookConfigurationChanged(e){this._listeners.push(ke.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=ke.workspace.getConfiguration(this._id),i=$.Trace.Off,s=$.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?i=$.Trace.fromString(o):(i=$.Trace.fromString(n.get("trace.server.verbosity","off")),s=$.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=i,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;qn.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get($.DidChangeWatchedFilesNotification.type.method).registerRaw(Gv.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),In.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature($.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof Xv.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new Qv.ConfigurationFeature(this)),this.registerFeature(new Ei.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new Ei.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new Ei.WillSaveFeature(this)),this.registerFeature(new Ei.WillSaveWaitUntilFeature(this)),this.registerFeature(new Ei.DidSaveTextDocumentFeature(this)),this.registerFeature(new Ei.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new sS.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new zR.CompletionItemFeature(this)),this.registerFeature(new BR.HoverFeature(this)),this.registerFeature(new XR.SignatureHelpFeature(this)),this.registerFeature(new GR.DefinitionFeature(this)),this.registerFeature(new ZR.ReferencesFeature(this)),this.registerFeature(new QR.DocumentHighlightFeature(this)),this.registerFeature(new JR.DocumentSymbolFeature(this)),this.registerFeature(new YR.WorkspaceSymbolFeature(this)),this.registerFeature(new eS.CodeActionFeature(this)),this.registerFeature(new tS.CodeLensFeature(this)),this.registerFeature(new Vl.DocumentFormattingFeature(this)),this.registerFeature(new Vl.DocumentRangeFormattingFeature(this)),this.registerFeature(new Vl.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new nS.RenameFeature(this)),this.registerFeature(new rS.DocumentLinkFeature(this)),this.registerFeature(new iS.ExecuteCommandFeature(this)),this.registerFeature(new Qv.SyncConfigurationFeature(this)),this.registerFeature(new cS.TypeDefinitionFeature(this)),this.registerFeature(new aS.ImplementationFeature(this)),this.registerFeature(new oS.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new uS.WorkspaceFoldersFeature(this)),this.registerFeature(new dS.FoldingRangeFeature(this)),this.registerFeature(new lS.DeclarationFeature(this)),this.registerFeature(new fS.SelectionRangeFeature(this)),this.registerFeature(new hS.ProgressFeature(this)),this.registerFeature(new pS.CallHierarchyFeature(this)),this.registerFeature(new gS.SemanticTokensFeature(this)),this.registerFeature(new mS.LinkedEditingFeature(this)),this.registerFeature(new xi.DidCreateFilesFeature(this)),this.registerFeature(new xi.DidRenameFilesFeature(this)),this.registerFeature(new xi.DidDeleteFilesFeature(this)),this.registerFeature(new xi.WillCreateFilesFeature(this)),this.registerFeature(new xi.WillRenameFilesFeature(this)),this.registerFeature(new xi.WillDeleteFilesFeature(this)),this.registerFeature(new vS.TypeHierarchyFeature(this)),this.registerFeature(new yS.InlineValueFeature(this)),this.registerFeature(new bS.InlayHintsFeature(this)),this.registerFeature(new VR.DiagnosticFeature(this)),this.registerFeature(new Xv.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(Xl.createAll(this))}fillInitializeParams(e){for(let t of this._features)qn.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,In.ensure)(e,"workspace").applyEdit=!0;let t=(0,In.ensure)((0,In.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[$.ResourceOperationKind.Create,$.ResourceOperationKind.Rename,$.ResourceOperationKind.Delete],t.failureHandling=$.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,In.ensure)((0,In.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[$.DiagnosticTag.Unnecessary,$.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let i=(0,In.ensure)(e,"window"),s=(0,In.ensure)(i,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,In.ensure)(i,"showDocument");o.support=!0;let a=(0,In.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(r.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)qn.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){let t=this.clientOptions.middleware?.handleRegisterCapability;return t?t(e,n=>this.doRegisterCapability(n)):this.doRegisterCapability(e)}async doRegisterCapability(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let i=t.registerOptions??{};i.documentSelector=i.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:i};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){let t=this.clientOptions.middleware?.handleUnregisterCapability;return t?t(e,n=>this.doUnregisterCapability(n)):this.doUnregisterCapability(e)}async doUnregisterCapability(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),i=new Map;ke.workspace.textDocuments.forEach(o=>i.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if($.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=i.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):qn.asPromise(ke.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,i,s=!0){if(n instanceof $.ResponseError){if(n.code===$.ErrorCodes.PendingResponseRejected||n.code===$.ErrorCodes.ConnectionInactive)return i;if(n.code===$.LSPErrorCodes.RequestCancelled||n.code===$.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return i;throw n.data!==void 0?new In.LSPCancellationError(n.data):new ke.CancellationError}else if(n.code===$.LSPErrorCodes.ContentModified){if(r.RequestsToCancelOnContentModified.has(e.method)||r.CancellableResolveCalls.has(e.method))throw new ke.CancellationError;return i}}throw this.error(`Request ${e.method} failed.`,n,s),n}};vt.BaseLanguageClient=gs;gs.RequestsToCancelOnContentModified=new Set([$.SemanticTokensRequest.method,$.SemanticTokensRangeRequest.method,$.SemanticTokensDeltaRequest.method]);gs.CancellableResolveCalls=new Set([$.CompletionResolveRequest.method,$.CodeLensResolveRequest.method,$.CodeActionResolveRequest.method,$.InlayHintResolveRequest.method,$.DocumentLinkResolveRequest.method,$.WorkspaceSymbolResolveRequest.method]);var Gl=class{error(e){(0,$.RAL)().console.error(e)}warn(e){(0,$.RAL)().console.warn(e)}info(e){(0,$.RAL)().console.info(e)}log(e){(0,$.RAL)().console.log(e)}};function CS(r,e,t,n,i){let s=new Gl,o=(0,$.createProtocolConnection)(r,e,s,i);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,d,p)=>{let m={sendNotification:!1,traceFormat:$.TraceFormat.Text};return p===void 0?o.trace(c,d,m):(qn.boolean(p),o.trace(c,d,p))},initialize:c=>o.sendRequest($.InitializeRequest.type,c),shutdown:()=>o.sendRequest($.ShutdownRequest.type,void 0),exit:()=>o.sendNotification($.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var Xl;(function(r){function e(t){return[new wS.InlineCompletionItemFeature(t)]}r.createAll=e})(Xl||(vt.ProposedFeatures=Xl={}))});var ey=x(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.terminate=void 0;var Zv=require("child_process"),RS=require("path"),SS=process.platform==="win32",DS=process.platform==="darwin",_S=process.platform==="linux";function TS(r,e){if(SS)try{let i={stdio:["pipe","pipe","ignore"]};return e&&(i.cwd=e),Zv.execFileSync("taskkill",["/T","/F","/PID",r.pid.toString()],i),!0}catch{return!1}else if(_S||DS)try{var t=(0,RS.join)(__dirname,"terminateProcess.sh"),n=Zv.spawnSync(t,[r.pid.toString()]);return!n.error}catch{return!1}else return r.kill("SIGKILL"),!0}la.terminate=TS});var Jl=x((ZT,ty)=>{"use strict";ty.exports=ie()});var ms=x((eP,ny)=>{var PS=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};ny.exports=PS});var fa=x((tP,ry)=>{var kS="2.0.0",ES=Number.MAX_SAFE_INTEGER||9007199254740991,xS=16,IS=250,qS=["major","premajor","minor","preminor","patch","prepatch","prerelease"];ry.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:xS,MAX_SAFE_BUILD_LENGTH:IS,MAX_SAFE_INTEGER:ES,RELEASE_TYPES:qS,SEMVER_SPEC_VERSION:kS,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var ha=x((ar,iy)=>{var{MAX_SAFE_COMPONENT_LENGTH:Yl,MAX_SAFE_BUILD_LENGTH:FS,MAX_LENGTH:OS}=fa(),LS=ms();ar=iy.exports={};var MS=ar.re=[],NS=ar.safeRe=[],z=ar.src=[],B=ar.t={},AS=0,Zl="[a-zA-Z0-9-]",$S=[["\\s",1],["\\d",OS],[Zl,FS]],jS=r=>{for(let[e,t]of $S)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},ce=(r,e,t)=>{let n=jS(e),i=AS++;LS(r,i,e),B[r]=i,z[i]=e,MS[i]=new RegExp(e,t?"g":void 0),NS[i]=new RegExp(n,t?"g":void 0)};ce("NUMERICIDENTIFIER","0|[1-9]\\d*");ce("NUMERICIDENTIFIERLOOSE","\\d+");ce("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Zl}*`);ce("MAINVERSION",`(${z[B.NUMERICIDENTIFIER]})\\.(${z[B.NUMERICIDENTIFIER]})\\.(${z[B.NUMERICIDENTIFIER]})`);ce("MAINVERSIONLOOSE",`(${z[B.NUMERICIDENTIFIERLOOSE]})\\.(${z[B.NUMERICIDENTIFIERLOOSE]})\\.(${z[B.NUMERICIDENTIFIERLOOSE]})`);ce("PRERELEASEIDENTIFIER",`(?:${z[B.NUMERICIDENTIFIER]}|${z[B.NONNUMERICIDENTIFIER]})`);ce("PRERELEASEIDENTIFIERLOOSE",`(?:${z[B.NUMERICIDENTIFIERLOOSE]}|${z[B.NONNUMERICIDENTIFIER]})`);ce("PRERELEASE",`(?:-(${z[B.PRERELEASEIDENTIFIER]}(?:\\.${z[B.PRERELEASEIDENTIFIER]})*))`);ce("PRERELEASELOOSE",`(?:-?(${z[B.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${z[B.PRERELEASEIDENTIFIERLOOSE]})*))`);ce("BUILDIDENTIFIER",`${Zl}+`);ce("BUILD",`(?:\\+(${z[B.BUILDIDENTIFIER]}(?:\\.${z[B.BUILDIDENTIFIER]})*))`);ce("FULLPLAIN",`v?${z[B.MAINVERSION]}${z[B.PRERELEASE]}?${z[B.BUILD]}?`);ce("FULL",`^${z[B.FULLPLAIN]}$`);ce("LOOSEPLAIN",`[v=\\s]*${z[B.MAINVERSIONLOOSE]}${z[B.PRERELEASELOOSE]}?${z[B.BUILD]}?`);ce("LOOSE",`^${z[B.LOOSEPLAIN]}$`);ce("GTLT","((?:<|>)?=?)");ce("XRANGEIDENTIFIERLOOSE",`${z[B.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);ce("XRANGEIDENTIFIER",`${z[B.NUMERICIDENTIFIER]}|x|X|\\*`);ce("XRANGEPLAIN",`[v=\\s]*(${z[B.XRANGEIDENTIFIER]})(?:\\.(${z[B.XRANGEIDENTIFIER]})(?:\\.(${z[B.XRANGEIDENTIFIER]})(?:${z[B.PRERELEASE]})?${z[B.BUILD]}?)?)?`);ce("XRANGEPLAINLOOSE",`[v=\\s]*(${z[B.XRANGEIDENTIFIERLOOSE]})(?:\\.(${z[B.XRANGEIDENTIFIERLOOSE]})(?:\\.(${z[B.XRANGEIDENTIFIERLOOSE]})(?:${z[B.PRERELEASELOOSE]})?${z[B.BUILD]}?)?)?`);ce("XRANGE",`^${z[B.GTLT]}\\s*${z[B.XRANGEPLAIN]}$`);ce("XRANGELOOSE",`^${z[B.GTLT]}\\s*${z[B.XRANGEPLAINLOOSE]}$`);ce("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Yl}})(?:\\.(\\d{1,${Yl}}))?(?:\\.(\\d{1,${Yl}}))?`);ce("COERCE",`${z[B.COERCEPLAIN]}(?:$|[^\\d])`);ce("COERCEFULL",z[B.COERCEPLAIN]+`(?:${z[B.PRERELEASE]})?(?:${z[B.BUILD]})?(?:$|[^\\d])`);ce("COERCERTL",z[B.COERCE],!0);ce("COERCERTLFULL",z[B.COERCEFULL],!0);ce("LONETILDE","(?:~>?)");ce("TILDETRIM",`(\\s*)${z[B.LONETILDE]}\\s+`,!0);ar.tildeTrimReplace="$1~";ce("TILDE",`^${z[B.LONETILDE]}${z[B.XRANGEPLAIN]}$`);ce("TILDELOOSE",`^${z[B.LONETILDE]}${z[B.XRANGEPLAINLOOSE]}$`);ce("LONECARET","(?:\\^)");ce("CARETTRIM",`(\\s*)${z[B.LONECARET]}\\s+`,!0);ar.caretTrimReplace="$1^";ce("CARET",`^${z[B.LONECARET]}${z[B.XRANGEPLAIN]}$`);ce("CARETLOOSE",`^${z[B.LONECARET]}${z[B.XRANGEPLAINLOOSE]}$`);ce("COMPARATORLOOSE",`^${z[B.GTLT]}\\s*(${z[B.LOOSEPLAIN]})$|^$`);ce("COMPARATOR",`^${z[B.GTLT]}\\s*(${z[B.FULLPLAIN]})$|^$`);ce("COMPARATORTRIM",`(\\s*)${z[B.GTLT]}\\s*(${z[B.LOOSEPLAIN]}|${z[B.XRANGEPLAIN]})`,!0);ar.comparatorTrimReplace="$1$2$3";ce("HYPHENRANGE",`^\\s*(${z[B.XRANGEPLAIN]})\\s+-\\s+(${z[B.XRANGEPLAIN]})\\s*$`);ce("HYPHENRANGELOOSE",`^\\s*(${z[B.XRANGEPLAINLOOSE]})\\s+-\\s+(${z[B.XRANGEPLAINLOOSE]})\\s*$`);ce("STAR","(<|>)?=?\\s*\\*");ce("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");ce("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var pa=x((nP,sy)=>{var US=Object.freeze({loose:!0}),WS=Object.freeze({}),HS=r=>r?typeof r!="object"?US:r:WS;sy.exports=HS});var uy=x((rP,cy)=>{var oy=/^[0-9]+$/,ay=(r,e)=>{let t=oy.test(r),n=oy.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},KS=(r,e)=>ay(e,r);cy.exports={compareIdentifiers:ay,rcompareIdentifiers:KS}});var vs=x((iP,hy)=>{var ga=ms(),{MAX_LENGTH:dy,MAX_SAFE_INTEGER:ma}=fa(),{safeRe:ly,t:fy}=ha(),VS=pa(),{compareIdentifiers:Ii}=uy(),ef=class r{constructor(e,t){if(t=VS(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>dy)throw new TypeError(`version is longer than ${dy} characters`);ga("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?ly[fy.LOOSE]:ly[fy.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>ma||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ma||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ma||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<ma)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ga("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),Ii(this.major,e.major)||Ii(this.minor,e.minor)||Ii(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(ga("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ii(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(ga("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ii(n,i)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),Ii(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};hy.exports=ef});var my=x((sP,gy)=>{var py=vs(),zS=(r,e,t=!1)=>{if(r instanceof py)return r;try{return new py(r,e)}catch(n){if(!t)return null;throw n}};gy.exports=zS});var yy=x((oP,vy)=>{var tf=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};vy.exports=tf});var Qr=x((aP,wy)=>{var by=vs(),BS=(r,e,t)=>new by(r,t).compare(new by(e,t));wy.exports=BS});var Ry=x((cP,Cy)=>{var GS=Qr(),XS=(r,e,t)=>GS(r,e,t)===0;Cy.exports=XS});var Dy=x((uP,Sy)=>{var QS=Qr(),JS=(r,e,t)=>QS(r,e,t)!==0;Sy.exports=JS});var Ty=x((dP,_y)=>{var YS=Qr(),ZS=(r,e,t)=>YS(r,e,t)>0;_y.exports=ZS});var ky=x((lP,Py)=>{var eD=Qr(),tD=(r,e,t)=>eD(r,e,t)>=0;Py.exports=tD});var xy=x((fP,Ey)=>{var nD=Qr(),rD=(r,e,t)=>nD(r,e,t)<0;Ey.exports=rD});var qy=x((hP,Iy)=>{var iD=Qr(),sD=(r,e,t)=>iD(r,e,t)<=0;Iy.exports=sD});var Oy=x((pP,Fy)=>{var oD=Ry(),aD=Dy(),cD=Ty(),uD=ky(),dD=xy(),lD=qy(),fD=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return oD(r,t,n);case"!=":return aD(r,t,n);case">":return cD(r,t,n);case">=":return uD(r,t,n);case"<":return dD(r,t,n);case"<=":return lD(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Fy.exports=fD});var Uy=x((gP,jy)=>{var ys=Symbol("SemVer ANY"),sf=class r{static get ANY(){return ys}constructor(e,t){if(t=Ly(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),rf("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ys?this.value="":this.value=this.operator+this.semver.version,rf("comp",this)}parse(e){let t=this.options.loose?My[Ny.COMPARATORLOOSE]:My[Ny.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ay(n[2],this.options.loose):this.semver=ys}toString(){return this.value}test(e){if(rf("Comparator.test",e,this.options.loose),this.semver===ys||e===ys)return!0;if(typeof e=="string")try{e=new Ay(e,this.options)}catch{return!1}return nf(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new $y(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new $y(this.value,t).test(e.semver):(t=Ly(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||nf(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||nf(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};jy.exports=sf;var Ly=pa(),{safeRe:My,t:Ny}=ha(),nf=Oy(),rf=ms(),Ay=vs(),$y=of()});var of=x((mP,Vy)=>{var hD=/\s+/g,af=class r{constructor(e,t){if(t=gD(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof cf)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(hD," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!Hy(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&RD(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&wD)|(this.options.loose&&CD))+":"+e,i=Wy.get(n);if(i)return i;let s=this.options.loose,o=s?Qt[At.HYPHENRANGELOOSE]:Qt[At.HYPHENRANGE];e=e.replace(o,qD(this.options.includePrerelease)),We("hyphen replace",e),e=e.replace(Qt[At.COMPARATORTRIM],vD),We("comparator trim",e),e=e.replace(Qt[At.TILDETRIM],yD),We("tilde trim",e),e=e.replace(Qt[At.CARETTRIM],bD),We("caret trim",e);let a=e.split(" ").map(m=>SD(m,this.options)).join(" ").split(/\s+/).map(m=>ID(m,this.options));s&&(a=a.filter(m=>(We("loose invalid filter",m,this.options),!!m.match(Qt[At.COMPARATORLOOSE])))),We("range list",a);let c=new Map,d=a.map(m=>new cf(m,this.options));for(let m of d){if(Hy(m))return[m];c.set(m.value,m)}c.size>1&&c.has("")&&c.delete("");let p=[...c.values()];return Wy.set(n,p),p}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Ky(n,t)&&e.set.some(i=>Ky(i,t)&&n.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new mD(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(FD(this.set[t],e,this.options))return!0;return!1}};Vy.exports=af;var pD=yy(),Wy=new pD,gD=pa(),cf=Uy(),We=ms(),mD=vs(),{safeRe:Qt,t:At,comparatorTrimReplace:vD,tildeTrimReplace:yD,caretTrimReplace:bD}=ha(),{FLAG_INCLUDE_PRERELEASE:wD,FLAG_LOOSE:CD}=fa(),Hy=r=>r.value==="<0.0.0-0",RD=r=>r.value==="",Ky=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},SD=(r,e)=>(We("comp",r,e),r=TD(r,e),We("caret",r),r=DD(r,e),We("tildes",r),r=kD(r,e),We("xrange",r),r=xD(r,e),We("stars",r),r),$t=r=>!r||r.toLowerCase()==="x"||r==="*",DD=(r,e)=>r.trim().split(/\s+/).map(t=>_D(t,e)).join(" "),_D=(r,e)=>{let t=e.loose?Qt[At.TILDELOOSE]:Qt[At.TILDE];return r.replace(t,(n,i,s,o,a)=>{We("tilde",r,n,i,s,o,a);let c;return $t(i)?c="":$t(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:$t(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(We("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,We("tilde return",c),c})},TD=(r,e)=>r.trim().split(/\s+/).map(t=>PD(t,e)).join(" "),PD=(r,e)=>{We("caret",r,e);let t=e.loose?Qt[At.CARETLOOSE]:Qt[At.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,o,a,c)=>{We("caret",r,i,s,o,a,c);let d;return $t(s)?d="":$t(o)?d=`>=${s}.0.0${n} <${+s+1}.0.0-0`:$t(a)?s==="0"?d=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(We("replaceCaret pr",c),s==="0"?o==="0"?d=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(We("no pr"),s==="0"?o==="0"?d=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),We("caret return",d),d})},kD=(r,e)=>(We("replaceXRanges",r,e),r.split(/\s+/).map(t=>ED(t,e)).join(" ")),ED=(r,e)=>{r=r.trim();let t=e.loose?Qt[At.XRANGELOOSE]:Qt[At.XRANGE];return r.replace(t,(n,i,s,o,a,c)=>{We("xRange",r,n,i,s,o,a,c);let d=$t(s),p=d||$t(o),m=p||$t(a),g=m;return i==="="&&g&&(i=""),c=e.includePrerelease?"-0":"",d?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&g?(p&&(o=0),a=0,i===">"?(i=">=",p?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",p?s=+s+1:o=+o+1),i==="<"&&(c="-0"),n=`${i+s}.${o}.${a}${c}`):p?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:m&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),We("xRange return",n),n})},xD=(r,e)=>(We("replaceStars",r,e),r.trim().replace(Qt[At.STAR],"")),ID=(r,e)=>(We("replaceGTE0",r,e),r.trim().replace(Qt[e.includePrerelease?At.GTE0PRE:At.GTE0],"")),qD=r=>(e,t,n,i,s,o,a,c,d,p,m,g)=>($t(n)?t="":$t(i)?t=`>=${n}.0.0${r?"-0":""}`:$t(s)?t=`>=${n}.${i}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,$t(d)?c="":$t(p)?c=`<${+d+1}.0.0-0`:$t(m)?c=`<${d}.${+p+1}.0-0`:g?c=`<=${d}.${p}.${m}-${g}`:r?c=`<${d}.${p}.${+m+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),FD=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(We(r[n].semver),r[n].semver!==cf.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var By=x((vP,zy)=>{var OD=of(),LD=(r,e,t)=>{try{e=new OD(e,t)}catch{return!1}return e.test(r)};zy.exports=LD});var Xy=x(cn=>{"use strict";var MD=cn&&cn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),uf=cn&&cn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&MD(e,r,t)};Object.defineProperty(cn,"__esModule",{value:!0});cn.DiagnosticPullMode=cn.vsdiag=void 0;uf(ie(),cn);uf(we(),cn);var Gy=gd();Object.defineProperty(cn,"vsdiag",{enumerable:!0,get:function(){return Gy.vsdiag}});Object.defineProperty(cn,"DiagnosticPullMode",{enumerable:!0,get:function(){return Gy.DiagnosticPullMode}});uf(Ql(),cn)});var va=x(Jt=>{"use strict";var ND=Jt&&Jt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Yy=Jt&&Jt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&ND(e,r,t)};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.SettingMonitor=Jt.LanguageClient=Jt.TransportKind=void 0;var cr=require("child_process"),df=require("fs"),lf=require("path"),xr=require("vscode"),ze=hn(),Qy=Ql(),AD=ey(),Qe=Jl(),$D=my(),jD=By();Yy(Jl(),Jt);Yy(Xy(),Jt);var Jy="^1.82.0",Je;(function(r){r[r.stdio=0]="stdio",r[r.ipc=1]="ipc",r[r.pipe=2]="pipe",r[r.socket=3]="socket"})(Je||(Jt.TransportKind=Je={}));var Er;(function(r){function e(t){let n=t;return n&&n.kind===Je.socket&&ze.number(n.port)}r.isSocket=e})(Er||(Er={}));var ff;(function(r){function e(t){return ze.string(t.command)}r.is=e})(ff||(ff={}));var hf;(function(r){function e(t){return ze.string(t.module)}r.is=e})(hf||(hf={}));var pf;(function(r){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}r.is=e})(pf||(pf={}));var gf;(function(r){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}r.is=e})(gf||(gf={}));var mf=class extends Qy.BaseLanguageClient{constructor(e,t,n,i,s){let o,a,c,d,p;ze.string(t)?(o=e,a=t,c=n,d=i,p=!!s):(o=e.toLowerCase(),a=e,c=t,d=n,p=i),p===void 0&&(p=!1),super(o,a,d),this._serverOptions=c,this._forceDebug=p,this._isInDebugMode=p;try{this.checkVersion()}catch(m){throw ze.string(m.message)&&this.outputChannel.appendLine(m.message),m}}checkVersion(){let e=$D(xr.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${xr.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!jD(e,Jy))throw new Error(`The language client requires VS Code version ${Jy} but received version ${xr.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,AD.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(p,m){if(!p&&!m)return;let g=Object.create(null);return Object.keys(process.env).forEach(R=>g[R]=process.env[R]),m&&(g.ELECTRON_RUN_AS_NODE="1",g.ELECTRON_NO_ASAR="1"),p&&Object.keys(p).forEach(R=>g[R]=p[R]),g}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],i=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let p=process.execArgv;return p?p.some(m=>n.some(g=>m.startsWith(g))||i.some(g=>m===g)):!1}function o(p){if(p.stdin===null||p.stdout===null||p.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(ze.func(a))return a().then(p=>{if(Qy.MessageTransports.is(p))return this._isDetached=!!p.detached,p;if(pf.is(p))return this._isDetached=!!p.detached,{reader:new Qe.StreamMessageReader(p.reader),writer:new Qe.StreamMessageWriter(p.writer)};{let m;return gf.is(p)?(m=p.process,this._isDetached=p.detached):(m=p,this._isDetached=!1),m.stderr.on("data",g=>this.outputChannel.append(ze.string(g)?g:g.toString(e))),{reader:new Qe.StreamMessageReader(m.stdout),writer:new Qe.StreamMessageWriter(m.stdin)}}});let c,d=a;return d.run||d.debug?this._forceDebug||s()?(c=d.debug,this._isInDebugMode=!0):(c=d.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(p=>{if(hf.is(c)&&c.module){let m=c,g=m.transport||Je.stdio;if(m.runtime){let R=[],y=m.options??Object.create(null);y.execArgv&&y.execArgv.forEach(N=>R.push(N)),R.push(m.module),m.args&&m.args.forEach(N=>R.push(N));let P=Object.create(null);P.cwd=p,P.env=t(y.env,!1);let k=this._getRuntimePath(m.runtime,p),M;if(g===Je.ipc?(P.stdio=[null,null,null,"ipc"],R.push("--node-ipc")):g===Je.stdio?R.push("--stdio"):g===Je.pipe?(M=(0,Qe.generateRandomPipeName)(),R.push(`--pipe=${M}`)):Er.isSocket(g)&&R.push(`--socket=${g.port}`),R.push(`--clientProcessId=${process.pid.toString()}`),g===Je.ipc||g===Je.stdio){let N=cr.spawn(k,R,P);return!N||!N.pid?qi(N,`Launching server using runtime ${k} failed.`):(this._serverProcess=N,N.stderr.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),g===Je.ipc?(N.stdout.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),Promise.resolve({reader:new Qe.IPCMessageReader(N),writer:new Qe.IPCMessageWriter(N)})):Promise.resolve({reader:new Qe.StreamMessageReader(N.stdout),writer:new Qe.StreamMessageWriter(N.stdin)}))}else{if(g===Je.pipe)return(0,Qe.createClientPipeTransport)(M).then(N=>{let A=cr.spawn(k,R,P);return!A||!A.pid?qi(A,`Launching server using runtime ${k} failed.`):(this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),N.onConnected().then(W=>({reader:W[0],writer:W[1]})))});if(Er.isSocket(g))return(0,Qe.createClientSocketTransport)(g.port).then(N=>{let A=cr.spawn(k,R,P);return!A||!A.pid?qi(A,`Launching server using runtime ${k} failed.`):(this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),N.onConnected().then(W=>({reader:W[0],writer:W[1]})))})}}else{let R;return new Promise((y,P)=>{let k=(m.args&&m.args.slice())??[];g===Je.ipc?k.push("--node-ipc"):g===Je.stdio?k.push("--stdio"):g===Je.pipe?(R=(0,Qe.generateRandomPipeName)(),k.push(`--pipe=${R}`)):Er.isSocket(g)&&k.push(`--socket=${g.port}`),k.push(`--clientProcessId=${process.pid.toString()}`);let M=m.options??Object.create(null);if(M.env=t(M.env,!0),M.execArgv=M.execArgv||[],M.cwd=p,M.silent=!0,g===Je.ipc||g===Je.stdio){let N=cr.fork(m.module,k||[],M);o(N),this._serverProcess=N,N.stderr.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),g===Je.ipc?(N.stdout.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),y({reader:new Qe.IPCMessageReader(this._serverProcess),writer:new Qe.IPCMessageWriter(this._serverProcess)})):y({reader:new Qe.StreamMessageReader(N.stdout),writer:new Qe.StreamMessageWriter(N.stdin)})}else g===Je.pipe?(0,Qe.createClientPipeTransport)(R).then(N=>{let A=cr.fork(m.module,k||[],M);o(A),this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),N.onConnected().then(W=>{y({reader:W[0],writer:W[1]})},P)},P):Er.isSocket(g)&&(0,Qe.createClientSocketTransport)(g.port).then(N=>{let A=cr.fork(m.module,k||[],M);o(A),this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),N.onConnected().then(W=>{y({reader:W[0],writer:W[1]})},P)},P)})}}else if(ff.is(c)&&c.command){let m=c,g=c.args!==void 0?c.args.slice(0):[],R,y=c.transport;if(y===Je.stdio)g.push("--stdio");else if(y===Je.pipe)R=(0,Qe.generateRandomPipeName)(),g.push(`--pipe=${R}`);else if(Er.isSocket(y))g.push(`--socket=${y.port}`);else if(y===Je.ipc)throw new Error("Transport kind ipc is not support for command executable");let P=Object.assign({},m.options);if(P.cwd=P.cwd||p,y===void 0||y===Je.stdio){let k=cr.spawn(m.command,g,P);return!k||!k.pid?qi(k,`Launching server using command ${m.command} failed.`):(k.stderr.on("data",M=>this.outputChannel.append(ze.string(M)?M:M.toString(e))),this._serverProcess=k,this._isDetached=!!P.detached,Promise.resolve({reader:new Qe.StreamMessageReader(k.stdout),writer:new Qe.StreamMessageWriter(k.stdin)}))}else{if(y===Je.pipe)return(0,Qe.createClientPipeTransport)(R).then(k=>{let M=cr.spawn(m.command,g,P);return!M||!M.pid?qi(M,`Launching server using command ${m.command} failed.`):(this._serverProcess=M,this._isDetached=!!P.detached,M.stderr.on("data",N=>this.outputChannel.append(ze.string(N)?N:N.toString(e))),M.stdout.on("data",N=>this.outputChannel.append(ze.string(N)?N:N.toString(e))),k.onConnected().then(N=>({reader:N[0],writer:N[1]})))});if(Er.isSocket(y))return(0,Qe.createClientSocketTransport)(y.port).then(k=>{let M=cr.spawn(m.command,g,P);return!M||!M.pid?qi(M,`Launching server using command ${m.command} failed.`):(this._serverProcess=M,this._isDetached=!!P.detached,M.stderr.on("data",N=>this.outputChannel.append(ze.string(N)?N:N.toString(e))),M.stdout.on("data",N=>this.outputChannel.append(ze.string(N)?N:N.toString(e))),k.onConnected().then(N=>({reader:N[0],writer:N[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))}).finally(()=>{this._serverProcess!==void 0&&this._serverProcess.on("exit",(p,m)=>{p!==null&&this.error(`Server process exited with code ${p}.`,void 0,!1),m!==null&&this.error(`Server process exited with signal ${m}.`,void 0,!1)})})}_getRuntimePath(e,t){if(lf.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let i=lf.join(n,e);if(df.existsSync(i))return i}if(t!==void 0){let i=lf.join(t,e);if(df.existsSync(i))return i}return e}_mainGetRootPath(){let e=xr.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{df.lstat(t,(i,s)=>{n(!i&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};Jt.LanguageClient=mf;var vf=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return xr.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new xr.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,i=n?xr.workspace.getConfiguration(t).get(n,!1):xr.workspace.getConfiguration(t);i&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!i&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};Jt.SettingMonitor=vf;function qi(r,e){return r===null?Promise.reject(e):new Promise((t,n)=>{r.on("error",i=>{n(`${e} ${i}`)}),setImmediate(()=>n(e))})}});var ya=x((wP,Zy)=>{"use strict";Zy.exports=va()});var r_={};$b(r_,{activate:()=>ZD,deactivate:()=>e_});module.exports=jb(r_);var qb=Z(require("os")),Ft=Z(require("vscode"));var L=Z(require("vscode")),Ff=Z(ya());var bs=class{provideTextDocumentContent(e){let t="Not a valid Ruby LSP document";switch(e.path){case"show-syntax-tree":t=e.query;break;case"show-diagnose-state":t=e.query;break}return t}};var lb=require("crypto"),Ye=Z(require("vscode")),qa=Z(ya());var Li=Z(require("path")),ka=Z(require("os")),Le=Z(require("vscode"));var eb=require("child_process"),tb=require("crypto"),nb=require("util"),Ir=Z(require("vscode"));var wn=new Ir.EventEmitter,qt=(0,nb.promisify)(eb.exec),ba="Ruby LSP",Bn=Ir.window.createOutputChannel(ba,{log:!0}),qr=["ruby","erb"],yf={tapiocaAddon:1,launcher:.1,fullTestDiscovery:-1};function rb(r,e){let t=null;return function(...n){return t&&clearTimeout(t),new Promise((i,s)=>{t=setTimeout(()=>{r(...n).then(o=>i(o)).catch(o=>s(o))},e)})}}function ws(r){let e=Ir.workspace.getConfiguration("rubyLsp").get("featureFlags");if(e[r]===!1||e.all===!1)return!1;let t=yf[r];if(e.all&&t!==-1||e[r])return!0;let n=Ir.env.machineId,i=(0,tb.createHash)("sha256").update(`${n}-${r}`).digest("hex");return parseInt(i.substring(0,8),16)/4294967295<t}var Jr=Z(require("vscode"));var Cs=Z(require("path")),ib=Z(require("os")),Gn=Z(require("vscode"));var Rs="RUBY_LSP_ACTIVATION_SEPARATOR",UD="RUBY_LSP_VS",WD="RUBY_LSP_FS",yt=class{constructor(e,t,n,i){this.workspaceFolder=e,this.outputChannel=t,this.context=n,this.manuallySelectRuby=i;let s=Gn.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=Cs.default.isAbsolute(s)?s:Cs.default.resolve(Cs.default.join(this.workspaceFolder.uri.fsPath,s))),this.bundleUri=this.customBundleGemfile?Gn.Uri.file(Cs.default.dirname(this.customBundleGemfile)):e.uri}async runEnvActivationScript(e){let t=Gn.Uri.joinPath(this.context.extensionUri,"activation.rb"),n=await this.runScript(`${e} -EUTF-8:UTF-8 '${t.fsPath}'`),i=new RegExp(`${Rs}([^]*)${Rs}`).exec(n.stderr),[s,o,a,...c]=i[1].split(WD);return{version:s,gemPath:o.split(","),yjit:a==="true",env:Object.fromEntries(c.map(d=>d.split(UD)))}}runScript(e){let t;return Gn.env.shell.length>0&&ib.default.platform()!=="win32"&&(t=Gn.env.shell),this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath} using shell: ${t}`),qt(e,{cwd:this.bundleUri.fsPath,shell:t,env:process.env,encoding:"utf-8"})}async findExec(e,t){for(let n of e)try{let i=Gn.Uri.joinPath(n,t);return await Gn.workspace.fs.stat(i),this.outputChannel.info(`Found ${t} executable at ${n.fsPath}`),i.fsPath}catch{}return t}};var Ss=class extends Error{},wa=class extends yt{async activate(){try{await Jr.workspace.fs.stat(Jr.Uri.joinPath(this.bundleUri,".shadowenv.d"))}catch{throw new Error("The Ruby LSP version manager is configured to be shadowenv,         but no .shadowenv.d directory was found in the workspace")}let e=await this.findExec([Jr.Uri.file("/opt/homebrew/bin")],"shadowenv");try{let t=await this.runEnvActivationScript(`${e} exec -- ruby`);return delete t.env.BUNDLE_GEMFILE,{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}catch(t){if(t.message.includes("untrusted shadowenv program")){if(await Jr.window.showErrorMessage(`Tried to activate Shadowenv, but the workspace is untrusted.
           Workspaces must be trusted to before allowing Shadowenv to load the environment for security reasons.`,"Trust workspace","Shutdown Ruby LSP")==="Trust workspace")return await qt("shadowenv trust",{cwd:this.bundleUri.fsPath}),this.activate();throw new Ss("Cannot activate Ruby environment in an untrusted workspace")}try{await qt("shadowenv --version")}catch{throw new Error(`Shadowenv executable not found. Ensure it is installed and available in the PATH.
           This error may happen if your shell configuration is failing to be sourced from the editor or if
           another extension is mutating the process PATH.`)}throw new Error(`Failed to activate Ruby environment with Shadowenv: ${t.message}`)}}};var bf=Z(require("os")),Xn=Z(require("path")),Ee=Z(require("vscode"));var Ds=class extends Error{},Fi=class extends yt{constructor(t,n,i,s){super(t,n,i,s);this.rubyInstallationUris=[Ee.Uri.joinPath(Ee.Uri.file(bf.default.homedir()),".rubies"),Ee.Uri.joinPath(Ee.Uri.file("/"),"opt","rubies")];let o=Ee.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.chrubyRubies");o&&this.rubyInstallationUris.push(...o.map(a=>Ee.Uri.file(a)))}async activate(){let t=await this.discoverRubyVersion(),n;try{if(t)n=await this.findRubyUri(t);else{let d=await this.fallbackWithCancellation("No .ruby-version file found. Trying to fall back to latest installed Ruby in 10 seconds","You can create a .ruby-version file in a parent directory to configure a fallback",this.findFallbackRuby.bind(this),this.rubyVersionError.bind(this));t=d.rubyVersion,n=d.uri}}catch(d){if(d instanceof Ds)return this.activate();throw d}try{if(!n){let d={...t},p=await this.fallbackWithCancellation(`Couldn't find installation for ${t.version}. Trying to fall back to other Ruby in 10 seconds`,"You can cancel this fallback and install the required Ruby",async()=>this.findClosestRubyInstallation(d),()=>this.missingRubyError(d.version));t=p.rubyVersion,n=p.uri}}catch(d){if(d instanceof Ds)return this.activate();throw d}this.outputChannel.info(`Discovered Ruby installation at ${n.fsPath}`);let{defaultGems:i,gemHome:s,yjit:o,version:a}=await this.runActivationScript(n,t);this.outputChannel.info(`Activated Ruby environment: defaultGems=${i} gemHome=${s} yjit=${o}`);let c={GEM_HOME:s,GEM_PATH:`${s}${Xn.default.delimiter}${i}`,PATH:`${Xn.default.join(s,"bin")}${Xn.default.delimiter}${Xn.default.join(i,"bin")}${Xn.default.delimiter}${Xn.default.dirname(n.fsPath)}${Xn.default.delimiter}${this.getProcessPath()}`};return{env:{...process.env,...c},yjit:o,version:a,gemPath:[s,i]}}getProcessPath(){return process.env.PATH}async findRubyUri(t){let n=t.engine?[`${t.engine}-${t.version}`,t.version]:[t.version,`ruby-${t.version}`];for(let i of this.rubyInstallationUris){let s;try{s=(await Ee.workspace.fs.readDirectory(i)).sort((o,a)=>a[0].localeCompare(o[0]))}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${i.fsPath} but it doesn't exist`);continue}for(let o of n){let a=s.find(([c])=>c.startsWith(o));if(a)return Ee.Uri.joinPath(i,a[0],"bin","ruby")}}}async runActivationScript(t,n){let i=["user_dir = Gem.user_dir","paths = Gem.path","if paths.length > 2","  paths.delete(Gem.default_dir)","  paths.delete(Gem.user_dir)","  if paths[0]","    user_dir = paths[0] if Dir.exist?(paths[0])","  end","end",`newer_gem_home = File.join(File.dirname(user_dir), "${n.version}")`,"gems = (Dir.exist?(newer_gem_home) ? newer_gem_home : user_dir)",`STDERR.print([Gem.default_dir, gems, !!defined?(RubyVM::YJIT), RUBY_VERSION].join("${Rs}"))`].join(";"),s=await this.runScript(`${t.fsPath} -EUTF-8:UTF-8 -e '${i}'`),[o,a,c,d]=s.stderr.split(Rs);return{defaultGems:o,gemHome:a,yjit:c==="true",version:d}}async findClosestRubyInstallation(t){let[n,i,s]=t.version.split("."),o=[];for(let c of this.rubyInstallationUris)try{(await Ee.workspace.fs.readDirectory(c)).forEach(([d])=>{let p=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(d);p?.groups&&p.groups.version.startsWith(n)&&o.push({uri:Ee.Uri.joinPath(c,d,"bin","ruby"),rubyVersion:{engine:p.groups.engine,version:p.groups.version}})})}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${c.fsPath} but it doesn't exist`);continue}let a=o.sort((c,d)=>{let p=c.rubyVersion.version.split("."),m=d.rubyVersion.version.split("."),g=Math.abs(Number(p[1])-Number(i)),R=Math.abs(Number(m[1])-Number(i));return g===R?Number(m[2]||0)-Number(p[2]||0):g-R})[0];if(a)return a;throw new Error("Cannot find any Ruby installations")}async discoverRubyVersion(){let t=this.bundleUri,n=Xn.default.parse(t.fsPath).root,i,s;for(;t.fsPath!==n;){try{s=Ee.Uri.joinPath(t,".ruby-version"),i=(await Ee.workspace.fs.readFile(s)).toString().trim()}catch{t=Ee.Uri.file(Xn.default.dirname(t.fsPath));continue}if(i==="")throw new Error(`Ruby version file ${s} is empty`);let o=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(i);if(!o?.groups)throw new Error(`Ruby version file ${s} contains invalid format. Expected (engine-)?version, got ${i}`);return this.outputChannel.info(`Discovered Ruby version ${i} from ${s.fsPath}`),{engine:o.groups.engine,version:o.groups.version}}}async fallbackWithCancellation(t,n,i,s){let o;try{o=await Ee.workspace.fs.readFile(Ee.Uri.joinPath(this.workspaceFolder.uri,"Gemfile"))}catch{}if(o&&/^ruby(\s|\()("|')[\d.]+/.test(o.toString()))throw s();return await Ee.window.withProgress({title:t,location:Ee.ProgressLocation.Notification,cancellable:!0},async(c,d)=>{if(c.report({message:n}),await new Promise(p=>{setTimeout(p,1e4),d.onCancellationRequested(()=>{p()})}),d.isCancellationRequested)throw await this.handleCancelledFallback(s),new Ds;return i()})}async handleCancelledFallback(t){let n=await Ee.window.showInformationMessage(`The Ruby LSP requires a Ruby version to launch.
      You can define a fallback for the system or for the Ruby LSP only`,"System","Ruby LSP only");throw n==="System"?await this.createParentRubyVersionFile(t):n==="Ruby LSP only"&&await this.manuallySelectRuby(),t()}async createParentRubyVersionFile(t){let n=[];for(let o of this.rubyInstallationUris){let a;try{a=(await Ee.workspace.fs.readDirectory(o)).sort((c,d)=>d[0].localeCompare(c[0])),a.forEach(c=>{n.push({label:c[0]})})}catch{continue}}let i=await Ee.window.showQuickPick(n,{title:"Select a Ruby version to use as fallback",ignoreFocusOut:!0});if(!i)throw t();let s=await Ee.window.showOpenDialog({defaultUri:Ee.Uri.file(bf.default.homedir()),openLabel:"Add fallback in this directory",canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select the directory to create the .ruby-version fallback in"});if(!s)throw t();await Ee.workspace.fs.writeFile(Ee.Uri.joinPath(s[0],".ruby-version"),Buffer.from(i.label))}async findFallbackRuby(){for(let t of this.rubyInstallationUris){let n;try{n=(await Ee.workspace.fs.readDirectory(t)).sort((o,a)=>a[0].localeCompare(o[0]));let i,s;for(let o of n){let a=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(o[0]);if(a?.groups){i=a.groups,s=o;break}}if(s)return{uri:Ee.Uri.joinPath(t,s[0],"bin","ruby"),rubyVersion:{engine:i.engine,version:i.version}}}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${t.fsPath} but it doesn't exist`);continue}}throw new Error("Cannot find any Ruby installations")}missingRubyError(t){return new Error(`Cannot find Ruby installation for version ${t}`)}rubyVersionError(){return new Error(`Cannot find .ruby-version file. Please specify the Ruby version in a
           .ruby-version either in ${this.bundleUri.fsPath} or in a parent directory`)}};var sb=Z(require("os")),Qn=Z(require("vscode"));var Ca=class extends yt{async activate(){let e=await this.findMiseUri(),t=await this.runEnvActivationScript(`${e.fsPath} x -- ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findMiseUri(){let t=Qn.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.miseExecutablePath");if(t){let i=Qn.Uri.file(t);try{return await Qn.workspace.fs.stat(i),i}catch{throw new Error(`Mise executable configured as ${i}, but that file doesn't exist`)}}let n=[Qn.Uri.joinPath(Qn.Uri.file(sb.default.homedir()),".local","bin","mise"),Qn.Uri.joinPath(Qn.Uri.file("/"),"opt","homebrew","bin","mise")];for(let i of n)try{return await Qn.workspace.fs.stat(i),i}catch{}throw new Error(`The Ruby LSP version manager is configured to be Mise, but could not find Mise installation. Searched in
        ${n.join(", ")}`)}};var Ra=Z(require("os")),Fr=Z(require("vscode"));var Sa=class extends Fi{getProcessPath(){return process.env.Path??process.env.PATH??process.env.path}async findRubyUri(e){let[t,n,i]=e.version.split(".").map(Number),s=[Fr.Uri.joinPath(Fr.Uri.file("C:"),`Ruby${t}${n}-${Ra.default.arch()}`),Fr.Uri.joinPath(Fr.Uri.file(Ra.default.homedir()),`Ruby${t}${n}-${Ra.default.arch()}`)];for(let o of s)try{return await Fr.workspace.fs.stat(o),Fr.Uri.joinPath(o,"bin","ruby")}catch{}throw new Error(`Cannot find installation directory for Ruby version ${e.version}.         Searched in ${s.map(o=>o.fsPath).join(", ")}`)}async runActivationScript(e,t){let n=await super.runActivationScript(e,t);return n.gemHome=n.gemHome.replace(/\//g,"\\"),n.defaultGems=n.defaultGems.replace(/\//g,"\\"),n}runScript(e){return this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath}`),this.outputChannel.debug(`Environment used for command: ${JSON.stringify(process.env)}`),qt(e,{cwd:this.bundleUri.fsPath,env:process.env})}};var Yr=Z(require("vscode"));var Da=class extends yt{async activate(){let e=await this.findRbenv(),t=await this.runEnvActivationScript(`${e} exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRbenv(){let t=Yr.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rbenvExecutablePath");return t?this.ensureRbenvExistsAt(t):this.findExec([Yr.Uri.file("/opt/homebrew/bin"),Yr.Uri.file("/usr/local/bin")],"rbenv")}async ensureRbenvExistsAt(e){try{return await Yr.workspace.fs.stat(Yr.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rbenv, but ${e} does not exist`)}}};var ob=Z(require("os")),ur=Z(require("vscode"));var _a=class extends yt{async activate(){let e=await this.findRvmInstallation(),t=await this.runEnvActivationScript(e.fsPath),n=Object.entries(t.env).map(([i,s])=>`${i}=${s}`).join(" ");return this.outputChannel.info(`Activated Ruby environment: ${n}`),{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRvmInstallation(){let e=[ur.Uri.joinPath(ur.Uri.file(ob.default.homedir()),".rvm","bin","rvm-auto-ruby"),ur.Uri.joinPath(ur.Uri.file("/"),"usr","local","rvm","bin","rvm-auto-ruby"),ur.Uri.joinPath(ur.Uri.file("/"),"usr","share","rvm","bin","rvm-auto-ruby")];for(let t of e)try{return await ur.workspace.fs.stat(t),t}catch{}throw new Error(`Cannot find RVM installation directory. Searched in ${e.map(t=>t.fsPath).join(",")}`)}};var Oi=class extends yt{constructor(e,t,n,i,s){super(e,t,n,i),this.rubyPath=s??"ruby"}async activate(){let e=await this.runEnvActivationScript(this.rubyPath);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}};var ab=Z(require("vscode"));var Ta=class extends yt{async activate(){let e=await this.runEnvActivationScript(`${this.customCommand()} && ruby`);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}customCommand(){let t=ab.workspace.getConfiguration("rubyLsp").get("customRubyCommand");if(t===void 0)throw new Error("The customRubyCommand configuration must be set when 'custom' is selected as the version manager.         See the [README](https://shopify.github.io/ruby-lsp/version-managers.html) for instructions.");return t}};var cb=Z(require("os")),wf=Z(require("path")),lt=Z(require("vscode"));var Pa=class extends yt{async activate(){let e=[lt.Uri.joinPath(lt.Uri.file("/"),"opt","homebrew","bin"),lt.Uri.joinPath(lt.Uri.file("/"),"usr","local","bin")],t=await this.getConfiguredAsdfPath()??await this.findAsdfInstallation()??await this.findExec(e,"asdf"),n=wf.default.extname(t)===""?t:`. ${t} && asdf`,i=await this.runEnvActivationScript(`${n} exec ruby`);return{env:{...process.env,...i.env},yjit:i.yjit,version:i.version,gemPath:i.gemPath}}async findAsdfInstallation(){let e=wf.default.basename(lt.env.shell)==="fish"?"asdf.fish":"asdf.sh",t=[lt.Uri.joinPath(lt.Uri.file(cb.default.homedir()),".asdf",e),lt.Uri.joinPath(lt.Uri.file("/"),"opt","asdf-vm",e),lt.Uri.joinPath(lt.Uri.file("/"),"opt","homebrew","opt","asdf","libexec",e),lt.Uri.joinPath(lt.Uri.file("/"),"usr","local","opt","asdf","libexec",e)];for(let n of t)try{return await lt.workspace.fs.stat(n),n.fsPath}catch{}this.outputChannel.info(`Could not find installation for ASDF < v0.16. Searched in ${t.join(", ")}`)}async getConfiguredAsdfPath(){let t=lt.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.asdfExecutablePath");if(!t)return;let n=lt.Uri.file(t);try{return await lt.workspace.fs.stat(n),this.outputChannel.info(`Using configured ASDF executable path: ${t}`),n.fsPath}catch{throw new Error(`ASDF executable configured as ${n}, but that file doesn't exist`)}}};async function HD(){let r=[Le.Uri.joinPath(Le.Uri.file(ka.default.homedir()),".local","bin","mise"),Le.Uri.joinPath(Le.Uri.file("/"),"opt","homebrew","bin","mise")];for(let e of r)try{return await Le.workspace.fs.stat(e),!0}catch{}return!1}var Cf=(p=>(p.Asdf="asdf",p.Auto="auto",p.Chruby="chruby",p.Rbenv="rbenv",p.Rvm="rvm",p.Shadowenv="shadowenv",p.Mise="mise",p.RubyInstaller="rubyInstaller",p.None="none",p.Custom="custom",p))(Cf||{}),Ea=class{constructor(e,t,n,i){this.gemPath=[];this.#e=Le.workspace.getConfiguration("rubyLsp").get("rubyVersionManager");this.shell=process.env.SHELL?.replace(/(\s+)/g,"\\$1");this._env={};this._error=!1;this.context=e,this.workspaceFolder=t,this.outputChannel=n,this.telemetry=i;let s=Le.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=Li.default.isAbsolute(s)?s:Li.default.resolve(Li.default.join(this.workspaceFolder.uri.fsPath,s)))}#e;get versionManager(){return this.#e}set versionManager(e){typeof e=="string"?this.#e.identifier=e:this.#e=e}get env(){return this._env}get error(){return this._error}async activateRuby(e=Le.workspace.getConfiguration("rubyLsp").get("rubyVersionManager")){this.versionManager=e,this._error=!1;let t=this.context.workspaceState.get(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`);if(t)await this.runActivation(new Oi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),t));else{this.versionManager.identifier==="auto"&&(await this.discoverVersionManager(),this.outputChannel.info(`Discovered version manager ${this.versionManager.identifier}`));try{await this.runManagerActivation()}catch(n){n instanceof Ss||this.telemetry.logError(n,{versionManager:this.versionManager.identifier,workspace:new Le.TelemetryTrustedValue(this.workspaceFolder.name)});let i=Le.workspace.getConfiguration("rubyLsp").get("rubyExecutablePath");if(i)await this.runActivation(new Oi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),i));else{if(this._error=!0,this.context.extensionMode===Le.ExtensionMode.Test)throw n;await this.handleRubyError(n.message)}}}if(!this.error&&(this.fetchRubyVersionInfo(),await this.setupBundlePath(),Li.default.basename(this.workspaceFolder.uri.fsPath)==="ruby-lsp"&&ka.default.platform()!=="win32")){let n=Le.Uri.joinPath(this.workspaceFolder.uri,"exe");this._env.PATH=`${n.fsPath}${Li.default.delimiter}${this._env.PATH}`}}async manuallySelectRuby(){let e=await Le.window.showInformationMessage("Configure global or workspace specific fallback for the Ruby LSP?","global","workspace","clear previous workspace selection");if(!e)return;if(e==="clear previous workspace selection")return await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0),this.activateRuby();let t=await Le.window.showOpenDialog({title:`Select Ruby binary path for ${e} configuration`,openLabel:"Select Ruby binary",canSelectMany:!1});if(!t)return;let n=t[0].fsPath;return e==="global"?await Le.workspace.getConfiguration("rubyLsp").update("rubyExecutablePath",n,!0):await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,n),this.activateRuby()}mergeComposedEnvironment(e){this._env={...this._env,...e}}async runActivation(e){let{env:t,version:n,yjit:i,gemPath:s}=await e.activate(),[o,a,c]=n.split(".").map(Number);this.sanitizeEnvironment(t),this.context.extensionMode!==Le.ExtensionMode.Test&&(process.env=t),this._env=t,this.rubyVersion=n,this.yjitEnabled=i&&o>3||o===3&&a>=2,this.gemPath.push(...s)}fetchRubyVersionInfo(){let[e,t,n]=this.rubyVersion.split(".").map(Number);if(e<3)throw new Error(`The Ruby LSP requires Ruby 3.0 or newer to run. This project is using ${this.rubyVersion}.         [See alternatives](https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#ruby-version-requirement)`);this.yjitEnabled&&e===3&&t===2&&(this._env.RUBYOPT?this._env.RUBYOPT.concat(" --yjit"):this._env.RUBYOPT="--yjit")}sanitizeEnvironment(e){Object.keys(e).forEach(t=>{t.startsWith("RUBY_GC")&&delete e[t]}),delete e.VERBOSE,delete e.DEBUG}async runManagerActivation(){switch(this.versionManager.identifier){case"asdf":await this.runActivation(new Pa(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"chruby":await this.runActivation(new Fi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rbenv":await this.runActivation(new Da(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rvm":await this.runActivation(new _a(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"mise":await this.runActivation(new Ca(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rubyInstaller":await this.runActivation(new Sa(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"custom":await this.runActivation(new Ta(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"none":await this.runActivation(new Oi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;default:await this.runActivation(new wa(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break}}async setupBundlePath(){if(this.customBundleGemfile)try{await Le.workspace.fs.stat(Le.Uri.file(this.customBundleGemfile)),this._env.BUNDLE_GEMFILE=this.customBundleGemfile}catch{throw new Error(`The configured bundle gemfile ${this.customBundleGemfile} does not exist`)}}async discoverVersionManager(){try{await Le.workspace.fs.stat(Le.Uri.joinPath(this.workspaceFolder.uri,".shadowenv.d")),this.versionManager.identifier="shadowenv";return}catch{}let e=["chruby","rbenv","rvm","asdf"];for(let t of e)if(await this.toolExists(t)){this.versionManager=t;return}if(await HD()){this.versionManager="mise";return}if(ka.default.platform()==="win32"){this.versionManager="rubyInstaller";return}this.versionManager="none"}async toolExists(e){try{let t=this.shell?`${this.shell} -i -c '`:"";return t+=`${e} --version`,this.shell&&(t+="'"),this.outputChannel.info(`Checking if ${e} is available on the path with command: ${t}`),await qt(t,{cwd:this.workspaceFolder.uri.fsPath,timeout:1e3}),!0}catch{return!1}}async handleRubyError(e){let t=await Le.window.showErrorMessage(`Automatic Ruby environment activation with ${this.versionManager.identifier} failed: ${e}`,"Retry","Select Ruby manually");if(t)return t==="Retry"&&await Le.commands.executeCommand("workbench.action.reloadWindow"),this.manuallySelectRuby()}};var Rf=Z(require("path")),ub=Z(require("os")),xa=require("perf_hooks"),de=Z(require("vscode")),jt=Z(ya());function KD(){let r=Object.keys(yf);return Object.fromEntries(r.map(e=>[e,ws(e)]))}function VD(r,e){let t,n,i=de.workspace.getConfiguration("rubyLsp"),s=i.get("branch"),o=i.get("bundleGemfile"),a=i.get("useBundlerCompose"),c=i.get("bypassTypechecker"),d={cwd:r.uri.fsPath,env:c?{...e,RUBY_LSP_BYPASS_TYPECHECKER:"true"}:e,shell:!0};if(o.length>0)t={command:"bundle",args:["exec","ruby-lsp"],options:d},n={command:"bundle",args:["exec","ruby-lsp","--debug"],options:d};else if(a)t={command:"bundle",args:["compose","gem","ruby-lsp"],options:d},n={command:"bundle",args:["compose","gem","ruby-lsp","--","--debug"],options:d};else{let p=[];s.length>0&&p.push("--branch",s),ws("launcher")&&p.push("--use-launcher"),t={command:"ruby-lsp",args:p,options:d},n={command:"ruby-lsp",args:p.concat(["--debug"]),options:d}}return{run:t,debug:n}}function zD(r,e,t,n,i,s){let o=r.get("pullDiagnosticsOn"),a={onChange:o==="change"||o==="both",onSave:o==="save"||o==="both"},c=r.get("enabledFeatures"),d=Object.keys(c).filter(R=>c[R]),p=["file","git"],m=e.uri.fsPath.replace(/\/$/,""),g=qr.flatMap(R=>p.map(y=>({scheme:y,language:R,pattern:`${m}/**/*`})));return i&&qr.forEach(R=>{g.push({language:R,scheme:"untitled"})}),n.gemPath.forEach(R=>{p.forEach(y=>{let P=R.replace(/\\/g,"/");g.push({scheme:y,language:"ruby",pattern:`${P}/**/*`}),/lib\/ruby\/gems\/(?=\d)/.test(P)&&g.push({scheme:y,language:"ruby",pattern:`${P.replace(/lib\/ruby\/gems\/(?=\d)/,"lib/ruby/")}/**/*`})})}),r.get("erbSupport")||(g=g.filter(R=>R.language!=="erb")),{documentSelector:g,workspaceFolder:e,diagnosticCollectionName:ba,outputChannel:t,revealOutputChannelOn:jt.RevealOutputChannelOn.Never,diagnosticPullOptions:a,errorHandler:new Sf(e,s),initializationOptions:{enabledFeatures:d,featuresConfiguration:r.get("featuresConfiguration"),formatter:r.get("formatter"),linters:r.get("linters"),indexing:r.get("indexing"),addonSettings:r.get("addonSettings"),enabledFeatureFlags:KD(),telemetryMachineId:de.env.machineId}}}var Sf=class{constructor(e,t){this.workspaceFolder=e,this.telemetry=t}error(e,t,n){return{action:jt.ErrorAction.Shutdown,handled:!0}}async closed(){let e=de.workspace.getConfiguration("rubyLsp").get("useLauncher")?"launcher":"direct";return this.telemetry.logUsage("ruby_lsp.launch_failure",{type:"counter",attributes:{label:e}}),await de.window.showErrorMessage(`Launching the Ruby LSP failed. This typically happens due to an error with version manager
      integration or Bundler issues.

      [Logs](command:workbench.action.output.toggleOutput) |
      [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) |
      [Run bundle install](command:rubyLsp.bundleInstall?"${this.workspaceFolder.uri.toString()}")`,"Retry","Shutdown")==="Retry"?{action:jt.CloseAction.Restart,handled:!0}:{action:jt.CloseAction.DoNotRestart,handled:!0}}},Df=class{fillClientCapabilities(e){e.experimental={requestDelegation:!0}}initialize(e,t){}getState(){return{kind:"static"}}clear(){}},_s=class extends jt.LanguageClient{constructor(t,n,i,s,o,a,c,d=!1,p){super(ba,VD(o,i.env),zD(de.workspace.getConfiguration("rubyLsp"),o,a,i,d,n),p);this.degraded=!1;this.virtualDocuments=new Map;this.subscriptions=[];this.registerFeature(new Df),this.workspaceOutputChannel=a,this.virtualDocuments=c,this.registerMiddleware(),this.workingDirectory=o.uri.fsPath,this.baseFolder=Rf.default.basename(this.workingDirectory),this.telemetry=n,this.createTestItems=s,this.#e=t,this.ruby=i,this.#t="",this.subscriptions.push(this.onNotification("delegate/textDocument/virtualState",m=>{this.virtualDocuments.set(m.textDocument.uri,m.textDocument.text)}),this.onTelemetry(m=>{m.type==="error"?this.telemetry.logError({message:m.errorMessage,name:m.errorClass,stack:m.stack},{serverVersion:this.serverVersion}):m.type==="data"&&this.validServerTelemetry(m)&&this.telemetry.logUsage(m.eventName,m.data)})),this.indexingPromise=new Promise(m=>{let g=this.onProgress(jt.WorkDoneProgress.type,"indexing-progress",R=>{R.kind==="end"&&(g.dispose(),m())})})}#e;#t;async afterStart(){this.#t=this.initializeResult?.formatter,this.serverVersion=this.initializeResult?.serverInfo?.version,this.initializeResult?.degraded_mode&&(this.degraded=this.initializeResult?.degraded_mode),this.initializeResult?.bundle_env&&this.ruby.mergeComposedEnvironment(this.initializeResult.bundle_env),await this.fetchAddons()}async fetchAddons(){if(this.initializeResult?.capabilities.experimental?.addon_detection)try{this.addons=await this.sendRequest("rubyLsp/workspace/addons",{})}catch(t){this.workspaceOutputChannel.error(`Error while fetching addons: ${t.data.errorMessage}`)}}async waitForIndexing(){return this.indexingPromise}get formatter(){return this.#t}get context(){return this.#e}set context(t){this.#e=t}async sendShowSyntaxTreeRequest(t,n){return this.sendRequest("rubyLsp/textDocument/showSyntaxTree",{textDocument:{uri:t.toString()},range:n})}async discoverTests(t){return this.sendRequest("rubyLsp/discoverTests",{textDocument:{uri:t.toString()}})}async resolveTestCommands(t){return this.sendRequest("rubyLsp/resolveTestCommands",{items:t})}async dispose(t){return this.subscriptions.forEach(n=>n.dispose()),this.subscriptions=[],super.dispose(t)}async benchmarkMiddleware(t,n,i){if(this.state!==jt.State.Running)return i();let s=typeof t=="string"?t:t.method;try{xa.performance.mark(`${s}.start`);let o=await i();xa.performance.mark(`${s}.end`);let a=xa.performance.measure("benchmarks",`${s}.start`,`${s}.end`);return this.logResponseTime(a.duration,s),o}catch(o){if(o.code===-32900)return this.executeDelegateRequest(t,n);if(o.data)if(this.baseFolder==="ruby-lsp"||this.baseFolder==="ruby-lsp-rails")await de.window.showErrorMessage(`Ruby LSP error ${o.data.errorClass}: ${o.data.errorMessage}

${o.data.backtrace}`);else{let{errorMessage:a,errorClass:c,backtrace:d}=o.data;if(a&&c&&d&&o.code===jt.ErrorCodes.InternalError){let p=new de.TelemetryTrustedValue(d.split(`
`).map(m=>m.replace(ub.default.homedir(),"~")).join(`
`));this.telemetry.logError({message:a,name:c,stack:p},{...o.data,serverVersion:this.serverVersion,workspace:new de.TelemetryTrustedValue(Rf.default.basename(this.workingDirectory))})}}throw o}}async executeDelegateRequest(t,n){let i=typeof t=="string"?t:t.method,s=n.textDocument.uri;if(!s)return null;let o=this.virtualDocumentUri(s);switch(i){case"textDocument/completion":return de.commands.executeCommand("vscode.executeCompletionItemProvider",de.Uri.parse(o),n.position,n.context.triggerCharacter).then(a=>(a.items.forEach(c=>{c.documentation&&typeof c.documentation!="string"&&"value"in c.documentation&&(c.documentation.kind="markdown"),c.data={...c.data,delegateCompletion:!0}}),a));case"textDocument/hover":return de.commands.executeCommand("vscode.executeHoverProvider",de.Uri.parse(o),n.position);case"textDocument/definition":return de.commands.executeCommand("vscode.executeDefinitionProvider",de.Uri.parse(o),n.position);case"textDocument/signatureHelp":return de.commands.executeCommand("vscode.executeSignatureHelpProvider",de.Uri.parse(o),n.position,n.context?.triggerCharacter);case"textDocument/documentHighlight":return de.commands.executeCommand("vscode.executeDocumentHighlights",de.Uri.parse(o),n.position);default:return this.workspaceOutputChannel.warn(`Attempted to delegate unsupported request ${i}`),null}}registerMiddleware(){this.clientOptions.middleware={provideCodeLenses:async(t,n,i)=>{let s=await i(t,n);if(s){let o=s.filter(a=>a.data.type==="test");o.length&&this.createTestItems(o)}return s},provideOnTypeFormattingEdits:async(t,n,i,s,o,a)=>{let c=await this.sendRequest("textDocument/onTypeFormatting",{textDocument:{uri:t.uri.toString()},position:n,ch:i,options:s},o);if(!c)return null;let d=c.find(k=>k.newText==="$0");if(!d)return c;c.splice(c.indexOf(d),1);let p=new de.WorkspaceEdit;p.set(t.uri,c);let g=de.window.activeTextEditor.document.lineAt(d.range.start.line).text;await de.workspace.applyEdit(p);let R=de.window.activeTextEditor?.options.insertSpaces?" ":"	",y=0;/^\s*$/.exec(g)&&(y=d.range.end.character);let P=R.repeat(y);return await de.window.activeTextEditor.insertSnippet(new de.SnippetString(`${P}${d.newText}`),new de.Selection(d.range.start,d.range.end)),null},sendRequest:async(t,n,i,s)=>this.benchmarkMiddleware(t,n,()=>s(t,n,i)),sendNotification:async(t,n,i)=>this.benchmarkMiddleware(t,i,()=>n(t,i)),didClose:(t,n)=>(this.virtualDocuments.delete(t.uri.toString(!0)),n(t)),provideFoldingRanges:async(t,n,i,s)=>{if(t.languageId==="erb"){let o=this.virtualDocumentUri(t.uri.toString(!0)),a=await de.commands.executeCommand("vscode.executeFoldingRangeProvider",de.Uri.parse(o)),c=await s(t,n,i);return a.concat(c??[])}return s(t,n,i)},provideDocumentLinks:async(t,n,i)=>{if(t.languageId==="erb"){let s=this.virtualDocumentUri(t.uri.toString(!0)),o=await de.commands.executeCommand("vscode.executeLinkProvider",de.Uri.parse(s)),a=await i(t,n);return o.concat(a??[])}return i(t,n)}}}virtualDocumentUri(t){let n=/\.([^.]+)\.erb$/.exec(t)?.[1]||"html";return`embedded-content://${n}/${encodeURIComponent(t)}.${n}`}logResponseTime(t,n){this.telemetry.logUsage("ruby_lsp.response_time",{type:"histogram",value:t,attributes:{message:new de.TelemetryTrustedValue(n),lspVersion:this.serverVersion,rubyVersion:this.ruby.rubyVersion}})}validServerTelemetry(t){let{eventName:n,data:{type:i,value:s}}=t;return typeof n=="string"&&(i==="histogram"&&typeof s=="number"||i==="counter"&&(typeof s=="number"||!s))}};var Ia=class{constructor(e,t){this.prefix=`(${e})`,this.actualChannel=t,this.onDidChangeLogLevel=this.actualChannel.onDidChangeLogLevel}get name(){return this.actualChannel.name}get logLevel(){return this.actualChannel.logLevel}trace(e,...t){this.actualChannel.trace(`${this.prefix} ${e}`,...t)}debug(e,...t){this.actualChannel.debug(`${this.prefix} ${e}`,...t)}info(e,...t){this.actualChannel.info(`${this.prefix} ${e}`,...t)}warn(e,...t){this.actualChannel.warn(`${this.prefix} ${e}`,...t)}error(e,...t){this.actualChannel.error(`${this.prefix} ${e}`,...t)}append(e){this.actualChannel.append(`${this.prefix} ${e}`)}appendLine(e){this.actualChannel.appendLine(`${this.prefix} ${e}`)}replace(e){this.actualChannel.replace(`${this.prefix} ${e}`)}clear(){this.actualChannel.clear()}show(e,t){this.actualChannel.show(t)}hide(){this.actualChannel.hide()}dispose(){this.actualChannel.dispose()}};var db=["Gemfile.lock","gems.locked"],Fa=class{constructor(e,t,n,i,s,o=!1){this.virtualDocuments=new Map;this.restartDocumentShas=new Map;this.needsRestart=!1;this.subscriptions=[];this.#e=!1;this.#t=!1;this.debouncedRestart=rb(async e=>{this.outputChannel.info(`Restarting the Ruby LSP because ${e}`),await this.restart()},5e3);this.context=e,this.workspaceFolder=t,this.outputChannel=new Ia(t.name,Bn),this.telemetry=n,this.ruby=new Ea(e,t,this.outputChannel,n),this.createTestItems=i,this.isMainWorkspace=o,this.virtualDocuments=s}#e;#t;async activate(){let e=Ye.extensions.getExtension("vscode.git"),t=this.workspaceFolder.uri;if(e){let i=await e.exports.getAPI(1).openRepository(this.workspaceFolder.uri);i&&(t=i.rootUri)}this.registerCreateDeleteWatcher(t,".git/{rebase-merge,rebase-apply,BISECT_START,CHERRY_PICK_HEAD}"),this.registerRestarts();for(let n of db){let i=Ye.Uri.joinPath(this.workspaceFolder.uri,n),s=await this.fileContentsSha(i);s&&this.restartDocumentShas.set(i.fsPath,s)}}async start(e){if(await this.ruby.activateRuby(),this.ruby.error){this.error=!0;return}try{if((await Ye.workspace.fs.stat(this.workspaceFolder.uri)).permissions)throw new Error(`Directory ${this.workspaceFolder.uri.fsPath} is readonly.`)}catch{this.error=!0,await Ye.window.showErrorMessage(`Directory ${this.workspaceFolder.uri.fsPath} is not writable. The Ruby LSP server needs to be able to create a
        .ruby-lsp directory to function appropriately. Consider switching to a directory for which VS Code has write
        permissions`);return}try{await this.installOrUpdateServer(!1)}catch(t){this.error=!0,await Ye.window.showErrorMessage(`Failed to setup the bundle: ${t.message}.         See [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) for help`);return}this.lspClient&&await this.stop(),this.lspClient=new _s(this.context,this.telemetry,this.ruby,this.createTestItems,this.workspaceFolder,this.outputChannel,this.virtualDocuments,this.isMainWorkspace,e);try{wn.fire(this),await Ye.window.withProgress({location:Ye.ProgressLocation.Window,title:"Initializing Ruby LSP"},async()=>{await this.lspClient.start(),await this.lspClient.afterStart()}),wn.fire(this),this.needsRestart&&(this.needsRestart=!1,await this.debouncedRestart("a restart was requested while the server was still booting"))}catch(t){this.error=!0,this.outputChannel.error(`Error starting the server: ${t.message}`)}}async stop(){await this.lspClient?.dispose()}async restart(){try{if(this.#e)return;if(this.error=!1,!this.lspClient)return this.start();let e=!1;switch(this.lspClient.state){case qa.State.Starting:this.needsRestart=!0;break;case qa.State.Running:e=!this.lspClient.initializeResult?.capabilities.experimental.compose_bundle||await this.composingBundleSucceeds(),e&&(await this.stop(),this.lspClient=void 0,await this.start());break;case qa.State.Stopped:await this.stop(),this.lspClient=void 0,await this.start();break}}catch(e){this.error=!0,this.outputChannel.error(`Error restarting the server: ${e.message}`)}}async dispose(){this.subscriptions.forEach(e=>e.dispose()),await this.lspClient?.dispose()}async installOrUpdateServer(e){if(Ye.workspace.getConfiguration("rubyLsp").get("bundleGemfile").length>0)return;let n=24*60*60*1e3,i=this.context.workspaceState.get("rubyLsp.lastGemUpdate"),s=["ruby-lsp","language_server-protocol","prism","rbs","sorbet-runtime"],{stdout:o}=await qt(`gem list ${s.join(" ")}`,{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env});if(!s.every(a=>new RegExp(`${a}\\s`).exec(o))){await qt("gem install ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now());return}if(e)try{await Ye.workspace.fs.delete(Ye.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp"),{recursive:!0})}catch{this.outputChannel.info(`Tried deleting ${Ye.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp")}, but it doesn't exist`)}if(e||i===void 0||Date.now()-i>n)try{await qt("gem update ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now())}catch(a){this.outputChannel.error(`Failed to update global ruby-lsp gem: ${a}`)}}get error(){return this.#t}set error(e){wn.fire(this),this.#t=e}get inhibitRestart(){return this.#e}async execute(e,t=!1){t&&(this.outputChannel.show(),this.outputChannel.info(`Running "${e}"`));let n=await qt(e,{env:this.ruby.env,cwd:this.workspaceFolder.uri.fsPath});return t&&(n.stderr.length>0?this.outputChannel.error(n.stderr):this.outputChannel.info(n.stdout)),n}registerRestarts(){this.createRestartWatcher(`{${db.join(",")}}`),this.subscriptions.push(Ye.workspace.onDidChangeConfiguration(async e=>{e.affectsConfiguration("rubyLsp")&&await this.debouncedRestart("configuration changed")}))}createRestartWatcher(e){let t=Ye.workspace.createFileSystemWatcher(new Ye.RelativePattern(this.workspaceFolder,e)),n=async s=>{let o=s.fsPath,a=await this.fileContentsSha(s);a&&this.restartDocumentShas.get(o)!==a&&(this.restartDocumentShas.set(o,a),await this.debouncedRestart(`${o} changed, matching ${e}`))},i=async s=>{this.restartDocumentShas.delete(s.fsPath),await this.debouncedRestart(`${s.fsPath} changed, matching ${e}`)};this.subscriptions.push(t,t.onDidChange(n),t.onDidCreate(n),t.onDidDelete(i))}registerCreateDeleteWatcher(e,t){let n=Ye.workspace.createFileSystemWatcher(new Ye.RelativePattern(e,t)),i=()=>{this.#e=!0},s=async o=>{this.#e=!1,await this.debouncedRestart(`${o.fsPath} changed, matching ${t}`)};this.subscriptions.push(n,n.onDidCreate(i),n.onDidDelete(s))}async fileContentsSha(e){let t;try{t=await Ye.workspace.fs.readFile(e)}catch{return}let n=(0,lb.createHash)("sha256");return n.update(t.toString()),n.digest("hex")}async composingBundleSucceeds(){if(!this.lspClient)return!1;try{return(await this.lspClient.sendRequest("rubyLsp/composeBundle")).success}catch{return!1}}};var Yt=Z(require("vscode")),Oa=Z(va());var fb=[{label:"Ruby LSP: Start",description:"rubyLsp.start"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"}],_f=[{label:"Ruby LSP: Stop",description:"rubyLsp.stop"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"},{label:"Ruby LSP: Open server changelog in browser",description:"rubyLsp.showServerChangelog"}],Zr=class{constructor(e){let t=qr.map(n=>({language:n}));this.item=Yt.languages.createLanguageStatusItem(e,t)}dispose(){this.item.dispose()}},Tf=class extends Zr{constructor(){super("rubyVersion"),this.item.name="Ruby Version",this.item.command={title:"Configure",command:"rubyLsp.selectRubyVersionManager"},this.item.text="Activating Ruby environment",this.item.severity=Yt.LanguageStatusSeverity.Information}refresh(e){e.ruby.error?(this.item.text="Failed to activate Ruby",this.item.severity=Yt.LanguageStatusSeverity.Error):(this.item.text=`Using Ruby ${e.ruby.rubyVersion} with ${e.ruby.versionManager.identifier}`,this.item.severity=Yt.LanguageStatusSeverity.Information)}},Pf=class extends Zr{constructor(){super("server"),this.item.name="Ruby LSP Server Status",this.item.text="Ruby LSP: Starting",this.item.severity=Yt.LanguageStatusSeverity.Information,this.item.command={title:"Configure",command:"rubyLsp.serverOptions",arguments:[_f]}}refresh(e){if(e.error){this.item.text="Ruby LSP: Error",this.item.command.arguments=[fb],this.item.severity=Yt.LanguageStatusSeverity.Error;return}if(e.lspClient)switch(e.lspClient.state){case Oa.State.Running:{this.item.text=e.lspClient.serverVersion?`Ruby LSP server v${e.lspClient.serverVersion}: Running`:"Ruby LSP: Running",e.lspClient.degraded?(this.item.text+=" (degraded)",this.item.severity=Yt.LanguageStatusSeverity.Warning):this.item.severity=Yt.LanguageStatusSeverity.Information,this.item.command.arguments=[_f];break}case Oa.State.Starting:{this.item.text="Ruby LSP: Starting",this.item.command.arguments=[_f],this.item.severity=Yt.LanguageStatusSeverity.Information;break}case Oa.State.Stopped:{this.item.text="Ruby LSP: Stopped",this.item.command.arguments=[fb],this.item.severity=Yt.LanguageStatusSeverity.Information;break}}}},kf=class extends Zr{constructor(){super("features"),this.item.name="Ruby LSP Features",this.item.command={title:"Manage",command:"rubyLsp.toggleFeatures"},this.item.text="Fetching feature information"}refresh(e){let n=Yt.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),i=Object.keys(n).filter(s=>n[s]);this.item.text=`${i.length}/${Object.keys(n).length} features enabled`}},Ef=class extends Zr{constructor(){super("formatter"),this.item.name="Ruby LSP Formatter",this.item.command={title:"Help",command:"rubyLsp.formatterHelp"},this.item.text="Fetching formatter information"}refresh(e){e.lspClient&&(e.lspClient.formatter?this.item.text=`Formatter: ${e.lspClient.formatter}`:this.item.text="Formatter: requires server to be v0.12.4 or higher to display this field")}},xf=class extends Zr{constructor(){super("addons"),this.item.name="Ruby LSP Add-ons",this.item.text="Fetching add-on information"}refresh(e){e.lspClient&&(e.lspClient.addons===void 0?this.item.text="Addons: requires server to be v0.17.4 or higher to display this field":e.lspClient.addons.length===0?this.item.text="Addons: none":(this.item.text=`Addons: ${e.lspClient.addons.length}`,this.item.command={title:"Details",command:"rubyLsp.displayAddons"}))}},La=class{constructor(){this.items=[];this.items=[new Tf,new Pf,new kf,new Ef,new xf],wn.event(e=>{e&&this.items.forEach(t=>t.refresh(e))})}dispose(){this.items.forEach(e=>e.dispose())}};var vb=require("child_process"),yb=require("util"),Lr=Z(require("path")),V=Z(require("vscode"));var BD=(0,yb.promisify)(vb.exec),pb=new V.TestTag("workspace"),gb=new V.TestTag("test_dir"),mb=new V.TestTag("test_group"),Or=new V.TestTag("debug"),GD=new V.TestTag("test_file"),Ma=class{constructor(e,t,n,i){this.testTimeout=V.workspace.getConfiguration("rubyLsp").get("testTimeout");this.fullDiscovery=ws("fullTestDiscovery");this.telemetry=t,this.currentWorkspace=n,this.getOrActivateWorkspace=i,this.testController=V.tests.createTestController("rubyTests","Ruby Tests"),this.fullDiscovery&&(this.testController.resolveHandler=this.resolveHandler.bind(this)),this.testCommands=new WeakMap,this.testRunProfile=this.testController.createRunProfile("Run",V.TestRunProfileKind.Run,async(s,o)=>{await this.runHandler(s,o)},!0),this.testDebugProfile=this.testController.createRunProfile("Debug",V.TestRunProfileKind.Debug,async(s,o)=>{await this.debugHandler(s,o)},!1,Or),e.subscriptions.push(this.testController,this.testDebugProfile,this.testRunProfile,V.window.onDidCloseTerminal(s=>{s===this.terminal&&(this.terminal=void 0)}),V.workspace.onDidSaveTextDocument(async s=>{let o=s.uri,a=await this.getParentTestItem(o);if(a){let c=a.children.get(o.toString());c&&(c.children.replace([]),await this.resolveHandler(c))}}))}createTestItems(e){if(this.fullDiscovery)return;this.testController.items.forEach(i=>{this.testController.items.delete(i.id),this.testCommands.delete(i)});let t=new Map,n=V.Uri.from({scheme:"file",path:e[0].command.arguments[0]});e.forEach(i=>{let[s,o,a,c,d]=i.command.arguments,p=this.testController.createTestItem(o,d||o,n),m=i.data;if(p.tags=[new V.TestTag(m.kind)],this.testCommands.set(p,a),p.range=new V.Range(new V.Position(c.start_line,c.start_column),new V.Position(c.end_line,c.end_column)),m.id?(t.set(m.id,p),p.canResolveChildren=!0):p.tags=[...p.tags,Or],m.group_id){let g=t.get(m.group_id);g?g.children.add(p):this.currentWorkspace()?.outputChannel.error(`Test example "${o}" is attached to group_id ${m.group_id}, but that group does not exist`)}else this.testController.items.add(p)})}runTestInTerminal(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"",this.terminal===void 0&&(this.terminal=this.getTerminal()),this.terminal.show(),this.terminal.sendText(n),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test_in_terminal",vscodemachineid:V.env.machineId}})}async runOnClick(e){let t=this.findTestById(e);if(!t)return;await V.commands.executeCommand("vscode.revealTestInExplorer",t);let n=new V.CancellationTokenSource;n.token.onCancellationRequested(async()=>{n?.dispose(),n=null,await V.window.showInformationMessage("Cancelled the progress")});let i=new V.TestRunRequest([t],[],this.testRunProfile);return this.testRunProfile.runHandler(i,n.token)}debugTest(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"";let i=this.currentWorkspace();if(!i)throw new Error("No workspace found. Debugging requires a workspace to be opened");return V.debug.startDebugging(i.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:n,env:{...i.ruby.env,DISABLE_SPRING:"1"}})}buildRequestTestItems(e,t){if(!t)return e.map(i=>this.testItemToServerItem(i));let n=[];return e.forEach(i=>{let s=this.recursivelyFilter(i,t);s&&n.push(s)}),n.map(i=>this.testItemToServerItem(i))}getTerminal(){let e=this.currentWorkspace(),t=e?`${e.workspaceFolder.name}: test`:"Ruby LSP: test",n=V.window.terminals.find(i=>i.name===t);return n||V.window.createTerminal({name:t})}async debugHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=e.include[0],s=Date.now();await this.debugTest("","",this.testCommands.get(i)),n.passed(i,Date.now()-s),n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"debug",vscodemachineid:V.env.machineId}})}async runHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=[],s=a=>{i.push(a),n.enqueued(a)};e.include?e.include.forEach(s):this.testController.items.forEach(s);let o=this.currentWorkspace();for(;i.length>0&&!t.isCancellationRequested;){let a=i.pop();if(e.exclude?.includes(a)){n.skipped(a);continue}if(n.started(a),a.tags.find(c=>c.id==="example")){let c=Date.now();try{if(!o){n.errored(a,new V.TestMessage("No workspace found"));continue}let d=await this.assertTestPasses(a,o.workspaceFolder.uri.fsPath,o.ruby.env);n.appendOutput(d.replace(/\r?\n/g,`\r
`),void 0,a),n.passed(a,Date.now()-c)}catch(d){let p=Date.now()-c;if(d.killed){n.errored(a,new V.TestMessage(`Test timed out after ${this.testTimeout} seconds`),p);continue}let m=d.message.split(`
`),g=m[0]===""?m.slice(10,m.length-2).join(`
`):m.slice(4,m.length-9).join(`
`),R=[new V.TestMessage(d.message),new V.TestMessage(g)];m.find(y=>y==="F")?n.failed(a,R,p):n.errored(a,R,p)}}a.children.forEach(s)}n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test",vscodemachineid:V.env.machineId}})}async assertTestPasses(e,t,n){try{return(await BD(this.testCommands.get(e),{cwd:t,env:n,timeout:this.testTimeout*1e3})).stdout}catch(i){throw i.killed?i:new Error(i.stdout)}}findTestById(e,t=this.testController.items){if(!e)return this.findTestByActiveLine();let n=t.get(e);return n||(t.forEach(i=>{let s=this.findTestById(e,i.children);s&&(n=s)}),n)}findTestByActiveLine(e=V.window.activeTextEditor,t=this.testController.items){if(!e)return;let n=e.selection.active.line,i;return t.forEach(s=>{if(!i&&(s.uri?.toString()===e.document.uri.toString()&&s.range?.start.line<=n&&s.range?.end.line>=n&&(i=s),s.children.size>0)){let o=this.findTestByActiveLine(e,s.children);o&&(i=o)}}),i}async resolveHandler(e){let t=V.workspace.workspaceFolders;if(t)if(e){let n=V.workspace.getWorkspaceFolder(e.uri);if(e.tags.some(i=>i===pb))await this.gatherWorkspaceTests(n,e);else if(!e.tags.some(i=>i===mb)){let s=(await this.getOrActivateWorkspace(n)).lspClient;if(s){await s.waitForIndexing();let o=await s.discoverTests(e.uri);o&&this.addDiscoveredItems(o,e)}}}else if(t.length===1)await this.gatherWorkspaceTests(t[0],void 0);else for(let n of t){let i=this.testPattern(n);if((await V.workspace.findFiles(i,void 0,1)).length===0)continue;let o=n.uri,a=this.testController.createTestItem(o.toString(),n.name,o);a.canResolveChildren=!0,a.tags=[pb,Or],this.testController.items.add(a)}}async gatherWorkspaceTests(e,t){let n=t?t.children:this.testController.items,i=this.testPattern(e);for(let s of await V.workspace.findFiles(i)){let o=Lr.default.basename(s.fsPath);if(o==="test_helper.rb")continue;let c=V.workspace.asRelativePath(s,!1).split(Lr.default.sep);if(c.some(N=>N==="fixtures"))continue;let d=this.testDirectoryPosition(c),p=c.slice(0,d+1).join(Lr.default.sep),m=V.Uri.joinPath(e.uri,p),g=n.get(m.toString());g||(g=this.testController.createTestItem(m.toString(),p,m),g.tags=[gb,Or],n.add(g));let R=c.slice(d+1,d+2).join(Lr.default.sep),y=V.Uri.joinPath(m,R),P=await V.workspace.fs.stat(y),k=g.children;if(P.type===V.FileType.Directory){let N=g.children.get(y.toString());N||(N=this.testController.createTestItem(y.toString(),R,y),N.tags=[gb,Or],g.children.add(N)),k=N.children}let M=this.testController.createTestItem(s.toString(),o,s);M.canResolveChildren=!0,M.tags=[GD,Or],k.add(M)}}testPattern(e){return new V.RelativePattern(e,"**/{test,spec,features}/**/{*_test.rb,test_*.rb,*_spec.rb,*.feature}")}testDirectoryPosition(e){let t=e.indexOf("test");return t!==-1||(t=e.indexOf("spec"),t!==-1)?t:e.indexOf("features")}async getParentTestItem(e){let t=V.workspace.workspaceFolders;if(!t)return;let n=this.testController.items,i=t[0];t.length>1&&(i=V.workspace.getWorkspaceFolder(e),n=n.get(i.uri.toString()).children);let{firstLevelUri:s,secondLevelUri:o}=await this.directoryLevelUris(e,i),a=n.get(s.toString());return o&&(a=a?.children.get(o.toString())),a}async directoryLevelUris(e,t){let i=V.workspace.asRelativePath(e).split(Lr.default.sep),s=this.testDirectoryPosition(i),o=i.slice(0,s+1).join(Lr.default.sep),a=V.Uri.joinPath(t.uri,o),c=i.slice(s+1,s+2).join(Lr.default.sep),d=V.Uri.joinPath(a,c);return(await V.workspace.fs.stat(d)).type===V.FileType.Directory?{firstLevelUri:a,secondLevelUri:d}:{firstLevelUri:a,secondLevelUri:void 0}}addDiscoveredItems(e,t){e.forEach(n=>{let i=this.testController.createTestItem(n.id,n.label,V.Uri.parse(n.uri));i.canResolveChildren=n.children.length>0;let s=n.range.start,o=n.range.end;i.range=new V.Range(new V.Position(s.line,s.character),new V.Position(o.line,o.character));let a=n.tags.map(c=>new V.TestTag(c));i.tags=i.canResolveChildren?[mb,Or,...a]:[Or,...a],t.children.add(i),i.canResolveChildren&&this.addDiscoveredItems(n.children,i)})}recursivelyFilter(e,t){if(t.includes(e))return null;let n=[];return e.children.forEach(i=>{let s=this.recursivelyFilter(i,t);s&&n.push(s)}),e.children.size>0&&n.length===0?null:(e.children.replace(n),e)}testItemToServerItem(e){let t=[];e.children.forEach(i=>{t.push(this.testItemToServerItem(i))});let n;return e.range&&(n={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),{id:e.id,label:e.label,uri:e.uri.toString(),range:n,children:t,tags:e.tags.map(i=>i.id)}}};var bb=Z(require("path")),je=Z(require("vscode"));async function wb(r,e,t){let{file:n,...i}=t,{line:s,character:o=0,endLine:a=s,endCharacter:c=o}=i,d=new je.Range(s,o,a,c),p=je.Uri.parse(`file://${n}`),m=await je.workspace.openTextDocument(p);await je.window.showTextDocument(m,{selection:d}),e?.lspClient?.serverVersion&&r.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"open_file",vscodemachineid:je.env.machineId}})}async function Cb(r){if(r.length===1){await je.commands.executeCommand("vscode.open",je.Uri.parse(r[0]));return}let e=r.map(n=>{let i=je.Uri.parse(n);return{label:bb.default.basename(i.fsPath),iconPath:new je.ThemeIcon("go-to-file"),uri:i}}),t=await je.window.showQuickPick(e,{title:"Select a file to jump to"});t&&await je.commands.executeCommand("vscode.open",t.uri)}async function Rb(){let r=await je.workspace.openTextDocument({language:"ruby"}),e=await je.window.showTextDocument(r,{preview:!1}),t=new je.Position(0,0);await e.insertSnippet(new je.SnippetString(`require "test_helper"

class $1Test < Minitest::Test
  def test_$2
    $3
  end
end
`),new je.Selection(t,t))}var Sb=Z(require("net")),Db=Z(require("os")),_b=require("child_process"),ot=Z(require("vscode"));var If=class{append(e){console.log(e)}appendLine(e){console.log(e)}},Na=class{constructor(e,t){this.console=process.env.CI?new If:ot.debug.activeDebugConsole;this.workspaceResolver=t,e.subscriptions.push(ot.debug.registerDebugConfigurationProvider("ruby_lsp",this),ot.debug.registerDebugAdapterDescriptorFactory("ruby_lsp",this))}async createDebugAdapterDescriptor(e,t){return e.configuration.request==="launch"?this.spawnDebuggeeForLaunch(e):e.configuration.request==="attach"?this.attachDebuggee(e):new Promise((n,i)=>i(new Error(`Unknown request type: ${e.configuration.request}. Please review your launch configurations`)))}provideDebugConfigurations(e,t){return[{type:"ruby_lsp",name:"Debug script",request:"launch",program:"ruby ${file}"},{type:"ruby_lsp",name:"Debug test",request:"launch",program:"ruby -Itest ${relativeFile}"},{type:"ruby_lsp",name:"Attach debugger",request:"attach"}]}resolveDebugConfiguration(e,t,n){let i=this.workspaceResolver(e?.uri);if(!i)throw new Error(`Couldn't find a workspace for URI: ${e?.uri} or editor: ${ot.window.activeTextEditor}`);t.env?t.env=Object.assign(t.env,i.ruby.env):t.env=i.ruby.env;let s=i.workspaceFolder.uri;if(t.targetFolder={path:s.fsPath,name:i.workspaceFolder.name},t.env.BUNDLE_GEMFILE)return t;let o=ot.Uri.joinPath(s,".ruby-lsp");return ot.workspace.fs.readDirectory(o).then(a=>(a.some(c=>c[0]==="Gemfile")?t.env.BUNDLE_GEMFILE=ot.Uri.joinPath(o,"Gemfile").fsPath:a.some(c=>c[0]==="gems.rb")&&(t.env.BUNDLE_GEMFILE=ot.Uri.joinPath(o,"gems.rb").fsPath),t),()=>t)}dispose(){this.debugProcess&&this.debugProcess.kill("SIGTERM")}async getSockets(e){let t=e.configuration,n=e.configuration.debugSocketPath;if(n)return[n];let i=[];try{i=(await qt("bundle exec rdbg --util=list-socks",{cwd:e.workspaceFolder?.uri.fsPath,env:t.env})).stdout.toString().split(`
`).filter(o=>o.length>0)}catch(s){this.console.append(`Error listing sockets: ${s.message}`)}return i}async attachDebuggee(e){let t=e.configuration.debugPort;if(t){let s=e.configuration.debugHost;return s?new ot.DebugAdapterServer(t,s):new ot.DebugAdapterServer(t)}let n=await this.getSockets(e);if(n.length===0)throw new Error("No debuggee processes found. Is the process running?");if(n.length===1)return new ot.DebugAdapterNamedPipeServer(n[0]);let i=await ot.window.showQuickPick(n,{placeHolder:"Select a debuggee",ignoreFocusOut:!0}).then(s=>{if(s===void 0)throw new Error("No debuggee selected");return s});return new ot.DebugAdapterNamedPipeServer(i)}async spawnDebuggeeForLaunch(e){let t="",n=!1,i=e.configuration,o=i.targetFolder.path,a=Db.default.platform()==="win32"?await this.availablePort():void 0;return new Promise((c,d)=>{let p=["exec","rdbg"];a&&p.push("--port",a.toString()),p.push("--open","--command","--",i.program),this.logDebuggerMessage(`Spawning debugger in directory ${o}`),this.logDebuggerMessage(`   Command bundle ${p.join(" ")}`),this.debugProcess=(0,_b.spawn)("bundle",p,{shell:!0,env:i.env,cwd:o}),this.debugProcess.stderr.on("data",m=>{let g=m.toString();if(this.logDebuggerMessage(g),n||(t+=g),t.includes("DEBUGGER: wait for debugger connection...")){n=!0;let y=RegExp(/DEBUGGER: Debugger can attach via UNIX domain socket \((.*)\)/).exec(t);a?c(new ot.DebugAdapterServer(a)):y&&y.length===2?c(new ot.DebugAdapterNamedPipeServer(y[1])):d(new Error("Debugger not found on UNIX socket"))}}),this.debugProcess.stdout.on("data",m=>{this.logDebuggerMessage(m.toString())}),this.debugProcess.on("error",m=>{this.logDebuggerMessage(m.message),d(m)}),this.debugProcess.on("close",m=>{if(m){let g=`Debugger exited with status ${m}.
Please make sure \`bundle ${p.join(" ")}\` runs without errors in the terminal.
Check the Ruby LSP output channel for more information.
`;this.logDebuggerMessage(g),d(new Error(g))}})})}async availablePort(){return new Promise((e,t)=>{let n=Sb.default.createServer();n.unref(),n.on("error",t),n.listen(0,()=>{let i=n.address(),s=typeof i=="string"?Number(i):i?.port;n.close(()=>{e(s)})})})}logDebuggerMessage(e){Bn.info(`[debugger]: ${e.trimEnd()}`),this.console.append(e)}};var Tb=Z(require("path")),Ie=Z(require("vscode")),Pb=Z(va());var Aa=class{constructor(){this._onDidChangeTreeData=new Ie.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.subscriptions=[];this.gemRootFolders={};this.treeView=Ie.window.createTreeView("dependencies",{treeDataProvider:this,showCollapseAll:!0}),this.subscriptions.push(wn.event(this.workspaceDidChange.bind(this)),Ie.window.onDidChangeActiveTextEditor(this.activeEditorDidChange.bind(this)),this.treeView.onDidChangeVisibility(this.treeVisibilityDidChange.bind(this)))}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.treeView.dispose()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.fetchDependencies()}getParent(e){let t=Ie.Uri.joinPath(e.resourceUri,".."),n=Tb.default.parse(t.path).root;if(t.path!==n)if(e instanceof Ts||e instanceof Mi){let i=this.gemRootFolders[t.toString()];return i||new Ts(t)}else return}async refresh(){await this.fetchDependencies(),this._onDidChangeTreeData.fire(void 0)}async workspaceDidChange(e){if(!(!e||e===this.currentWorkspace))return this.currentWorkspace=e,this.refresh()}async activeEditorDidChange(e){let t=e?.document.uri;t&&(this.currentVisibleItem=new Mi(t),this.treeView.visible&&await this.revealElement(this.currentVisibleItem))}async treeVisibilityDidChange(e){this.currentVisibleItem&&e.visible&&await this.revealElement(this.currentVisibleItem)}async revealElement(e){Ie.workspace.getConfiguration("explorer").get("autoReveal")&&await this.treeView.reveal(e,{select:!0,focus:!1,expand:!0}),this.currentVisibleItem=void 0}async fetchDependencies(){if(this.gemRootFolders={},!this.currentWorkspace)return[];let e=this.currentWorkspace.lspClient;if(!e||e.state!==Pb.State.Running)return[];let n=(await e.sendRequest("rubyLsp/workspace/dependencies",{})).sort((i,s)=>i.dependency===s.dependency?i.name.localeCompare(s.name):s.dependency?1:-1).map(i=>{let s=Ie.Uri.file(i.path),o=new qf(i.name,i.version,s);return this.gemRootFolders[s.toString()]=o,o});return n.forEach(i=>{this.gemRootFolders[i.resourceUri.toString()]=i}),n}},qf=class extends Ie.TreeItem{constructor(t,n,i){super(`${t} (${n})`,Ie.TreeItemCollapsibleState.Collapsed);this.resourceUri=i;this.contextValue="dependency",this.iconPath=new Ie.ThemeIcon("ruby")}async getChildren(){let t=this.resourceUri;return(await Ie.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ie.FileType.Directory?new Ts(Ie.Uri.joinPath(t,i)):new Mi(Ie.Uri.joinPath(t,i)))}},Ts=class r extends Ie.TreeItem{constructor(t){super(t,Ie.TreeItemCollapsibleState.Collapsed);this.resourceUri=t;this.contextValue="gem-directory-path",this.description=!0,this.command={command:"list.toggleExpand",title:"Toggle"}}async getChildren(){let t=this.resourceUri;return(await Ie.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ie.FileType.Directory?new r(Ie.Uri.joinPath(t,i)):new Mi(Ie.Uri.joinPath(t,i)))}},Mi=class extends Ie.TreeItem{constructor(t){super(t,Ie.TreeItemCollapsibleState.None);this.resourceUri=t;this.contextValue="gem-file-path",this.description=!0,this.command={command:"vscode.open",title:"Open",arguments:[t]}}getChildren(){}};var Eb=Z(require("os")),Zt=Z(require("vscode")),kb=Eb.default.platform()==="win32"?"ruby bin/rails":"bin/rails",$a=class{constructor(e){this.showWorkspacePick=e}async generate(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${kb} generate ${e}`;await Zt.window.withProgress({location:Zt.ProgressLocation.Notification,title:"Running Rails generate"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/create\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Revealing generated files"}),await this.revealFormattedFiles(n,i)})}async destroy(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${kb} destroy ${e}`;await Zt.window.withProgress({location:Zt.ProgressLocation.Notification,title:"Running Rails destroy"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/remove\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Closing deleted files"});for(let c of i)await Zt.commands.executeCommand("workbench.action.closeActiveEditor",Zt.Uri.joinPath(n.workspaceFolder.uri,c))})}async revealFormattedFiles(e,t){for(let n of t){let i=Zt.Uri.joinPath(e.workspaceFolder.uri,n);await Zt.window.showTextDocument(i,{preview:!1}),await Zt.commands.executeCommand("editor.action.formatDocument",i),await Zt.commands.executeCommand("workbench.action.files.save",i)}}};var Be=Z(require("vscode"));var xb="rubyLsp.chatAgent",XD=`
  You are a domain driven design and Ruby on Rails expert.
  The user will provide you with details about their Rails application.
  The user will ask you to help model a single specific concept.

  Analyze the provided concept carefully and think step by step. Consider the following aspects:
  1. The core purpose of the concept
  2. Its relationships with other potential entities in the system
  3. The attributes that would best represent this concept in a database

  Based on your analysis, suggest an appropriate model name and attributes to effectively model the concept.
  Follow these guidelines:

  1. Choose a clear, singular noun for the model name that accurately represents the concept
  2. Select attributes that capture the essential characteristics of the concept
  3. Use appropriate data types for each attribute (e.g. string, integer, datetime, boolean)
  4. Consider adding foreign keys for relationships with other models, if applicable

  After determining the model structure, generate the Rails commands to create the model and any associated resources.
  Include all relevant \`generate\` commands in a single Markdown shell code block at the end of your response.

  The \`generate\` commands should ONLY include the type of generator and arguments, not the \`rails generate\` part
  (e.g.: \`model User name:string\` but not \`rails generate model User name:string\`).
  NEVER include commands to migrate the database as part of the code block.
  NEVER include redundant commands (e.g. including the migration and model generation commands for the same model).
`.trim(),ja=class{constructor(e,t){this.agent=Be.chat.createChatParticipant(xb,this.handler.bind(this)),this.agent.iconPath=Be.Uri.joinPath(e.extensionUri,"icon.png"),this.showWorkspacePick=t}dispose(){this.agent.dispose()}async handler(e,t,n,i){return this.withinConversation("design",e,t)?this.runDesignCommand(e,t,n,i):(n.markdown("Please indicate which command you would like to use for our chat."),{metadata:{command:""}})}async runDesignCommand(e,t,n,i){let s=this.previousInteractions(t),o=[Be.LanguageModelChatMessage.User(`User prompt: ${e.prompt}`),Be.LanguageModelChatMessage.User(XD),Be.LanguageModelChatMessage.User(`Previous interactions with the user: ${s}`)],a=await this.showWorkspacePick();if(e.command&&a){let c=await this.schema(a);c&&o.push(Be.LanguageModelChatMessage.User(`Existing application schema: ${c}`))}try{let[c]=await Be.lm.selectChatModels({vendor:"copilot",family:"gpt-4o"});n.progress("Designing the models for the requested concept...");let d=await c.sendRequest(o,{},i),p="";for await(let g of d.text)n.markdown(g),p+=g;let m=/(?<=```shell)[^.$]*(?=```)/.exec(p);if(a&&m&&m[0]){let g=m[0].trim().split(`
`).map(R=>R.replace(/\s*(bin\/rails|rails) generate\s*/,""));n.button({command:"rubyLsp.railsGenerate",title:"Generate with Rails",arguments:[g,a]}),n.button({command:"rubyLsp.railsDestroy",title:"Revert previous generation",arguments:[g,a]})}}catch(c){this.handleError(c,n)}return{metadata:{command:"design"}}}async schema(e){try{return(await Be.workspace.fs.readFile(Be.Uri.joinPath(e.workspaceFolder.uri,"db/schema.rb"))).toString()}catch{}try{return(await Be.workspace.fs.readFile(Be.Uri.joinPath(e.workspaceFolder.uri,"db/structure.sql"))).toString()}catch{}}withinConversation(e,t,n){return t.command===e||!t.command&&n.history.some(i=>i instanceof Be.ChatRequestTurn&&i.command===e)}handleError(e,t){if(e instanceof Be.LanguageModelError)e.cause instanceof Error&&e.cause.message.includes("off_topic")&&t.markdown("Sorry, I can only help you with Ruby related questions");else throw e}previousInteractions(e){let t="";return e.history.forEach(n=>{if(n instanceof Be.ChatResponseTurn){if(n.participant===xb){let i="";n.response.forEach(s=>{s instanceof Be.ChatResponseMarkdownPart&&(i+=s.value.value)}),t+=`Response: ${i}`}}else t+=`Request: ${n.prompt}`}),t}};var un=Z(require("vscode"));async function Ib(r){if(!r){await un.window.showErrorMessage("No active Ruby workspace found.");return}let e=await QD(r),t=un.window.createWebviewPanel("rubyLspInfo","Ruby LSP Information",un.ViewColumn.One,{enableScripts:!0});t.webview.html=YD(e)}async function QD(r){let e=un.version,n=un.extensions.getExtension("Shopify.ruby-lsp").packageJSON.version,i=r.lspClient?.serverVersion??"Unknown",s=r.lspClient?.addons?.map(p=>p.name)??[],o=await JD(),a=un.workspace.getConfiguration("rubyLsp",r.workspaceFolder),c=un.workspace.getConfiguration("rubyLsp"),d={};for(let p of Object.keys(a))a.inspect(p)?.workspaceValue!==void 0&&(d[p]=a.get(p));return{"VS Code Version":e,"Ruby LSP Extension Version":n,"Ruby LSP Server Version":i,"Ruby LSP Add-ons":s,"Ruby Version":r.ruby.rubyVersion??"Unknown","Ruby Version Manager":r.ruby.versionManager.identifier,"Installed Extensions":o.sort(),"Ruby LSP Settings":{Workspace:d,User:c}}}async function JD(){return un.extensions.all.filter(r=>!(r.packageJSON.isBuiltin||r.packageJSON.license==="UNLICENSED"||!r.packageJSON.license)).map(r=>`${r.packageJSON.name} (${r.packageJSON.version})`)}function YD(r){let e=`
### Ruby LSP Information

`;for(let[n,i]of Object.entries(r)){if(e+=`#### ${n}

`,Array.isArray(i))n==="Installed Extensions"?(e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`,e+=`${i.map(s=>`- ${s}`).join(`
`)}
`,e+=`&lt;/details&gt;
`):e+=`${i.map(s=>`- ${s}`).join(`
`)}
`;else if(typeof i=="object"&&i!==null){e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`;for(let[s,o]of Object.entries(i))e+=`##### ${s}

`,e+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`;e+=`&lt;/details&gt;
`}else e+=`${i}
`;e+=`
`}return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ruby LSP Information</title>
      <style>
        body { font-family: var(--vscode-font-family); padding: 20px; }
        h1, h2, h3, p, li { color: var(--vscode-editor-foreground); }
        pre {
          background-color: var(--vscode-textBlockQuote-background);
          padding: 16px;
          overflow-x: auto;
          position: relative;
        }
        code { font-family: var(--vscode-editor-font-family); }
        #copyButton {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--vscode-button-background);
          color: var(--vscode-button-foreground);
          border: none;
          padding: 5px 10px;
          cursor: pointer;
        }
        #copyButton:hover { background-color: var(--vscode-button-hoverBackground); }
      </style>
    </head>
    <body>
      <h1>Ruby LSP Information</h1>
      <p>Please copy the content below and paste it into the issue you're opening:</p>
      <pre><button id="copyButton">Copy</button><code id="diagnosticContent">${e}</code></pre>
      <script>
        const copyButton = document.getElementById('copyButton');
        const diagnosticContent = document.getElementById('diagnosticContent');

        copyButton.addEventListener('click', () => {
          const range = document.createRange();
          range.selectNode(diagnosticContent);
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
          document.execCommand('copy');
          window.getSelection().removeAllRanges();

          copyButton.textContent = 'Copied!';
          setTimeout(() => {
            copyButton.textContent = 'Copy';
          }, 2000);
        });
      </script>
    </body>
    </html>
  `}var Ua=class{constructor(e,t){this.workspaces=new Map;this.virtualDocuments=new Map;this.workspacesBeingLaunched=new Map;this.context=e,this.telemetry=t,this.testController=new Ma(e,this.telemetry,this.currentActiveWorkspace.bind(this),this.getOrActivateWorkspace.bind(this)),this.debug=new Na(e,this.workspaceResolver.bind(this)),this.rails=new $a(this.showWorkspacePick.bind(this)),this.statusItems=new La;let n=new Aa;e.subscriptions.push(this.statusItems,this.debug,n,new ja(e,this.showWorkspacePick.bind(this)),L.window.onDidChangeActiveTextEditor(i=>{wn.fire(this.currentActiveWorkspace(i))}),L.workspace.onDidChangeWorkspaceFolders(async i=>{for(let s of i.removed){let o=this.getWorkspace(s.uri);o&&(await o.stop(),await o.dispose(),this.workspaces.delete(s.uri.toString()))}}),L.workspace.onDidOpenTextDocument(async i=>{if(!qr.includes(i.languageId))return;let s=L.workspace.getWorkspaceFolder(i.uri);if(!s)return;this.getWorkspace(s.uri)||await this.activateWorkspace(s,!1)}),L.workspace.registerTextDocumentContentProvider("embedded-content",{provideTextDocumentContent:i=>{let s=/^\/(.*)\.[^.]+$/.exec(i.path)?.[1];if(!s)return"";let o=decodeURIComponent(s);return this.virtualDocuments.get(o)}}),Bn,L.workspace.registerTextDocumentContentProvider("ruby-lsp",new bs),...this.registerCommands())}async activate(){await L.commands.executeCommand("testing.clearTestResults");let e=L.workspace.workspaceFolders?.[0];e&&await this.activateWorkspace(e,!0);let t=L.window.activeTextEditor?.document;if(t&&qr.includes(t.languageId)){let n=L.workspace.getWorkspaceFolder(t.uri);n&&(this.workspaces.get(n.uri.toString())||await this.activateWorkspace(n,!1))}wn.fire(this.currentActiveWorkspace())}async deactivate(){for(let e of this.workspaces.values())await e.stop(),await e.dispose()}async activateWorkspace(e,t){let n=this.workspacesBeingLaunched.get(e.index);if(n)return n;let i=this.runActivation(e,t);return this.workspacesBeingLaunched.set(e.index,i),i}async runActivation(e,t){let n=L.workspace.getConfiguration("rubyLsp").get("bundleGemfile"),i=await this.lockfileExists(e.uri);if(t&&!i)return;n.length===0&&!i&&await this.showStandaloneWarning(e.uri.fsPath);let s=new Fa(this.context,e,this.telemetry,this.testController.createTestItems.bind(this.testController),this.virtualDocuments,this.workspaces.size===0);return await s.activate(),await s.start(),this.workspaces.set(e.uri.toString(),s),await L.commands.executeCommand("setContext","rubyLsp.activated",!0),await this.showFormatOnSaveModeWarning(s),this.workspacesBeingLaunched.delete(e.index),s}registerCommands(){return[L.commands.registerCommand("rubyLsp.update",async()=>{let e=await this.showWorkspacePick();e&&(await e.installOrUpdateServer(!0),await e.restart())}),L.commands.registerCommand("rubyLsp.start",async()=>{await(await this.showWorkspacePick())?.start()}),L.commands.registerCommand("rubyLsp.restart",async()=>{await(await this.showWorkspacePick())?.restart()}),L.commands.registerCommand("rubyLsp.stop",async()=>{await(await this.showWorkspacePick())?.dispose()}),L.commands.registerCommand("rubyLsp.showSyntaxTree",this.showSyntaxTree.bind(this)),L.commands.registerCommand("rubyLsp.diagnoseState",this.diagnoseState.bind(this)),L.commands.registerCommand("rubyLsp.showServerChangelog",()=>{let e=this.currentActiveWorkspace()?.lspClient?.serverVersion;if(e)return L.env.openExternal(L.Uri.parse(`https://github.com/Shopify/ruby-lsp/releases/tag/v${e}`))}),L.commands.registerCommand("rubyLsp.formatterHelp",()=>L.env.openExternal(L.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#formatting"))),L.commands.registerCommand("rubyLsp.displayAddons",async()=>{let e=this.currentActiveWorkspace()?.lspClient;if(!e||!e.addons)return;let t=e.addons.sort(i=>i.errored?1:-1).map(i=>({label:`${i.errored?"$(error)":"$(pass)"} ${i.name} ${i.version?`v${i.version}`:""}`})),n=L.window.createQuickPick();n.items=t,n.placeholder="Addons (click to view output)",n.onDidAccept(()=>{n.selectedItems[0]&&this.currentActiveWorkspace()?.outputChannel.show(),n.hide()}),n.onDidHide(()=>{n.dispose()}),n.show()}),L.commands.registerCommand("rubyLsp.toggleFeatures",async()=>{let e=L.extensions.getExtension("Shopify.ruby-lsp").packageJSON.contributes.configuration.properties["rubyLsp.enabledFeatures"].properties,t={};Object.entries(e).forEach(([c,d])=>{t[c]=d.description});let i=L.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),s=Object.keys(i),o=s.map(c=>({label:c,picked:i[c],description:t[c]})),a=await L.window.showQuickPick(o,{canPickMany:!0,placeHolder:"Select the features you would like to enable"});a!==void 0&&(s.forEach(c=>{i[c]=a.some(d=>d.label===c)}),await L.workspace.getConfiguration("rubyLsp").update("enabledFeatures",i,!0,!0))}),L.commands.registerCommand("rubyLsp.toggleExperimentalFeatures",async()=>{let e=L.workspace.getConfiguration("rubyLsp"),t=e.get("enableExperimentalFeatures");await e.update("enableExperimentalFeatures",!t,!0,!0),wn.fire(this.currentActiveWorkspace())}),L.commands.registerCommand("rubyLsp.serverOptions",async e=>{let t=await L.window.showQuickPick(e,{placeHolder:"Select server action"});t!==void 0&&await L.commands.executeCommand(t.description)}),L.commands.registerCommand("rubyLsp.selectRubyVersionManager",async()=>{let e=await L.window.showQuickPick(["Change version manager","Change manual Ruby configuration"],{placeHolder:"What would you like to do?"});if(!e)return;if(e==="Change version manager"){let n=L.workspace.getConfiguration("rubyLsp"),i=n.get("rubyVersionManager"),s=Object.values(Cf),o=await L.window.showQuickPick(s,{placeHolder:`Current: ${i.identifier}`});o!==void 0&&(i.identifier=o,await n.update("rubyVersionManager",i,!0));return}let t=await this.showWorkspacePick();t&&await t.ruby.manuallySelectRuby()}),L.commands.registerCommand("rubyLsp.runTest",(e,t,n)=>this.testController.runOnClick(t)),L.commands.registerCommand("rubyLsp.runTestInTerminal",this.testController.runTestInTerminal.bind(this.testController)),L.commands.registerCommand("rubyLsp.debugTest",this.testController.debugTest.bind(this.testController)),L.commands.registerCommand("rubyLsp.runTask",async e=>{let t=this.currentActiveWorkspace();t||(t=await this.showWorkspacePick()),t&&await t.execute(e,!0)}),L.commands.registerCommand("rubyLsp.bundleInstall",e=>{let t=this.workspaces.get(e);if(!t)return;let n=L.window.createTerminal({name:"Bundle install",cwd:t.workspaceFolder.uri.fsPath,env:t.ruby.env});n.show(),n.sendText("bundle install")}),L.commands.registerCommand("rubyLsp.openFile",e=>{if(typeof e[0]=="string")return Cb(e);let[t,n]=e,i=this.currentActiveWorkspace();return wb(this.telemetry,i,{file:t,line:parseInt(n,10)-1})}),L.commands.registerCommand("rubyLsp.railsGenerate",async(e,t)=>{let n=e??await L.window.showInputBox({title:"Rails generate arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.generate(n,t);return}for(let i of n)await this.rails.generate(i,t)}}),L.commands.registerCommand("rubyLsp.railsDestroy",async(e,t)=>{let n=e??await L.window.showInputBox({title:"Rails destroy arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.destroy(n,t);return}for(let i of n)await this.rails.destroy(i,t)}}),L.commands.registerCommand("rubyLsp.fileOperation",async()=>{let e=await this.showWorkspacePick();if(!e)return;let t=[{label:"Minitest test",description:"Create a new Minitest test",iconPath:new L.ThemeIcon("new-file"),command:"rubyLsp.newMinitestFile",args:[]}];e.lspClient?.addons?.some(i=>i.name==="Ruby LSP Rails")&&t.push({label:"Rails generate",description:"Run Rails generate",iconPath:new L.ThemeIcon("new-file"),command:"rubyLsp.railsGenerate",args:[void 0,e]},{label:"Rails destroy",description:"Run Rails destroy",iconPath:new L.ThemeIcon("trash"),command:"rubyLsp.railsDestroy",args:[void 0,e]});let n=await L.window.showQuickPick(t,{title:"Select a Ruby file operation"});n&&await L.commands.executeCommand(n.command,...n.args)}),L.commands.registerCommand("rubyLsp.newMinitestFile",Rb),L.commands.registerCommand("rubyLsp.collectRubyLspInfo",async()=>{let e=await this.showWorkspacePick();await Ib(e)}),L.commands.registerCommand("rubyLsp.startServerInDebugMode",async()=>{await(await this.showWorkspacePick())?.start(!0)}),L.commands.registerCommand("rubyLsp.showOutput",async()=>{Bn.show()}),L.commands.registerCommand("rubyLsp.migrateLaunchConfiguration",async()=>{if(!await this.showWorkspacePick())return;let n=(L.workspace.getConfiguration("launch")?.get("configurations")||[]).map(i=>{if(i.type==="rdbg"){if(i.request==="launch"){let s={...i};if(s.type="ruby_lsp",s.askParameters!==!0){delete s.rdbgPath,delete s.cwd,delete s.useBundler;let o=(s.command||"").replace("${workspaceRoot}/",""),a=s.script||"",c=(s.args||[]).join(" ");s.program=`${o} ${a} ${c}`.trim(),delete s.command,delete s.script,delete s.args,delete s.askParameters}return s}else if(i.request==="attach"){let s={...i};return s.type="ruby_lsp",s.debugSocketPath=i.debugPort,s}}return i});await L.workspace.getConfiguration("launch").update("configurations",n,L.ConfigurationTarget.Workspace)})]}currentActiveWorkspace(e=L.window.activeTextEditor){let t;if(e?t=L.workspace.getWorkspaceFolder(e.document.uri):t=L.workspace.workspaceFolders?.find(n=>n.name===L.workspace.name),!!t)return this.getWorkspace(t.uri)}async getOrActivateWorkspace(e){let t=this.getWorkspace(e.uri);return t||L.window.withProgress({location:L.ProgressLocation.Notification,title:`Workspace ${e.name} is not activated yet.`},async n=>(n.report({message:"Activating workspace..."}),this.activateWorkspace(e,!1)))}getWorkspace(e){return this.workspaces.get(e.toString())}workspaceResolver(e){if(!e)return this.currentActiveWorkspace();let t=this.workspaces.get(e.toString());return t||this.currentActiveWorkspace()}async showWorkspacePick(){if(this.workspaces.size===1)return this.workspaces.values().next().value;let e=await L.window.showWorkspaceFolderPick();if(e)return this.getWorkspace(e.uri)}async diagnoseState(){let t=await(await this.showWorkspacePick())?.lspClient?.sendRequest("rubyLsp/diagnoseState");if(t){let n=Object.entries(t.documents),i=[`Worker alive: ${t.workerAlive}`,`Incoming queue size: ${t.incomingQueueSize}`,`Backtrace:
${t.backtrace.join(`
`)}
`,`=========== Documents (${n.length}) ===========`,...n.map(([o,a])=>`URI: ${o}

${a}
===========`)].join(`
`),s=await L.workspace.openTextDocument(L.Uri.from({scheme:"ruby-lsp",path:"show-diagnose-state",query:i}));await L.window.showTextDocument(s,{viewColumn:L.ViewColumn.Beside,preserveFocus:!0})}}async showSyntaxTree(){let e=L.window.activeTextEditor;if(e){let t=e.document;if(t.languageId!=="ruby"){await L.window.showErrorMessage("Show syntax tree: not a Ruby file");return}let n=L.workspace.getWorkspaceFolder(t.uri);if(!n)return;let i=this.getWorkspace(n.uri),s=e.selection,o;s.active.isEqual(s.anchor)||(s.isReversed?o=Ff.Range.create(s.active.line,s.active.character,s.anchor.line,s.anchor.character):o=Ff.Range.create(s.anchor.line,s.anchor.character,s.active.line,s.active.character));let a=await i?.lspClient?.sendShowSyntaxTreeRequest(t.uri,o);if(a){let c=await L.workspace.openTextDocument(L.Uri.from({scheme:"ruby-lsp",path:"show-syntax-tree",query:a.ast}));await L.window.showTextDocument(c,{viewColumn:L.ViewColumn.Beside,preserveFocus:!0})}}}async showFormatOnSaveModeWarning(e){let t=L.workspace.getConfiguration("editor",{languageId:"ruby"}),n=t.get("formatOnSaveMode");if(n==="file")return;await L.window.showWarningMessage(`The "editor.formatOnSaveMode" setting is set to ${n} in workspace ${e.workspaceFolder.name}, which
      is currently unsupported by the Ruby LSP. If you'd like to have formatting enabled, please set it to 'file'`,"Change setting to 'file'","Use without formatting")==="Change setting to 'file'"&&await t.update("formatOnSaveMode","file",L.ConfigurationTarget.Global)}async lockfileExists(e){try{return await L.workspace.fs.stat(L.Uri.joinPath(e,"Gemfile.lock")),!0}catch{}try{return await L.workspace.fs.stat(L.Uri.joinPath(e,"gems.locked")),!0}catch{}return!1}async showStandaloneWarning(e){await L.window.withProgress({location:L.ProgressLocation.Notification,title:"No bundle found. Launching in standalone mode in 5 seconds",cancellable:!0},async(t,n)=>{if(t.report({message:"If working in a monorepo, cancel to see configuration instructions"}),await new Promise(i=>{n.onCancellationRequested(()=>{i()}),setTimeout(i,5e3)}),n.isCancellationRequested&&await L.window.showWarningMessage(`Could not find a lockfile in ${e}. Are you using a monorepo setup?`,"See the multi-root workspace docs","Launch anyway")==="See the multi-root workspace docs"){let s=L.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md?tab=readme-ov-file#multi-root-workspaces");await L.env.openExternal(s)}})}};var Fn=Z(require("vscode")),Wa=class{constructor(){this.disposables=[];this.decorationType=Fn.window.createTextEditorDecorationType({opacity:Fn.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel")}),this.disposables.push(Fn.window.onDidChangeActiveTextEditor(()=>this.updateDecorations()),Fn.workspace.onDidChangeTextDocument(()=>this.updateDecorations())),this.updateDecorations()}reload(){let e=Fn.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel");this.decorationType.dispose(),this.decorationType=Fn.window.createTextEditorDecorationType({opacity:e}),this.updateDecorations()}dispose(){this.decorationType.dispose(),this.disposables.forEach(e=>e.dispose())}updateDecorations(){let e=Fn.window.activeTextEditor;if(!e||e.document.languageId!=="ruby")return;let t=e.document.getText(),n=[],i=t.split(`
`);for(let s=0;s<i.length;s++){let o=i[s];o.trim().startsWith("#:")&&n.push({range:new Fn.Range(s,0,s,o.length)})}e.setDecorations(this.decorationType,n)}};var Of;async function ZD(r){if(!Ft.workspace.workspaceFolders){await Ft.window.showWarningMessage(`Using the Ruby LSP without any workspaces opened is currently not supported
      ([learn more](https://github.com/Shopify/ruby-lsp/issues/1780))`,"Open a workspace","Continue anyway")==="Open a workspace"&&await Ft.commands.executeCommand("workbench.action.files.openFolder");return}await t_();let e=new Wa;r.subscriptions.push(e,Ft.workspace.onDidChangeConfiguration(async n=>{n.affectsConfiguration("rubyLsp.sigOpacityLevel")&&e.reload()}));let t=await n_(r);r.subscriptions.push(t),Of=new Ua(r,t),await Of.activate()}async function e_(){await Of.deactivate()}async function t_(){let r=Ft.workspace.getConfiguration("rubyLsp");r.get("enableExperimentalFeatures")&&(await r.update("enableExperimentalFeatures",void 0,!0),await r.update("featureFlags",{all:!0},!0))}async function n_(r){let e;switch(r.extensionMode){case Ft.ExtensionMode.Development:e={sendEventData:(t,n)=>{Bn.debug(t,n)},sendErrorData:(t,n)=>{Bn.error(t,n)}};break;case Ft.ExtensionMode.Test:e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}};break;default:try{let t=0;for(;!e&&t<5;)await Ft.commands.executeCommand("getTelemetrySenderObject"),e=await Ft.commands.executeCommand("getTelemetrySenderObject"),t++}catch{e={sendEventData:(n,i)=>{},sendErrorData:(n,i)=>{}}}break}return e||(e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}}),Ft.env.createTelemetryLogger(e,{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0,additionalCommonProperties:{extensionVersion:r.extension.packageJSON.version,environment:qb.default.platform(),machineId:Ft.env.machineId}})}0&&(module.exports={activate,deactivate});
