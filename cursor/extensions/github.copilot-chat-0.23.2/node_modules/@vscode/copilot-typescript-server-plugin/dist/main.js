"use strict";var Me=Object.create;var Ie=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Ke=Object.prototype.hasOwnProperty;var Ee=(p,e)=>()=>(e||p((e={exports:{}}).exports,e),e.exports);var Ve=(p,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of _e(e))!Ke.call(p,n)&&n!==t&&Ie(p,n,{get:()=>e[n],enumerable:!(i=Le(e,n))||i.enumerable});return p};var P=(p,e,t)=>(t=p!=null?Me(Re(p)):{},Ve(e||!p||!p.__esModule?Ie(t,"default",{value:p,enumerable:!0}):t,p));var q=Ee((Ue,De)=>{"use strict";var h=P(require("typescript")),ke;(M=>{let p=h.default;M.getTokenAtPosition=p.getTokenAtPosition,M.getNameTable=p.getNameTable,M.findReferencedSymbols=p.findReferencedSymbols,M.getSymbolId=p.getSymbolId;class s{cancellationToken;end;constructor(r,a,c=!1){this.cancellationToken=r,this.end=c?Number.MAX_VALUE:Date.now()+a}isCancellationRequested(){return this.cancellationToken&&this.cancellationToken.isCancellationRequested()?!0:Date.now()>this.end}isTimedOut(){return Date.now()>this.end}throwIfCancellationRequested(){if(this.isCancellationRequested())throw new h.default.OperationCanceledException}}M.CancellationTokenWithTimer=s;class l{isCancellationRequested(){return!1}throwIfCancellationRequested(){}}M.NullCancellationToken=l;let o;(a=>{function V(c){return c.symbol}a.getSymbol=V;function r(c){if((0,h.isTypeReferenceNode)(c))return c.typeName.getText()}a.getTypeName=r})(o=M.Node||={});let d;(r=>{function V(a){return(h.default.getCombinedModifierFlags(a)&h.default.ModifierFlags.Private)!==0}r.isPrivate=V})(d=M.Declarations||={});let u;(c=>{function V(g){let C=g.heritageClauses;if(C!==void 0)return C.find(y=>y.token===h.default.SyntaxKind.ExtendsKeyword)}c.getExtendsClause=V;function r(g){return a(g.statements)}c.entries=r;function*a(g){for(let C of g)h.default.isClassDeclaration(C)?yield C:h.default.isModuleDeclaration(C)&&C.body!==void 0&&h.default.isModuleBlock(C.body)&&(yield*a(C.body.statements))}})(u=M.ClassDeclarations||={});let S;(a=>{function V(c){return c.getBaseTypes()}a.getBaseTypes=V;function r(c,g){let C=g.getSymbol();if(C===void 0)return;let y=C.getDeclarations();if(y===void 0)return;let m=[];for(let f of y)if(h.default.isClassDeclaration(f)){let v=f.heritageClauses;if(v!==void 0)for(let L of v)for(let B of L.types)m.push(c.getTypeAtLocation(B.expression))}return m}a.getExtendsTypes=r})(S=M.Types||={});let x;(a=>(a.depthFirst="depthFirst",a.breadthFirst="breadthFirst"))(x=M.Traversal||={});let k;(r=>r.breadthFirstOnly="breadthFirstOnly")(k||={});class b{program;typeChecker;constructor(r){this.program=r,this.typeChecker=r.getTypeChecker()}static Unknown="unknown";static Undefined="undefined";static None="none";static getParent(r){return r.parent}static isMethod(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Method)!==0}static isProperty(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Property)!==0}static isClass(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Class)!==0}static isInterface(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Interface)!==0}static isTypeAlias(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.TypeAlias)!==0}static isTypeLiteral(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.TypeLiteral)!==0}static isAlias(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Alias)!==0}static isFunction(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Function)!==0}static isValueModule(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.ValueModule)!==0}static isBase(r){return r!==void 0&&(r.getFlags()&h.default.SymbolFlags.Class)!==0}static isPrivate(r){let a=r.declarations;if(a!==void 0){for(let c of a)if(!(h.default.getCombinedModifierFlags(c)&h.default.ModifierFlags.Private))return!1}return!0}static isAbstract(r){let a=r.declarations;if(a!==void 0){for(let c of a)if(!(h.default.getCombinedModifierFlags(c)&h.default.ModifierFlags.Abstract))return!1}return!0}static isStatic(r){let a=r.declarations;if(a!==void 0){for(let c of a)if(!(h.default.getCombinedModifierFlags(c)&h.default.ModifierFlags.Static))return!1}return!0}static fillSources(r,a){if(a.declarations!==void 0)for(let c of a.declarations){let g=c.getSourceFile();g!==void 0&&r.add(g.fileName)}}static getPrimarySource(r){let a=r.declarations;if(!(a===void 0||a.length===0))return a[0].getSourceFile()}getProgram(){return this.program}getTypeChecker(){return this.typeChecker}getSymbolAtLocation(r){let a=this.typeChecker.getSymbolAtLocation(r);return a===void 0&&(a=o.getSymbol(r)),a}getExtendsSymbol(r){let a=r.declarations;if(a===void 0)return[void 0,void 0];for(let c of a)if(h.default.isClassDeclaration(c)){let g=c.heritageClauses;if(g!==void 0){for(let C of g)if(C.token===h.default.SyntaxKind.ExtendsKeyword){let y=C.types[0]?.expression,m=this.typeChecker.getSymbolAtLocation(y);if(b.isAlias(m)&&(m=this.typeChecker.getAliasedSymbol(m)),b.isClass(m))return[m,y.getText()]}}}return[void 0,void 0]}getLeafSymbolAtLocation(r){let a=this.getSymbolAtLocation(r);if(a!==void 0)return b.isAlias(a)?this.typeChecker.getAliasedSymbol(a):a}getSymbolAtTypeNodeLocation(r){return h.default.isTypeReferenceNode(r)?this.getLeafSymbolAtLocation(r.typeName):h.default.isTypeLiteralNode(r)?this.getLeafSymbolAtLocation(r):this.getLeafSymbolAtLocation(r)}getAliasedSymbol(r){return this.typeChecker.getAliasedSymbol(r)}createKey(r,a,c){let g=r.getDeclarations();if(g===void 0)return this.typeChecker.isUnknownSymbol(r)?b.Unknown:this.typeChecker.isUndefinedSymbol(r)?b.Undefined:b.None;let C=[];for(let m of g){let f=m.getSourceFile(),v=a.getScriptVersion(f);if(v===void 0)return;C.push({f:f.fileName,v,s:m.getStart(),e:m.getEnd(),k:m.kind})}C.length>1&&C.sort((m,f)=>{let v=m.f<f.f?-1:m.f>f.f?1:0;return v!==0||(v=m.v<f.v?-1:m.v>f.v?1:0,v!==0)||(v=m.s-f.s,v!==0)||(v=m.e-f.e,v!==0)?v:m.k-f.k});let y=c.createHash("md5");return r.flags&h.default.SymbolFlags.Transient&&y.update(JSON.stringify({trans:!0},void 0,0)),y.update(JSON.stringify(C,void 0,0)),y.digest("base64")}getAllSuperTypes(r){return this._getAllSuperTypes(r,new Set,!1)}getAllSuperTypesWithPath(r){return this._getAllSuperTypes(r,new Set,!0)}*_getAllSuperTypes(r,a,c){if(b.isAlias(r)&&(a.add(r),r=this.typeChecker.getAliasedSymbol(r)),b.isClass(r)||b.isInterface(r)){let g=r.declarations;if(g===void 0)return;for(let C of g){let y;if((h.default.isClassDeclaration(C)||h.default.isInterfaceDeclaration(C))&&(y=C.heritageClauses),y!==void 0)for(let m of y)for(let f of m.types){let v=this.getLeafSymbolAtLocation(f.expression);v!==void 0&&!a.has(v)&&(yield c?[r,v]:v,a.add(v),yield*this._getAllSuperTypes(v,a,c))}}}else if(b.isTypeAlias(r)){let g=r.declarations;if(g===void 0)return;for(let C of g)if(h.default.isTypeAliasDeclaration(C)){let y=C.type;if(h.default.isTypeLiteralNode(y)){let m=this.getSymbolAtLocation(y);m!==void 0&&!a.has(m)&&(yield c?[r,m]:m,a.add(m))}else if(h.default.isTypeReferenceNode(y)){let m=this.getLeafSymbolAtLocation(y.typeName);m!==void 0&&!a.has(m)&&(yield c?[r,m]:m,a.add(m),yield*this._getAllSuperTypes(m,a,c))}else if(h.default.isIntersectionTypeNode(y))for(let m of y.types){let f=this.getSymbolAtTypeNodeLocation(m);f!==void 0&&!a.has(f)&&(b.isTypeLiteral(f)?(yield c?[r,f]:f,a.add(f)):b.isTypeAlias(f)?(a.add(f),yield*this._getAllSuperTypes(f,a,c)):(yield c?[r,f]:f,a.add(f),yield*this._getAllSuperTypes(f,a,c)))}}}}getAllSuperClasses(r){return this._getAllSuperClasses(r,new Set)}*_getAllSuperClasses(r,a){if(!b.isClass(r))return;let c=[r];for(;c.length>0;){let C=c.pop().declarations;if(C!==void 0)for(let y of C){if(!h.default.isClassDeclaration(y))continue;let m=y.heritageClauses;if(m!==void 0)for(let f of m){if(f.token!==h.default.SyntaxKind.ExtendsKeyword||f.types.length<1)continue;let v=f.types[0],L=this.getLeafSymbolAtLocation(v.expression);L!==void 0&&!a.has(L)&&(yield L,a.add(L),c.push(L))}}}}getDirectSubTypes(r,a=new G){return this._getAllSubTypes(r,"breadthFirstOnly",new Set,a)}getAllSubTypes(r,a="depthFirst",c=new G){return this._getAllSubTypes(r,a,new Set,c)}*_getAllSubTypes(r,a,c,g=new G){if(!b.isClass(r))return;let C=[r];for(;C.length>0;){let y=C.pop(),m=y.declarations;if(m===void 0||m.length===0)return;for(let f of m){if(!h.default.isClassDeclaration(f))continue;let v=new z(this.program,f.getSourceFile(),g);for(let L of v)for(let B of u.entries(L)){let _=u.getExtendsClause(B);if(_===void 0||_.types.length===0)continue;if(this.getLeafSymbolAtLocation(_.types[0].expression)===y){let R=this.getSymbolAtLocation(B.name?B.name:B);R!==void 0&&!c.has(R)&&b.isClass(R)&&(yield R,c.add(R),a==="depthFirst"?yield*this._getAllSubTypes(R,a,c,g):a==="breadthFirst"&&C.push(R))}}}}}getMemberStatistic(r){let a=new Set,c=new Set;b._getMemberStatistic(a,c,r);for(let g of this.getAllSuperTypes(r))b._getMemberStatistic(a,c,g);return{abstract:a,concrete:c}}static _getMemberStatistic(r,a,c){if(b.isClass(c)){let g=c.declarations;if(g===void 0)return;for(let C of g)if(h.default.isClassDeclaration(C))for(let y of C.members)if(h.default.isMethodDeclaration(y)||h.default.isGetAccessorDeclaration(y)||h.default.isSetAccessorDeclaration(y)||h.default.isPropertyDeclaration(y)){let m=y.name.getText();b.includesAbstract(y.modifiers)&&!a.has(m)?r.add(m):a.add(m)}else h.default.isIndexSignatureDeclaration(y)&&(b.includesAbstract(y.modifiers)&&!a.has("[]")?r.add("[]"):a.add("[]"))}else if((b.isInterface(c)||b.isTypeLiteral(c))&&c.members!==void 0)for(let g of c.members.values())a.has(g.name)||r.add(g.name)}static includesAbstract(r){return r===void 0?!1:r.some(a=>a.kind===h.default.SyntaxKind.AbstractKeyword)}}M.Symbols=b;let T;(c=>{function V(g){return g.projectService}c.getProjectService=V;function r(g,C){let y=g;if(typeof y.getFileAndProject=="function")return y.getFileAndProject(C)}c.getFileAndProject=r;function a(g,C,y){let m=g;if(typeof m.getPositionInFile=="function")return m.getPositionInFile(C,y)}c.getPositionInFile=a})(T=M.Sessions||={});function w(V){return V.moduleReference.kind===h.SyntaxKind.ExternalModuleReference&&V.moduleReference.expression.kind===h.SyntaxKind.StringLiteral}class G{visited;_cache;constructor(r=!1){this.visited=new Map,r&&(this._cache=new Map)}get cache(){return this._cache}ensureCache(){this._cache===void 0&&(this._cache=new Map)}}M.ReferencedByContext=G;class z{program;sourceFile;context;visited;constructor(r,a,c){this.program=r,this.sourceFile=a,this.context=c,this.visited=z.getVisited(c.visited,a)}static getVisited(r,a){let c=r.get(a.fileName);return c===void 0&&(c=new Set,r.set(a.fileName,c)),c}getSourceFile(r){return this.program.getSourceFile(r)}[Symbol.iterator](){return this.entries()}*entries(){if(this.context.cache!==void 0&&this.context.cache.has(this.sourceFile.fileName)){for(let f of this.context.cache.get(this.sourceFile.fileName)){let v=this.program.getSourceFile(f);v!==void 0&&(yield v)}return}function r(f){return f.kind===h.SyntaxKind.ModuleDeclaration&&f.name.kind===h.SyntaxKind.StringLiteral}let a=this.context.cache?.get(this.sourceFile.fileName),c=this.program,g=c.getTypeChecker(),C=c.getSourceFiles(),y=g.getSymbolAtLocation(this.sourceFile),m=this.visited;for(let f of C){if(this.sourceFile===f){yield f,m.add(f.fileName);continue}if(!(m.has(f.fileName)||this.skipSourceFile(c,f)))if(f.externalModuleIndicator===!0&&f.imports!==void 0)for(let v of f.imports){let L=g.getSymbolAtLocation(v);if(!m.has(f.fileName)&&L===y){yield f,m.add(f.fileName),a&&a.add(f.fileName);break}}else{let v=f,L=v.kind===h.SyntaxKind.SourceFile?v.statements:v.body.statements,B=_=>{switch(_.kind){case h.SyntaxKind.ExportDeclaration:case h.SyntaxKind.ImportDeclaration:{let j=_;if(j.moduleSpecifier&&h.default.isStringLiteral(j.moduleSpecifier)&&g.getSymbolAtLocation(j.moduleSpecifier)===y)return!0;break}case h.SyntaxKind.ImportEqualsDeclaration:{let j=_;if(w(j)&&g.getSymbolAtLocation(j.moduleReference.expression)===y)return!0;break}}return!1};e:for(let _ of L)if(!m.has(f.fileName)&&B(_)){yield f,m.add(f.fileName),a&&a.add(f.fileName);break e}else if(r(_)){let j=_.body&&_.body.statements;if(j!==void 0){for(let R of j)if(!m.has(f.fileName)&&B(R)){yield f,m.add(f.fileName),a&&a.add(f.fileName);break e}}}}}}skipSourceFile(r,a){return r.isSourceFileDefaultLibrary(a)||r.isSourceFileFromExternalLibrary(a)||a.isDeclarationFile}}M.ReferencedByVisitor=z})(ke||={});De.exports=ke});var ue=P(require("typescript")),we=P(q());var H=P(require("typescript")),Te=P(q());var J=P(require("typescript"));var pe;(e=>{function p(t){return{kind:"metaData",completionContext:t}}e.create=p})(pe||={});var fe;(e=>{function p(t,i,n,s,l){return{kind:"snippet",snippetKind:s,uri:t,additionalUris:i,value:n,priority:l??0}}e.create=p})(fe||={});var je;(t=>{function p(i){return i.body.items!==void 0}t.isOk=p;function e(i){return i.body.error!==void 0}t.isError=e})(je||={});var D=P(q());var me=class{[Symbol.toStringTag]="LinkedMap";_map;_head;_tail;_size;_state;constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let i=this._map.get(e);if(i)return t!==0&&this.touch(i,t),i.value}set(e,t,i=0){let n=this._map.get(e);if(n)n.value=t,i!==0&&this.touch(n,i);else{switch(n={key:e,value:t,next:void 0,previous:void 0},i){case 0:this.addItemLast(n);break;case 1:this.addItemFirst(n);break;case 2:this.addItemLast(n);break;default:this.addItemLast(n);break}this._map.set(e,n),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let i=this._state,n=this._head;for(;n;){if(t?e.bind(t)(n.value,n.key,this):e(n.value,n.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");n=n.next}}keys(){let e=this,t=this._state,i=this._head,n={[Symbol.iterator](){return n},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:i.key,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return n}values(){let e=this,t=this._state,i=this._head,n={[Symbol.iterator](){return n},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:i.value,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return n}entries(){let e=this,t=this._state,i=this._head,n={[Symbol.iterator](){return n},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:[i.key,i.value],done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return n}[Symbol.iterator](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.next,i--;this._head=t,this._size=i,t&&(t.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._tail,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.previous,i--;this._tail=t,this._size=i,t&&(t.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,i=e.previous;if(!t||!i)throw new Error("Invalid list");t.previous=i,i.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let i=e.next,n=e.previous;e===this._tail?(n.next=void 0,this._tail=n):(i.previous=n,n.next=i),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let i=e.next,n=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=n,n.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,i)=>{e.push([i,t])}),e}fromJSON(e){this.clear();for(let[t,i]of e)this.set(t,i)}},he=class extends me{_limit;_ratio;constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=2){return super.get(e,t)}peek(e){return super.get(e,0)}set(e,t){return super.set(e,t,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},ee=class extends he{constructor(e,t=1){super(e,t)}trim(e){this.trimOld(e)}set(e,t){return super.set(e,t),this.checkTrim(),this}};var U=class{getSymbolInfo(e,t=!1){let i=e.declarations;if(i===void 0||i.length===0)return{skip:!0};let n,s=0,l=this.getProgram();for(let o of i){let d=o.getSourceFile();n===void 0&&(n=d),(l.isSourceFileDefaultLibrary(d)||t&&l.isSourceFileFromExternalLibrary(d))&&s++}return s===i.length?{skip:!0}:{skip:!1,primary:n}}skipDeclaration(e,t=e.getSourceFile()){let i=this.getProgram();return i.isSourceFileDefaultLibrary(t)||i.isSourceFileFromExternalLibrary(t)||t.isDeclarationFile}},te=class{referencedByContext;constructor(){this.referencedByContext=void 0}getReferencedByContext(e=!1){return this.referencedByContext===void 0?this.referencedByContext=new D.ReferencedByContext(e):e&&this.referencedByContext.ensureCache(),this.referencedByContext}},K=class extends U{program;symbols;constructor(e,t=new D.Symbols(e)){super(),this.program=e,this.symbols=t}getSymbols(){return this.symbols}getProgram(){return this.program}getHeritageSymbol(e){let t=this.symbols.getSymbolAtLocation(e);if(t===void 0)return;D.Symbols.isAlias(t)&&(t=this.symbols.getAliasedSymbol(t));let i=0;for(;D.Symbols.isTypeAlias(t)&&i<10;){let n=t.declarations;if(n!==void 0){let s=t;for(let l of n)if(J.default.isTypeAliasDeclaration(l)){let o=l.type;J.default.isTypeReferenceNode(o)&&(t=this.symbols.getLeafSymbolAtLocation(o.typeName))}if(s===t)break}i++}return t}static getNodeInProgram(e,t){let i=t.getSourceFile().fileName,n=e.getSourceFile(i);if(n===void 0)throw new Error(`No source file found for ${i}`);let s=D.default.getTokenAtPosition(n,t.pos);if(s===void 0||t.kind!==s.kind)throw new Error(`No ${t.kind} node found for ${i}:${t.pos}`);return s}},ge=class{info(){}msg(){}startGroup(){}endGroup(){}},ye=class{host;codeCache;supportsCaching;constructor(e,t){this.host=e,this.codeCache=new ee(100),this.supportsCaching=t}run(e,t,i){let n=this.getPossiblePrograms(e);for(let s of n){let o=e.with(s).run(t,i);if(o!==void 0)return o}}getPossiblePrograms(e){let t=[];for(let i of this.getLanguageServices()){let n=i.getProgram();if(n===void 0)continue;let s=e.score(n);s>0&&t.push([s,n])}return t.sort((i,n)=>n[0]-i[0]).map(i=>i[1])}getCachedCode(e,t){if(this.supportsCaching){if(typeof e=="string")return this.codeCache.get(e);{let i=e.createKey(t,this,this.host);return i===void 0?void 0:this.codeCache.get(i)}}}cacheCode(e,t,i){if(this.supportsCaching)if(typeof e=="string")this.codeCache.set(e,t);else{let n=e.createKey(t,this,this.host);n!==void 0&&this.codeCache.set(n,i)}}},ie=class extends ye{session;logger;constructor(e,t){super(t,!0),this.session=e;let i=D.Sessions.getProjectService(this.session);this.logger=i?.logger??new ge}logError(e,t){this.session.logError(e,t)}foo(){D.Sessions.getProjectService(this.session)?.logger}getFileAndProject(e){return D.Sessions.getFileAndProject(this.session,e)}getPositionInFile(e,t){return D.Sessions.getPositionInFile(this.session,e,t)}*getLanguageServices(e){let t=D.Sessions.getProjectService(this.session);if(t!==void 0)if(e===void 0){for(let i of t.configuredProjects.values())yield i.getLanguageService();for(let i of t.inferredProjects)yield i.getLanguageService();for(let i of t.externalProjects)yield i.getLanguageService()}else{let i=J.default.server.toNormalizedPath(e.fileName),n=t.getScriptInfoForNormalizedPath(i);yield*n?n.containingProjects.map(s=>s.getLanguageService()):[]}}getScriptVersion(e){let t=J.default.server.toNormalizedPath(e.fileName),i=D.Sessions.getProjectService(this.session);return i===void 0?void 0:i.getScriptInfoForNormalizedPath(t)?.getLatestVersion()}};var ne=class{_items;constructor(){this._items=[]}get items(){return this._items}addMetaData(e){this._items.push(pe.create(e))}addSnippet(e,t,i){e.isEmpty()||this._items.push(e.snippet(t,i))}},$=class extends U{languageService;session;constructor(e,t){super(),this.languageService=t,this.session=e}getProgram(){let e=this.languageService.getProgram();if(e===void 0)throw new Error("No program available");return e}};var O=P(require("typescript")),W=P(q());var A=P(require("typescript"));var I=P(q()),X;(n=>{function p(s,l){l??=s.getSourceFile();let o=s.getStart(l,!0),d=l.getLineAndCharacterOfPosition(o),S=l.text.substring(o,s.getEnd()).split(/\r?\n/g);if(d.character>0){let x=l.getPositionOfLineAndCharacter(d.line,0),k=l.text.substring(x,o);t(S,k)}return i(S),S}n.getLines=p;function e(s){let l=s.getFullText(),o=A.default.getLeadingCommentRanges(l,0);if(o!==void 0&&o.length>0){let d=o.at(-1).pos,u=o.at(-1).end,x=l.substring(d,u).trim().split(/\r?\n/);if(i(x),x.length>1){let b=x[1].match(/^\s+/);b!==null&&t(x,b[0])}return x}}n.getDocumentation=e;function t(s,l,o=1){let d=!0;for(let u=o;u<s.length;u++)if(!s[u].startsWith(l)){d=!1;break}if(d)for(let u=o;u<s.length;u++)s[u]=s[u].substring(l.length)}function i(s){for(;s.length>0&&s[0].trim()==="";)s.shift();for(;s.length>0&&s.at(-1).trim()==="";)s.pop()}})(X||={});var Q=class{session;symbols;indent;lines;source;additionalSources;constructor(e,t,i,n=0){this.session=e,this.symbols=t,this.indent=n,this.source=i.fileName,this.lines=[],this.additionalSources=new Set}getAdditionalSources(){return this.additionalSources.delete(this.source),this.additionalSources}increaseIndent(){this.indent++}decreaseIndent(){this.indent--}addPropertyDeclaration(e){this.lines.push(...X.getLines(e))}addMethodDeclaration(e){let t=X.getDocumentation(e);t!==void 0&&this.lines.push(...t);let i=[];i.push("	".repeat(this.indent)),e.modifiers!==void 0&&(i.push(e.modifiers.map(n=>n.getText()).join(" ")),i.push(" ")),i.push(e.name.getText()),e.typeParameters!==void 0&&(i.push("<"),i.push(e.typeParameters.map(n=>n.getText()).join(", ")),i.push(">")),i.push("("),e.parameters!==void 0&&i.push(e.parameters.map(n=>n.getText()).join(", ")),i.push(")"),e.type!==void 0&&(i.push(": "),i.push(e.type.getText())),i.push(";"),this.lines.push(i.join(""))}addFunctionDeclaration(e,t,i){t??=e.name?.getText()??"";let n=X.getDocumentation(e);n!==void 0&&this.lines.push(...n);let s=[];s.push("	".repeat(this.indent)),s.push(this.getModifiers(e.modifiers,i)),s.push(" function "),s.push(t),s.push(this.getTypeParameters(e.typeParameters)),s.push("("),s.push(this.getParameters(e.parameters)),s.push(")"),s.push(this.getReturnTypes(e)),s.push(";"),this.lines.push(s.join(""))}getModifiers(e,t){if(e===void 0)return"";let i=[];t!==void 0&&i.push(t);for(let n of e)n.kind===A.default.SyntaxKind.AsyncKeyword||n.kind===A.default.SyntaxKind.DeclareKeyword||n.kind===A.default.SyntaxKind.ExportKeyword||i.push(n.getText());return i.join(" ")}getTypeParameters(e){if(e===void 0)return"";let t=[];return t.push("<"),t.push(e.map(i=>i.getText()).join(", ")),t.push(">"),t.join("")}getParameters(e){return e===void 0?"":e.map(t=>t.getText()).join(", ")}getReturnTypes(e){return e.type===void 0?"":`: ${e.type.getText()}`}},Y=class extends Q{type;name;constructor(e,t,i,n,s){super(e,t,i),this.type=n,this.name=s}makeKey(e){if(Array.isArray(e)){let t=[];for(let i of e){let n=this.symbols.createKey(i,this.session,this.session.host);if(n!==void 0)t.push(n);else{t=void 0;break}}return t===void 0?void 0:t.join(";")}else return this.symbols.createKey(e,this.session,this.session.host)}processMembers(e){for(let[t,i]of e)this.processMember(i)}processMember(e){let t=e.declarations;if(t!==void 0){if(I.Symbols.isProperty(e)){let i=t[0];(A.default.isPropertyDeclaration(i)||A.default.isPropertySignature(i))&&this.addPropertyDeclaration(i)}else if(I.Symbols.isMethod(e))for(let i of t)(A.default.isMethodDeclaration(i)||A.default.isMethodSignature(i))&&this.addMethodDeclaration(i)}}},se=class extends Y{superClasses;includePrivates;key;constructor(e,t,i,n,s,l,o){super(e,t,i,n,s),this.includePrivates=o,this.key=void 0,l?(this.superClasses=new Array(...t.getAllSuperClasses(n)),this.key=this.makeKey(this.superClasses)):(this.key=this.makeKey(n),this.superClasses=void 0)}emit(){if(this.lines.push(`declare class${this.getTypeParameters()} ${this.name} {`),this.increaseIndent(),this.superClasses!==void 0)for(let e=this.superClasses.length-1;e>=0;e--){let t=this.superClasses[e];t.members!==void 0&&(I.Symbols.fillSources(this.additionalSources,t),this.processMembers(t.members))}this.type.members!==void 0&&(I.Symbols.fillSources(this.additionalSources,this.type),this.processMembers(this.type.members)),this.decreaseIndent(),this.lines.push("}")}processMember(e){!this.includePrivates&&I.Symbols.isPrivate(e)||super.processMember(e)}getTypeParameters(){let e=this.type.declarations;if(e===void 0||e.length===0)return"";let t=e[0];return A.default.isClassDeclaration(t)&&t.typeParameters!==void 0?super.getTypeParameters(t.typeParameters):""}},re=class extends Y{superTypes;key;constructor(e,t,i,n,s){super(e,t,i,n,s),this.superTypes=new Array(...t.getAllSuperTypes(n)).filter(l=>I.Symbols.isInterface(l)),this.key=this.makeKey(this.superTypes)}emit(){this.lines.push(`interface ${this.name} {`),this.increaseIndent();for(let e=this.superTypes.length-1;e>=0;e--){let t=this.superTypes[e];t.members!==void 0&&(I.Symbols.fillSources(this.additionalSources,t),this.processMembers(t.members))}this.type.members!==void 0&&(I.Symbols.fillSources(this.additionalSources,this.type),this.processMembers(this.type.members)),this.decreaseIndent(),this.lines.push("}")}},be=class extends Y{key;constructor(e,t,i,n,s){super(e,t,i,n,s)}emit(){this.lines.push(`type ${this.name} = {`),this.increaseIndent(),this.type.members!==void 0&&this.processMembers(this.type.members),this.decreaseIndent(),this.lines.push("}")}},Se=class extends Q{func;name;constructor(e,t,i,n,s){super(e,t,i),this.func=n,this.name=s??n.getName()}get key(){}emit(e){let t=this.func.declarations;if(t!==void 0)for(let i of t){let n=i.getSourceFile().fileName;n!==e.fileName&&A.default.isFunctionDeclaration(i)&&(this.addFunctionDeclaration(i,this.name,"declare"),this.additionalSources.add(n))}}},Ce=class extends Q{module;name;constructor(e,t,i,n,s){super(e,t,i),this.module=n,this.name=s??n.getName()}get key(){}emit(e){this.lines.push(`declare namespace ${this.name} {`),this.increaseIndent();let t=this.module.exports;t!==void 0&&this.addExports(t,e),this.decreaseIndent(),this.lines.push("}")}addExports(e,t){for(let[i,n]of e){let s=n.declarations;if(s!==void 0&&I.Symbols.isFunction(n))for(let l of s){let o=l.getSourceFile().fileName;o!==t.fileName&&A.default.isFunctionDeclaration(l)&&(this.addFunctionDeclaration(l,this.name,"declare"),this.additionalSources.add(o))}}}},E=class extends U{lines;source;additionalSources;indent=0;session;symbols;currentSourceFile;seen;constructor(e,t,i,n){super(),this.lines=[],this.source=void 0,this.additionalSources=new Set,this.session=e,this.symbols=t,this.currentSourceFile=i,this.seen=n}increaseIndent(){this.indent++}decreaseIndent(){this.indent--}getProgram(){return this.symbols.getProgram()}addSource(e){this.source===void 0?this.source=e:this.additionalSources.add(e)}addAdditionalSource(e){if(e!==void 0)for(let t of e)this.additionalSources.add(t)}isEmpty(){return this.lines.length===0||this.source===void 0}snippet(e,t){if(this.source===void 0)throw new Error("No source");return this.additionalSources.delete(this.source),fe.create(this.source,this.additionalSources.size===0?void 0:[...this.additionalSources],this.lines.join(`
`),e,t)}addDeclaration(e){let t=e.getSourceFile();if(t.fileName===this.currentSourceFile.fileName||this.skipDeclaration(e,t))return;let i=X.getLines(e,t);this.indent===0?this.lines.push(...i):this.lines.push(...i.map(n=>`${"	".repeat(this.indent)}${n})`)),this.addSource(t.fileName)}addClassSymbol(e,t,i,n){if(!I.Symbols.isClass(e)||this.seen.has(e))return;let s=this.getSymbolInfo(e);s.skip||this.addEmitter(new se(this.session,this.symbols,s.primary,e,t,i,n))}addInterfaceSymbol(e,t){if(!I.Symbols.isInterface(e)||this.seen.has(e))return;let i=this.getSymbolInfo(e);i.skip||this.addEmitter(new re(this.session,this.symbols,i.primary,e,t))}addTypeAliasSymbol(e,t){if(!I.Symbols.isTypeAlias(e)||this.seen.has(e))return;let i=this.getTypeToEmit(e);if(i===void 0)return;let n=this.getSymbolInfo(i);if(n.skip)return;let s=n.primary;I.Symbols.isClass(i)?this.addEmitter(new se(this.session,this.symbols,s,i,t,!0,!1)):I.Symbols.isInterface(i)?this.addEmitter(new re(this.session,this.symbols,s,i,t)):I.Symbols.isTypeLiteral(i)&&this.addEmitter(new be(this.session,this.symbols,s,i,t))}addFunctionSymbol(e,t){if(!I.Symbols.isFunction(e)||this.seen.has(e))return;let i=this.getSymbolInfo(e);i.skip||this.addEmitter(new Se(this.session,this.symbols,i.primary,e,t))}addModuleSymbol(e,t){if(!I.Symbols.isValueModule(e)||this.seen.has(e))return;let i=this.getSymbolInfo(e);i.skip||this.addEmitter(new Ce(this.session,this.symbols,i.primary,e,t))}addEmitter(e){let t,i,n;if(e.key!==void 0){let s=this.session.getCachedCode(e.key);s!==void 0&&(t=s.value,i=s.uri,n=s.additionalUris)}(t===void 0||i===void 0)&&(e.emit(this.currentSourceFile),t=e.lines,i=e.source,n=e.getAdditionalSources(),e.key!==void 0&&this.session.cacheCode(e.key,{value:t,uri:i,additionalUris:n})),this.indent===0?this.lines.push(...t):this.lines.push(...t.map(s=>`${"	".repeat(this.indent)}${s}`)),this.addSource(i),this.addAdditionalSource(n)}getTypeToEmit(e){if(!I.Symbols.isTypeAlias(e))return;let t=e.declarations;if(t!==void 0){for(let i of t)if(A.default.isTypeAliasDeclaration(i)){let n=i.type;if(A.default.isTypeLiteralNode(n)){let s=this.symbols.getSymbolAtLocation(n);if(I.Symbols.isTypeLiteral(s))return s}else if(A.default.isTypeReferenceNode(n)){let s=this.symbols.getLeafSymbolAtLocation(n.typeName);if(I.Symbols.isInterface(s)||I.Symbols.isTypeLiteral(s)||I.Symbols.isTypeLiteral(s))return s}}}}};var xe=class p extends K{classDeclaration;abstractMembers;extends;implements;constructor(e,t){super(e);let i=this.symbols;if(t instanceof p){let n=t;this.classDeclaration=K.getNodeInProgram(e,n.classDeclaration),this.abstractMembers=n.abstractMembers;let s=l=>{let o=l.type,d=e.getSourceFile(o.getSourceFile().fileName);if(d!==void 0){let u=W.default.getTokenAtPosition(d,o.pos);if(O.default.isExpressionWithTypeArguments(u)){let S=i.getSymbolAtLocation(u.expression);if(S!==void 0&&!this.getSymbolInfo(S).skip)return{symbol:S,type:u,abstractMembers:l.abstractMembers}}}};if(n.extends!==void 0&&(this.extends=s(n.extends)),n.implements!==void 0){let l;for(let o of n.implements){let d=s(o);d!==void 0&&(l=l??[],l.push(d))}this.implements=l}}else{let n=t;this.classDeclaration=n;let s=n.heritageClauses;if(s===void 0){this.abstractMembers=0,this.extends=void 0,this.implements=void 0;return}let l=0,o,d;for(let u of s)if(u.token===O.default.SyntaxKind.ExtendsKeyword){if(u.types.length===1){let S=u.types[0],x=this.getHeritageSymbol(S.expression);if(x!==void 0&&!this.getSymbolInfo(x).skip){let k=this.getNumberOfAbstractMembers(x);l+=k,o={symbol:x,type:S,abstractMembers:k}}}}else if(u.token===O.default.SyntaxKind.ImplementsKeyword)for(let S of u.types){let x=this.getHeritageSymbol(S.expression);if(x!==void 0&&!this.getSymbolInfo(x).skip){d=d??[];let k=this.getNumberOfAbstractMembers(x);l+=k,d.push({symbol:x,type:S,abstractMembers:k})}}d!==void 0&&d.sort((u,S)=>S.abstractMembers-u.abstractMembers),this.abstractMembers=l,this.extends=o,this.implements=d}}with(e){return e===this.program?this:new p(e,this)}*all(){this.extends!==void 0&&(yield this.extends),this.implements!==void 0&&(yield*this.implements)}isSame(e){return this.classDeclaration===e||this.classDeclaration.getSourceFile().fileName===e.getSourceFile().fileName&&this.classDeclaration.pos===e.pos}score(e){if(this.abstractMembers===0){if(this.extends===void 0)return-1;let i=this.extends.symbol.declarations;if(i===void 0)return-1;for(let n of i)if(e.getSourceFile(n.getSourceFile().fileName)===void 0)return-1;return 1}let t;for(let i of this.all())if(i.symbol.declarations!==void 0)for(let n of i.symbol.declarations){let s=n.getSourceFile();if(e.getSourceFile(s.fileName)!==void 0){t??=0,t+=i.abstractMembers;break}}return t===void 0?-1:t/this.abstractMembers}run(e,t){if(this.extends===void 0&&this.implements===void 0)return;let i,n=new Map([...this.all()].map(s=>[s.symbol,s]));for(let s of this.all()){let o=s.symbol.declarations;if(o===void 0)continue;let d=new Set;for(let u of o){if(!O.default.isClassDeclaration(u)&&!O.default.isInterfaceDeclaration(u)&&!O.default.isTypeAliasDeclaration(u)||u.name===void 0)continue;let S=u.getSourceFile();if(d.has(S.fileName))continue;let x=new W.ReferencedByVisitor(this.program,S,e.getReferencedByContext());for(let k of x.entries()){t.throwIfCancellationRequested();for(let b of W.ClassDeclarations.entries(k)){if(b.heritageClauses===void 0||this.isSame(b))continue;let T;for(let w of b.heritageClauses)for(let G of w.types){let z=this.getHeritageSymbol(G.expression);if(z===void 0)continue;let M=n.get(z);M!==void 0&&(T??=0,T+=M.abstractMembers)}if(T!==void 0&&(i===void 0?i={declaration:b,matchesAbstractMembers:T}:T>i.matchesAbstractMembers&&(i={declaration:b,matchesAbstractMembers:T})),i!==void 0&&i.matchesAbstractMembers===this.abstractMembers)return i}}}}}getNumberOfAbstractMembers(e){return this.symbols.getMemberStatistic(e).abstract.size}},oe=class extends ${classDeclaration;constructor(e,t,i){super(e,t),this.classDeclaration=i}compute(e,t,i){e.addMetaData("wholeClass");let n=this.getProgram(),s=this.classDeclaration,l=new xe(n,s);if(l.extends===void 0&&l.implements===void 0)return;let o=this.session.run(l,t,i);if(o===void 0)return;let d=new E(this.session,l.getSymbols(),s.getSourceFile(),new Set);d.addDeclaration(o.declaration),e.addSnippet(d,"blueprint",1)}};var N=P(require("typescript")),F=P(q());var Z=class extends K{methodDeclaration;constructor(e,t,i){super(e,t),this.methodDeclaration=i}static create(e,t){let i=t.parent;if(!N.default.isClassDeclaration(i))return;let n=F.Declarations.isPrivate(t),s=new F.Symbols(e),l=[],o;if(!n){let d=s.getSymbolAtLocation(i.name!==void 0?i.name:i);if(d===void 0||!F.Symbols.isClass(d))return;let u=N.default.escapeLeadingUnderscores(t.name.getText()),S,x=!1;for(let[k,b]of s.getAllSuperTypesWithPath(d)){if(d===k&&(x=!1,S=[]),x)continue;S.push(b);let T=b.members?.get(u);if(T!==void 0){if(F.Symbols.isInterface(b)||F.Symbols.isTypeLiteral(b))l.push(...S),x=!0;else if(F.Symbols.isClass(b))if(F.Symbols.isAbstract(T))l.push(...S),x=!0;else{o=b;break}}}}if(n){let d=F.ClassDeclarations.getExtendsClause(i);if(d===void 0||d.types.length===0)return;{let u=s.getLeafSymbolAtLocation(d.types[0].expression);return u===void 0||!F.Symbols.isClass(u)?void 0:new ve(e,s,i,u,t)}}else return o===void 0&&l.length>0&&F.Symbols.isClass(l[0])&&(o=l[0]),o!==void 0?new Fe(e,s,i,t,o):void 0}isSame(e){return this.methodDeclaration===e||this.methodDeclaration.getSourceFile().fileName===e.getSourceFile().fileName&&this.methodDeclaration.pos===e.pos}score(e){return e.getSourceFile(this.methodDeclaration.getSourceFile().fileName)===void 0?0:1}},ve=class p extends Z{classDeclaration;extendsSymbol;constructor(e,t,i,n,s){if(i instanceof p){let l=i,o=K.getNodeInProgram(e,l.methodDeclaration);super(e,t,o),this.classDeclaration=K.getNodeInProgram(e,l.classDeclaration);let d=l.extendsSymbol.declarations;if(d===void 0||d.length===0)throw new Error("No declarations found for extends symbol");let u;for(let S of d)if(N.default.isClassDeclaration(S)){let x=F.ClassDeclarations.getExtendsClause(S);if(x===void 0||x.types.length===0)throw new Error("No extends clause found");if(u=this.symbols.getSymbolAtLocation(x.types[0].expression),u===void 0||!F.Symbols.isClass(u))throw new Error("No extends symbol found");break}if(u===void 0)throw new Error("No extends symbol found");this.extendsSymbol=u}else super(e,t,s),this.classDeclaration=i,this.extendsSymbol=n}run(e,t){let i=N.default.escapeLeadingUnderscores(this.methodDeclaration.name.getText());for(let n of this.symbols.getDirectSubTypes(this.extendsSymbol,e.getReferencedByContext(!0)))if(t.throwIfCancellationRequested(),n.members!==void 0){let s=n.members.get(i);if(s===void 0)continue;let l=s.declarations;if(l===void 0||l.length===0)continue;for(let o of l){if(!N.default.isMethodDeclaration(o))continue;let d=o.parent;if(!(!N.default.isClassDeclaration(d)||d===this.classDeclaration))return d}}}with(e){return e===this.program?this:new p(e,void 0,this)}},Fe=class p extends Z{classDeclaration;startClass;constructor(e,t,i,n,s){if(i instanceof p){let l=i,o=K.getNodeInProgram(e,l.methodDeclaration);super(e,t,o),this.classDeclaration=K.getNodeInProgram(e,l.classDeclaration);let u=l.startClass.declarations;if(u===void 0||u.length===0)throw new Error("No declarations found for start class");let S;for(let x of u)if(N.default.isClassDeclaration(x)&&(S=this.symbols.getSymbolAtLocation(x.name?x.name:x),S!==void 0))break;if(S===void 0)throw new Error("No symbol found for start class");this.startClass=S}else super(e,t,n),this.classDeclaration=i,this.startClass=s}with(e){return e===this.program?this:new p(e,void 0,this)}run(e,t){let i=N.default.escapeLeadingUnderscores(this.methodDeclaration.name.getText());for(let n of this.symbols.getAllSubTypes(this.startClass,F.Traversal.breadthFirst,e.getReferencedByContext(!0)))if(t.throwIfCancellationRequested(),n.members!==void 0){let s=n.members.get(i);if(s===void 0)continue;let l=s.declarations;if(l===void 0||l.length===0)continue;for(let o of l){if(!N.default.isMethodDeclaration(o))continue;let d=o.parent;if(!(!N.default.isClassDeclaration(d)||d===this.classDeclaration))return d}}}},ae=class extends ${methodDeclaration;sourceFile;constructor(e,t,i){super(e,t),this.methodDeclaration=i,this.sourceFile=i.getSourceFile()}compute(e,t,i){let n=this.languageService.getProgram();if(n===void 0)return;let s=new F.Symbols(n),l=s.getSymbolAtLocation(this.methodDeclaration.name);if(l===void 0||!F.Symbols.isMethod(l))return;let o=F.Symbols.getParent(l);if(o===void 0||!F.Symbols.isClass(o)||o.declarations===void 0)return;let d=new Set,[u,S]=s.getExtendsSymbol(o);if(u!==void 0&&S!==void 0){let T=new E(this.session,s,this.sourceFile,d);T.addClassSymbol(u,S,!0,!1),e.addSnippet(T,"superClass",.9),d.add(u)}i.throwIfCancellationRequested(),this.addSignatureContext(e,n,s,.8,d,i);let x=new E(this.session,s,this.sourceFile,d),k=this.getModulesAndFunctionsInScope(n,s.getTypeChecker());for(let T of k.functions.real)x.addFunctionSymbol(T);for(let{alias:T,real:w}of k.functions.aliased)x.addFunctionSymbol(w,T.getName());x.isEmpty()||e.addSnippet(x,"generalScope",.7);let b=Z.create(n,this.methodDeclaration);if(b!==void 0){let T=this.session.run(b,t,i);if(T!==void 0){let w=new E(this.session,s,this.sourceFile,d);w.addDeclaration(T),e.addSnippet(w,"blueprint",1)}}}getModulesAndFunctionsInScope(e,t){let i={functions:{real:[],aliased:[]},modules:[]},n=t.getSymbolsInScope(this.methodDeclaration,N.SymbolFlags.Function|N.SymbolFlags.Alias);for(let s of n){let l=s.declarations;if(l!==void 0)for(let o of l){let d=o.getSourceFile();if(!(e.isSourceFileDefaultLibrary(d)||e.isSourceFileFromExternalLibrary(d))){if(F.Symbols.isFunction(s)&&d!==this.sourceFile){i.functions.real.push(s);break}else if(F.Symbols.isAlias(s)){let u=t.getAliasedSymbol(s);if(F.Symbols.isFunction(u)){i.functions.aliased.push({alias:s,real:u});break}else if(F.Symbols.isValueModule(u)){i.modules.push({alias:s,real:u});break}}}}}return i}getDeclarations(e){let t=e.declarations;if(t!==void 0)return t.filter(i=>i.getSourceFile()!==this.sourceFile)}addSignatureContext(e,t,i,n,s,l){for(let d of this.methodDeclaration.parameters){l.throwIfCancellationRequested();let u=d.type;if(u===void 0)continue;let S=i.getSymbolAtTypeNodeLocation(u);S===void 0||s.has(S)||this.processSymbol(e,i,S,F.default.Node.getTypeName(u)??S.getName(),n,s)}let o=this.methodDeclaration.type;if(o!==void 0){l.throwIfCancellationRequested();let d=i.getSymbolAtTypeNodeLocation(o);d!==void 0&&!s.has(d)&&this.processSymbol(e,i,d,F.default.Node.getTypeName(o)??d.getName(),n,s)}}processSymbol(e,t,i,n,s,l){if(F.Symbols.isClass(i)){let o=new E(this.session,t,this.sourceFile,l);o.addClassSymbol(i,n,!0,!1),e.addSnippet(o,"signature",s)}else if(F.Symbols.isInterface(i)){let o=new E(this.session,t,this.sourceFile,l);o.addInterfaceSymbol(i,n),e.addSnippet(o,"signature",s)}else if(F.Symbols.isTypeAlias(i)){let o=new E(this.session,t,this.sourceFile,l);o.addTypeAliasSymbol(i,n),e.addSnippet(o,"signature",s)}}},le=class extends ae{constructor(e,t,i){super(e,t,i)}compute(e,t,i){e.addMetaData("wholeMethod"),super.compute(e,t,i)}},de=class extends ae{token;constructor(e,t,i,n){super(e,t,i),this.token=n}compute(e,t,i){e.addMetaData("method"),super.compute(e,t,i)}};var He=new Set([H.default.SyntaxKind.MethodDeclaration,H.default.SyntaxKind.ClassDeclaration]);function qe(p,e,t,i){let n=[],s=Te.default.getTokenAtPosition(t,i);for(;s.kind===H.default.SyntaxKind.EndOfFileToken&&i>1;)s=Te.default.getTokenAtPosition(t,--i);if(s.kind===H.default.SyntaxKind.EndOfFileToken)return;let l=s;do He.has(l.kind)&&n.push(l),l=l.parent;while(l!==void 0&&l.kind!==H.default.SyntaxKind.SourceFile);if(n.length!==0){for(let o of n)if(H.default.isClassDeclaration(o)){if(o.members===void 0||o.members.length===0)return new oe(p,e,o)}else if(H.default.isMethodDeclaration(o))return o.body===void 0||o.body.statements.length===0?new le(p,e,o):new de(p,e,o,s)}}function Pe(p,e,t,i,n,s){let l=t.getProgram();if(l===void 0)return;let o=l.getSourceFile(i);if(o===void 0)return;let d=qe(e,t,o,n);d===void 0?p.addMetaData("none"):d.compute(p,new te,s)}var Ne=P(require("crypto")),ce=class{constructor(){}createHash(e){return Ne.default.createHash(e)}isDebugging(){return process.execArgv.some(e=>/^--(?:inspect|debug)(?:-brk)?(?:=\d+)?$/i.test(e))}};function Oe(p){let e=!1,t,i,n=o=>{if(o.arguments===void 0)return{response:{error:"noArguments",message:"No arguments provided"},responseRequired:!0};let d=t?.getFileAndProject(o.arguments);if(d===void 0)return{response:{error:"noProject",message:"No project founds"},responseRequired:!0};if(typeof o.arguments.line!="number"||typeof o.arguments.offset!="number")return{response:{error:"invalidArguments",message:"No project founds"},responseRequired:!0};let{file:u,project:S}=d,x=t?.getPositionInFile(o.arguments,u);if(x===void 0)return{response:{error:"invalidPosition",message:"Position not valid"},responseRequired:!0};let k=typeof o.arguments.timeBudget=="number"?o.arguments.timeBudget:75,b=new we.CancellationTokenWithTimer(i?.getCancellationToken?i.getCancellationToken():void 0,k,t?.host.isDebugging()??!1),T=new ne;try{Pe(T,t,S.getLanguageService(),u,x,b)}catch(w){if(!(w instanceof ue.OperationCanceledException))return w instanceof Error?{response:{error:"exception",message:w.message,stack:w.stack},responseRequired:!0}:{response:{error:"exception",message:"Unknown error"},responseRequired:!0}}return{response:{items:T.items,timedOut:b.isTimedOut()},responseRequired:!0}};function s(o){if(!e&&o.session!==void 0&&t===void 0&&l())try{t=new ie(o.session,new ce),i=o.languageServiceHost,o.session.addProtocolHandler("_.copilot.context",n),o.session.addProtocolHandler("_.copilot.ping",()=>({response:{pong:!0},responseRequired:!0}))}catch(d){d instanceof Error?o.session.logError(d,"_.copilot.installHandler"):o.session.logError(new Error("Unknown error"),"_.copilot.installHandler"),e=!0}return o.languageService}function l(){try{let o=ue.default.versionMajorMinor.split(".");if(o.length<2)return!1;let d=parseInt(o[0]),u=parseInt(o[1]);return d>=5&&u>=5}catch{return!1}}return{create:s}}module.exports=Oe;
