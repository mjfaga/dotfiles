{"version":3,"file":"base.js","sourceRoot":"","sources":["../../../src/transports/base.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\nimport { Payload, Response, Status, Transport } from '@amplitude/analytics-types';\n\nexport class BaseTransport implements Transport {\n  send(_serverUrl: string, _payload: Payload): Promise<Response | null> {\n    return Promise.resolve(null);\n  }\n\n  buildResponse(responseJSON: Record<string, any>): Response | null {\n    if (typeof responseJSON !== 'object') {\n      return null;\n    }\n\n    const statusCode = responseJSON.code || 0;\n    const status = this.buildStatus(statusCode);\n\n    switch (status) {\n      case Status.Success:\n        return {\n          status,\n          statusCode,\n          body: {\n            eventsIngested: responseJSON.events_ingested ?? 0,\n            payloadSizeBytes: responseJSON.payload_size_bytes ?? 0,\n            serverUploadTime: responseJSON.server_upload_time ?? 0,\n          },\n        };\n\n      case Status.Invalid:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n            missingField: responseJSON.missing_field ?? '',\n            eventsWithInvalidFields: responseJSON.events_with_invalid_fields ?? {},\n            eventsWithMissingFields: responseJSON.events_with_missing_fields ?? {},\n            eventsWithInvalidIdLengths: responseJSON.events_with_invalid_id_lengths ?? {},\n            epsThreshold: responseJSON.eps_threshold ?? 0,\n            exceededDailyQuotaDevices: responseJSON.exceeded_daily_quota_devices ?? {},\n            silencedDevices: responseJSON.silenced_devices ?? [],\n            silencedEvents: responseJSON.silenced_events ?? [],\n            throttledDevices: responseJSON.throttled_devices ?? {},\n            throttledEvents: responseJSON.throttled_events ?? [],\n          },\n        };\n      case Status.PayloadTooLarge:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n          },\n        };\n      case Status.RateLimit:\n        return {\n          status,\n          statusCode,\n          body: {\n            error: responseJSON.error ?? '',\n            epsThreshold: responseJSON.eps_threshold ?? 0,\n            throttledDevices: responseJSON.throttled_devices ?? {},\n            throttledUsers: responseJSON.throttled_users ?? {},\n            exceededDailyQuotaDevices: responseJSON.exceeded_daily_quota_devices ?? {},\n            exceededDailyQuotaUsers: responseJSON.exceeded_daily_quota_users ?? {},\n            throttledEvents: responseJSON.throttled_events ?? [],\n          },\n        };\n      case Status.Timeout:\n      default:\n        return {\n          status,\n          statusCode,\n        };\n    }\n  }\n\n  buildStatus(code: number): Status {\n    if (code >= 200 && code < 300) {\n      return Status.Success;\n    }\n\n    if (code === 429) {\n      return Status.RateLimit;\n    }\n\n    if (code === 413) {\n      return Status.PayloadTooLarge;\n    }\n\n    if (code === 408) {\n      return Status.Timeout;\n    }\n\n    if (code >= 400 && code < 500) {\n      return Status.Invalid;\n    }\n\n    if (code >= 500) {\n      return Status.Failed;\n    }\n\n    return Status.Unknown;\n  }\n}\n"]}