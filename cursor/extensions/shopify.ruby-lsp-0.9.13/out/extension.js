"use strict";var FR=Object.create;var go=Object.defineProperty;var LR=Object.getOwnPropertyDescriptor;var MR=Object.getOwnPropertyNames;var NR=Object.getPrototypeOf,AR=Object.prototype.hasOwnProperty;var I=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),jR=(r,e)=>{for(var t in e)go(r,t,{get:e[t],enumerable:!0})},ig=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of MR(e))!AR.call(r,i)&&i!==t&&go(r,i,{get:()=>e[i],enumerable:!(n=LR(e,i))||n.enumerable});return r};var ue=(r,e,t)=>(t=r!=null?FR(NR(r)):{},ig(e||!r||!r.__esModule?go(t,"default",{value:r,enumerable:!0}):t,r)),$R=r=>ig(go({},"__esModule",{value:!0}),r);var Hn=I(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.asPromise=vt.thenable=vt.typedArray=vt.stringArray=vt.array=vt.func=vt.error=vt.number=vt.string=vt.boolean=void 0;function UR(r){return r===!0||r===!1}vt.boolean=UR;function sg(r){return typeof r=="string"||r instanceof String}vt.string=sg;function WR(r){return typeof r=="number"||r instanceof Number}vt.number=WR;function HR(r){return r instanceof Error}vt.error=HR;function og(r){return typeof r=="function"}vt.func=og;function ag(r){return Array.isArray(r)}vt.array=ag;function VR(r){return ag(r)&&r.every(e=>sg(e))}vt.stringArray=VR;function KR(r,e){return Array.isArray(r)&&r.every(e)}vt.typedArray=KR;function cg(r){return r&&og(r.then)}vt.thenable=cg;function zR(r){return r instanceof Promise?r:cg(r)?new Promise((e,t)=>{r.then(n=>e(n),n=>t(n))}):Promise.resolve(r)}vt.asPromise=zR});var Ti=I(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.stringArray=Ht.array=Ht.func=Ht.error=Ht.number=Ht.string=Ht.boolean=void 0;function BR(r){return r===!0||r===!1}Ht.boolean=BR;function ug(r){return typeof r=="string"||r instanceof String}Ht.string=ug;function GR(r){return typeof r=="number"||r instanceof Number}Ht.number=GR;function JR(r){return r instanceof Error}Ht.error=JR;function XR(r){return typeof r=="function"}Ht.func=XR;function dg(r){return Array.isArray(r)}Ht.array=dg;function QR(r){return dg(r)&&r.every(e=>ug(e))}Ht.stringArray=QR});var Ru=I(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.Message=ie.NotificationType9=ie.NotificationType8=ie.NotificationType7=ie.NotificationType6=ie.NotificationType5=ie.NotificationType4=ie.NotificationType3=ie.NotificationType2=ie.NotificationType1=ie.NotificationType0=ie.NotificationType=ie.RequestType9=ie.RequestType8=ie.RequestType7=ie.RequestType6=ie.RequestType5=ie.RequestType4=ie.RequestType3=ie.RequestType2=ie.RequestType1=ie.RequestType=ie.RequestType0=ie.AbstractMessageSignature=ie.ParameterStructures=ie.ResponseError=ie.ErrorCodes=void 0;var ri=Ti(),Yc;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(Yc||(ie.ErrorCodes=Yc={}));var Zc=class r extends Error{constructor(e,t,n){super(t),this.code=ri.number(e)?e:Yc.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};ie.ResponseError=Zc;var cn=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};ie.ParameterStructures=cn;cn.auto=new cn("auto");cn.byPosition=new cn("byPosition");cn.byName=new cn("byName");var et=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return cn.auto}};ie.AbstractMessageSignature=et;var eu=class extends et{constructor(e){super(e,0)}};ie.RequestType0=eu;var tu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ie.RequestType=tu;var nu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ie.RequestType1=nu;var ru=class extends et{constructor(e){super(e,2)}};ie.RequestType2=ru;var iu=class extends et{constructor(e){super(e,3)}};ie.RequestType3=iu;var su=class extends et{constructor(e){super(e,4)}};ie.RequestType4=su;var ou=class extends et{constructor(e){super(e,5)}};ie.RequestType5=ou;var au=class extends et{constructor(e){super(e,6)}};ie.RequestType6=au;var cu=class extends et{constructor(e){super(e,7)}};ie.RequestType7=cu;var uu=class extends et{constructor(e){super(e,8)}};ie.RequestType8=uu;var du=class extends et{constructor(e){super(e,9)}};ie.RequestType9=du;var lu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ie.NotificationType=lu;var fu=class extends et{constructor(e){super(e,0)}};ie.NotificationType0=fu;var hu=class extends et{constructor(e,t=cn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};ie.NotificationType1=hu;var pu=class extends et{constructor(e){super(e,2)}};ie.NotificationType2=pu;var gu=class extends et{constructor(e){super(e,3)}};ie.NotificationType3=gu;var mu=class extends et{constructor(e){super(e,4)}};ie.NotificationType4=mu;var vu=class extends et{constructor(e){super(e,5)}};ie.NotificationType5=vu;var yu=class extends et{constructor(e){super(e,6)}};ie.NotificationType6=yu;var bu=class extends et{constructor(e){super(e,7)}};ie.NotificationType7=bu;var wu=class extends et{constructor(e){super(e,8)}};ie.NotificationType8=wu;var Cu=class extends et{constructor(e){super(e,9)}};ie.NotificationType9=Cu;var lg;(function(r){function e(i){let s=i;return s&&ri.string(s.method)&&(ri.string(s.id)||ri.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&ri.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(ri.string(s.id)||ri.number(s.id)||s.id===null)}r.isResponse=n})(lg||(ie.Message=lg={}))});var _u=I(Or=>{"use strict";var fg;Object.defineProperty(Or,"__esModule",{value:!0});Or.LRUCache=Or.LinkedMap=Or.Touch=void 0;var Vt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Vt||(Or.Touch=Vt={}));var mo=class{constructor(){this[fg]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Vt.None){let n=this._map.get(e);if(n)return t!==Vt.None&&this.touch(n,t),n.value}set(e,t,n=Vt.None){let i=this._map.get(e);if(i)i.value=t,n!==Vt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Vt.None:this.addItemLast(i);break;case Vt.First:this.addItemFirst(i);break;case Vt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(fg=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Vt.First&&t!==Vt.Last)){if(t===Vt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Vt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};Or.LinkedMap=mo;var Su=class extends mo{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Vt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Vt.None)}set(e,t){return super.set(e,t,Vt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Or.LRUCache=Su});var pg=I(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.Disposable=void 0;var hg;(function(r){function e(t){return{dispose:t}}r.create=e})(hg||(vo.Disposable=hg={}))});var Fr=I(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});var Tu;function Du(){if(Tu===void 0)throw new Error("No runtime abstraction layer installed");return Tu}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");Tu=t}r.install=e})(Du||(Du={}));Pu.default=Du});var Pi=I(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.Emitter=Di.Event=void 0;var YR=Fr(),gg;(function(r){let e={dispose(){}};r.None=function(){return e}})(gg||(Di.Event=gg={}));var ku=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,YR.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},yo=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new ku),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};Di.Emitter=yo;yo._noop=function(){}});var Co=I(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.CancellationTokenSource=ki.CancellationToken=void 0;var ZR=Fr(),eS=Ti(),Eu=Pi(),bo;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Eu.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Eu.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||eS.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(bo||(ki.CancellationToken=bo={}));var tS=Object.freeze(function(r,e){let t=(0,ZR.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),wo=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?tS:(this._emitter||(this._emitter=new Eu.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},xu=class{get token(){return this._token||(this._token=new wo),this._token}cancel(){this._token?this._token.cancel():this._token=bo.Cancelled}dispose(){this._token?this._token instanceof wo&&this._token.dispose():this._token=bo.None}};ki.CancellationTokenSource=xu});var mg=I(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.SharedArrayReceiverStrategy=Ei.SharedArraySenderStrategy=void 0;var nS=Co(),vs;(function(r){r.Continue=0,r.Cancelled=1})(vs||(vs={}));var Iu=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=vs.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,vs.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};Ei.SharedArraySenderStrategy=Iu;var qu=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===vs.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Ou=class{constructor(e){this.token=new qu(e)}cancel(){}dispose(){}},Fu=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new nS.CancellationTokenSource:new Ou(t)}};Ei.SharedArrayReceiverStrategy=Fu});var Mu=I(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.Semaphore=void 0;var rS=Fr(),Lu=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,rS.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ro.Semaphore=Lu});var yg=I(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.ReadableStreamMessageReader=Lr.AbstractMessageReader=Lr.MessageReader=void 0;var Au=Fr(),xi=Ti(),Nu=Pi(),iS=Mu(),vg;(function(r){function e(t){let n=t;return n&&xi.func(n.listen)&&xi.func(n.dispose)&&xi.func(n.onError)&&xi.func(n.onClose)&&xi.func(n.onPartialMessage)}r.is=e})(vg||(Lr.MessageReader=vg={}));var So=class{constructor(){this.errorEmitter=new Nu.Emitter,this.closeEmitter=new Nu.Emitter,this.partialMessageEmitter=new Nu.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${xi.string(e.message)?e.message:"unknown"}`)}};Lr.AbstractMessageReader=So;var ju;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,Au.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(ju||(ju={}));var $u=class extends So{constructor(e,t){super(),this.readable=e,this.options=ju.fromOptions(t),this.buffer=(0,Au.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new iS.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Au.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};Lr.ReadableStreamMessageReader=$u});var Sg=I(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.WriteableStreamMessageWriter=Mr.AbstractMessageWriter=Mr.MessageWriter=void 0;var bg=Fr(),ys=Ti(),sS=Mu(),wg=Pi(),oS="Content-Length: ",Cg=`\r
`,Rg;(function(r){function e(t){let n=t;return n&&ys.func(n.dispose)&&ys.func(n.onClose)&&ys.func(n.onError)&&ys.func(n.write)}r.is=e})(Rg||(Mr.MessageWriter=Rg={}));var _o=class{constructor(){this.errorEmitter=new wg.Emitter,this.closeEmitter=new wg.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ys.string(e.message)?e.message:"unknown"}`)}};Mr.AbstractMessageWriter=_o;var Uu;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,bg.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,bg.default)().applicationJson.encoder}}r.fromOptions=e})(Uu||(Uu={}));var Wu=class extends _o{constructor(e,t){super(),this.writable=e,this.options=Uu.fromOptions(t),this.errorCount=0,this.writeSemaphore=new sS.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(oS,n.byteLength.toString(),Cg),i.push(Cg),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};Mr.WriteableStreamMessageWriter=Wu});var _g=I(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.AbstractMessageBuffer=void 0;var aS=13,cS=10,uS=`\r
`,Hu=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case aS:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case cS:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(uS);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let h=c[d],m=h.indexOf(":");if(m===-1)throw new Error(`Message header must separate key and value using ':'
${h}`);let v=h.substr(0,m),S=h.substr(m+1).trim();a.set(e?v.toLowerCase():v,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};To.AbstractMessageBuffer=Hu});var Eg=I(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.createMessageConnection=ye.ConnectionOptions=ye.MessageStrategy=ye.CancellationStrategy=ye.CancellationSenderStrategy=ye.CancellationReceiverStrategy=ye.RequestCancellationReceiverStrategy=ye.IdCancellationReceiverStrategy=ye.ConnectionStrategy=ye.ConnectionError=ye.ConnectionErrors=ye.LogTraceNotification=ye.SetTraceNotification=ye.TraceFormat=ye.TraceValues=ye.Trace=ye.NullLogger=ye.ProgressType=ye.ProgressToken=void 0;var Tg=Fr(),ut=Ti(),de=Ru(),Dg=_u(),bs=Pi(),Vu=Co(),Rs;(function(r){r.type=new de.NotificationType("$/cancelRequest")})(Rs||(Rs={}));var Ku;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Ku||(ye.ProgressToken=Ku={}));var ws;(function(r){r.type=new de.NotificationType("$/progress")})(ws||(ws={}));var zu=class{constructor(){}};ye.ProgressType=zu;var Bu;(function(r){function e(t){return ut.func(t)}r.is=e})(Bu||(Bu={}));ye.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Fe;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Fe||(ye.Trace=Fe={}));var Pg;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(Pg||(ye.TraceValues=Pg={}));(function(r){function e(n){if(!ut.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Fe||(ye.Trace=Fe={}));var kn;(function(r){r.Text="text",r.JSON="json"})(kn||(ye.TraceFormat=kn={}));(function(r){function e(t){return ut.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(kn||(ye.TraceFormat=kn={}));var Gu;(function(r){r.type=new de.NotificationType("$/setTrace")})(Gu||(ye.SetTraceNotification=Gu={}));var Do;(function(r){r.type=new de.NotificationType("$/logTrace")})(Do||(ye.LogTraceNotification=Do={}));var Cs;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(Cs||(ye.ConnectionErrors=Cs={}));var Ii=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};ye.ConnectionError=Ii;var Ju;(function(r){function e(t){let n=t;return n&&ut.func(n.cancelUndispatched)}r.is=e})(Ju||(ye.ConnectionStrategy=Ju={}));var Po;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&ut.func(n.createCancellationTokenSource)&&(n.dispose===void 0||ut.func(n.dispose))}r.is=e})(Po||(ye.IdCancellationReceiverStrategy=Po={}));var Xu;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&ut.func(n.createCancellationTokenSource)&&(n.dispose===void 0||ut.func(n.dispose))}r.is=e})(Xu||(ye.RequestCancellationReceiverStrategy=Xu={}));var ko;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Vu.CancellationTokenSource}});function e(t){return Po.is(t)||Xu.is(t)}r.is=e})(ko||(ye.CancellationReceiverStrategy=ko={}));var Eo;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(Rs.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&ut.func(n.sendCancellation)&&ut.func(n.cleanup)}r.is=e})(Eo||(ye.CancellationSenderStrategy=Eo={}));var xo;(function(r){r.Message=Object.freeze({receiver:ko.Message,sender:Eo.Message});function e(t){let n=t;return n&&ko.is(n.receiver)&&Eo.is(n.sender)}r.is=e})(xo||(ye.CancellationStrategy=xo={}));var Io;(function(r){function e(t){let n=t;return n&&ut.func(n.handleMessage)}r.is=e})(Io||(ye.MessageStrategy=Io={}));var kg;(function(r){function e(t){let n=t;return n&&(xo.is(n.cancellationStrategy)||Ju.is(n.connectionStrategy)||Io.is(n.messageStrategy))}r.is=e})(kg||(ye.ConnectionOptions=kg={}));var er;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(er||(er={}));function dS(r,e,t,n){let i=t!==void 0?t:ye.NullLogger,s=0,o=0,a=0,c="2.0",d,h=new Map,m,v=new Map,S=new Map,y,P=new Dg.LinkedMap,x=new Map,$=new Set,U=new Map,M=Fe.Off,K=kn.Text,B,pe=er.New,J=new bs.Emitter,ae=new bs.Emitter,Re=new bs.Emitter,rt=new bs.Emitter,Ze=new bs.Emitter,je=n&&n.cancellationStrategy?n.cancellationStrategy:xo.Message;function Zt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function Nt(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function Dt(){return"not-"+(++o).toString()}function Pt(l,C){de.Message.isRequest(C)?l.set(Zt(C.id),C):de.Message.isResponse(C)?l.set(Nt(C.id),C):l.set(Dt(),C)}function bn(l){}function wn(){return pe===er.Listening}function $e(){return pe===er.Closed}function wt(){return pe===er.Disposed}function It(){(pe===er.New||pe===er.Listening)&&(pe=er.Closed,ae.fire(void 0))}function kt(l){J.fire([l,void 0,void 0])}function cr(l){J.fire(l)}r.onClose(It),r.onError(kt),e.onClose(It),e.onError(cr);function Cn(){y||P.size===0||(y=(0,Tg.default)().timer.setImmediate(()=>{y=void 0,Qn()}))}function Rn(l){de.Message.isRequest(l)?An(l):de.Message.isNotification(l)?_n(l):de.Message.isResponse(l)?Sn(l):jn(l)}function Qn(){if(P.size===0)return;let l=P.shift();try{let C=n?.messageStrategy;Io.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let ur=l=>{try{if(de.Message.isNotification(l)&&l.method===Rs.type.method){let C=l.params.id,k=Zt(C),O=P.get(k);if(de.Message.isRequest(O)){let ee=n?.connectionStrategy,oe=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(oe&&(oe.error!==void 0||oe.result!==void 0)){P.delete(k),U.delete(C),oe.id=O.id,At(oe,l.method,Date.now()),e.write(oe).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Wt(l);return}else $.add(C)}Pt(P,l)}finally{Cn()}};function An(l){if(wt())return;function C(G,re,Z){let he={jsonrpc:c,id:l.id};G instanceof de.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function k(G,re,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,re,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}dr(l);let ne=h.get(l.method),ee,oe;ne&&(ee=ne.type,oe=ne.handler);let ce=Date.now();if(oe||d){let G=l.id??String(Date.now()),re=Po.is(je.receiver)?je.receiver.createCancellationTokenSource(G):je.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&re.cancel(),l.id!==null&&U.set(G,re);try{let Z;if(oe)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){k(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ce);return}Z=oe(re.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byName){k(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ce);return}Z=oe(...l.params,re.token)}else{if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byPosition){k(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ce);return}Z=oe(l.params,re.token)}else d&&(Z=d(l.method,l.params,re.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ce)},_e=>{U.delete(G),_e instanceof de.ResponseError?k(_e,l.method,ce):_e&&ut.string(_e.message)?k(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ce):k(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ce)}):(U.delete(G),C(Z,l.method,ce)):(U.delete(G),O(Z,l.method,ce))}catch(Z){U.delete(G),Z instanceof de.ResponseError?C(Z,l.method,ce):Z&&ut.string(Z.message)?k(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ce):k(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ce)}}else k(new de.ResponseError(de.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ce)}function Sn(l){if(!wt())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,k=x.get(C);if($n(l,k),k!==void 0){x.delete(C);try{if(l.error){let O=l.error;k.reject(new de.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)k.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${k.method}' failed with message: ${O.message}`):i.error(`Response handler '${k.method}' failed unexpectedly.`)}}}}function _n(l){if(wt())return;let C,k;if(l.method===Rs.type.method){let O=l.params.id;$.delete(O),Wt(l);return}else{let O=v.get(l.method);O&&(k=O.handler,C=O.type)}if(k||m)try{if(Wt(l),k)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),k();else if(Array.isArray(l.params)){let O=l.params;l.method===ws.type.method&&O.length===2&&Ku.is(O[0])?k({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),k(...O))}else C!==void 0&&C.parameterStructures===de.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),k(l.params);else m&&m(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function jn(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(ut.string(C.id)||ut.number(C.id)){let k=C.id,O=x.get(k);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function Ue(l){if(l!=null)switch(M){case Fe.Verbose:return JSON.stringify(l,null,4);case Fe.Compact:return JSON.stringify(l);default:return}}function Yn(l){if(!(M===Fe.Off||!B))if(K===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&l.params&&(C=`Params: ${Ue(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Fe.Off||!B))if(K===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&(l.params?C=`Params: ${Ue(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function At(l,C,k){if(!(M===Fe.Off||!B))if(K===kn.Text){let O;(M===Fe.Verbose||M===Fe.Compact)&&(l.error&&l.error.data?O=`Error data: ${Ue(l.error.data)}

`:l.result?O=`Result: ${Ue(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-k}ms`,O)}else Ke("send-response",l)}function dr(l){if(!(M===Fe.Off||!B))if(K===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&l.params&&(C=`Params: ${Ue(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Wt(l){if(!(M===Fe.Off||!B||l.method===Do.type.method))if(K===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&(l.params?C=`Params: ${Ue(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function $n(l,C){if(!(M===Fe.Off||!B))if(K===kn.Text){let k;if((M===Fe.Verbose||M===Fe.Compact)&&(l.error&&l.error.data?k=`Error data: ${Ue(l.error.data)}

`:l.result?k=`Result: ${Ue(l.result)}

`:l.error===void 0&&(k=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,k)}else B.log(`Received response ${l.id} without active response promise.`,k)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Fe.Off)return;let k={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(k)}function gt(){if($e())throw new Ii(Cs.Closed,"Connection is closed.");if(wt())throw new Ii(Cs.Disposed,"Connection is disposed.")}function Et(){if(wn())throw new Ii(Cs.AlreadyListening,"Connection is already listening")}function en(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Dn(l){if(l!==null)return l}function Un(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function tn(l,C){switch(l){case de.ParameterStructures.auto:return Un(C)?Dn(C):[Rt(C)];case de.ParameterStructures.byName:if(!Un(C))throw new Error("Received parameters by name but param is not an object literal.");return Dn(C);case de.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Wn(l,C){let k,O=l.numberOfParams;switch(O){case 0:k=void 0;break;case 1:k=tn(l.parameterStructures,C[0]);break;default:k=[];for(let ne=0;ne<C.length&&ne<O;ne++)k.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)k.push(null);break}return k}let mt={sendNotification:(l,...C)=>{gt();let k,O;if(ut.string(l)){k=l;let ee=C[0],oe=0,ce=de.ParameterStructures.auto;de.ParameterStructures.is(ee)&&(oe=1,ce=ee);let G=C.length,re=G-oe;switch(re){case 0:O=void 0;break;case 1:O=tn(ce,C[oe]);break;default:if(ce===de.ParameterStructures.byName)throw new Error(`Received ${re} parameters for 'by Name' notification parameter structure.`);O=C.slice(oe,G).map(Z=>Rt(Z));break}}else{let ee=C;k=l.method,O=Wn(l,ee)}let ne={jsonrpc:c,method:k,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let k;return ut.func(l)?m=l:C&&(ut.string(l)?(k=l,v.set(l,{type:void 0,handler:C})):(k=l.method,v.set(l.method,{type:l,handler:C}))),{dispose:()=>{k!==void 0?v.delete(k):m=void 0}}},onProgress:(l,C,k)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,k),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,k)=>mt.sendNotification(ws.type,{token:C,value:k}),onUnhandledProgress:rt.event,sendRequest:(l,...C)=>{gt(),en();let k,O,ne;if(ut.string(l)){k=l;let G=C[0],re=C[C.length-1],Z=0,he=de.ParameterStructures.auto;de.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Vu.CancellationToken.is(re)&&(_e=_e-1,ne=re);let We=_e-Z;switch(We){case 0:O=void 0;break;case 1:O=tn(he,C[Z]);break;default:if(he===de.ParameterStructures.byName)throw new Error(`Received ${We} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(lr=>Rt(lr));break}}else{let G=C;k=l.method,O=Wn(l,G);let re=l.numberOfParams;ne=Vu.CancellationToken.is(G[re])?G[re]:void 0}let ee=s++,oe;ne&&(oe=ne.onCancellationRequested(()=>{let G=je.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ce={jsonrpc:c,id:ee,method:k,params:O};return Yn(ce),typeof je.sender.enableCancellation=="function"&&je.sender.enableCancellation(ce),new Promise(async(G,re)=>{let Z=We=>{G(We),je.sender.cleanup(ee),oe?.dispose()},he=We=>{re(We),je.sender.cleanup(ee),oe?.dispose()},_e={method:k,timerStart:Date.now(),resolve:Z,reject:he};try{await e.write(ce),x.set(ee,_e)}catch(We){throw i.error("Sending request failed."),_e.reject(new de.ResponseError(de.ErrorCodes.MessageWriteError,We.message?We.message:"Unknown reason")),We}})},onRequest:(l,C)=>{gt();let k=null;return Bu.is(l)?(k=void 0,d=l):ut.string(l)?(k=null,C!==void 0&&(k=l,h.set(l,{handler:C,type:void 0}))):C!==void 0&&(k=l.method,h.set(l.method,{type:l,handler:C})),{dispose:()=>{k!==null&&(k!==void 0?h.delete(k):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,k)=>{let O=!1,ne=kn.Text;k!==void 0&&(ut.boolean(k)?O=k:(O=k.sendNotification||!1,ne=k.traceFormat||kn.Text)),M=l,K=ne,M===Fe.Off?B=void 0:B=C,O&&!$e()&&!wt()&&await mt.sendNotification(Gu.type,{value:Fe.toString(l)})},onError:J.event,onClose:ae.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(wt())return;pe=er.Disposed,Ze.fire(void 0);let l=new de.ResponseError(de.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,P=new Dg.LinkedMap,ut.func(e.dispose)&&e.dispose(),ut.func(r.dispose)&&r.dispose()},listen:()=>{gt(),Et(),pe=er.Listening,r.listen(ur)},inspect:()=>{(0,Tg.default)().console.log("inspect")}};return mt.onNotification(Do.type,l=>{if(M===Fe.Off||!B)return;let C=M===Fe.Verbose||M===Fe.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(ws.type,l=>{let C=S.get(l.token);C?C(l.value):rt.fire(l)}),mt}ye.createMessageConnection=dS});var qo=I(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.ProgressType=F.ProgressToken=F.createMessageConnection=F.NullLogger=F.ConnectionOptions=F.ConnectionStrategy=F.AbstractMessageBuffer=F.WriteableStreamMessageWriter=F.AbstractMessageWriter=F.MessageWriter=F.ReadableStreamMessageReader=F.AbstractMessageReader=F.MessageReader=F.SharedArrayReceiverStrategy=F.SharedArraySenderStrategy=F.CancellationToken=F.CancellationTokenSource=F.Emitter=F.Event=F.Disposable=F.LRUCache=F.Touch=F.LinkedMap=F.ParameterStructures=F.NotificationType9=F.NotificationType8=F.NotificationType7=F.NotificationType6=F.NotificationType5=F.NotificationType4=F.NotificationType3=F.NotificationType2=F.NotificationType1=F.NotificationType0=F.NotificationType=F.ErrorCodes=F.ResponseError=F.RequestType9=F.RequestType8=F.RequestType7=F.RequestType6=F.RequestType5=F.RequestType4=F.RequestType3=F.RequestType2=F.RequestType1=F.RequestType0=F.RequestType=F.Message=F.RAL=void 0;F.MessageStrategy=F.CancellationStrategy=F.CancellationSenderStrategy=F.CancellationReceiverStrategy=F.ConnectionError=F.ConnectionErrors=F.LogTraceNotification=F.SetTraceNotification=F.TraceFormat=F.TraceValues=F.Trace=void 0;var Xe=Ru();Object.defineProperty(F,"Message",{enumerable:!0,get:function(){return Xe.Message}});Object.defineProperty(F,"RequestType",{enumerable:!0,get:function(){return Xe.RequestType}});Object.defineProperty(F,"RequestType0",{enumerable:!0,get:function(){return Xe.RequestType0}});Object.defineProperty(F,"RequestType1",{enumerable:!0,get:function(){return Xe.RequestType1}});Object.defineProperty(F,"RequestType2",{enumerable:!0,get:function(){return Xe.RequestType2}});Object.defineProperty(F,"RequestType3",{enumerable:!0,get:function(){return Xe.RequestType3}});Object.defineProperty(F,"RequestType4",{enumerable:!0,get:function(){return Xe.RequestType4}});Object.defineProperty(F,"RequestType5",{enumerable:!0,get:function(){return Xe.RequestType5}});Object.defineProperty(F,"RequestType6",{enumerable:!0,get:function(){return Xe.RequestType6}});Object.defineProperty(F,"RequestType7",{enumerable:!0,get:function(){return Xe.RequestType7}});Object.defineProperty(F,"RequestType8",{enumerable:!0,get:function(){return Xe.RequestType8}});Object.defineProperty(F,"RequestType9",{enumerable:!0,get:function(){return Xe.RequestType9}});Object.defineProperty(F,"ResponseError",{enumerable:!0,get:function(){return Xe.ResponseError}});Object.defineProperty(F,"ErrorCodes",{enumerable:!0,get:function(){return Xe.ErrorCodes}});Object.defineProperty(F,"NotificationType",{enumerable:!0,get:function(){return Xe.NotificationType}});Object.defineProperty(F,"NotificationType0",{enumerable:!0,get:function(){return Xe.NotificationType0}});Object.defineProperty(F,"NotificationType1",{enumerable:!0,get:function(){return Xe.NotificationType1}});Object.defineProperty(F,"NotificationType2",{enumerable:!0,get:function(){return Xe.NotificationType2}});Object.defineProperty(F,"NotificationType3",{enumerable:!0,get:function(){return Xe.NotificationType3}});Object.defineProperty(F,"NotificationType4",{enumerable:!0,get:function(){return Xe.NotificationType4}});Object.defineProperty(F,"NotificationType5",{enumerable:!0,get:function(){return Xe.NotificationType5}});Object.defineProperty(F,"NotificationType6",{enumerable:!0,get:function(){return Xe.NotificationType6}});Object.defineProperty(F,"NotificationType7",{enumerable:!0,get:function(){return Xe.NotificationType7}});Object.defineProperty(F,"NotificationType8",{enumerable:!0,get:function(){return Xe.NotificationType8}});Object.defineProperty(F,"NotificationType9",{enumerable:!0,get:function(){return Xe.NotificationType9}});Object.defineProperty(F,"ParameterStructures",{enumerable:!0,get:function(){return Xe.ParameterStructures}});var Qu=_u();Object.defineProperty(F,"LinkedMap",{enumerable:!0,get:function(){return Qu.LinkedMap}});Object.defineProperty(F,"LRUCache",{enumerable:!0,get:function(){return Qu.LRUCache}});Object.defineProperty(F,"Touch",{enumerable:!0,get:function(){return Qu.Touch}});var lS=pg();Object.defineProperty(F,"Disposable",{enumerable:!0,get:function(){return lS.Disposable}});var xg=Pi();Object.defineProperty(F,"Event",{enumerable:!0,get:function(){return xg.Event}});Object.defineProperty(F,"Emitter",{enumerable:!0,get:function(){return xg.Emitter}});var Ig=Co();Object.defineProperty(F,"CancellationTokenSource",{enumerable:!0,get:function(){return Ig.CancellationTokenSource}});Object.defineProperty(F,"CancellationToken",{enumerable:!0,get:function(){return Ig.CancellationToken}});var qg=mg();Object.defineProperty(F,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return qg.SharedArraySenderStrategy}});Object.defineProperty(F,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return qg.SharedArrayReceiverStrategy}});var Yu=yg();Object.defineProperty(F,"MessageReader",{enumerable:!0,get:function(){return Yu.MessageReader}});Object.defineProperty(F,"AbstractMessageReader",{enumerable:!0,get:function(){return Yu.AbstractMessageReader}});Object.defineProperty(F,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Yu.ReadableStreamMessageReader}});var Zu=Sg();Object.defineProperty(F,"MessageWriter",{enumerable:!0,get:function(){return Zu.MessageWriter}});Object.defineProperty(F,"AbstractMessageWriter",{enumerable:!0,get:function(){return Zu.AbstractMessageWriter}});Object.defineProperty(F,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Zu.WriteableStreamMessageWriter}});var fS=_g();Object.defineProperty(F,"AbstractMessageBuffer",{enumerable:!0,get:function(){return fS.AbstractMessageBuffer}});var $t=Eg();Object.defineProperty(F,"ConnectionStrategy",{enumerable:!0,get:function(){return $t.ConnectionStrategy}});Object.defineProperty(F,"ConnectionOptions",{enumerable:!0,get:function(){return $t.ConnectionOptions}});Object.defineProperty(F,"NullLogger",{enumerable:!0,get:function(){return $t.NullLogger}});Object.defineProperty(F,"createMessageConnection",{enumerable:!0,get:function(){return $t.createMessageConnection}});Object.defineProperty(F,"ProgressToken",{enumerable:!0,get:function(){return $t.ProgressToken}});Object.defineProperty(F,"ProgressType",{enumerable:!0,get:function(){return $t.ProgressType}});Object.defineProperty(F,"Trace",{enumerable:!0,get:function(){return $t.Trace}});Object.defineProperty(F,"TraceValues",{enumerable:!0,get:function(){return $t.TraceValues}});Object.defineProperty(F,"TraceFormat",{enumerable:!0,get:function(){return $t.TraceFormat}});Object.defineProperty(F,"SetTraceNotification",{enumerable:!0,get:function(){return $t.SetTraceNotification}});Object.defineProperty(F,"LogTraceNotification",{enumerable:!0,get:function(){return $t.LogTraceNotification}});Object.defineProperty(F,"ConnectionErrors",{enumerable:!0,get:function(){return $t.ConnectionErrors}});Object.defineProperty(F,"ConnectionError",{enumerable:!0,get:function(){return $t.ConnectionError}});Object.defineProperty(F,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return $t.CancellationReceiverStrategy}});Object.defineProperty(F,"CancellationSenderStrategy",{enumerable:!0,get:function(){return $t.CancellationSenderStrategy}});Object.defineProperty(F,"CancellationStrategy",{enumerable:!0,get:function(){return $t.CancellationStrategy}});Object.defineProperty(F,"MessageStrategy",{enumerable:!0,get:function(){return $t.MessageStrategy}});var hS=Fr();F.RAL=hS.default});var Lg=I(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});var Og=require("util"),Rr=qo(),Oo=class r extends Rr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new Og.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Oo.emptyBuffer=Buffer.allocUnsafe(0);var ed=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Rr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Rr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Rr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Rr.Disposable.create(()=>this.stream.off("data",e))}},td=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Rr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Rr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Rr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},Fg=Object.freeze({messageBuffer:Object.freeze({create:r=>new Oo(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new Og.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new ed(r),asWritableStream:r=>new td(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function nd(){return Fg}(function(r){function e(){Rr.RAL.install(Fg)}r.install=e})(nd||(nd={}));rd.default=nd});var oi=I(Ee=>{"use strict";var pS=Ee&&Ee.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),gS=Ee&&Ee.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&pS(e,r,t)};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.createMessageConnection=Ee.createServerSocketTransport=Ee.createClientSocketTransport=Ee.createServerPipeTransport=Ee.createClientPipeTransport=Ee.generateRandomPipeName=Ee.StreamMessageWriter=Ee.StreamMessageReader=Ee.SocketMessageWriter=Ee.SocketMessageReader=Ee.PortMessageWriter=Ee.PortMessageReader=Ee.IPCMessageWriter=Ee.IPCMessageReader=void 0;var qi=Lg();qi.default.install();var Mg=require("path"),mS=require("os"),vS=require("crypto"),Mo=require("net"),En=qo();gS(qo(),Ee);var id=class extends En.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),En.Disposable.create(()=>this.process.off("message",e))}};Ee.IPCMessageReader=id;var sd=class extends En.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.IPCMessageWriter=sd;var od=class extends En.AbstractMessageReader{constructor(e){super(),this.onData=new En.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};Ee.PortMessageReader=od;var ad=class extends En.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.PortMessageWriter=ad;var ii=class extends En.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,qi.default)().stream.asReadableStream(e),t)}};Ee.SocketMessageReader=ii;var si=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,qi.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};Ee.SocketMessageWriter=si;var Fo=class extends En.ReadableStreamMessageReader{constructor(e,t){super((0,qi.default)().stream.asReadableStream(e),t)}};Ee.StreamMessageReader=Fo;var Lo=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,qi.default)().stream.asWritableStream(e),t)}};Ee.StreamMessageWriter=Lo;var Ng=process.env.XDG_RUNTIME_DIR,yS=new Map([["linux",107],["darwin",103]]);function bS(){let r=(0,vS.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;Ng?e=Mg.join(Ng,`vscode-ipc-${r}.sock`):e=Mg.join(mS.tmpdir(),`vscode-${r}.sock`);let t=yS.get(process.platform);return t!==void 0&&e.length>t&&(0,qi.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}Ee.generateRandomPipeName=bS;function wS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ii(a,e),new si(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientPipeTransport=wS;function CS(r,e="utf-8"){let t=(0,Mo.createConnection)(r);return[new ii(t,e),new si(t,e)]}Ee.createServerPipeTransport=CS;function RS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ii(a,e),new si(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientSocketTransport=RS;function SS(r,e="utf-8"){let t=(0,Mo.createConnection)(r,"127.0.0.1");return[new ii(t,e),new si(t,e)]}Ee.createServerSocketTransport=SS;function _S(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function TS(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function DS(r,e,t,n){t||(t=En.NullLogger);let i=_S(r)?new Fo(r):r,s=TS(e)?new Lo(e):e;return En.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,En.createMessageConnection)(i,s,t,n)}Ee.createMessageConnection=DS});var cd=I((nE,Ag)=>{"use strict";Ag.exports=oi()});var Ao=I((jg,No)=>{(function(r){if(typeof No=="object"&&typeof No.exports=="object"){var e=r(require,jg);e!==void 0&&(No.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlineCompletionContext=e.SelectedCompletionInfo=e.InlineCompletionTriggerKind=e.InlineCompletionList=e.InlineCompletionItem=e.StringValue=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(g){function R(_){return typeof _=="string"}g.is=R})(t||(e.DocumentUri=t={}));var n;(function(g){function R(_){return typeof _=="string"}g.is=R})(n||(e.URI=n={}));var i;(function(g){g.MIN_VALUE=-2147483648,g.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&g.MIN_VALUE<=_&&_<=g.MAX_VALUE}g.is=R})(i||(e.integer=i={}));var s;(function(g){g.MIN_VALUE=0,g.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&g.MIN_VALUE<=_&&_<=g.MAX_VALUE}g.is=R})(s||(e.uinteger=s={}));var o;(function(g){function R(b,f){return b===Number.MAX_VALUE&&(b=s.MAX_VALUE),f===Number.MAX_VALUE&&(f=s.MAX_VALUE),{line:b,character:f}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&D.uinteger(f.line)&&D.uinteger(f.character)}g.is=_})(o||(e.Position=o={}));var a;(function(g){function R(b,f,E,N){if(D.uinteger(b)&&D.uinteger(f)&&D.uinteger(E)&&D.uinteger(N))return{start:o.create(b,f),end:o.create(E,N)};if(o.is(b)&&o.is(f))return{start:b,end:f};throw new Error("Range#create called with invalid arguments[".concat(b,", ").concat(f,", ").concat(E,", ").concat(N,"]"))}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&o.is(f.start)&&o.is(f.end)}g.is=_})(a||(e.Range=a={}));var c;(function(g){function R(b,f){return{uri:b,range:f}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&a.is(f.range)&&(D.string(f.uri)||D.undefined(f.uri))}g.is=_})(c||(e.Location=c={}));var d;(function(g){function R(b,f,E,N){return{targetUri:b,targetRange:f,targetSelectionRange:E,originSelectionRange:N}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&a.is(f.targetRange)&&D.string(f.targetUri)&&a.is(f.targetSelectionRange)&&(a.is(f.originSelectionRange)||D.undefined(f.originSelectionRange))}g.is=_})(d||(e.LocationLink=d={}));var h;(function(g){function R(b,f,E,N){return{red:b,green:f,blue:E,alpha:N}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&D.numberRange(f.red,0,1)&&D.numberRange(f.green,0,1)&&D.numberRange(f.blue,0,1)&&D.numberRange(f.alpha,0,1)}g.is=_})(h||(e.Color=h={}));var m;(function(g){function R(b,f){return{range:b,color:f}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&a.is(f.range)&&h.is(f.color)}g.is=_})(m||(e.ColorInformation=m={}));var v;(function(g){function R(b,f,E){return{label:b,textEdit:f,additionalTextEdits:E}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&D.string(f.label)&&(D.undefined(f.textEdit)||B.is(f))&&(D.undefined(f.additionalTextEdits)||D.typedArray(f.additionalTextEdits,B.is))}g.is=_})(v||(e.ColorPresentation=v={}));var S;(function(g){g.Comment="comment",g.Imports="imports",g.Region="region"})(S||(e.FoldingRangeKind=S={}));var y;(function(g){function R(b,f,E,N,ge,it){var ze={startLine:b,endLine:f};return D.defined(E)&&(ze.startCharacter=E),D.defined(N)&&(ze.endCharacter=N),D.defined(ge)&&(ze.kind=ge),D.defined(it)&&(ze.collapsedText=it),ze}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&D.uinteger(f.startLine)&&D.uinteger(f.startLine)&&(D.undefined(f.startCharacter)||D.uinteger(f.startCharacter))&&(D.undefined(f.endCharacter)||D.uinteger(f.endCharacter))&&(D.undefined(f.kind)||D.string(f.kind))}g.is=_})(y||(e.FoldingRange=y={}));var P;(function(g){function R(b,f){return{location:b,message:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&c.is(f.location)&&D.string(f.message)}g.is=_})(P||(e.DiagnosticRelatedInformation=P={}));var x;(function(g){g.Error=1,g.Warning=2,g.Information=3,g.Hint=4})(x||(e.DiagnosticSeverity=x={}));var $;(function(g){g.Unnecessary=1,g.Deprecated=2})($||(e.DiagnosticTag=$={}));var U;(function(g){function R(_){var b=_;return D.objectLiteral(b)&&D.string(b.href)}g.is=R})(U||(e.CodeDescription=U={}));var M;(function(g){function R(b,f,E,N,ge,it){var ze={range:b,message:f};return D.defined(E)&&(ze.severity=E),D.defined(N)&&(ze.code=N),D.defined(ge)&&(ze.source=ge),D.defined(it)&&(ze.relatedInformation=it),ze}g.create=R;function _(b){var f,E=b;return D.defined(E)&&a.is(E.range)&&D.string(E.message)&&(D.number(E.severity)||D.undefined(E.severity))&&(D.integer(E.code)||D.string(E.code)||D.undefined(E.code))&&(D.undefined(E.codeDescription)||D.string((f=E.codeDescription)===null||f===void 0?void 0:f.href))&&(D.string(E.source)||D.undefined(E.source))&&(D.undefined(E.relatedInformation)||D.typedArray(E.relatedInformation,P.is))}g.is=_})(M||(e.Diagnostic=M={}));var K;(function(g){function R(b,f){for(var E=[],N=2;N<arguments.length;N++)E[N-2]=arguments[N];var ge={title:b,command:f};return D.defined(E)&&E.length>0&&(ge.arguments=E),ge}g.create=R;function _(b){var f=b;return D.defined(f)&&D.string(f.title)&&D.string(f.command)}g.is=_})(K||(e.Command=K={}));var B;(function(g){function R(E,N){return{range:E,newText:N}}g.replace=R;function _(E,N){return{range:{start:E,end:E},newText:N}}g.insert=_;function b(E){return{range:E,newText:""}}g.del=b;function f(E){var N=E;return D.objectLiteral(N)&&D.string(N.newText)&&a.is(N.range)}g.is=f})(B||(e.TextEdit=B={}));var pe;(function(g){function R(b,f,E){var N={label:b};return f!==void 0&&(N.needsConfirmation=f),E!==void 0&&(N.description=E),N}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&D.string(f.label)&&(D.boolean(f.needsConfirmation)||f.needsConfirmation===void 0)&&(D.string(f.description)||f.description===void 0)}g.is=_})(pe||(e.ChangeAnnotation=pe={}));var J;(function(g){function R(_){var b=_;return D.string(b)}g.is=R})(J||(e.ChangeAnnotationIdentifier=J={}));var ae;(function(g){function R(E,N,ge){return{range:E,newText:N,annotationId:ge}}g.replace=R;function _(E,N,ge){return{range:{start:E,end:E},newText:N,annotationId:ge}}g.insert=_;function b(E,N){return{range:E,newText:"",annotationId:N}}g.del=b;function f(E){var N=E;return B.is(N)&&(pe.is(N.annotationId)||J.is(N.annotationId))}g.is=f})(ae||(e.AnnotatedTextEdit=ae={}));var Re;(function(g){function R(b,f){return{textDocument:b,edits:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&$e.is(f.textDocument)&&Array.isArray(f.edits)}g.is=_})(Re||(e.TextDocumentEdit=Re={}));var rt;(function(g){function R(b,f,E){var N={kind:"create",uri:b};return f!==void 0&&(f.overwrite!==void 0||f.ignoreIfExists!==void 0)&&(N.options=f),E!==void 0&&(N.annotationId=E),N}g.create=R;function _(b){var f=b;return f&&f.kind==="create"&&D.string(f.uri)&&(f.options===void 0||(f.options.overwrite===void 0||D.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||D.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})(rt||(e.CreateFile=rt={}));var Ze;(function(g){function R(b,f,E,N){var ge={kind:"rename",oldUri:b,newUri:f};return E!==void 0&&(E.overwrite!==void 0||E.ignoreIfExists!==void 0)&&(ge.options=E),N!==void 0&&(ge.annotationId=N),ge}g.create=R;function _(b){var f=b;return f&&f.kind==="rename"&&D.string(f.oldUri)&&D.string(f.newUri)&&(f.options===void 0||(f.options.overwrite===void 0||D.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||D.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})(Ze||(e.RenameFile=Ze={}));var je;(function(g){function R(b,f,E){var N={kind:"delete",uri:b};return f!==void 0&&(f.recursive!==void 0||f.ignoreIfNotExists!==void 0)&&(N.options=f),E!==void 0&&(N.annotationId=E),N}g.create=R;function _(b){var f=b;return f&&f.kind==="delete"&&D.string(f.uri)&&(f.options===void 0||(f.options.recursive===void 0||D.boolean(f.options.recursive))&&(f.options.ignoreIfNotExists===void 0||D.boolean(f.options.ignoreIfNotExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})(je||(e.DeleteFile=je={}));var Zt;(function(g){function R(_){var b=_;return b&&(b.changes!==void 0||b.documentChanges!==void 0)&&(b.documentChanges===void 0||b.documentChanges.every(function(f){return D.string(f.kind)?rt.is(f)||Ze.is(f)||je.is(f):Re.is(f)}))}g.is=R})(Zt||(e.WorkspaceEdit=Zt={}));var Nt=function(){function g(R,_){this.edits=R,this.changeAnnotations=_}return g.prototype.insert=function(R,_,b){var f,E;if(b===void 0?f=B.insert(R,_):J.is(b)?(E=b,f=ae.insert(R,_,b)):(this.assertChangeAnnotations(this.changeAnnotations),E=this.changeAnnotations.manage(b),f=ae.insert(R,_,E)),this.edits.push(f),E!==void 0)return E},g.prototype.replace=function(R,_,b){var f,E;if(b===void 0?f=B.replace(R,_):J.is(b)?(E=b,f=ae.replace(R,_,b)):(this.assertChangeAnnotations(this.changeAnnotations),E=this.changeAnnotations.manage(b),f=ae.replace(R,_,E)),this.edits.push(f),E!==void 0)return E},g.prototype.delete=function(R,_){var b,f;if(_===void 0?b=B.del(R):J.is(_)?(f=_,b=ae.del(R,_)):(this.assertChangeAnnotations(this.changeAnnotations),f=this.changeAnnotations.manage(_),b=ae.del(R,f)),this.edits.push(b),f!==void 0)return f},g.prototype.add=function(R){this.edits.push(R)},g.prototype.all=function(){return this.edits},g.prototype.clear=function(){this.edits.splice(0,this.edits.length)},g.prototype.assertChangeAnnotations=function(R){if(R===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},g}(),Dt=function(){function g(R){this._annotations=R===void 0?Object.create(null):R,this._counter=0,this._size=0}return g.prototype.all=function(){return this._annotations},Object.defineProperty(g.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),g.prototype.manage=function(R,_){var b;if(J.is(R)?b=R:(b=this.nextId(),_=R),this._annotations[b]!==void 0)throw new Error("Id ".concat(b," is already in use."));if(_===void 0)throw new Error("No annotation provided for id ".concat(b));return this._annotations[b]=_,this._size++,b},g.prototype.nextId=function(){return this._counter++,this._counter.toString()},g}(),Pt=function(){function g(R){var _=this;this._textEditChanges=Object.create(null),R!==void 0?(this._workspaceEdit=R,R.documentChanges?(this._changeAnnotations=new Dt(R.changeAnnotations),R.changeAnnotations=this._changeAnnotations.all(),R.documentChanges.forEach(function(b){if(Re.is(b)){var f=new Nt(b.edits,_._changeAnnotations);_._textEditChanges[b.textDocument.uri]=f}})):R.changes&&Object.keys(R.changes).forEach(function(b){var f=new Nt(R.changes[b]);_._textEditChanges[b]=f})):this._workspaceEdit={}}return Object.defineProperty(g.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),g.prototype.getTextEditChange=function(R){if($e.is(R)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _={uri:R.uri,version:R.version},b=this._textEditChanges[_.uri];if(!b){var f=[],E={textDocument:_,edits:f};this._workspaceEdit.documentChanges.push(E),b=new Nt(f,this._changeAnnotations),this._textEditChanges[_.uri]=b}return b}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var b=this._textEditChanges[R];if(!b){var f=[];this._workspaceEdit.changes[R]=f,b=new Nt(f),this._textEditChanges[R]=b}return b}},g.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new Dt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},g.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},g.prototype.createFile=function(R,_,b){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:b=_;var E,N;if(f===void 0?E=rt.create(R,b):(N=J.is(f)?f:this._changeAnnotations.manage(f),E=rt.create(R,b,N)),this._workspaceEdit.documentChanges.push(E),N!==void 0)return N},g.prototype.renameFile=function(R,_,b,f){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var E;pe.is(b)||J.is(b)?E=b:f=b;var N,ge;if(E===void 0?N=Ze.create(R,_,f):(ge=J.is(E)?E:this._changeAnnotations.manage(E),N=Ze.create(R,_,f,ge)),this._workspaceEdit.documentChanges.push(N),ge!==void 0)return ge},g.prototype.deleteFile=function(R,_,b){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:b=_;var E,N;if(f===void 0?E=je.create(R,b):(N=J.is(f)?f:this._changeAnnotations.manage(f),E=je.create(R,b,N)),this._workspaceEdit.documentChanges.push(E),N!==void 0)return N},g}();e.WorkspaceChange=Pt;var bn;(function(g){function R(b){return{uri:b}}g.create=R;function _(b){var f=b;return D.defined(f)&&D.string(f.uri)}g.is=_})(bn||(e.TextDocumentIdentifier=bn={}));var wn;(function(g){function R(b,f){return{uri:b,version:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&D.string(f.uri)&&D.integer(f.version)}g.is=_})(wn||(e.VersionedTextDocumentIdentifier=wn={}));var $e;(function(g){function R(b,f){return{uri:b,version:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&D.string(f.uri)&&(f.version===null||D.integer(f.version))}g.is=_})($e||(e.OptionalVersionedTextDocumentIdentifier=$e={}));var wt;(function(g){function R(b,f,E,N){return{uri:b,languageId:f,version:E,text:N}}g.create=R;function _(b){var f=b;return D.defined(f)&&D.string(f.uri)&&D.string(f.languageId)&&D.integer(f.version)&&D.string(f.text)}g.is=_})(wt||(e.TextDocumentItem=wt={}));var It;(function(g){g.PlainText="plaintext",g.Markdown="markdown";function R(_){var b=_;return b===g.PlainText||b===g.Markdown}g.is=R})(It||(e.MarkupKind=It={}));var kt;(function(g){function R(_){var b=_;return D.objectLiteral(_)&&It.is(b.kind)&&D.string(b.value)}g.is=R})(kt||(e.MarkupContent=kt={}));var cr;(function(g){g.Text=1,g.Method=2,g.Function=3,g.Constructor=4,g.Field=5,g.Variable=6,g.Class=7,g.Interface=8,g.Module=9,g.Property=10,g.Unit=11,g.Value=12,g.Enum=13,g.Keyword=14,g.Snippet=15,g.Color=16,g.File=17,g.Reference=18,g.Folder=19,g.EnumMember=20,g.Constant=21,g.Struct=22,g.Event=23,g.Operator=24,g.TypeParameter=25})(cr||(e.CompletionItemKind=cr={}));var Cn;(function(g){g.PlainText=1,g.Snippet=2})(Cn||(e.InsertTextFormat=Cn={}));var Rn;(function(g){g.Deprecated=1})(Rn||(e.CompletionItemTag=Rn={}));var Qn;(function(g){function R(b,f,E){return{newText:b,insert:f,replace:E}}g.create=R;function _(b){var f=b;return f&&D.string(f.newText)&&a.is(f.insert)&&a.is(f.replace)}g.is=_})(Qn||(e.InsertReplaceEdit=Qn={}));var ur;(function(g){g.asIs=1,g.adjustIndentation=2})(ur||(e.InsertTextMode=ur={}));var An;(function(g){function R(_){var b=_;return b&&(D.string(b.detail)||b.detail===void 0)&&(D.string(b.description)||b.description===void 0)}g.is=R})(An||(e.CompletionItemLabelDetails=An={}));var Sn;(function(g){function R(_){return{label:_}}g.create=R})(Sn||(e.CompletionItem=Sn={}));var _n;(function(g){function R(_,b){return{items:_||[],isIncomplete:!!b}}g.create=R})(_n||(e.CompletionList=_n={}));var jn;(function(g){function R(b){return b.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}g.fromPlainText=R;function _(b){var f=b;return D.string(f)||D.objectLiteral(f)&&D.string(f.language)&&D.string(f.value)}g.is=_})(jn||(e.MarkedString=jn={}));var Ue;(function(g){function R(_){var b=_;return!!b&&D.objectLiteral(b)&&(kt.is(b.contents)||jn.is(b.contents)||D.typedArray(b.contents,jn.is))&&(_.range===void 0||a.is(_.range))}g.is=R})(Ue||(e.Hover=Ue={}));var Yn;(function(g){function R(_,b){return b?{label:_,documentation:b}:{label:_}}g.create=R})(Yn||(e.ParameterInformation=Yn={}));var Tn;(function(g){function R(_,b){for(var f=[],E=2;E<arguments.length;E++)f[E-2]=arguments[E];var N={label:_};return D.defined(b)&&(N.documentation=b),D.defined(f)?N.parameters=f:N.parameters=[],N}g.create=R})(Tn||(e.SignatureInformation=Tn={}));var At;(function(g){g.Text=1,g.Read=2,g.Write=3})(At||(e.DocumentHighlightKind=At={}));var dr;(function(g){function R(_,b){var f={range:_};return D.number(b)&&(f.kind=b),f}g.create=R})(dr||(e.DocumentHighlight=dr={}));var Wt;(function(g){g.File=1,g.Module=2,g.Namespace=3,g.Package=4,g.Class=5,g.Method=6,g.Property=7,g.Field=8,g.Constructor=9,g.Enum=10,g.Interface=11,g.Function=12,g.Variable=13,g.Constant=14,g.String=15,g.Number=16,g.Boolean=17,g.Array=18,g.Object=19,g.Key=20,g.Null=21,g.EnumMember=22,g.Struct=23,g.Event=24,g.Operator=25,g.TypeParameter=26})(Wt||(e.SymbolKind=Wt={}));var $n;(function(g){g.Deprecated=1})($n||(e.SymbolTag=$n={}));var Ke;(function(g){function R(_,b,f,E,N){var ge={name:_,kind:b,location:{uri:E,range:f}};return N&&(ge.containerName=N),ge}g.create=R})(Ke||(e.SymbolInformation=Ke={}));var gt;(function(g){function R(_,b,f,E){return E!==void 0?{name:_,kind:b,location:{uri:f,range:E}}:{name:_,kind:b,location:{uri:f}}}g.create=R})(gt||(e.WorkspaceSymbol=gt={}));var Et;(function(g){function R(b,f,E,N,ge,it){var ze={name:b,detail:f,kind:E,range:N,selectionRange:ge};return it!==void 0&&(ze.children=it),ze}g.create=R;function _(b){var f=b;return f&&D.string(f.name)&&D.number(f.kind)&&a.is(f.range)&&a.is(f.selectionRange)&&(f.detail===void 0||D.string(f.detail))&&(f.deprecated===void 0||D.boolean(f.deprecated))&&(f.children===void 0||Array.isArray(f.children))&&(f.tags===void 0||Array.isArray(f.tags))}g.is=_})(Et||(e.DocumentSymbol=Et={}));var en;(function(g){g.Empty="",g.QuickFix="quickfix",g.Refactor="refactor",g.RefactorExtract="refactor.extract",g.RefactorInline="refactor.inline",g.RefactorRewrite="refactor.rewrite",g.Source="source",g.SourceOrganizeImports="source.organizeImports",g.SourceFixAll="source.fixAll"})(en||(e.CodeActionKind=en={}));var Rt;(function(g){g.Invoked=1,g.Automatic=2})(Rt||(e.CodeActionTriggerKind=Rt={}));var Dn;(function(g){function R(b,f,E){var N={diagnostics:b};return f!=null&&(N.only=f),E!=null&&(N.triggerKind=E),N}g.create=R;function _(b){var f=b;return D.defined(f)&&D.typedArray(f.diagnostics,M.is)&&(f.only===void 0||D.typedArray(f.only,D.string))&&(f.triggerKind===void 0||f.triggerKind===Rt.Invoked||f.triggerKind===Rt.Automatic)}g.is=_})(Dn||(e.CodeActionContext=Dn={}));var Un;(function(g){function R(b,f,E){var N={title:b},ge=!0;return typeof f=="string"?(ge=!1,N.kind=f):K.is(f)?N.command=f:N.edit=f,ge&&E!==void 0&&(N.kind=E),N}g.create=R;function _(b){var f=b;return f&&D.string(f.title)&&(f.diagnostics===void 0||D.typedArray(f.diagnostics,M.is))&&(f.kind===void 0||D.string(f.kind))&&(f.edit!==void 0||f.command!==void 0)&&(f.command===void 0||K.is(f.command))&&(f.isPreferred===void 0||D.boolean(f.isPreferred))&&(f.edit===void 0||Zt.is(f.edit))}g.is=_})(Un||(e.CodeAction=Un={}));var tn;(function(g){function R(b,f){var E={range:b};return D.defined(f)&&(E.data=f),E}g.create=R;function _(b){var f=b;return D.defined(f)&&a.is(f.range)&&(D.undefined(f.command)||K.is(f.command))}g.is=_})(tn||(e.CodeLens=tn={}));var Wn;(function(g){function R(b,f){return{tabSize:b,insertSpaces:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&D.uinteger(f.tabSize)&&D.boolean(f.insertSpaces)}g.is=_})(Wn||(e.FormattingOptions=Wn={}));var mt;(function(g){function R(b,f,E){return{range:b,target:f,data:E}}g.create=R;function _(b){var f=b;return D.defined(f)&&a.is(f.range)&&(D.undefined(f.target)||D.string(f.target))}g.is=_})(mt||(e.DocumentLink=mt={}));var l;(function(g){function R(b,f){return{range:b,parent:f}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&a.is(f.range)&&(f.parent===void 0||g.is(f.parent))}g.is=_})(l||(e.SelectionRange=l={}));var C;(function(g){g.namespace="namespace",g.type="type",g.class="class",g.enum="enum",g.interface="interface",g.struct="struct",g.typeParameter="typeParameter",g.parameter="parameter",g.variable="variable",g.property="property",g.enumMember="enumMember",g.event="event",g.function="function",g.method="method",g.macro="macro",g.keyword="keyword",g.modifier="modifier",g.comment="comment",g.string="string",g.number="number",g.regexp="regexp",g.operator="operator",g.decorator="decorator"})(C||(e.SemanticTokenTypes=C={}));var k;(function(g){g.declaration="declaration",g.definition="definition",g.readonly="readonly",g.static="static",g.deprecated="deprecated",g.abstract="abstract",g.async="async",g.modification="modification",g.documentation="documentation",g.defaultLibrary="defaultLibrary"})(k||(e.SemanticTokenModifiers=k={}));var O;(function(g){function R(_){var b=_;return D.objectLiteral(b)&&(b.resultId===void 0||typeof b.resultId=="string")&&Array.isArray(b.data)&&(b.data.length===0||typeof b.data[0]=="number")}g.is=R})(O||(e.SemanticTokens=O={}));var ne;(function(g){function R(b,f){return{range:b,text:f}}g.create=R;function _(b){var f=b;return f!=null&&a.is(f.range)&&D.string(f.text)}g.is=_})(ne||(e.InlineValueText=ne={}));var ee;(function(g){function R(b,f,E){return{range:b,variableName:f,caseSensitiveLookup:E}}g.create=R;function _(b){var f=b;return f!=null&&a.is(f.range)&&D.boolean(f.caseSensitiveLookup)&&(D.string(f.variableName)||f.variableName===void 0)}g.is=_})(ee||(e.InlineValueVariableLookup=ee={}));var oe;(function(g){function R(b,f){return{range:b,expression:f}}g.create=R;function _(b){var f=b;return f!=null&&a.is(f.range)&&(D.string(f.expression)||f.expression===void 0)}g.is=_})(oe||(e.InlineValueEvaluatableExpression=oe={}));var ce;(function(g){function R(b,f){return{frameId:b,stoppedLocation:f}}g.create=R;function _(b){var f=b;return D.defined(f)&&a.is(b.stoppedLocation)}g.is=_})(ce||(e.InlineValueContext=ce={}));var G;(function(g){g.Type=1,g.Parameter=2;function R(_){return _===1||_===2}g.is=R})(G||(e.InlayHintKind=G={}));var re;(function(g){function R(b){return{value:b}}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&(f.tooltip===void 0||D.string(f.tooltip)||kt.is(f.tooltip))&&(f.location===void 0||c.is(f.location))&&(f.command===void 0||K.is(f.command))}g.is=_})(re||(e.InlayHintLabelPart=re={}));var Z;(function(g){function R(b,f,E){var N={position:b,label:f};return E!==void 0&&(N.kind=E),N}g.create=R;function _(b){var f=b;return D.objectLiteral(f)&&o.is(f.position)&&(D.string(f.label)||D.typedArray(f.label,re.is))&&(f.kind===void 0||G.is(f.kind))&&f.textEdits===void 0||D.typedArray(f.textEdits,B.is)&&(f.tooltip===void 0||D.string(f.tooltip)||kt.is(f.tooltip))&&(f.paddingLeft===void 0||D.boolean(f.paddingLeft))&&(f.paddingRight===void 0||D.boolean(f.paddingRight))}g.is=_})(Z||(e.InlayHint=Z={}));var he;(function(g){function R(_){return{kind:"snippet",value:_}}g.createSnippet=R})(he||(e.StringValue=he={}));var _e;(function(g){function R(_,b,f,E){return{insertText:_,filterText:b,range:f,command:E}}g.create=R})(_e||(e.InlineCompletionItem=_e={}));var We;(function(g){function R(_){return{items:_}}g.create=R})(We||(e.InlineCompletionList=We={}));var lr;(function(g){g.Invoked=0,g.Automatic=1})(lr||(e.InlineCompletionTriggerKind=lr={}));var qr;(function(g){function R(_,b){return{range:_,text:b}}g.create=R})(qr||(e.SelectedCompletionInfo=qr={}));var p;(function(g){function R(_,b){return{triggerKind:_,selectedCompletionInfo:b}}g.create=R})(p||(e.InlineCompletionContext=p={}));var q;(function(g){function R(_){var b=_;return D.objectLiteral(b)&&n.is(b.uri)&&D.string(b.name)}g.is=R})(q||(e.WorkspaceFolder=q={})),e.EOL=[`
`,`\r
`,"\r"];var Y;(function(g){function R(E,N,ge,it){return new Oe(E,N,ge,it)}g.create=R;function _(E){var N=E;return!!(D.defined(N)&&D.string(N.uri)&&(D.undefined(N.languageId)||D.string(N.languageId))&&D.uinteger(N.lineCount)&&D.func(N.getText)&&D.func(N.positionAt)&&D.func(N.offsetAt))}g.is=_;function b(E,N){for(var ge=E.getText(),it=f(N,function(fr,u){var T=fr.range.start.line-u.range.start.line;return T===0?fr.range.start.character-u.range.start.character:T}),ze=ge.length,an=it.length-1;an>=0;an--){var Pn=it[an],Zn=E.offsetAt(Pn.range.start),De=E.offsetAt(Pn.range.end);if(De<=ze)ge=ge.substring(0,Zn)+Pn.newText+ge.substring(De,ge.length);else throw new Error("Overlapping edit");ze=Zn}return ge}g.applyEdits=b;function f(E,N){if(E.length<=1)return E;var ge=E.length/2|0,it=E.slice(0,ge),ze=E.slice(ge);f(it,N),f(ze,N);for(var an=0,Pn=0,Zn=0;an<it.length&&Pn<ze.length;){var De=N(it[an],ze[Pn]);De<=0?E[Zn++]=it[an++]:E[Zn++]=ze[Pn++]}for(;an<it.length;)E[Zn++]=it[an++];for(;Pn<ze.length;)E[Zn++]=ze[Pn++];return E}})(Y||(e.TextDocument=Y={}));var Oe=function(){function g(R,_,b,f){this._uri=R,this._languageId=_,this._version=b,this._content=f,this._lineOffsets=void 0}return Object.defineProperty(g.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),g.prototype.getText=function(R){if(R){var _=this.offsetAt(R.start),b=this.offsetAt(R.end);return this._content.substring(_,b)}return this._content},g.prototype.update=function(R,_){this._content=R.text,this._version=_,this._lineOffsets=void 0},g.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var R=[],_=this._content,b=!0,f=0;f<_.length;f++){b&&(R.push(f),b=!1);var E=_.charAt(f);b=E==="\r"||E===`
`,E==="\r"&&f+1<_.length&&_.charAt(f+1)===`
`&&f++}b&&_.length>0&&R.push(_.length),this._lineOffsets=R}return this._lineOffsets},g.prototype.positionAt=function(R){R=Math.max(Math.min(R,this._content.length),0);var _=this.getLineOffsets(),b=0,f=_.length;if(f===0)return o.create(0,R);for(;b<f;){var E=Math.floor((b+f)/2);_[E]>R?f=E:b=E+1}var N=b-1;return o.create(N,R-_[N])},g.prototype.offsetAt=function(R){var _=this.getLineOffsets();if(R.line>=_.length)return this._content.length;if(R.line<0)return 0;var b=_[R.line],f=R.line+1<_.length?_[R.line+1]:this._content.length;return Math.max(Math.min(b+R.character,f),b)},Object.defineProperty(g.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),g}(),D;(function(g){var R=Object.prototype.toString;function _(De){return typeof De<"u"}g.defined=_;function b(De){return typeof De>"u"}g.undefined=b;function f(De){return De===!0||De===!1}g.boolean=f;function E(De){return R.call(De)==="[object String]"}g.string=E;function N(De){return R.call(De)==="[object Number]"}g.number=N;function ge(De,fr,u){return R.call(De)==="[object Number]"&&fr<=De&&De<=u}g.numberRange=ge;function it(De){return R.call(De)==="[object Number]"&&-2147483648<=De&&De<=2147483647}g.integer=it;function ze(De){return R.call(De)==="[object Number]"&&0<=De&&De<=2147483647}g.uinteger=ze;function an(De){return R.call(De)==="[object Function]"}g.func=an;function Pn(De){return De!==null&&typeof De=="object"}g.objectLiteral=Pn;function Zn(De,fr){return Array.isArray(De)&&De.every(fr)}g.typedArray=Zn})(D||(D={}))})});var st=I(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.ProtocolNotificationType=un.ProtocolNotificationType0=un.ProtocolRequestType=un.ProtocolRequestType0=un.RegistrationType=un.MessageDirection=void 0;var Oi=oi(),$g;(function(r){r.clientToServer="clientToServer",r.serverToClient="serverToClient",r.both="both"})($g||(un.MessageDirection=$g={}));var ud=class{constructor(e){this.method=e}};un.RegistrationType=ud;var dd=class extends Oi.RequestType0{constructor(e){super(e)}};un.ProtocolRequestType0=dd;var ld=class extends Oi.RequestType{constructor(e){super(e,Oi.ParameterStructures.byName)}};un.ProtocolRequestType=ld;var fd=class extends Oi.NotificationType0{constructor(e){super(e)}};un.ProtocolNotificationType0=fd;var hd=class extends Oi.NotificationType{constructor(e){super(e,Oi.ParameterStructures.byName)}};un.ProtocolNotificationType=hd});var jo=I(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.objectLiteral=St.typedArray=St.stringArray=St.array=St.func=St.error=St.number=St.string=St.boolean=void 0;function PS(r){return r===!0||r===!1}St.boolean=PS;function Ug(r){return typeof r=="string"||r instanceof String}St.string=Ug;function kS(r){return typeof r=="number"||r instanceof Number}St.number=kS;function ES(r){return r instanceof Error}St.error=ES;function xS(r){return typeof r=="function"}St.func=xS;function Wg(r){return Array.isArray(r)}St.array=Wg;function IS(r){return Wg(r)&&r.every(e=>Ug(e))}St.stringArray=IS;function qS(r,e){return Array.isArray(r)&&r.every(e)}St.typedArray=qS;function OS(r){return r!==null&&typeof r=="object"}St.objectLiteral=OS});var Kg=I($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.ImplementationRequest=void 0;var Hg=st(),Vg;(function(r){r.method="textDocument/implementation",r.messageDirection=Hg.MessageDirection.clientToServer,r.type=new Hg.ProtocolRequestType(r.method)})(Vg||($o.ImplementationRequest=Vg={}))});var Gg=I(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.TypeDefinitionRequest=void 0;var zg=st(),Bg;(function(r){r.method="textDocument/typeDefinition",r.messageDirection=zg.MessageDirection.clientToServer,r.type=new zg.ProtocolRequestType(r.method)})(Bg||(Uo.TypeDefinitionRequest=Bg={}))});var Qg=I(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.DidChangeWorkspaceFoldersNotification=Fi.WorkspaceFoldersRequest=void 0;var Wo=st(),Jg;(function(r){r.method="workspace/workspaceFolders",r.messageDirection=Wo.MessageDirection.serverToClient,r.type=new Wo.ProtocolRequestType0(r.method)})(Jg||(Fi.WorkspaceFoldersRequest=Jg={}));var Xg;(function(r){r.method="workspace/didChangeWorkspaceFolders",r.messageDirection=Wo.MessageDirection.clientToServer,r.type=new Wo.ProtocolNotificationType(r.method)})(Xg||(Fi.DidChangeWorkspaceFoldersNotification=Xg={}))});var em=I(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.ConfigurationRequest=void 0;var Yg=st(),Zg;(function(r){r.method="workspace/configuration",r.messageDirection=Yg.MessageDirection.serverToClient,r.type=new Yg.ProtocolRequestType(r.method)})(Zg||(Ho.ConfigurationRequest=Zg={}))});var rm=I(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.ColorPresentationRequest=Li.DocumentColorRequest=void 0;var Vo=st(),tm;(function(r){r.method="textDocument/documentColor",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(tm||(Li.DocumentColorRequest=tm={}));var nm;(function(r){r.method="textDocument/colorPresentation",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(nm||(Li.ColorPresentationRequest=nm={}))});var om=I(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.FoldingRangeRefreshRequest=Mi.FoldingRangeRequest=void 0;var Ko=st(),im;(function(r){r.method="textDocument/foldingRange",r.messageDirection=Ko.MessageDirection.clientToServer,r.type=new Ko.ProtocolRequestType(r.method)})(im||(Mi.FoldingRangeRequest=im={}));var sm;(function(r){r.method="workspace/foldingRange/refresh",r.messageDirection=Ko.MessageDirection.serverToClient,r.type=new Ko.ProtocolRequestType0(r.method)})(sm||(Mi.FoldingRangeRefreshRequest=sm={}))});var um=I(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.DeclarationRequest=void 0;var am=st(),cm;(function(r){r.method="textDocument/declaration",r.messageDirection=am.MessageDirection.clientToServer,r.type=new am.ProtocolRequestType(r.method)})(cm||(zo.DeclarationRequest=cm={}))});var fm=I(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.SelectionRangeRequest=void 0;var dm=st(),lm;(function(r){r.method="textDocument/selectionRange",r.messageDirection=dm.MessageDirection.clientToServer,r.type=new dm.ProtocolRequestType(r.method)})(lm||(Bo.SelectionRangeRequest=lm={}))});var mm=I(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.WorkDoneProgressCancelNotification=Nr.WorkDoneProgressCreateRequest=Nr.WorkDoneProgress=void 0;var FS=oi(),Go=st(),hm;(function(r){r.type=new FS.ProgressType;function e(t){return t===r.type}r.is=e})(hm||(Nr.WorkDoneProgress=hm={}));var pm;(function(r){r.method="window/workDoneProgress/create",r.messageDirection=Go.MessageDirection.serverToClient,r.type=new Go.ProtocolRequestType(r.method)})(pm||(Nr.WorkDoneProgressCreateRequest=pm={}));var gm;(function(r){r.method="window/workDoneProgress/cancel",r.messageDirection=Go.MessageDirection.clientToServer,r.type=new Go.ProtocolNotificationType(r.method)})(gm||(Nr.WorkDoneProgressCancelNotification=gm={}))});var wm=I(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.CallHierarchyOutgoingCallsRequest=Ar.CallHierarchyIncomingCallsRequest=Ar.CallHierarchyPrepareRequest=void 0;var Ni=st(),vm;(function(r){r.method="textDocument/prepareCallHierarchy",r.messageDirection=Ni.MessageDirection.clientToServer,r.type=new Ni.ProtocolRequestType(r.method)})(vm||(Ar.CallHierarchyPrepareRequest=vm={}));var ym;(function(r){r.method="callHierarchy/incomingCalls",r.messageDirection=Ni.MessageDirection.clientToServer,r.type=new Ni.ProtocolRequestType(r.method)})(ym||(Ar.CallHierarchyIncomingCallsRequest=ym={}));var bm;(function(r){r.method="callHierarchy/outgoingCalls",r.messageDirection=Ni.MessageDirection.clientToServer,r.type=new Ni.ProtocolRequestType(r.method)})(bm||(Ar.CallHierarchyOutgoingCallsRequest=bm={}))});var Dm=I(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.SemanticTokensRefreshRequest=dn.SemanticTokensRangeRequest=dn.SemanticTokensDeltaRequest=dn.SemanticTokensRequest=dn.SemanticTokensRegistrationType=dn.TokenFormat=void 0;var Sr=st(),Cm;(function(r){r.Relative="relative"})(Cm||(dn.TokenFormat=Cm={}));var Ss;(function(r){r.method="textDocument/semanticTokens",r.type=new Sr.RegistrationType(r.method)})(Ss||(dn.SemanticTokensRegistrationType=Ss={}));var Rm;(function(r){r.method="textDocument/semanticTokens/full",r.messageDirection=Sr.MessageDirection.clientToServer,r.type=new Sr.ProtocolRequestType(r.method),r.registrationMethod=Ss.method})(Rm||(dn.SemanticTokensRequest=Rm={}));var Sm;(function(r){r.method="textDocument/semanticTokens/full/delta",r.messageDirection=Sr.MessageDirection.clientToServer,r.type=new Sr.ProtocolRequestType(r.method),r.registrationMethod=Ss.method})(Sm||(dn.SemanticTokensDeltaRequest=Sm={}));var _m;(function(r){r.method="textDocument/semanticTokens/range",r.messageDirection=Sr.MessageDirection.clientToServer,r.type=new Sr.ProtocolRequestType(r.method),r.registrationMethod=Ss.method})(_m||(dn.SemanticTokensRangeRequest=_m={}));var Tm;(function(r){r.method="workspace/semanticTokens/refresh",r.messageDirection=Sr.MessageDirection.serverToClient,r.type=new Sr.ProtocolRequestType0(r.method)})(Tm||(dn.SemanticTokensRefreshRequest=Tm={}))});var Em=I(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.ShowDocumentRequest=void 0;var Pm=st(),km;(function(r){r.method="window/showDocument",r.messageDirection=Pm.MessageDirection.serverToClient,r.type=new Pm.ProtocolRequestType(r.method)})(km||(Jo.ShowDocumentRequest=km={}))});var qm=I(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.LinkedEditingRangeRequest=void 0;var xm=st(),Im;(function(r){r.method="textDocument/linkedEditingRange",r.messageDirection=xm.MessageDirection.clientToServer,r.type=new xm.ProtocolRequestType(r.method)})(Im||(Xo.LinkedEditingRangeRequest=Im={}))});var $m=I(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.WillDeleteFilesRequest=Kt.DidDeleteFilesNotification=Kt.DidRenameFilesNotification=Kt.WillRenameFilesRequest=Kt.DidCreateFilesNotification=Kt.WillCreateFilesRequest=Kt.FileOperationPatternKind=void 0;var Vn=st(),Om;(function(r){r.file="file",r.folder="folder"})(Om||(Kt.FileOperationPatternKind=Om={}));var Fm;(function(r){r.method="workspace/willCreateFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolRequestType(r.method)})(Fm||(Kt.WillCreateFilesRequest=Fm={}));var Lm;(function(r){r.method="workspace/didCreateFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolNotificationType(r.method)})(Lm||(Kt.DidCreateFilesNotification=Lm={}));var Mm;(function(r){r.method="workspace/willRenameFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolRequestType(r.method)})(Mm||(Kt.WillRenameFilesRequest=Mm={}));var Nm;(function(r){r.method="workspace/didRenameFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolNotificationType(r.method)})(Nm||(Kt.DidRenameFilesNotification=Nm={}));var Am;(function(r){r.method="workspace/didDeleteFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolNotificationType(r.method)})(Am||(Kt.DidDeleteFilesNotification=Am={}));var jm;(function(r){r.method="workspace/willDeleteFiles",r.messageDirection=Vn.MessageDirection.clientToServer,r.type=new Vn.ProtocolRequestType(r.method)})(jm||(Kt.WillDeleteFilesRequest=jm={}))});var Km=I(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.MonikerRequest=jr.MonikerKind=jr.UniquenessLevel=void 0;var Um=st(),Wm;(function(r){r.document="document",r.project="project",r.group="group",r.scheme="scheme",r.global="global"})(Wm||(jr.UniquenessLevel=Wm={}));var Hm;(function(r){r.$import="import",r.$export="export",r.local="local"})(Hm||(jr.MonikerKind=Hm={}));var Vm;(function(r){r.method="textDocument/moniker",r.messageDirection=Um.MessageDirection.clientToServer,r.type=new Um.ProtocolRequestType(r.method)})(Vm||(jr.MonikerRequest=Vm={}))});var Jm=I($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.TypeHierarchySubtypesRequest=$r.TypeHierarchySupertypesRequest=$r.TypeHierarchyPrepareRequest=void 0;var Ai=st(),zm;(function(r){r.method="textDocument/prepareTypeHierarchy",r.messageDirection=Ai.MessageDirection.clientToServer,r.type=new Ai.ProtocolRequestType(r.method)})(zm||($r.TypeHierarchyPrepareRequest=zm={}));var Bm;(function(r){r.method="typeHierarchy/supertypes",r.messageDirection=Ai.MessageDirection.clientToServer,r.type=new Ai.ProtocolRequestType(r.method)})(Bm||($r.TypeHierarchySupertypesRequest=Bm={}));var Gm;(function(r){r.method="typeHierarchy/subtypes",r.messageDirection=Ai.MessageDirection.clientToServer,r.type=new Ai.ProtocolRequestType(r.method)})(Gm||($r.TypeHierarchySubtypesRequest=Gm={}))});var Ym=I(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.InlineValueRefreshRequest=ji.InlineValueRequest=void 0;var Qo=st(),Xm;(function(r){r.method="textDocument/inlineValue",r.messageDirection=Qo.MessageDirection.clientToServer,r.type=new Qo.ProtocolRequestType(r.method)})(Xm||(ji.InlineValueRequest=Xm={}));var Qm;(function(r){r.method="workspace/inlineValue/refresh",r.messageDirection=Qo.MessageDirection.serverToClient,r.type=new Qo.ProtocolRequestType0(r.method)})(Qm||(ji.InlineValueRefreshRequest=Qm={}))});var nv=I(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.InlayHintRefreshRequest=Ur.InlayHintResolveRequest=Ur.InlayHintRequest=void 0;var $i=st(),Zm;(function(r){r.method="textDocument/inlayHint",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Zm||(Ur.InlayHintRequest=Zm={}));var ev;(function(r){r.method="inlayHint/resolve",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(ev||(Ur.InlayHintResolveRequest=ev={}));var tv;(function(r){r.method="workspace/inlayHint/refresh",r.messageDirection=$i.MessageDirection.serverToClient,r.type=new $i.ProtocolRequestType0(r.method)})(tv||(Ur.InlayHintRefreshRequest=tv={}))});var uv=I(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.DiagnosticRefreshRequest=Kn.WorkspaceDiagnosticRequest=Kn.DocumentDiagnosticRequest=Kn.DocumentDiagnosticReportKind=Kn.DiagnosticServerCancellationData=void 0;var cv=oi(),LS=jo(),Ui=st(),rv;(function(r){function e(t){let n=t;return n&&LS.boolean(n.retriggerRequest)}r.is=e})(rv||(Kn.DiagnosticServerCancellationData=rv={}));var iv;(function(r){r.Full="full",r.Unchanged="unchanged"})(iv||(Kn.DocumentDiagnosticReportKind=iv={}));var sv;(function(r){r.method="textDocument/diagnostic",r.messageDirection=Ui.MessageDirection.clientToServer,r.type=new Ui.ProtocolRequestType(r.method),r.partialResult=new cv.ProgressType})(sv||(Kn.DocumentDiagnosticRequest=sv={}));var ov;(function(r){r.method="workspace/diagnostic",r.messageDirection=Ui.MessageDirection.clientToServer,r.type=new Ui.ProtocolRequestType(r.method),r.partialResult=new cv.ProgressType})(ov||(Kn.WorkspaceDiagnosticRequest=ov={}));var av;(function(r){r.method="workspace/diagnostic/refresh",r.messageDirection=Ui.MessageDirection.serverToClient,r.type=new Ui.ProtocolRequestType0(r.method)})(av||(Kn.DiagnosticRefreshRequest=av={}))});var mv=I(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.DidCloseNotebookDocumentNotification=yt.DidSaveNotebookDocumentNotification=yt.DidChangeNotebookDocumentNotification=yt.NotebookCellArrayChange=yt.DidOpenNotebookDocumentNotification=yt.NotebookDocumentSyncRegistrationType=yt.NotebookDocument=yt.NotebookCell=yt.ExecutionSummary=yt.NotebookCellKind=void 0;var _s=Ao(),tr=jo(),pr=st(),pd;(function(r){r.Markup=1,r.Code=2;function e(t){return t===1||t===2}r.is=e})(pd||(yt.NotebookCellKind=pd={}));var gd;(function(r){function e(i,s){let o={executionOrder:i};return(s===!0||s===!1)&&(o.success=s),o}r.create=e;function t(i){let s=i;return tr.objectLiteral(s)&&_s.uinteger.is(s.executionOrder)&&(s.success===void 0||tr.boolean(s.success))}r.is=t;function n(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}r.equals=n})(gd||(yt.ExecutionSummary=gd={}));var Yo;(function(r){function e(s,o){return{kind:s,document:o}}r.create=e;function t(s){let o=s;return tr.objectLiteral(o)&&pd.is(o.kind)&&_s.DocumentUri.is(o.document)&&(o.metadata===void 0||tr.objectLiteral(o.metadata))}r.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!i(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!gd.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}r.diff=n;function i(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let d=0;d<s.length;d++)if(!i(s[d],o[d]))return!1}if(tr.objectLiteral(s)&&tr.objectLiteral(o)){let d=Object.keys(s),h=Object.keys(o);if(d.length!==h.length||(d.sort(),h.sort(),!i(d,h)))return!1;for(let m=0;m<d.length;m++){let v=d[m];if(!i(s[v],o[v]))return!1}}return!0}})(Yo||(yt.NotebookCell=Yo={}));var dv;(function(r){function e(n,i,s,o){return{uri:n,notebookType:i,version:s,cells:o}}r.create=e;function t(n){let i=n;return tr.objectLiteral(i)&&tr.string(i.uri)&&_s.integer.is(i.version)&&tr.typedArray(i.cells,Yo.is)}r.is=t})(dv||(yt.NotebookDocument=dv={}));var Wi;(function(r){r.method="notebookDocument/sync",r.messageDirection=pr.MessageDirection.clientToServer,r.type=new pr.RegistrationType(r.method)})(Wi||(yt.NotebookDocumentSyncRegistrationType=Wi={}));var lv;(function(r){r.method="notebookDocument/didOpen",r.messageDirection=pr.MessageDirection.clientToServer,r.type=new pr.ProtocolNotificationType(r.method),r.registrationMethod=Wi.method})(lv||(yt.DidOpenNotebookDocumentNotification=lv={}));var fv;(function(r){function e(n){let i=n;return tr.objectLiteral(i)&&_s.uinteger.is(i.start)&&_s.uinteger.is(i.deleteCount)&&(i.cells===void 0||tr.typedArray(i.cells,Yo.is))}r.is=e;function t(n,i,s){let o={start:n,deleteCount:i};return s!==void 0&&(o.cells=s),o}r.create=t})(fv||(yt.NotebookCellArrayChange=fv={}));var hv;(function(r){r.method="notebookDocument/didChange",r.messageDirection=pr.MessageDirection.clientToServer,r.type=new pr.ProtocolNotificationType(r.method),r.registrationMethod=Wi.method})(hv||(yt.DidChangeNotebookDocumentNotification=hv={}));var pv;(function(r){r.method="notebookDocument/didSave",r.messageDirection=pr.MessageDirection.clientToServer,r.type=new pr.ProtocolNotificationType(r.method),r.registrationMethod=Wi.method})(pv||(yt.DidSaveNotebookDocumentNotification=pv={}));var gv;(function(r){r.method="notebookDocument/didClose",r.messageDirection=pr.MessageDirection.clientToServer,r.type=new pr.ProtocolNotificationType(r.method),r.registrationMethod=Wi.method})(gv||(yt.DidCloseNotebookDocumentNotification=gv={}))});var bv=I(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.InlineCompletionRequest=void 0;var vv=st(),yv;(function(r){r.method="textDocument/inlineCompletion",r.messageDirection=vv.MessageDirection.clientToServer,r.type=new vv.ProtocolRequestType(r.method)})(yv||(Zo.InlineCompletionRequest=yv={}))});var qy=I(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.WorkspaceSymbolRequest=w.CodeActionResolveRequest=w.CodeActionRequest=w.DocumentSymbolRequest=w.DocumentHighlightRequest=w.ReferencesRequest=w.DefinitionRequest=w.SignatureHelpRequest=w.SignatureHelpTriggerKind=w.HoverRequest=w.CompletionResolveRequest=w.CompletionRequest=w.CompletionTriggerKind=w.PublishDiagnosticsNotification=w.WatchKind=w.RelativePattern=w.FileChangeType=w.DidChangeWatchedFilesNotification=w.WillSaveTextDocumentWaitUntilRequest=w.WillSaveTextDocumentNotification=w.TextDocumentSaveReason=w.DidSaveTextDocumentNotification=w.DidCloseTextDocumentNotification=w.DidChangeTextDocumentNotification=w.TextDocumentContentChangeEvent=w.DidOpenTextDocumentNotification=w.TextDocumentSyncKind=w.TelemetryEventNotification=w.LogMessageNotification=w.ShowMessageRequest=w.ShowMessageNotification=w.MessageType=w.DidChangeConfigurationNotification=w.ExitNotification=w.ShutdownRequest=w.InitializedNotification=w.InitializeErrorCodes=w.InitializeRequest=w.WorkDoneProgressOptions=w.TextDocumentRegistrationOptions=w.StaticRegistrationOptions=w.PositionEncodingKind=w.FailureHandlingKind=w.ResourceOperationKind=w.UnregistrationRequest=w.RegistrationRequest=w.DocumentSelector=w.NotebookCellTextDocumentFilter=w.NotebookDocumentFilter=w.TextDocumentFilter=void 0;w.MonikerRequest=w.MonikerKind=w.UniquenessLevel=w.WillDeleteFilesRequest=w.DidDeleteFilesNotification=w.WillRenameFilesRequest=w.DidRenameFilesNotification=w.WillCreateFilesRequest=w.DidCreateFilesNotification=w.FileOperationPatternKind=w.LinkedEditingRangeRequest=w.ShowDocumentRequest=w.SemanticTokensRegistrationType=w.SemanticTokensRefreshRequest=w.SemanticTokensRangeRequest=w.SemanticTokensDeltaRequest=w.SemanticTokensRequest=w.TokenFormat=w.CallHierarchyPrepareRequest=w.CallHierarchyOutgoingCallsRequest=w.CallHierarchyIncomingCallsRequest=w.WorkDoneProgressCancelNotification=w.WorkDoneProgressCreateRequest=w.WorkDoneProgress=w.SelectionRangeRequest=w.DeclarationRequest=w.FoldingRangeRefreshRequest=w.FoldingRangeRequest=w.ColorPresentationRequest=w.DocumentColorRequest=w.ConfigurationRequest=w.DidChangeWorkspaceFoldersNotification=w.WorkspaceFoldersRequest=w.TypeDefinitionRequest=w.ImplementationRequest=w.ApplyWorkspaceEditRequest=w.ExecuteCommandRequest=w.PrepareRenameRequest=w.RenameRequest=w.PrepareSupportDefaultBehavior=w.DocumentOnTypeFormattingRequest=w.DocumentRangesFormattingRequest=w.DocumentRangeFormattingRequest=w.DocumentFormattingRequest=w.DocumentLinkResolveRequest=w.DocumentLinkRequest=w.CodeLensRefreshRequest=w.CodeLensResolveRequest=w.CodeLensRequest=w.WorkspaceSymbolResolveRequest=void 0;w.InlineCompletionRequest=w.DidCloseNotebookDocumentNotification=w.DidSaveNotebookDocumentNotification=w.DidChangeNotebookDocumentNotification=w.NotebookCellArrayChange=w.DidOpenNotebookDocumentNotification=w.NotebookDocumentSyncRegistrationType=w.NotebookDocument=w.NotebookCell=w.ExecutionSummary=w.NotebookCellKind=w.DiagnosticRefreshRequest=w.WorkspaceDiagnosticRequest=w.DocumentDiagnosticRequest=w.DocumentDiagnosticReportKind=w.DiagnosticServerCancellationData=w.InlayHintRefreshRequest=w.InlayHintResolveRequest=w.InlayHintRequest=w.InlineValueRefreshRequest=w.InlineValueRequest=w.TypeHierarchySupertypesRequest=w.TypeHierarchySubtypesRequest=w.TypeHierarchyPrepareRequest=void 0;var V=st(),wv=Ao(),Ot=jo(),MS=Kg();Object.defineProperty(w,"ImplementationRequest",{enumerable:!0,get:function(){return MS.ImplementationRequest}});var NS=Gg();Object.defineProperty(w,"TypeDefinitionRequest",{enumerable:!0,get:function(){return NS.TypeDefinitionRequest}});var ky=Qg();Object.defineProperty(w,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return ky.WorkspaceFoldersRequest}});Object.defineProperty(w,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return ky.DidChangeWorkspaceFoldersNotification}});var AS=em();Object.defineProperty(w,"ConfigurationRequest",{enumerable:!0,get:function(){return AS.ConfigurationRequest}});var Ey=rm();Object.defineProperty(w,"DocumentColorRequest",{enumerable:!0,get:function(){return Ey.DocumentColorRequest}});Object.defineProperty(w,"ColorPresentationRequest",{enumerable:!0,get:function(){return Ey.ColorPresentationRequest}});var xy=om();Object.defineProperty(w,"FoldingRangeRequest",{enumerable:!0,get:function(){return xy.FoldingRangeRequest}});Object.defineProperty(w,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return xy.FoldingRangeRefreshRequest}});var jS=um();Object.defineProperty(w,"DeclarationRequest",{enumerable:!0,get:function(){return jS.DeclarationRequest}});var $S=fm();Object.defineProperty(w,"SelectionRangeRequest",{enumerable:!0,get:function(){return $S.SelectionRangeRequest}});var wd=mm();Object.defineProperty(w,"WorkDoneProgress",{enumerable:!0,get:function(){return wd.WorkDoneProgress}});Object.defineProperty(w,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return wd.WorkDoneProgressCreateRequest}});Object.defineProperty(w,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return wd.WorkDoneProgressCancelNotification}});var Cd=wm();Object.defineProperty(w,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return Cd.CallHierarchyIncomingCallsRequest}});Object.defineProperty(w,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return Cd.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(w,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return Cd.CallHierarchyPrepareRequest}});var Hi=Dm();Object.defineProperty(w,"TokenFormat",{enumerable:!0,get:function(){return Hi.TokenFormat}});Object.defineProperty(w,"SemanticTokensRequest",{enumerable:!0,get:function(){return Hi.SemanticTokensRequest}});Object.defineProperty(w,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return Hi.SemanticTokensDeltaRequest}});Object.defineProperty(w,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return Hi.SemanticTokensRangeRequest}});Object.defineProperty(w,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return Hi.SemanticTokensRefreshRequest}});Object.defineProperty(w,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return Hi.SemanticTokensRegistrationType}});var US=Em();Object.defineProperty(w,"ShowDocumentRequest",{enumerable:!0,get:function(){return US.ShowDocumentRequest}});var WS=qm();Object.defineProperty(w,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return WS.LinkedEditingRangeRequest}});var ai=$m();Object.defineProperty(w,"FileOperationPatternKind",{enumerable:!0,get:function(){return ai.FileOperationPatternKind}});Object.defineProperty(w,"DidCreateFilesNotification",{enumerable:!0,get:function(){return ai.DidCreateFilesNotification}});Object.defineProperty(w,"WillCreateFilesRequest",{enumerable:!0,get:function(){return ai.WillCreateFilesRequest}});Object.defineProperty(w,"DidRenameFilesNotification",{enumerable:!0,get:function(){return ai.DidRenameFilesNotification}});Object.defineProperty(w,"WillRenameFilesRequest",{enumerable:!0,get:function(){return ai.WillRenameFilesRequest}});Object.defineProperty(w,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return ai.DidDeleteFilesNotification}});Object.defineProperty(w,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return ai.WillDeleteFilesRequest}});var Rd=Km();Object.defineProperty(w,"UniquenessLevel",{enumerable:!0,get:function(){return Rd.UniquenessLevel}});Object.defineProperty(w,"MonikerKind",{enumerable:!0,get:function(){return Rd.MonikerKind}});Object.defineProperty(w,"MonikerRequest",{enumerable:!0,get:function(){return Rd.MonikerRequest}});var Sd=Jm();Object.defineProperty(w,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return Sd.TypeHierarchyPrepareRequest}});Object.defineProperty(w,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return Sd.TypeHierarchySubtypesRequest}});Object.defineProperty(w,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return Sd.TypeHierarchySupertypesRequest}});var Iy=Ym();Object.defineProperty(w,"InlineValueRequest",{enumerable:!0,get:function(){return Iy.InlineValueRequest}});Object.defineProperty(w,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return Iy.InlineValueRefreshRequest}});var _d=nv();Object.defineProperty(w,"InlayHintRequest",{enumerable:!0,get:function(){return _d.InlayHintRequest}});Object.defineProperty(w,"InlayHintResolveRequest",{enumerable:!0,get:function(){return _d.InlayHintResolveRequest}});Object.defineProperty(w,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return _d.InlayHintRefreshRequest}});var Ts=uv();Object.defineProperty(w,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Ts.DiagnosticServerCancellationData}});Object.defineProperty(w,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Ts.DocumentDiagnosticReportKind}});Object.defineProperty(w,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Ts.DocumentDiagnosticRequest}});Object.defineProperty(w,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Ts.WorkspaceDiagnosticRequest}});Object.defineProperty(w,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Ts.DiagnosticRefreshRequest}});var gr=mv();Object.defineProperty(w,"NotebookCellKind",{enumerable:!0,get:function(){return gr.NotebookCellKind}});Object.defineProperty(w,"ExecutionSummary",{enumerable:!0,get:function(){return gr.ExecutionSummary}});Object.defineProperty(w,"NotebookCell",{enumerable:!0,get:function(){return gr.NotebookCell}});Object.defineProperty(w,"NotebookDocument",{enumerable:!0,get:function(){return gr.NotebookDocument}});Object.defineProperty(w,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return gr.NotebookDocumentSyncRegistrationType}});Object.defineProperty(w,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return gr.DidOpenNotebookDocumentNotification}});Object.defineProperty(w,"NotebookCellArrayChange",{enumerable:!0,get:function(){return gr.NotebookCellArrayChange}});Object.defineProperty(w,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return gr.DidChangeNotebookDocumentNotification}});Object.defineProperty(w,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return gr.DidSaveNotebookDocumentNotification}});Object.defineProperty(w,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return gr.DidCloseNotebookDocumentNotification}});var HS=bv();Object.defineProperty(w,"InlineCompletionRequest",{enumerable:!0,get:function(){return HS.InlineCompletionRequest}});var md;(function(r){function e(t){let n=t;return Ot.string(n)||Ot.string(n.language)||Ot.string(n.scheme)||Ot.string(n.pattern)}r.is=e})(md||(w.TextDocumentFilter=md={}));var vd;(function(r){function e(t){let n=t;return Ot.objectLiteral(n)&&(Ot.string(n.notebookType)||Ot.string(n.scheme)||Ot.string(n.pattern))}r.is=e})(vd||(w.NotebookDocumentFilter=vd={}));var yd;(function(r){function e(t){let n=t;return Ot.objectLiteral(n)&&(Ot.string(n.notebook)||vd.is(n.notebook))&&(n.language===void 0||Ot.string(n.language))}r.is=e})(yd||(w.NotebookCellTextDocumentFilter=yd={}));var bd;(function(r){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!Ot.string(n)&&!md.is(n)&&!yd.is(n))return!1;return!0}r.is=e})(bd||(w.DocumentSelector=bd={}));var Cv;(function(r){r.method="client/registerCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Cv||(w.RegistrationRequest=Cv={}));var Rv;(function(r){r.method="client/unregisterCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Rv||(w.UnregistrationRequest=Rv={}));var Sv;(function(r){r.Create="create",r.Rename="rename",r.Delete="delete"})(Sv||(w.ResourceOperationKind=Sv={}));var _v;(function(r){r.Abort="abort",r.Transactional="transactional",r.TextOnlyTransactional="textOnlyTransactional",r.Undo="undo"})(_v||(w.FailureHandlingKind=_v={}));var Tv;(function(r){r.UTF8="utf-8",r.UTF16="utf-16",r.UTF32="utf-32"})(Tv||(w.PositionEncodingKind=Tv={}));var Dv;(function(r){function e(t){let n=t;return n&&Ot.string(n.id)&&n.id.length>0}r.hasId=e})(Dv||(w.StaticRegistrationOptions=Dv={}));var Pv;(function(r){function e(t){let n=t;return n&&(n.documentSelector===null||bd.is(n.documentSelector))}r.is=e})(Pv||(w.TextDocumentRegistrationOptions=Pv={}));var kv;(function(r){function e(n){let i=n;return Ot.objectLiteral(i)&&(i.workDoneProgress===void 0||Ot.boolean(i.workDoneProgress))}r.is=e;function t(n){let i=n;return i&&Ot.boolean(i.workDoneProgress)}r.hasWorkDoneProgress=t})(kv||(w.WorkDoneProgressOptions=kv={}));var Ev;(function(r){r.method="initialize",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ev||(w.InitializeRequest=Ev={}));var xv;(function(r){r.unknownProtocolVersion=1})(xv||(w.InitializeErrorCodes=xv={}));var Iv;(function(r){r.method="initialized",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Iv||(w.InitializedNotification=Iv={}));var qv;(function(r){r.method="shutdown",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType0(r.method)})(qv||(w.ShutdownRequest=qv={}));var Ov;(function(r){r.method="exit",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType0(r.method)})(Ov||(w.ExitNotification=Ov={}));var Fv;(function(r){r.method="workspace/didChangeConfiguration",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Fv||(w.DidChangeConfigurationNotification=Fv={}));var Lv;(function(r){r.Error=1,r.Warning=2,r.Info=3,r.Log=4,r.Debug=5})(Lv||(w.MessageType=Lv={}));var Mv;(function(r){r.method="window/showMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Mv||(w.ShowMessageNotification=Mv={}));var Nv;(function(r){r.method="window/showMessageRequest",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Nv||(w.ShowMessageRequest=Nv={}));var Av;(function(r){r.method="window/logMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Av||(w.LogMessageNotification=Av={}));var jv;(function(r){r.method="telemetry/event",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(jv||(w.TelemetryEventNotification=jv={}));var $v;(function(r){r.None=0,r.Full=1,r.Incremental=2})($v||(w.TextDocumentSyncKind=$v={}));var Uv;(function(r){r.method="textDocument/didOpen",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Uv||(w.DidOpenTextDocumentNotification=Uv={}));var Wv;(function(r){function e(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}r.isIncremental=e;function t(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}r.isFull=t})(Wv||(w.TextDocumentContentChangeEvent=Wv={}));var Hv;(function(r){r.method="textDocument/didChange",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Hv||(w.DidChangeTextDocumentNotification=Hv={}));var Vv;(function(r){r.method="textDocument/didClose",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Vv||(w.DidCloseTextDocumentNotification=Vv={}));var Kv;(function(r){r.method="textDocument/didSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Kv||(w.DidSaveTextDocumentNotification=Kv={}));var zv;(function(r){r.Manual=1,r.AfterDelay=2,r.FocusOut=3})(zv||(w.TextDocumentSaveReason=zv={}));var Bv;(function(r){r.method="textDocument/willSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Bv||(w.WillSaveTextDocumentNotification=Bv={}));var Gv;(function(r){r.method="textDocument/willSaveWaitUntil",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Gv||(w.WillSaveTextDocumentWaitUntilRequest=Gv={}));var Jv;(function(r){r.method="workspace/didChangeWatchedFiles",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Jv||(w.DidChangeWatchedFilesNotification=Jv={}));var Xv;(function(r){r.Created=1,r.Changed=2,r.Deleted=3})(Xv||(w.FileChangeType=Xv={}));var Qv;(function(r){function e(t){let n=t;return Ot.objectLiteral(n)&&(wv.URI.is(n.baseUri)||wv.WorkspaceFolder.is(n.baseUri))&&Ot.string(n.pattern)}r.is=e})(Qv||(w.RelativePattern=Qv={}));var Yv;(function(r){r.Create=1,r.Change=2,r.Delete=4})(Yv||(w.WatchKind=Yv={}));var Zv;(function(r){r.method="textDocument/publishDiagnostics",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Zv||(w.PublishDiagnosticsNotification=Zv={}));var ey;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.TriggerForIncompleteCompletions=3})(ey||(w.CompletionTriggerKind=ey={}));var ty;(function(r){r.method="textDocument/completion",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ty||(w.CompletionRequest=ty={}));var ny;(function(r){r.method="completionItem/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ny||(w.CompletionResolveRequest=ny={}));var ry;(function(r){r.method="textDocument/hover",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ry||(w.HoverRequest=ry={}));var iy;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.ContentChange=3})(iy||(w.SignatureHelpTriggerKind=iy={}));var sy;(function(r){r.method="textDocument/signatureHelp",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(sy||(w.SignatureHelpRequest=sy={}));var oy;(function(r){r.method="textDocument/definition",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(oy||(w.DefinitionRequest=oy={}));var ay;(function(r){r.method="textDocument/references",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ay||(w.ReferencesRequest=ay={}));var cy;(function(r){r.method="textDocument/documentHighlight",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(cy||(w.DocumentHighlightRequest=cy={}));var uy;(function(r){r.method="textDocument/documentSymbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(uy||(w.DocumentSymbolRequest=uy={}));var dy;(function(r){r.method="textDocument/codeAction",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(dy||(w.CodeActionRequest=dy={}));var ly;(function(r){r.method="codeAction/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ly||(w.CodeActionResolveRequest=ly={}));var fy;(function(r){r.method="workspace/symbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(fy||(w.WorkspaceSymbolRequest=fy={}));var hy;(function(r){r.method="workspaceSymbol/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(hy||(w.WorkspaceSymbolResolveRequest=hy={}));var py;(function(r){r.method="textDocument/codeLens",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(py||(w.CodeLensRequest=py={}));var gy;(function(r){r.method="codeLens/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(gy||(w.CodeLensResolveRequest=gy={}));var my;(function(r){r.method="workspace/codeLens/refresh",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType0(r.method)})(my||(w.CodeLensRefreshRequest=my={}));var vy;(function(r){r.method="textDocument/documentLink",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(vy||(w.DocumentLinkRequest=vy={}));var yy;(function(r){r.method="documentLink/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(yy||(w.DocumentLinkResolveRequest=yy={}));var by;(function(r){r.method="textDocument/formatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(by||(w.DocumentFormattingRequest=by={}));var wy;(function(r){r.method="textDocument/rangeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(wy||(w.DocumentRangeFormattingRequest=wy={}));var Cy;(function(r){r.method="textDocument/rangesFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Cy||(w.DocumentRangesFormattingRequest=Cy={}));var Ry;(function(r){r.method="textDocument/onTypeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ry||(w.DocumentOnTypeFormattingRequest=Ry={}));var Sy;(function(r){r.Identifier=1})(Sy||(w.PrepareSupportDefaultBehavior=Sy={}));var _y;(function(r){r.method="textDocument/rename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(_y||(w.RenameRequest=_y={}));var Ty;(function(r){r.method="textDocument/prepareRename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ty||(w.PrepareRenameRequest=Ty={}));var Dy;(function(r){r.method="workspace/executeCommand",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Dy||(w.ExecuteCommandRequest=Dy={}));var Py;(function(r){r.method="workspace/applyEdit",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType("workspace/applyEdit")})(Py||(w.ApplyWorkspaceEditRequest=Py={}))});var Fy=I(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.createProtocolConnection=void 0;var Oy=oi();function VS(r,e,t,n){return Oy.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Oy.createMessageConnection)(r,e,t,n)}ea.createProtocolConnection=VS});var My=I(ln=>{"use strict";var KS=ln&&ln.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ta=ln&&ln.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&KS(e,r,t)};Object.defineProperty(ln,"__esModule",{value:!0});ln.LSPErrorCodes=ln.createProtocolConnection=void 0;ta(oi(),ln);ta(Ao(),ln);ta(st(),ln);ta(qy(),ln);var zS=Fy();Object.defineProperty(ln,"createProtocolConnection",{enumerable:!0,get:function(){return zS.createProtocolConnection}});var Ly;(function(r){r.lspReservedErrorRangeStart=-32899,r.RequestFailed=-32803,r.ServerCancelled=-32802,r.ContentModified=-32801,r.RequestCancelled=-32800,r.lspReservedErrorRangeEnd=-32800})(Ly||(ln.LSPErrorCodes=Ly={}))});var me=I(mr=>{"use strict";var BS=mr&&mr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ny=mr&&mr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&BS(e,r,t)};Object.defineProperty(mr,"__esModule",{value:!0});mr.createProtocolConnection=void 0;var GS=cd();Ny(cd(),mr);Ny(My(),mr);function JS(r,e,t,n){return(0,GS.createMessageConnection)(r,e,t,n)}mr.createProtocolConnection=JS});var na=I(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.forEach=zt.mapAsync=zt.map=zt.clearTestMode=zt.setTestMode=zt.Semaphore=zt.Delayer=void 0;var Ps=me(),Td=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,Ps.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};zt.Delayer=Td;var Dd=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Ps.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};zt.Semaphore=Dd;var Pd=!1;function XS(){Pd=!0}zt.setTestMode=XS;function QS(){Pd=!1}zt.clearTestMode=QS;var Ay=15,Ds=class{constructor(e=Ay){this.yieldAfter=Pd===!0?Math.max(e,2):Math.max(e,Ay),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function YS(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new Ds(n?.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=e(r[d]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Ps.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}zt.map=YS;async function ZS(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new Ds(n?.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=await e(r[d],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Ps.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}zt.mapAsync=ZS;async function e_(r,e,t,n){if(r.length===0)return;let i=new Ds(n?.yieldAfter);function s(a){i.start();for(let c=a;c<r.length;c++)if(e(r[c]),i.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,Ps.RAL)().timer.setImmediate(()=>{a(s(o))})})}zt.forEach=e_});var xd=I(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});var t_=require("vscode"),kd=class extends t_.CompletionItem{constructor(e){super(e)}};Ed.default=kd});var Od=I(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});var n_=require("vscode"),Id=class extends n_.CodeLens{constructor(e){super(e)}};qd.default=Id});var Md=I(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});var r_=require("vscode"),Fd=class extends r_.DocumentLink{constructor(e,t){super(e,t)}};Ld.default=Fd});var jd=I(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});var i_=require("vscode"),Nd=class extends i_.CodeAction{constructor(e,t){super(e),this.data=t}};Ad.default=Nd});var Wd=I(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.ProtocolDiagnostic=Vi.DiagnosticCode=void 0;var s_=require("vscode"),$d=Hn(),jy;(function(r){function e(t){let n=t;return n!=null&&($d.number(n.value)||$d.string(n.value))&&$d.string(n.target)}r.is=e})(jy||(Vi.DiagnosticCode=jy={}));var Ud=class extends s_.Diagnostic{constructor(e,t,n,i){super(e,t,n),this.data=i,this.hasDiagnosticCode=!1}};Vi.ProtocolDiagnostic=Ud});var Kd=I(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});var o_=require("vscode"),Hd=class extends o_.CallHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Vd.default=Hd});var Gd=I(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var a_=require("vscode"),zd=class extends a_.TypeHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Bd.default=zd});var Qd=I(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});var ra=require("vscode"),Jd=class extends ra.SymbolInformation{constructor(e,t,n,i,s){let o=!(i instanceof ra.Uri);super(e,t,n,o?i:new ra.Location(i,new ra.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};Xd.default=Jd});var el=I(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});var c_=require("vscode"),Yd=class extends c_.InlayHint{constructor(e,t,n){super(e,t,n)}};Zd.default=Yd});var Hy=I(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.createConverter=void 0;var _t=require("vscode"),ve=me(),ci=Hn(),$y=na(),u_=xd(),d_=Od(),l_=Md(),Uy=jd(),Wy=Wd(),f_=Kd(),h_=Gd(),p_=Qd(),g_=el(),tl;(function(r){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}r.is=e})(tl||(tl={}));function m_(r){let t=r||(p=>p.toString());function n(p){return t(p)}function i(p){return{uri:t(p.uri)}}function s(p){return{uri:t(p.uri),languageId:p.languageId,version:p.version,text:p.getText()}}function o(p){return{uri:t(p.uri),version:p.version}}function a(p){return{textDocument:s(p)}}function c(p){let q=p;return!!q.document&&!!q.contentChanges}function d(p){let q=p;return!!q.uri&&!!q.version}function h(p,q,Y){if(d(p))return{textDocument:{uri:t(p.uri),version:p.version},contentChanges:[{text:p.getText()}]};if(c(p)){let Oe=q,D=Y;return{textDocument:{uri:t(Oe),version:D},contentChanges:p.contentChanges.map(R=>{let _=R.range;return{range:{start:{line:_.start.line,character:_.start.character},end:{line:_.end.line,character:_.end.character}},rangeLength:R.rangeLength,text:R.text}})}}else throw Error("Unsupported text document change parameter")}function m(p){return{textDocument:i(p)}}function v(p,q=!1){let Y={textDocument:i(p)};return q&&(Y.text=p.getText()),Y}function S(p){switch(p){case _t.TextDocumentSaveReason.Manual:return ve.TextDocumentSaveReason.Manual;case _t.TextDocumentSaveReason.AfterDelay:return ve.TextDocumentSaveReason.AfterDelay;case _t.TextDocumentSaveReason.FocusOut:return ve.TextDocumentSaveReason.FocusOut}return ve.TextDocumentSaveReason.Manual}function y(p){return{textDocument:i(p.document),reason:S(p.reason)}}function P(p){return{files:p.files.map(q=>({uri:t(q)}))}}function x(p){return{files:p.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function $(p){return{files:p.files.map(q=>({uri:t(q)}))}}function U(p){return{files:p.files.map(q=>({uri:t(q)}))}}function M(p){return{files:p.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function K(p){return{files:p.files.map(q=>({uri:t(q)}))}}function B(p,q){return{textDocument:i(p),position:Dt(q)}}function pe(p){switch(p){case _t.CompletionTriggerKind.TriggerCharacter:return ve.CompletionTriggerKind.TriggerCharacter;case _t.CompletionTriggerKind.TriggerForIncompleteCompletions:return ve.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return ve.CompletionTriggerKind.Invoked}}function J(p,q,Y){return{textDocument:i(p),position:Dt(q),context:{triggerKind:pe(Y.triggerKind),triggerCharacter:Y.triggerCharacter}}}function ae(p){switch(p){case _t.SignatureHelpTriggerKind.Invoke:return ve.SignatureHelpTriggerKind.Invoked;case _t.SignatureHelpTriggerKind.TriggerCharacter:return ve.SignatureHelpTriggerKind.TriggerCharacter;case _t.SignatureHelpTriggerKind.ContentChange:return ve.SignatureHelpTriggerKind.ContentChange}}function Re(p){return{label:p.label}}function rt(p){return p.map(Re)}function Ze(p){return{label:p.label,parameters:rt(p.parameters)}}function je(p){return p.map(Ze)}function Zt(p){return p===void 0?p:{signatures:je(p.signatures),activeSignature:p.activeSignature,activeParameter:p.activeParameter}}function Nt(p,q,Y){return{textDocument:i(p),position:Dt(q),context:{isRetrigger:Y.isRetrigger,triggerCharacter:Y.triggerCharacter,triggerKind:ae(Y.triggerKind),activeSignatureHelp:Zt(Y.activeSignatureHelp)}}}function Dt(p){return{line:p.line,character:p.character}}function Pt(p){return p==null?p:{line:p.line>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:p.line,character:p.character>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:p.character}}function bn(p,q){return $y.map(p,Pt,q)}function wn(p){return p.map(Pt)}function $e(p){return p==null?p:{start:Pt(p.start),end:Pt(p.end)}}function wt(p){return p.map($e)}function It(p){return p==null?p:ve.Location.create(n(p.uri),$e(p.range))}function kt(p){switch(p){case _t.DiagnosticSeverity.Error:return ve.DiagnosticSeverity.Error;case _t.DiagnosticSeverity.Warning:return ve.DiagnosticSeverity.Warning;case _t.DiagnosticSeverity.Information:return ve.DiagnosticSeverity.Information;case _t.DiagnosticSeverity.Hint:return ve.DiagnosticSeverity.Hint}}function cr(p){if(!p)return;let q=[];for(let Y of p){let Oe=Cn(Y);Oe!==void 0&&q.push(Oe)}return q.length>0?q:void 0}function Cn(p){switch(p){case _t.DiagnosticTag.Unnecessary:return ve.DiagnosticTag.Unnecessary;case _t.DiagnosticTag.Deprecated:return ve.DiagnosticTag.Deprecated;default:return}}function Rn(p){return{message:p.message,location:It(p.location)}}function Qn(p){return p.map(Rn)}function ur(p){if(p!=null)return ci.number(p)||ci.string(p)?p:{value:p.value,target:n(p.target)}}function An(p){let q=ve.Diagnostic.create($e(p.range),p.message),Y=p instanceof Wy.ProtocolDiagnostic?p:void 0;Y!==void 0&&Y.data!==void 0&&(q.data=Y.data);let Oe=ur(p.code);return Wy.DiagnosticCode.is(Oe)?Y!==void 0&&Y.hasDiagnosticCode?q.code=Oe:(q.code=Oe.value,q.codeDescription={href:Oe.target}):q.code=Oe,ci.number(p.severity)&&(q.severity=kt(p.severity)),Array.isArray(p.tags)&&(q.tags=cr(p.tags)),p.relatedInformation&&(q.relatedInformation=Qn(p.relatedInformation)),p.source&&(q.source=p.source),q}function Sn(p,q){return p==null?p:$y.map(p,An,q)}function _n(p){return p==null?p:p.map(An)}function jn(p,q){switch(p){case"$string":return q;case ve.MarkupKind.PlainText:return{kind:p,value:q};case ve.MarkupKind.Markdown:return{kind:p,value:q.value};default:return`Unsupported Markup content received. Kind is: ${p}`}}function Ue(p){switch(p){case _t.CompletionItemTag.Deprecated:return ve.CompletionItemTag.Deprecated}}function Yn(p){if(p===void 0)return p;let q=[];for(let Y of p){let Oe=Ue(Y);Oe!==void 0&&q.push(Oe)}return q}function Tn(p,q){return q!==void 0?q:p+1}function At(p,q=!1){let Y,Oe;ci.string(p.label)?Y=p.label:(Y=p.label.label,q&&(p.label.detail!==void 0||p.label.description!==void 0)&&(Oe={detail:p.label.detail,description:p.label.description}));let D={label:Y};Oe!==void 0&&(D.labelDetails=Oe);let g=p instanceof u_.default?p:void 0;p.detail&&(D.detail=p.detail),p.documentation&&(!g||g.documentationFormat==="$string"?D.documentation=p.documentation:D.documentation=jn(g.documentationFormat,p.documentation)),p.filterText&&(D.filterText=p.filterText),dr(D,p),ci.number(p.kind)&&(D.kind=Tn(p.kind,g&&g.originalItemKind)),p.sortText&&(D.sortText=p.sortText),p.additionalTextEdits&&(D.additionalTextEdits=Ke(p.additionalTextEdits)),p.commitCharacters&&(D.commitCharacters=p.commitCharacters.slice()),p.command&&(D.command=O(p.command)),(p.preselect===!0||p.preselect===!1)&&(D.preselect=p.preselect);let R=Yn(p.tags);if(g){if(g.data!==void 0&&(D.data=g.data),g.deprecated===!0||g.deprecated===!1){if(g.deprecated===!0&&R!==void 0&&R.length>0){let _=R.indexOf(_t.CompletionItemTag.Deprecated);_!==-1&&R.splice(_,1)}D.deprecated=g.deprecated}g.insertTextMode!==void 0&&(D.insertTextMode=g.insertTextMode)}return R!==void 0&&R.length>0&&(D.tags=R),D.insertTextMode===void 0&&p.keepWhitespace===!0&&(D.insertTextMode=ve.InsertTextMode.adjustIndentation),D}function dr(p,q){let Y=ve.InsertTextFormat.PlainText,Oe,D;q.textEdit?(Oe=q.textEdit.newText,D=q.textEdit.range):q.insertText instanceof _t.SnippetString?(Y=ve.InsertTextFormat.Snippet,Oe=q.insertText.value):Oe=q.insertText,q.range&&(D=q.range),p.insertTextFormat=Y,q.fromEdit&&Oe!==void 0&&D!==void 0?p.textEdit=Wt(Oe,D):p.insertText=Oe}function Wt(p,q){return tl.is(q)?ve.InsertReplaceEdit.create(p,$e(q.inserting),$e(q.replacing)):{newText:p,range:$e(q)}}function $n(p){return{range:$e(p.range),newText:p.newText}}function Ke(p){return p==null?p:p.map($n)}function gt(p){return p<=_t.SymbolKind.TypeParameter?p+1:ve.SymbolKind.Property}function Et(p){return p}function en(p){return p.map(Et)}function Rt(p,q,Y){return{textDocument:i(p),position:Dt(q),context:{includeDeclaration:Y.includeDeclaration}}}async function Dn(p,q){let Y=ve.CodeAction.create(p.title);if(p instanceof Uy.default&&p.data!==void 0&&(Y.data=p.data),p.kind!==void 0&&(Y.kind=l(p.kind)),p.diagnostics!==void 0&&(Y.diagnostics=await Sn(p.diagnostics,q)),p.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return p.command!==void 0&&(Y.command=O(p.command)),p.isPreferred!==void 0&&(Y.isPreferred=p.isPreferred),p.disabled!==void 0&&(Y.disabled={reason:p.disabled.reason}),Y}function Un(p){let q=ve.CodeAction.create(p.title);if(p instanceof Uy.default&&p.data!==void 0&&(q.data=p.data),p.kind!==void 0&&(q.kind=l(p.kind)),p.diagnostics!==void 0&&(q.diagnostics=_n(p.diagnostics)),p.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return p.command!==void 0&&(q.command=O(p.command)),p.isPreferred!==void 0&&(q.isPreferred=p.isPreferred),p.disabled!==void 0&&(q.disabled={reason:p.disabled.reason}),q}async function tn(p,q){if(p==null)return p;let Y;return p.only&&ci.string(p.only.value)&&(Y=[p.only.value]),ve.CodeActionContext.create(await Sn(p.diagnostics,q),Y,mt(p.triggerKind))}function Wn(p){if(p==null)return p;let q;return p.only&&ci.string(p.only.value)&&(q=[p.only.value]),ve.CodeActionContext.create(_n(p.diagnostics),q,mt(p.triggerKind))}function mt(p){switch(p){case _t.CodeActionTriggerKind.Invoke:return ve.CodeActionTriggerKind.Invoked;case _t.CodeActionTriggerKind.Automatic:return ve.CodeActionTriggerKind.Automatic;default:return}}function l(p){if(p!=null)return p.value}function C(p){return p==null?p:ve.InlineValueContext.create(p.frameId,$e(p.stoppedLocation))}function k(p,q,Y){return{context:ve.InlineCompletionContext.create(Y.triggerKind,Y.selectedCompletionInfo),textDocument:i(p),position:Pt(q)}}function O(p){let q=ve.Command.create(p.title,p.command);return p.arguments&&(q.arguments=p.arguments),q}function ne(p){let q=ve.CodeLens.create($e(p.range));return p.command&&(q.command=O(p.command)),p instanceof d_.default&&p.data&&(q.data=p.data),q}function ee(p,q){let Y={tabSize:p.tabSize,insertSpaces:p.insertSpaces};return q.trimTrailingWhitespace&&(Y.trimTrailingWhitespace=!0),q.trimFinalNewlines&&(Y.trimFinalNewlines=!0),q.insertFinalNewline&&(Y.insertFinalNewline=!0),Y}function oe(p){return{textDocument:i(p)}}function ce(p){return{textDocument:i(p)}}function G(p){let q=ve.DocumentLink.create($e(p.range));p.target&&(q.target=n(p.target)),p.tooltip!==void 0&&(q.tooltip=p.tooltip);let Y=p instanceof l_.default?p:void 0;return Y&&Y.data&&(q.data=Y.data),q}function re(p){return{textDocument:i(p)}}function Z(p){let q={name:p.name,kind:gt(p.kind),uri:n(p.uri),range:$e(p.range),selectionRange:$e(p.selectionRange)};return p.detail!==void 0&&p.detail.length>0&&(q.detail=p.detail),p.tags!==void 0&&(q.tags=en(p.tags)),p instanceof f_.default&&p.data!==void 0&&(q.data=p.data),q}function he(p){let q={name:p.name,kind:gt(p.kind),uri:n(p.uri),range:$e(p.range),selectionRange:$e(p.selectionRange)};return p.detail!==void 0&&p.detail.length>0&&(q.detail=p.detail),p.tags!==void 0&&(q.tags=en(p.tags)),p instanceof h_.default&&p.data!==void 0&&(q.data=p.data),q}function _e(p){let q=p instanceof p_.default?{name:p.name,kind:gt(p.kind),location:p.hasRange?It(p.location):{uri:t(p.location.uri)},data:p.data}:{name:p.name,kind:gt(p.kind),location:It(p.location)};return p.tags!==void 0&&(q.tags=en(p.tags)),p.containerName!==""&&(q.containerName=p.containerName),q}function We(p){let q=typeof p.label=="string"?p.label:p.label.map(lr),Y=ve.InlayHint.create(Pt(p.position),q);return p.kind!==void 0&&(Y.kind=p.kind),p.textEdits!==void 0&&(Y.textEdits=Ke(p.textEdits)),p.tooltip!==void 0&&(Y.tooltip=qr(p.tooltip)),p.paddingLeft!==void 0&&(Y.paddingLeft=p.paddingLeft),p.paddingRight!==void 0&&(Y.paddingRight=p.paddingRight),p instanceof g_.default&&p.data!==void 0&&(Y.data=p.data),Y}function lr(p){let q=ve.InlayHintLabelPart.create(p.value);return p.location!==void 0&&(q.location=It(p.location)),p.command!==void 0&&(q.command=O(p.command)),p.tooltip!==void 0&&(q.tooltip=qr(p.tooltip)),q}function qr(p){return typeof p=="string"?p:{kind:ve.MarkupKind.Markdown,value:p.value}}return{asUri:n,asTextDocumentIdentifier:i,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:h,asCloseTextDocumentParams:m,asSaveTextDocumentParams:v,asWillSaveTextDocumentParams:y,asDidCreateFilesParams:P,asDidRenameFilesParams:x,asDidDeleteFilesParams:$,asWillCreateFilesParams:U,asWillRenameFilesParams:M,asWillDeleteFilesParams:K,asTextDocumentPositionParams:B,asCompletionParams:J,asSignatureHelpParams:Nt,asWorkerPosition:Dt,asRange:$e,asRanges:wt,asPosition:Pt,asPositions:bn,asPositionsSync:wn,asLocation:It,asDiagnosticSeverity:kt,asDiagnosticTag:Cn,asDiagnostic:An,asDiagnostics:Sn,asDiagnosticsSync:_n,asCompletionItem:At,asTextEdit:$n,asSymbolKind:gt,asSymbolTag:Et,asSymbolTags:en,asReferenceParams:Rt,asCodeAction:Dn,asCodeActionSync:Un,asCodeActionContext:tn,asCodeActionContextSync:Wn,asInlineValueContext:C,asCommand:O,asCodeLens:ne,asFormattingOptions:ee,asDocumentSymbolParams:oe,asCodeLensParams:ce,asDocumentLink:G,asDocumentLinkParams:re,asCallHierarchyItem:Z,asTypeHierarchyItem:he,asInlayHint:We,asWorkspaceSymbol:_e,asInlineCompletionParams:k}}ia.createConverter=m_});var zy=I(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.createConverter=void 0;var z=require("vscode"),le=me(),zn=Hn(),qe=na(),v_=xd(),y_=Od(),b_=Md(),w_=jd(),Vy=Wd(),C_=Kd(),R_=Gd(),S_=Qd(),__=el(),Ky=me(),sa;(function(r){function e(t){let n=t;return n&&zn.string(n.language)&&zn.string(n.value)}r.is=e})(sa||(sa={}));function T_(r,e,t){let i=r||(u=>z.Uri.parse(u));function s(u){return i(u)}function o(u){let T=[];for(let A of u)if(typeof A=="string")T.push(A);else if(Ky.NotebookCellTextDocumentFilter.is(A))if(typeof A.notebook=="string")T.push({notebookType:A.notebook,language:A.language});else{let te=A.notebook.notebookType??"*";T.push({notebookType:te,scheme:A.notebook.scheme,pattern:A.notebook.pattern,language:A.language})}else Ky.TextDocumentFilter.is(A)&&T.push({language:A.language,scheme:A.scheme,pattern:A.pattern});return T}async function a(u,T){return qe.map(u,d,T)}function c(u){let T=new Array(u.length);for(let A=0;A<u.length;A++)T[A]=d(u[A]);return T}function d(u){let T=new Vy.ProtocolDiagnostic(y(u.range),u.message,x(u.severity),u.data);if(u.code!==void 0){if(typeof u.code=="string"||typeof u.code=="number")le.CodeDescription.is(u.codeDescription)?T.code={value:u.code,target:s(u.codeDescription.href)}:T.code=u.code;else if(Vy.DiagnosticCode.is(u.code)){T.hasDiagnosticCode=!0;let A=u.code;T.code={value:A.value,target:s(A.target)}}}return u.source&&(T.source=u.source),u.relatedInformation&&(T.relatedInformation=h(u.relatedInformation)),Array.isArray(u.tags)&&(T.tags=m(u.tags)),T}function h(u){let T=new Array(u.length);for(let A=0;A<u.length;A++){let te=u[A];T[A]=new z.DiagnosticRelatedInformation(kt(te.location),te.message)}return T}function m(u){if(!u)return;let T=[];for(let A of u){let te=v(A);te!==void 0&&T.push(te)}return T.length>0?T:void 0}function v(u){switch(u){case le.DiagnosticTag.Unnecessary:return z.DiagnosticTag.Unnecessary;case le.DiagnosticTag.Deprecated:return z.DiagnosticTag.Deprecated;default:return}}function S(u){return u?new z.Position(u.line,u.character):void 0}function y(u){return u?new z.Range(u.start.line,u.start.character,u.end.line,u.end.character):void 0}async function P(u,T){return qe.map(u,A=>new z.Range(A.start.line,A.start.character,A.end.line,A.end.character),T)}function x(u){if(u==null)return z.DiagnosticSeverity.Error;switch(u){case le.DiagnosticSeverity.Error:return z.DiagnosticSeverity.Error;case le.DiagnosticSeverity.Warning:return z.DiagnosticSeverity.Warning;case le.DiagnosticSeverity.Information:return z.DiagnosticSeverity.Information;case le.DiagnosticSeverity.Hint:return z.DiagnosticSeverity.Hint}return z.DiagnosticSeverity.Error}function $(u){if(zn.string(u))return M(u);if(sa.is(u))return M().appendCodeblock(u.value,u.language);if(Array.isArray(u)){let T=[];for(let A of u){let te=M();sa.is(A)?te.appendCodeblock(A.value,A.language):te.appendMarkdown(A),T.push(te)}return T}else return M(u)}function U(u){if(zn.string(u))return u;switch(u.kind){case le.MarkupKind.Markdown:return M(u.value);case le.MarkupKind.PlainText:return u.value;default:return`Unsupported Markup content received. Kind is: ${u.kind}`}}function M(u){let T;if(u===void 0||typeof u=="string")T=new z.MarkdownString(u);else switch(u.kind){case le.MarkupKind.Markdown:T=new z.MarkdownString(u.value);break;case le.MarkupKind.PlainText:T=new z.MarkdownString,T.appendText(u.value);break;default:T=new z.MarkdownString,T.appendText(`Unsupported Markup content received. Kind is: ${u.kind}`);break}return T.isTrusted=e,T.supportHtml=t,T}function K(u){if(u)return new z.Hover($(u.contents),y(u.range))}async function B(u,T,A){if(!u)return;if(Array.isArray(u))return qe.map(u,hr=>rt(hr,T),A);let te=u,{defaultRange:qt,commitCharacters:jt}=pe(te,T),He=await qe.map(te.items,hr=>rt(hr,jt,qt,te.itemDefaults?.insertTextMode,te.itemDefaults?.insertTextFormat,te.itemDefaults?.data),A);return new z.CompletionList(He,te.isIncomplete)}function pe(u,T){let A=u.itemDefaults?.editRange,te=u.itemDefaults?.commitCharacters??T;return le.Range.is(A)?{defaultRange:y(A),commitCharacters:te}:A!==void 0?{defaultRange:{inserting:y(A.insert),replacing:y(A.replace)},commitCharacters:te}:{defaultRange:void 0,commitCharacters:te}}function J(u){return le.CompletionItemKind.Text<=u&&u<=le.CompletionItemKind.TypeParameter?[u-1,void 0]:[z.CompletionItemKind.Text,u]}function ae(u){switch(u){case le.CompletionItemTag.Deprecated:return z.CompletionItemTag.Deprecated}}function Re(u){if(u==null)return[];let T=[];for(let A of u){let te=ae(A);te!==void 0&&T.push(te)}return T}function rt(u,T,A,te,qt,jt){let He=Re(u.tags),hr=Ze(u),Ge=new v_.default(hr);u.detail&&(Ge.detail=u.detail),u.documentation&&(Ge.documentation=U(u.documentation),Ge.documentationFormat=zn.string(u.documentation)?"$string":u.documentation.kind),u.filterText&&(Ge.filterText=u.filterText);let po=je(u,A,qt);if(po&&(Ge.insertText=po.text,Ge.range=po.range,Ge.fromEdit=po.fromEdit),zn.number(u.kind)){let[OR,rg]=J(u.kind);Ge.kind=OR,rg&&(Ge.originalItemKind=rg)}u.sortText&&(Ge.sortText=u.sortText),u.additionalTextEdits&&(Ge.additionalTextEdits=Pt(u.additionalTextEdits));let tg=u.commitCharacters!==void 0?zn.stringArray(u.commitCharacters)?u.commitCharacters:void 0:T;tg&&(Ge.commitCharacters=tg.slice()),u.command&&(Ge.command=Ke(u.command)),(u.deprecated===!0||u.deprecated===!1)&&(Ge.deprecated=u.deprecated,u.deprecated===!0&&He.push(z.CompletionItemTag.Deprecated)),(u.preselect===!0||u.preselect===!1)&&(Ge.preselect=u.preselect);let ng=u.data??jt;ng!==void 0&&(Ge.data=ng),He.length>0&&(Ge.tags=He);let Qc=u.insertTextMode??te;return Qc!==void 0&&(Ge.insertTextMode=Qc,Qc===le.InsertTextMode.asIs&&(Ge.keepWhitespace=!0)),Ge}function Ze(u){return le.CompletionItemLabelDetails.is(u.labelDetails)?{label:u.label,detail:u.labelDetails.detail,description:u.labelDetails.description}:u.label}function je(u,T,A){let te=u.insertTextFormat??A;if(u.textEdit!==void 0||T!==void 0){let[qt,jt]=u.textEdit!==void 0?Zt(u.textEdit):[T,u.textEditText??u.label];return te===le.InsertTextFormat.Snippet?{text:new z.SnippetString(jt),range:qt,fromEdit:!0}:{text:jt,range:qt,fromEdit:!0}}else return u.insertText?te===le.InsertTextFormat.Snippet?{text:new z.SnippetString(u.insertText),fromEdit:!1}:{text:u.insertText,fromEdit:!1}:void 0}function Zt(u){return le.InsertReplaceEdit.is(u)?[{inserting:y(u.insert),replacing:y(u.replace)},u.newText]:[y(u.range),u.newText]}function Nt(u){if(u)return new z.TextEdit(y(u.range),u.newText)}async function Dt(u,T){if(u)return qe.map(u,Nt,T)}function Pt(u){if(!u)return;let T=new Array(u.length);for(let A=0;A<u.length;A++)T[A]=Nt(u[A]);return T}async function bn(u,T){if(!u)return;let A=new z.SignatureHelp;return zn.number(u.activeSignature)?A.activeSignature=u.activeSignature:A.activeSignature=0,zn.number(u.activeParameter)?A.activeParameter=u.activeParameter:A.activeParameter=0,u.signatures&&(A.signatures=await wn(u.signatures,T)),A}async function wn(u,T){return qe.mapAsync(u,$e,T)}async function $e(u,T){let A=new z.SignatureInformation(u.label);return u.documentation!==void 0&&(A.documentation=U(u.documentation)),u.parameters!==void 0&&(A.parameters=await wt(u.parameters,T)),u.activeParameter!==void 0&&(A.activeParameter=u.activeParameter),A}function wt(u,T){return qe.map(u,It,T)}function It(u){let T=new z.ParameterInformation(u.label);return u.documentation&&(T.documentation=U(u.documentation)),T}function kt(u){return u?new z.Location(i(u.uri),y(u.range)):void 0}async function cr(u,T){if(u)return Qn(u,T)}async function Cn(u,T){if(u)return Qn(u,T)}function Rn(u){if(!u)return;let T={targetUri:i(u.targetUri),targetRange:y(u.targetRange),originSelectionRange:y(u.originSelectionRange),targetSelectionRange:y(u.targetSelectionRange)};if(!T.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return T}async function Qn(u,T){if(u)if(zn.array(u)){if(u.length===0)return[];if(le.LocationLink.is(u[0])){let A=u;return qe.map(A,Rn,T)}else{let A=u;return qe.map(A,kt,T)}}else return le.LocationLink.is(u)?[Rn(u)]:kt(u)}async function ur(u,T){if(u)return qe.map(u,kt,T)}async function An(u,T){if(u)return qe.map(u,Sn,T)}function Sn(u){let T=new z.DocumentHighlight(y(u.range));return zn.number(u.kind)&&(T.kind=_n(u.kind)),T}function _n(u){switch(u){case le.DocumentHighlightKind.Text:return z.DocumentHighlightKind.Text;case le.DocumentHighlightKind.Read:return z.DocumentHighlightKind.Read;case le.DocumentHighlightKind.Write:return z.DocumentHighlightKind.Write}return z.DocumentHighlightKind.Text}async function jn(u,T){if(u)return qe.map(u,At,T)}function Ue(u){return u<=le.SymbolKind.TypeParameter?u-1:z.SymbolKind.Property}function Yn(u){switch(u){case le.SymbolTag.Deprecated:return z.SymbolTag.Deprecated;default:return}}function Tn(u){if(u==null)return;let T=[];for(let A of u){let te=Yn(A);te!==void 0&&T.push(te)}return T.length===0?void 0:T}function At(u){let T=u.data,A=u.location,te=A.range===void 0||T!==void 0?new S_.default(u.name,Ue(u.kind),u.containerName??"",A.range===void 0?i(A.uri):new z.Location(i(u.location.uri),y(A.range)),T):new z.SymbolInformation(u.name,Ue(u.kind),u.containerName??"",new z.Location(i(u.location.uri),y(A.range)));return $n(te,u),te}async function dr(u,T){if(u!=null)return qe.map(u,Wt,T)}function Wt(u){let T=new z.DocumentSymbol(u.name,u.detail||"",Ue(u.kind),y(u.range),y(u.selectionRange));if($n(T,u),u.children!==void 0&&u.children.length>0){let A=[];for(let te of u.children)A.push(Wt(te));T.children=A}return T}function $n(u,T){u.tags=Tn(T.tags),T.deprecated&&(u.tags?u.tags.includes(z.SymbolTag.Deprecated)||(u.tags=u.tags.concat(z.SymbolTag.Deprecated)):u.tags=[z.SymbolTag.Deprecated])}function Ke(u){let T={title:u.title,command:u.command};return u.arguments&&(T.arguments=u.arguments),T}async function gt(u,T){if(u)return qe.map(u,Ke,T)}let Et=new Map;Et.set(le.CodeActionKind.Empty,z.CodeActionKind.Empty),Et.set(le.CodeActionKind.QuickFix,z.CodeActionKind.QuickFix),Et.set(le.CodeActionKind.Refactor,z.CodeActionKind.Refactor),Et.set(le.CodeActionKind.RefactorExtract,z.CodeActionKind.RefactorExtract),Et.set(le.CodeActionKind.RefactorInline,z.CodeActionKind.RefactorInline),Et.set(le.CodeActionKind.RefactorRewrite,z.CodeActionKind.RefactorRewrite),Et.set(le.CodeActionKind.Source,z.CodeActionKind.Source),Et.set(le.CodeActionKind.SourceOrganizeImports,z.CodeActionKind.SourceOrganizeImports);function en(u){if(u==null)return;let T=Et.get(u);if(T)return T;let A=u.split(".");T=z.CodeActionKind.Empty;for(let te of A)T=T.append(te);return T}function Rt(u){if(u!=null)return u.map(T=>en(T))}async function Dn(u,T){if(u==null)return;let A=new w_.default(u.title,u.data);return u.kind!==void 0&&(A.kind=en(u.kind)),u.diagnostics!==void 0&&(A.diagnostics=c(u.diagnostics)),u.edit!==void 0&&(A.edit=await mt(u.edit,T)),u.command!==void 0&&(A.command=Ke(u.command)),u.isPreferred!==void 0&&(A.isPreferred=u.isPreferred),u.disabled!==void 0&&(A.disabled={reason:u.disabled.reason}),A}function Un(u,T){return qe.mapAsync(u,async A=>le.Command.is(A)?Ke(A):Dn(A,T),T)}function tn(u){if(!u)return;let T=new y_.default(y(u.range));return u.command&&(T.command=Ke(u.command)),u.data!==void 0&&u.data!==null&&(T.data=u.data),T}async function Wn(u,T){if(u)return qe.map(u,tn,T)}async function mt(u,T){if(!u)return;let A=new Map;if(u.changeAnnotations!==void 0){let jt=u.changeAnnotations;await qe.forEach(Object.keys(jt),He=>{let hr=l(jt[He]);A.set(He,hr)},T)}let te=jt=>{if(jt!==void 0)return A.get(jt)},qt=new z.WorkspaceEdit;if(u.documentChanges){let jt=u.documentChanges;await qe.forEach(jt,He=>{if(le.CreateFile.is(He))qt.createFile(i(He.uri),He.options,te(He.annotationId));else if(le.RenameFile.is(He))qt.renameFile(i(He.oldUri),i(He.newUri),He.options,te(He.annotationId));else if(le.DeleteFile.is(He))qt.deleteFile(i(He.uri),He.options,te(He.annotationId));else if(le.TextDocumentEdit.is(He)){let hr=i(He.textDocument.uri);for(let Ge of He.edits)le.AnnotatedTextEdit.is(Ge)?qt.replace(hr,y(Ge.range),Ge.newText,te(Ge.annotationId)):qt.replace(hr,y(Ge.range),Ge.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(He,void 0,4)}`)},T)}else if(u.changes){let jt=u.changes;await qe.forEach(Object.keys(jt),He=>{qt.set(i(He),Pt(jt[He]))},T)}return qt}function l(u){if(u!==void 0)return{label:u.label,needsConfirmation:!!u.needsConfirmation,description:u.description}}function C(u){let T=y(u.range),A=u.target?s(u.target):void 0,te=new b_.default(T,A);return u.tooltip!==void 0&&(te.tooltip=u.tooltip),u.data!==void 0&&u.data!==null&&(te.data=u.data),te}async function k(u,T){if(u)return qe.map(u,C,T)}function O(u){return new z.Color(u.red,u.green,u.blue,u.alpha)}function ne(u){return new z.ColorInformation(y(u.range),O(u.color))}async function ee(u,T){if(u)return qe.map(u,ne,T)}function oe(u){let T=new z.ColorPresentation(u.label);return T.additionalTextEdits=Pt(u.additionalTextEdits),u.textEdit&&(T.textEdit=Nt(u.textEdit)),T}async function ce(u,T){if(u)return qe.map(u,oe,T)}function G(u){if(u)switch(u){case le.FoldingRangeKind.Comment:return z.FoldingRangeKind.Comment;case le.FoldingRangeKind.Imports:return z.FoldingRangeKind.Imports;case le.FoldingRangeKind.Region:return z.FoldingRangeKind.Region}}function re(u){return new z.FoldingRange(u.startLine,u.endLine,G(u.kind))}async function Z(u,T){if(u)return qe.map(u,re,T)}function he(u){return new z.SelectionRange(y(u.range),u.parent?he(u.parent):void 0)}async function _e(u,T){return Array.isArray(u)?qe.map(u,he,T):[]}function We(u){return le.InlineValueText.is(u)?new z.InlineValueText(y(u.range),u.text):le.InlineValueVariableLookup.is(u)?new z.InlineValueVariableLookup(y(u.range),u.variableName,u.caseSensitiveLookup):new z.InlineValueEvaluatableExpression(y(u.range),u.expression)}async function lr(u,T){return Array.isArray(u)?qe.map(u,We,T):[]}async function qr(u,T){let A=typeof u.label=="string"?u.label:await qe.map(u.label,p,T),te=new __.default(S(u.position),A);return u.kind!==void 0&&(te.kind=u.kind),u.textEdits!==void 0&&(te.textEdits=await Dt(u.textEdits,T)),u.tooltip!==void 0&&(te.tooltip=q(u.tooltip)),u.paddingLeft!==void 0&&(te.paddingLeft=u.paddingLeft),u.paddingRight!==void 0&&(te.paddingRight=u.paddingRight),u.data!==void 0&&(te.data=u.data),te}function p(u){let T=new z.InlayHintLabelPart(u.value);return u.location!==void 0&&(T.location=kt(u.location)),u.tooltip!==void 0&&(T.tooltip=q(u.tooltip)),u.command!==void 0&&(T.command=Ke(u.command)),T}function q(u){return typeof u=="string"?u:M(u)}async function Y(u,T){if(Array.isArray(u))return qe.mapAsync(u,qr,T)}function Oe(u){if(u===null)return;let T=new C_.default(Ue(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function D(u,T){if(u!==null)return qe.map(u,Oe,T)}async function g(u,T){return new z.CallHierarchyIncomingCall(Oe(u.from),await P(u.fromRanges,T))}async function R(u,T){if(u!==null)return qe.mapAsync(u,g,T)}async function _(u,T){return new z.CallHierarchyOutgoingCall(Oe(u.to),await P(u.fromRanges,T))}async function b(u,T){if(u!==null)return qe.mapAsync(u,_,T)}async function f(u,T){if(u!=null)return new z.SemanticTokens(new Uint32Array(u.data),u.resultId)}function E(u){return new z.SemanticTokensEdit(u.start,u.deleteCount,u.data!==void 0?new Uint32Array(u.data):void 0)}async function N(u,T){if(u!=null)return new z.SemanticTokensEdits(u.edits.map(E),u.resultId)}function ge(u){return u}async function it(u,T){if(u!=null)return new z.LinkedEditingRanges(await P(u.ranges,T),ze(u.wordPattern))}function ze(u){if(u!=null)return new RegExp(u)}function an(u){if(u===null)return;let T=new R_.default(Ue(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function Pn(u,T){if(u!==null)return qe.map(u,an,T)}function Zn(u){if(zn.string(u))return u;if(le.RelativePattern.is(u)){if(le.URI.is(u.baseUri))return new z.RelativePattern(s(u.baseUri),u.pattern);if(le.WorkspaceFolder.is(u.baseUri)){let T=z.workspace.getWorkspaceFolder(s(u.baseUri.uri));return T!==void 0?new z.RelativePattern(T,u.pattern):void 0}}}async function De(u,T){if(!u)return;if(Array.isArray(u))return qe.map(u,qt=>fr(qt),T);let A=u,te=await qe.map(A.items,qt=>fr(qt),T);return new z.InlineCompletionList(te)}function fr(u){let T;typeof u.insertText=="string"?T=u.insertText:T=new z.SnippetString(u.insertText.value);let A;u.command&&(A=Ke(u.command));let te=new z.InlineCompletionItem(T,y(u.range),A);return u.filterText&&(te.filterText=u.filterText),te}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:y,asRanges:P,asPosition:S,asDiagnosticSeverity:x,asDiagnosticTag:v,asHover:K,asCompletionResult:B,asCompletionItem:rt,asTextEdit:Nt,asTextEdits:Dt,asSignatureHelp:bn,asSignatureInformations:wn,asSignatureInformation:$e,asParameterInformations:wt,asParameterInformation:It,asDeclarationResult:cr,asDefinitionResult:Cn,asLocation:kt,asReferences:ur,asDocumentHighlights:An,asDocumentHighlight:Sn,asDocumentHighlightKind:_n,asSymbolKind:Ue,asSymbolTag:Yn,asSymbolTags:Tn,asSymbolInformations:jn,asSymbolInformation:At,asDocumentSymbols:dr,asDocumentSymbol:Wt,asCommand:Ke,asCommands:gt,asCodeAction:Dn,asCodeActionKind:en,asCodeActionKinds:Rt,asCodeActionResult:Un,asCodeLens:tn,asCodeLenses:Wn,asWorkspaceEdit:mt,asDocumentLink:C,asDocumentLinks:k,asFoldingRangeKind:G,asFoldingRange:re,asFoldingRanges:Z,asColor:O,asColorInformation:ne,asColorInformations:ee,asColorPresentation:oe,asColorPresentations:ce,asSelectionRange:he,asSelectionRanges:_e,asInlineValue:We,asInlineValues:lr,asInlayHint:qr,asInlayHints:Y,asSemanticTokensLegend:ge,asSemanticTokens:f,asSemanticTokensEdit:E,asSemanticTokensEdits:N,asCallHierarchyItem:Oe,asCallHierarchyItems:D,asCallHierarchyIncomingCall:g,asCallHierarchyIncomingCalls:R,asCallHierarchyOutgoingCall:_,asCallHierarchyOutgoingCalls:b,asLinkedEditingRanges:it,asTypeHierarchyItem:an,asTypeHierarchyItems:Pn,asGlobPattern:Zn,asInlineCompletionResult:De,asInlineCompletionItem:fr}}oa.createConverter=T_});var ot=I(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.generateUuid=Bn.parse=Bn.isUUID=Bn.v4=Bn.empty=void 0;var ks=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Es=class r extends ks{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}};Es._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Es._timeHighBits=["8","9","a","b"];Bn.empty=new ks("00000000-0000-0000-0000-000000000000");function By(){return new Es}Bn.v4=By;var D_=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Gy(r){return D_.test(r)}Bn.isUUID=Gy;function P_(r){if(!Gy(r))throw new Error("invalid uuid");return new ks(r)}Bn.parse=P_;function k_(){return By().asHex()}Bn.generateUuid=k_});var rl=I(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.ProgressPart=void 0;var Jy=require("vscode"),Xy=me(),Qy=Hn(),nl=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(Xy.WorkDoneProgress.type,this._token,i=>{switch(i.kind){case"begin":this.begin(i);break;case"report":this.report(i);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&Jy.window.withProgress({location:Jy.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(Xy.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((i,s)=>{this._resolve=i,this._reject=s})})}report(e){if(this._infinite&&Qy.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(Qy.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};aa.ProgressPart=nl});var Ie=I(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.WorkspaceFeature=Ft.TextDocumentLanguageFeature=Ft.TextDocumentEventFeature=Ft.DynamicDocumentFeature=Ft.DynamicFeature=Ft.StaticFeature=Ft.ensure=Ft.LSPCancellationError=void 0;var ui=require("vscode"),il=me(),nn=Hn(),Yy=ot(),sl=class extends ui.CancellationError{constructor(e){super(),this.data=e}};Ft.LSPCancellationError=sl;function E_(r,e){return r[e]===void 0&&(r[e]={}),r[e]}Ft.ensure=E_;var Zy;(function(r){function e(t){let n=t;return n!=null&&nn.func(n.fillClientCapabilities)&&nn.func(n.initialize)&&nn.func(n.getState)&&nn.func(n.clear)&&(n.fillInitializeParams===void 0||nn.func(n.fillInitializeParams))}r.is=e})(Zy||(Ft.StaticFeature=Zy={}));var eb;(function(r){function e(t){let n=t;return n!=null&&nn.func(n.fillClientCapabilities)&&nn.func(n.initialize)&&nn.func(n.getState)&&nn.func(n.clear)&&(n.fillInitializeParams===void 0||nn.func(n.fillInitializeParams))&&nn.func(n.register)&&nn.func(n.unregister)&&n.registrationType!==void 0}r.is=e})(eb||(Ft.DynamicFeature=eb={}));var xs=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let i of e){t++;for(let s of ui.workspace.textDocuments)if(ui.languages.match(i,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};Ft.DynamicDocumentFeature=xs;var ol=class extends xs{static textDocumentFilter(e,t){for(let n of e)if(ui.languages.match(n,t)>0)return!0;return!1}constructor(e,t,n,i,s,o,a){super(e),this._event=t,this._type=n,this._middleware=i,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new ui.EventEmitter}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let i=this._createParams(n);await this._client.sendNotification(this._type,i),this.notificationSent(this.getTextDocument(n),this._type,i)};if(this.matches(e)){let n=this._middleware();return n?n(e,i=>t(i)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(ui.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};Ft.TextDocumentEventFeature=ol;var al=class extends xs{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(il.TextDocumentRegistrationOptions.is(t)){let n=il.StaticRegistrationOptions.hasId(t)?t.id:Yy.generateUuid(),i=t.documentSelector??e;if(i)return[n,Object.assign({},t,{documentSelector:i})]}else if(nn.boolean(t)&&t===!0||il.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=nn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[Yy.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return nn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&ui.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Ft.TextDocumentLanguageFeature=al;var cl=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Ft.WorkspaceFeature=cl});var nb=I((KE,tb)=>{var x_=typeof process=="object"&&process&&process.platform==="win32";tb.exports=x_?{sep:"\\"}:{sep:"/"}});var ab=I((zE,ob)=>{"use strict";ob.exports=ib;function ib(r,e,t){r instanceof RegExp&&(r=rb(r,t)),e instanceof RegExp&&(e=rb(e,t));var n=sb(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function rb(r,e){var t=e.match(r);return t?t[0]:null}ib.range=sb;function sb(r,e,t){var n,i,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),h=c;if(c>=0&&d>0){if(r===e)return[c,d];for(n=[],s=t.length;h>=0&&!a;)h==c?(n.push(h),c=t.indexOf(r,h+1)):n.length==1?a=[n.pop(),d]:(i=n.pop(),i<s&&(s=i,o=d),d=t.indexOf(e,h+1)),h=c<d&&c>=0?c:d;n.length&&(a=[s,o])}return a}});var gb=I((BE,pb)=>{var cb=ab();pb.exports=O_;var ub="\0SLASH"+Math.random()+"\0",db="\0OPEN"+Math.random()+"\0",dl="\0CLOSE"+Math.random()+"\0",lb="\0COMMA"+Math.random()+"\0",fb="\0PERIOD"+Math.random()+"\0";function ul(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function I_(r){return r.split("\\\\").join(ub).split("\\{").join(db).split("\\}").join(dl).split("\\,").join(lb).split("\\.").join(fb)}function q_(r){return r.split(ub).join("\\").split(db).join("{").split(dl).join("}").split(lb).join(",").split(fb).join(".")}function hb(r){if(!r)return[""];var e=[],t=cb("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=hb(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function O_(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Is(I_(r),!0).map(q_)):[]}function F_(r){return"{"+r+"}"}function L_(r){return/^-?0\d/.test(r)}function M_(r,e){return r<=e}function N_(r,e){return r>=e}function Is(r,e){var t=[],n=cb("{","}",r);if(!n)return[r];var i=n.pre,s=n.post.length?Is(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=i+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),h=c||d,m=n.body.indexOf(",")>=0;if(!h&&!m)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+dl+n.post,Is(r)):[r];var v;if(h)v=n.body.split(/\.\./);else if(v=hb(n.body),v.length===1&&(v=Is(v[0],!1).map(F_),v.length===1))return s.map(function(rt){return n.pre+v[0]+rt});var S;if(h){var y=ul(v[0]),P=ul(v[1]),x=Math.max(v[0].length,v[1].length),$=v.length==3?Math.abs(ul(v[2])):1,U=M_,M=P<y;M&&($*=-1,U=N_);var K=v.some(L_);S=[];for(var B=y;U(B,P);B+=$){var pe;if(d)pe=String.fromCharCode(B),pe==="\\"&&(pe="");else if(pe=String(B),K){var J=x-pe.length;if(J>0){var ae=new Array(J+1).join("0");B<0?pe="-"+ae+pe.slice(1):pe=ae+pe}}S.push(pe)}}else{S=[];for(var Re=0;Re<v.length;Re++)S.push.apply(S,Is(v[Re],!1))}for(var Re=0;Re<S.length;Re++)for(var o=0;o<s.length;o++){var a=i+S[Re]+s[o];(!e||h||a)&&t.push(a)}}return t}});var ua=I((JE,gl)=>{var xn=gl.exports=(r,e,t={})=>(ca(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Ki(e,t).match(r));gl.exports=xn;var hl=nb();xn.sep=hl.sep;var nr=Symbol("globstar **");xn.GLOBSTAR=nr;var A_=gb(),mb={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},pl="[^/]",ll=pl+"*?",j_="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",$_="(?:(?!(?:\\/|^)\\.).)*?",bb=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),vb=bb("().*{}+?[]^$\\!"),U_=bb("[.("),yb=/\/+/;xn.filter=(r,e={})=>(t,n,i)=>xn(t,r,e);var Wr=(r,e={})=>{let t={};return Object.keys(r).forEach(n=>t[n]=r[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};xn.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return xn;let e=xn,t=(n,i,s)=>e(n,i,Wr(r,s));return t.Minimatch=class extends e.Minimatch{constructor(i,s){super(i,Wr(r,s))}},t.Minimatch.defaults=n=>e.defaults(Wr(r,n)).Minimatch,t.filter=(n,i)=>e.filter(n,Wr(r,i)),t.defaults=n=>e.defaults(Wr(r,n)),t.makeRe=(n,i)=>e.makeRe(n,Wr(r,i)),t.braceExpand=(n,i)=>e.braceExpand(n,Wr(r,i)),t.match=(n,i,s)=>e.match(n,i,Wr(r,s)),t};xn.braceExpand=(r,e)=>wb(r,e);var wb=(r,e={})=>(ca(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:A_(r)),W_=1024*64,ca=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>W_)throw new TypeError("pattern is too long")},fl=Symbol("subparse");xn.makeRe=(r,e)=>new Ki(r,e||{}).makeRe();xn.match=(r,e,t={})=>{let n=new Ki(e,t);return r=r.filter(i=>n.match(i)),n.options.nonull&&!r.length&&r.push(e),r};var H_=r=>r.replace(/\\(.)/g,"$1"),V_=r=>r.replace(/\\([^-\]])/g,"$1"),K_=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),z_=r=>r.replace(/[[\]\\]/g,"\\$&"),Ki=class{constructor(e,t){ca(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,n),n=this.globParts=n.map(i=>i.split(yb)),this.debug(this.pattern,n),n=n.map((i,s,o)=>i.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(i=>i.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],h=e[s];if(this.debug(t,d,h),d===!1)return!1;if(d===nr){this.debug("GLOBSTAR",[t,d,h]);var m=s,v=o+1;if(v===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!i.dot&&e[s].charAt(0)===".")return!1;return!0}for(;m<a;){var S=e[m];if(this.debug(`
globstar while`,e,m,t,v,S),this.matchOne(e.slice(m),t.slice(v),n))return this.debug("globstar found match!",m,a,S),!0;if(S==="."||S===".."||!i.dot&&S.charAt(0)==="."){this.debug("dot detected!",e,m,t,v);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,m,t,v),m===a))}var y;if(typeof d=="string"?(y=h===d,this.debug("string match",d,h,y)):(y=h.match(d),this.debug("pattern match",d,h,y)),!y)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return wb(this.pattern,this.options)}parse(e,t){ca(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return nr;if(e==="")return"";let i="",s=!1,o=!1,a=[],c=[],d,h=!1,m=-1,v=-1,S,y,P,x=e.charAt(0)===".",$=n.dot||x,U=()=>x?"":$?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",M=J=>J.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",K=()=>{if(d){switch(d){case"*":i+=ll,s=!0;break;case"?":i+=pl,s=!0;break;default:i+="\\"+d;break}this.debug("clearStateChar %j %j",d,i),d=!1}};for(let J=0,ae;J<e.length&&(ae=e.charAt(J));J++){if(this.debug("%s	%s %s %j",e,J,i,ae),o){if(ae==="/")return!1;vb[ae]&&(i+="\\"),i+=ae,o=!1;continue}switch(ae){case"/":return!1;case"\\":if(h&&e.charAt(J+1)==="-"){i+=ae;continue}K(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,J,i,ae),h){this.debug("  in class"),ae==="!"&&J===v+1&&(ae="^"),i+=ae;continue}this.debug("call clearStateChar %j",d),K(),d=ae,n.noext&&K();continue;case"(":{if(h){i+="(";continue}if(!d){i+="\\(";continue}let Re={type:d,start:J-1,reStart:i.length,open:mb[d].open,close:mb[d].close};this.debug(this.pattern,"	",Re),a.push(Re),i+=Re.open,Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1))),this.debug("plType %j %j",d,i),d=!1;continue}case")":{let Re=a[a.length-1];if(h||!Re){i+="\\)";continue}a.pop(),K(),s=!0,y=Re,i+=y.close,y.type==="!"&&c.push(Object.assign(y,{reEnd:i.length}));continue}case"|":{let Re=a[a.length-1];if(h||!Re){i+="\\|";continue}K(),i+="|",Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1)));continue}case"[":if(K(),h){i+="\\"+ae;continue}h=!0,v=J,m=i.length,i+=ae;continue;case"]":if(J===v+1||!h){i+="\\"+ae;continue}S=e.substring(v+1,J);try{RegExp("["+z_(V_(S))+"]"),i+=ae}catch{i=i.substring(0,m)+"(?:$.)"}s=!0,h=!1;continue;default:K(),vb[ae]&&!(ae==="^"&&h)&&(i+="\\"),i+=ae;break}}for(h&&(S=e.slice(v+1),P=this.parse(S,fl),i=i.substring(0,m)+"\\["+P[0],s=s||P[1]),y=a.pop();y;y=a.pop()){let J;J=i.slice(y.reStart+y.open.length),this.debug("setting tail",i,y),J=J.replace(/((?:\\{2}){0,64})(\\?)\|/g,(Re,rt,Ze)=>(Ze||(Ze="\\"),rt+rt+Ze+"|")),this.debug(`tail=%j
   %s`,J,J,y,i);let ae=y.type==="*"?ll:y.type==="?"?pl:"\\"+y.type;s=!0,i=i.slice(0,y.reStart)+ae+"\\("+J}K(),o&&(i+="\\\\");let B=U_[i.charAt(0)];for(let J=c.length-1;J>-1;J--){let ae=c[J],Re=i.slice(0,ae.reStart),rt=i.slice(ae.reStart,ae.reEnd-8),Ze=i.slice(ae.reEnd),je=i.slice(ae.reEnd-8,ae.reEnd)+Ze,Zt=Re.split(")").length,Nt=Re.split("(").length-Zt,Dt=Ze;for(let bn=0;bn<Nt;bn++)Dt=Dt.replace(/\)[+*?]?/,"");Ze=Dt;let Pt=Ze===""&&t!==fl?"(?:$|\\/)":"";i=Re+rt+Ze+Pt+je}if(i!==""&&s&&(i="(?=.)"+i),B&&(i=U()+i),t===fl)return[i,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return H_(e);let pe=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",pe),{_glob:e,_src:i})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?ll:t.dot?j_:$_,i=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?K_(a):a===nr?nr:a._src).reduce((a,c)=>(a[a.length-1]===nr&&c===nr||a.push(c),a),[]),o.forEach((a,c)=>{a!==nr||o[c-1]===nr||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=nr))}),o.filter(a=>a!==nr).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,i)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;hl.sep!=="/"&&(e=e.split(hl.sep).join("/")),e=e.split(yb),this.debug(this.pattern,"split",e);let i=this.set;this.debug(this.pattern,"set",i);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<i.length;o++){let a=i[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return xn.defaults(e).Minimatch}};xn.Minimatch=Ki});var Sl=I(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.DiagnosticFeature=Hr.DiagnosticPullMode=Hr.vsdiag=void 0;var B_=ua(),Pe=require("vscode"),bt=me(),G_=ot(),ml=Ie();function da(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Gn;(function(r){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={}))})(Gn||(Hr.vsdiag=Gn={}));var la;(function(r){r.onType="onType",r.onSave="onSave"})(la||(Hr.DiagnosticPullMode=la={}));var Bt;(function(r){r.active="open",r.reschedule="reschedule",r.outDated="drop"})(Bt||(Bt={}));var vl=class r{constructor(){this.open=new Set,this._onOpen=new Pe.EventEmitter,this._onClose=new Pe.EventEmitter,r.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,i=new Set;r.fillTabResources(i);let s=new Set,o=new Set(i);for(let a of n.values())i.has(a)?o.delete(a):s.add(a);if(this.open=i,s.size>0){let a=new Set;for(let c of s)a.add(Pe.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(Pe.Uri.parse(c));this._onOpen.fire(a)}};Pe.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=Pe.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof Pe.Uri?Pe.window.activeTextEditor?.document.uri===e:Pe.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof Pe.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return r.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let i of Pe.window.tabGroups.all)for(let s of i.tabs){let o=s.input,a;o instanceof Pe.TabInputText?a=o.uri:o instanceof Pe.TabInputTextDiff?a=o.modified:o instanceof Pe.TabInputCustom&&(a=o.uri),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},xt;(function(r){r[r.document=1]="document",r[r.workspace=2]="workspace"})(xt||(xt={}));var _r;(function(r){function e(t){return t instanceof Pe.Uri?t.toString():t.uri.toString()}r.asKey=e})(_r||(_r={}));var yl=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let i=e===xt.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof Pe.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=i.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},i.set(s,c)),c}update(e,t,n,i){let s=e===xt.document?this.documentPullStates:this.workspacePullStates,[o,a,c,d]=t instanceof Pe.Uri?[t.toString(),t,n,i]:[t.uri.toString(),t.uri,t.version,n],h=s.get(o);h===void 0?(h={document:a,pulledVersion:c,resultId:d},s.set(o,h)):(h.pulledVersion=c,h.resultId=d)}unTrack(e,t){let n=_r.asKey(t);(e===xt.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=_r.asKey(t);return(e===xt.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=_r.asKey(t);return(e===xt.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},bl=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new Pe.EventEmitter,this.provider=this.createProvider(),this.diagnostics=Pe.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new yl,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof Pe.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof Pe.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},i=>{this.client.error(`Document pull failed for text document ${n.toString()}`,i,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof Pe.Uri,i=n?e:e.uri,s=i.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(xt.document,e,t):this.documentStates.track(xt.document,e);if(o===void 0){let c=new Pe.CancellationTokenSource;this.openRequests.set(s,{state:Bt.active,document:e,version:t,tokenSource:c});let d,h;try{d=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:Gn.DocumentDiagnosticReportKind.full,items:[]}}catch(m){if(m instanceof ml.LSPCancellationError&&bt.DiagnosticServerCancellationData.is(m.data)&&m.data.retriggerRequest===!1&&(h={state:Bt.outDated,document:e}),h===void 0&&m instanceof Pe.CancellationError)h={state:Bt.reschedule,document:e};else throw m}if(h=h??this.openRequests.get(s),h===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(i);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(xt.document,e);return}if(h.state===Bt.outDated)return;d!==void 0&&(d.kind===Gn.DocumentDiagnosticReportKind.full&&this.diagnostics.set(i,d.items),a.pulledVersion=t,a.resultId=d.resultId),h.state===Bt.reschedule&&this.pull(e)}else o.state===Bt.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:Bt.reschedule,document:o.document})):o.state===Bt.outDated&&this.openRequests.set(s,{state:Bt.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof Pe.Uri?e:e.uri,n=t.toString(),i=this.openRequests.get(n);this.options.workspaceDiagnostics?i!==void 0?this.openRequests.set(n,{state:Bt.reschedule,document:e}):this.pull(e,()=>{this.forget(xt.document,e)}):(i!==void 0&&(i.state===Bt.active&&i.tokenSource.cancel(),this.openRequests.set(n,{state:Bt.outDated,document:e})),this.diagnostics.delete(t),this.forget(xt.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof ml.LSPCancellationError)&&!bt.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new Pe.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===Gn.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(xt.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(xt.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,i)=>{let s=(a,c,d)=>{let h={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof Pe.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:Gn.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(bt.DocumentDiagnosticRequest.type,h,d).then(async m=>m==null||this.isDisposed||d.isCancellationRequested?{kind:Gn.DocumentDiagnosticReportKind.full,items:[]}:m.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Gn.DocumentDiagnosticReportKind.full,resultId:m.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(m.items,d)}:{kind:Gn.DocumentDiagnosticReportKind.unChanged,resultId:m.resultId},m=>this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,d,m,{kind:Gn.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,i,s):s(t,n,i)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,i)=>{let s=async d=>d.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Gn.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version,items:await this.client.protocol2CodeConverter.asDiagnostics(d.items,n)}:{kind:Gn.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version},o=d=>{let h=[];for(let m of d)h.push({uri:this.client.code2ProtocolConverter.asUri(m.uri),value:m.value});return h},a=(d,h)=>{let m=(0,G_.generateUuid)(),v=this.client.onProgress(bt.WorkspaceDiagnosticRequest.partialResult,m,async y=>{if(y==null){i(null);return}let P={items:[]};for(let x of y.items)try{P.items.push(await s(x))}catch($){this.client.error("Converting workspace diagnostics failed.",$)}i(P)}),S={identifier:this.options.identifier,previousResultIds:o(d),partialResultToken:m};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(bt.WorkspaceDiagnosticRequest.type,S,h).then(async y=>{if(h.isCancellationRequested)return{items:[]};let P={items:[]};for(let x of y.items)P.items.push(await s(x));return v.dispose(),i(P),{items:[]}},y=>(v.dispose(),this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,h,y,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,i,a):a(t,n,i)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===Bt.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:Bt.outDated,document:t.document});this.diagnostics.dispose()}},wl=class{constructor(e){this.diagnosticRequestor=e,this.documents=new bt.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=_r.asKey(e);this.documents.has(t)||(this.documents.set(t,e,bt.Touch.Last),this.trigger())}remove(e){let t=_r.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,bt.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=_r.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,bt.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?_r.asKey(this.endDocument):void 0}},Cl=class{constructor(e,t,n){let i=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=y=>{let P=n.documentSelector;if(i.match!==void 0)return i.match(P,y);for(let x of P)if(bt.TextDocumentFilter.is(x)){if(typeof x=="string"||x.language!==void 0&&x.language!=="*"||x.scheme!==void 0&&x.scheme!=="*"&&x.scheme!==y.scheme)return!1;if(x.pattern!==void 0){let $=new B_.Minimatch(x.pattern,{noext:!0});if(!$.makeRe()||!$.match(y.fsPath))return!1}}return!0},c=y=>y instanceof Pe.Uri?a(y):Pe.languages.match(s,y)>0&&t.isVisible(y),d=y=>y instanceof Pe.Uri?this.activeTextDocument?.uri.toString()===y.toString():this.activeTextDocument===y;this.diagnosticRequestor=new bl(e,t,n),this.backgroundScheduler=new wl(this.diagnosticRequestor);let h=y=>{!c(y)||!n.interFileDependencies||d(y)||this.backgroundScheduler.add(y)};this.activeTextDocument=Pe.window.activeTextEditor?.document,Pe.window.onDidChangeActiveTextEditor(y=>{let P=this.activeTextDocument;this.activeTextDocument=y?.document,P!==void 0&&h(P),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let m=e.getFeature(bt.DidOpenTextDocumentNotification.method);o.push(m.onNotificationSent(y=>{let P=y.textDocument;this.diagnosticRequestor.knows(xt.document,P)||c(P)&&this.diagnosticRequestor.pull(P,()=>{h(P)})})),o.push(t.onOpen(y=>{for(let P of y){if(this.diagnosticRequestor.knows(xt.document,P))continue;let x=P.toString(),$;for(let U of Pe.workspace.textDocuments)if(x===U.uri.toString()){$=U;break}$!==void 0&&c($)&&this.diagnosticRequestor.pull($,()=>{h($)})}}));let v=new Set;for(let y of Pe.workspace.textDocuments)c(y)&&(this.diagnosticRequestor.pull(y,()=>{h(y)}),v.add(y.uri.toString()));if(i.onTabs===!0)for(let y of t.getTabResources())!v.has(y.toString())&&c(y)&&this.diagnosticRequestor.pull(y,()=>{h(y)});if(i.onChange===!0){let y=e.getFeature(bt.DidChangeTextDocumentNotification.method);o.push(y.onNotificationSent(async P=>{let x=P.textDocument;(i.filter===void 0||!i.filter(x,la.onType))&&this.diagnosticRequestor.knows(xt.document,x)&&this.diagnosticRequestor.pull(x,()=>{this.backgroundScheduler.trigger()})}))}if(i.onSave===!0){let y=e.getFeature(bt.DidSaveTextDocumentNotification.method);o.push(y.onNotificationSent(P=>{let x=P.textDocument;(i.filter===void 0||!i.filter(x,la.onSave))&&this.diagnosticRequestor.knows(xt.document,x)&&this.diagnosticRequestor.pull(P.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let S=e.getFeature(bt.DidCloseTextDocumentNotification.method);o.push(S.onNotificationSent(y=>{this.cleanUpDocument(y.textDocument)})),t.onClose(y=>{for(let P of y)this.cleanUpDocument(P)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let y of Pe.workspace.textDocuments)c(y)&&this.diagnosticRequestor.pull(y)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=Pe.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(xt.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},Rl=class extends ml.TextDocumentLanguageFeature{constructor(e){super(e,bt.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=da(da(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,da(da(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(bt.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[i,s]=this.getRegistration(t,e.diagnosticProvider);!i||!s||this.register({id:i,registerOptions:s})}clear(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.clear()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new vl);let t=new Cl(this._client,this.tabs,e);return[t.disposable,t]}};Hr.DiagnosticFeature=Rl});var Sb=I(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.NotebookDocumentSyncFeature=void 0;var Gt=require("vscode"),J_=ua(),Tr=me(),X_=ot(),Cb=Hn();function Rb(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var zi;(function(r){let e;(function(t){function n(v,S){return{version:v.version,uri:S.asUri(v.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function i(v,S,y){let P=Tr.NotebookDocument.create(y.asUri(v.uri),v.notebookType,v.version,s(S,y));return Object.keys(v.metadata).length>0&&(P.metadata=o(v.metadata)),P}t.asNotebookDocument=i;function s(v,S){return v.map(y=>a(y,S))}t.asNotebookCells=s;function o(v){return d(new Set,v)}t.asMetadata=o;function a(v,S){let y=Tr.NotebookCell.create(c(v.kind),S.asUri(v.document.uri));return Object.keys(v.metadata).length>0&&(y.metadata=o(v.metadata)),v.executionSummary!==void 0&&Cb.number(v.executionSummary.executionOrder)&&Cb.boolean(v.executionSummary.success)&&(y.executionSummary={executionOrder:v.executionSummary.executionOrder,success:v.executionSummary.success}),y}t.asNotebookCell=a;function c(v){switch(v){case Gt.NotebookCellKind.Markup:return Tr.NotebookCellKind.Markup;case Gt.NotebookCellKind.Code:return Tr.NotebookCellKind.Code}}function d(v,S){if(v.has(S))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(S)){let y=[];for(let P of S)if(P!==null&&typeof P=="object"||Array.isArray(P))y.push(d(v,P));else{if(P instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");y.push(P)}return y}else{let y=Object.keys(S),P=Object.create(null);for(let x of y){let $=S[x];if($!==null&&typeof $=="object"||Array.isArray($))P[x]=d(v,$);else{if($ instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");P[x]=$}}return P}}function h(v,S){let y=S.asChangeTextDocumentParams(v,v.document.uri,v.document.version);return{document:y.textDocument,changes:y.contentChanges}}t.asTextContentChange=h;function m(v,S){let y=Object.create(null);if(v.metadata&&(y.metadata=r.c2p.asMetadata(v.metadata)),v.cells!==void 0){let P=Object.create(null),x=v.cells;x.structure&&(P.structure={array:{start:x.structure.array.start,deleteCount:x.structure.array.deleteCount,cells:x.structure.array.cells!==void 0?x.structure.array.cells.map($=>r.c2p.asNotebookCell($,S)):void 0},didOpen:x.structure.didOpen!==void 0?x.structure.didOpen.map($=>S.asOpenTextDocumentParams($.document).textDocument):void 0,didClose:x.structure.didClose!==void 0?x.structure.didClose.map($=>S.asCloseTextDocumentParams($.document).textDocument):void 0}),x.data!==void 0&&(P.data=x.data.map($=>r.c2p.asNotebookCell($,S))),x.textContent!==void 0&&(P.textContent=x.textContent.map($=>r.c2p.asTextContentChange($,S))),Object.keys(P).length>0&&(y.cells=P)}return y}t.asNotebookDocumentChangeEvent=m})(e=r.c2p||(r.c2p={}))})(zi||(zi={}));var _l;(function(r){function e(a,c,d){let h=a.length,m=c.length,v=0;for(;v<m&&v<h&&t(a[v],c[v],d);)v++;if(v<m&&v<h){let S=h-1,y=m-1;for(;S>=0&&y>=0&&t(a[S],c[y],d);)S--,y--;let P=S+1-v,x=v===y+1?void 0:c.slice(v,y+1);return x!==void 0?{start:v,deleteCount:P,cells:x}:{start:v,deleteCount:P}}else return v<m?{start:v,deleteCount:0,cells:c.slice(v)}:v<h?{start:v,deleteCount:h-v}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&i(a.timing,c.timing)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let d=Array.isArray(a),h=Array.isArray(c);if(d!==h)return!1;if(d&&h){if(a.length!==c.length)return!1;for(let m=0;m<a.length;m++)if(!s(a[m],c[m]))return!1}if(o(a)&&o(c)){let m=Object.keys(a),v=Object.keys(c);if(m.length!==v.length||(m.sort(),v.sort(),!s(m,v)))return!1;for(let S=0;S<m.length;S++){let y=m[S];if(!s(a[y],c[y]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(_l||(_l={}));var Tl;(function(r){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let i=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&i.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new J_.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(i.fsPath))return!1}return!0}r.matchNotebook=e})(Tl||(Tl={}));var fa;(function(r){function e(n){let i=n.notebookSelector,s=[];for(let o of i){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,d=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let h of o.cells)s.push(t(a,c,d,h.language));else s.push(t(a,c,d,void 0))}return s}r.asDocumentSelector=e;function t(n,i,s,o){return i===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:i,pattern:s},language:o}}})(fa||(fa={}));var ha;(function(r){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}r.create=e})(ha||(ha={}));var Bi=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)),Gt.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of Gt.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);Gt.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&Gt.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),Gt.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of Gt.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return Gt.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(Gt.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),i=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(i&&s||!i&&!s)return;if(i){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else i&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){Gt.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let i=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===i.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let i=this.asNotebookDocumentChangeEvent(e,void 0,n,t);i!==void 0&&this.doSendChange(i,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let i=this.getMatchingCells(t);if(i===void 0)return;this.didOpen(t,i,n)}else{let i=this.getMatchingCells(t);if(i===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,i);s!==void 0&&this.doSendChange(s,i).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(i=>t.uris.has(i.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=zi.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(d=>this.client.code2ProtocolConverter.asTextDocumentItem(d.document));try{await this.client.sendNotification(Tr.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(d){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",d),d}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),ha.create(t)),i?.didOpen!==void 0?i.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(Tr.DidChangeNotebookDocumentNotification.type,{notebookDocument:zi.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:zi.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},i=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),ha.create(t??[])),i?.didChange!==void 0?i?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async i=>{try{await this.client.sendNotification(Tr.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(i.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(Tr.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),i?.didClose!==void 0?i.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,i){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=zi.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(i.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&i!==void 0){let a=n.cells,c=i,d=_l.computeDiff(a,c,!1),h,m;if(d!==void 0){h=d.cells===void 0?new Map:new Map(d.cells.map(y=>[y.document.uri.toString(),y])),m=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(y=>[y.document.uri.toString(),y]));for(let y of Array.from(m.keys()))h.has(y)&&(m.delete(y),h.delete(y));s.cells=s.cells??{};let v=[],S=[];if(h.size>0||m.size>0){for(let y of h.values())v.push(y);for(let y of m.values())S.push(y)}s.cells.structure={array:d,didOpen:v,didClose:S}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||Tl.matchNotebook(n.notebook,e)){let i=this.filterCells(e,t,n.cells);return i.length===0?void 0:i}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let i=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some(a=>a.language==="*"||o===a.language)}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,i):i}},pa=class r{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=Tr.NotebookDocumentSyncRegistrationType.type,Gt.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Bi&&s.didOpenNotebookCellTextDocument(n,i)}),Gt.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==r.CellScheme)return;let[i]=this.findNotebookDocumentAndCell(n);if(i!==void 0)for(let s of this.registrations.values())s instanceof Bi&&s.didChangeNotebookCellTextDocument(i,t)}),Gt.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Bi&&s.didCloseNotebookCellTextDocument(n,i)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=Rb(Rb(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??X_.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new Bi(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}clear(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==r.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&Gt.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of Gt.workspace.notebookDocuments)for(let i of n.getCells())if(i.document.uri.toString()===t)return[n,i];return[void 0,void 0]}};ga.NotebookDocumentSyncFeature=pa;pa.CellScheme="vscode-notebook-cell"});var Tb=I(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.SyncConfigurationFeature=Vr.toJSONObject=Vr.ConfigurationFeature=void 0;var Gi=require("vscode"),qs=me(),Q_=Hn(),Y_=ot(),_b=Ie(),Dl=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(qs.ConfigurationRequest.type,(t,n)=>{let i=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,i):i(t,n)})}getConfiguration(e,t){let n=null;if(t){let i=t.lastIndexOf(".");if(i===-1)n=di(Gi.workspace.getConfiguration(void 0,e).get(t));else{let s=Gi.workspace.getConfiguration(t.substr(0,i),e);s&&(n=di(s.get(t.substr(i+1))))}}else{let i=Gi.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(i))i.has(s)&&(n[s]=di(i.get(s)))}return n===void 0&&(n=null),n}clear(){}};Vr.ConfigurationFeature=Dl;function di(r){if(r){if(Array.isArray(r))return r.map(di);if(typeof r=="object"){let e=Object.create(null);for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=di(r[t]));return e}}return r}Vr.toJSONObject=di;var Pl=class{constructor(e){this._client=e,this.isCleared=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return qs.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,_b.ensure)((0,_b.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){this.isCleared=!1;let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:Y_.generateUuid(),registerOptions:{section:e}})}register(e){let t=Gi.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isCleared=!0}onDidChangeConfiguration(e,t){if(this.isCleared)return;let n;if(Q_.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let i=async o=>o===void 0?this._client.sendNotification(qs.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(qs.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,i):i(n)).catch(o=>{this._client.error(`Sending notification ${qs.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,i=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=Gi.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=Gi.workspace.getConfiguration(void 0,n).get(o),c){let d=e[s].split(".");t(i,d)[d[d.length-1]]=di(c)}}return i}};Vr.SyncConfigurationFeature=Pl});var Db=I(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.DidSaveTextDocumentFeature=fn.WillSaveWaitUntilFeature=fn.WillSaveFeature=fn.DidChangeTextDocumentFeature=fn.DidCloseTextDocumentFeature=fn.DidOpenTextDocumentFeature=void 0;var In=require("vscode"),Je=me(),dt=Ie(),Ji=ot(),kl=class extends dt.TextDocumentEventFeature{constructor(e,t){super(e,In.workspace.onDidOpenTextDocument,Je.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,dt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Ji.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Je.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);In.workspace.textDocuments.forEach(n=>{let i=n.uri.toString();if(!this._syncedDocuments.has(i)&&In.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(i,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};fn.DidOpenTextDocumentFeature=kl;var El=class extends dt.TextDocumentEventFeature{constructor(e,t,n){super(e,In.workspace.onDidCloseTextDocument,Je.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,i=>e.code2ProtocolConverter.asCloseTextDocumentParams(i),i=>i,dt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return Je.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Ji.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(i=>{if(In.languages.match(t,i)>0&&!this._selectorFilter(n,i)&&!this._client.hasDedicatedTextSynchronizationFeature(i)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(i.uri.toString()),(s.didClose?s.didClose(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};fn.DidCloseTextDocumentFeature=El;var xl=class extends dt.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new In.EventEmitter,this._onPendingChangeAdded=new In.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Je.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Je.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==Je.TextDocumentSyncKind.None&&this.register({id:Ji.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,i=[];for(let s of this._changeData.values())if(In.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===Je.TextDocumentSyncKind.Incremental){let a=async c=>{let d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification(Je.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Je.DidChangeTextDocumentNotification.type,d)};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Je.TextDocumentSyncKind.Full){let a=async c=>{let d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(i).then(void 0,s=>{throw this._client.error(`Sending document notification ${Je.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Je.TextDocumentSyncKind.None;else{this._syncKind=Je.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Je.TextDocumentSyncKind.Full)break}}clear(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Je.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(In.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==Je.TextDocumentSyncKind.Full)switch(e){case Je.TextDocumentSyncKind.Full:this._syncKind=e;break;case Je.TextDocumentSyncKind.Incremental:this._syncKind===Je.TextDocumentSyncKind.None&&(this._syncKind=Je.TextDocumentSyncKind.Incremental);break}}};fn.DidChangeTextDocumentFeature=xl;var Il=class extends dt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onWillSaveTextDocument,Je.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>dt.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return Je.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:Ji.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};fn.WillSaveFeature=Il;var ql=class extends dt.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Je.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:Ji.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(dt.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=i=>this._client.sendRequest(Je.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(i)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};fn.WillSaveWaitUntilFeature=ql;var Ol=class extends dt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onDidSaveTextDocument,Je.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,dt.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Je.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,dt.ensure)((0,dt.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let i=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:Ji.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},i)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};fn.DidSaveTextDocumentFeature=Ol});var Pb=I(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.CompletionItemFeature=void 0;var Z_=require("vscode"),ke=me(),Fl=Ie(),eT=ot(),tT=[ke.CompletionItemKind.Text,ke.CompletionItemKind.Method,ke.CompletionItemKind.Function,ke.CompletionItemKind.Constructor,ke.CompletionItemKind.Field,ke.CompletionItemKind.Variable,ke.CompletionItemKind.Class,ke.CompletionItemKind.Interface,ke.CompletionItemKind.Module,ke.CompletionItemKind.Property,ke.CompletionItemKind.Unit,ke.CompletionItemKind.Value,ke.CompletionItemKind.Enum,ke.CompletionItemKind.Keyword,ke.CompletionItemKind.Snippet,ke.CompletionItemKind.Color,ke.CompletionItemKind.File,ke.CompletionItemKind.Reference,ke.CompletionItemKind.Folder,ke.CompletionItemKind.EnumMember,ke.CompletionItemKind.Constant,ke.CompletionItemKind.Struct,ke.CompletionItemKind.Event,ke.CompletionItemKind.Operator,ke.CompletionItemKind.TypeParameter],Ll=class extends Fl.TextDocumentLanguageFeature{constructor(e){super(e,ke.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,Fl.ensure)((0,Fl.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ke.MarkupKind.Markdown,ke.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ke.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ke.InsertTextMode.asIs,ke.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ke.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:tT},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:eT.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],i=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,d,h)=>{let m=this._client,v=this._client.middleware,S=(y,P,x,$)=>m.sendRequest(ke.CompletionRequest.type,m.code2ProtocolConverter.asCompletionParams(y,P,x),$).then(U=>$.isCancellationRequested?null:m.protocol2CodeConverter.asCompletionResult(U,i,$),U=>m.handleFailedRequest(ke.CompletionRequest.type,$,U,null));return v.provideCompletionItem?v.provideCompletionItem(a,c,h,d,S):S(a,c,h,d)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let d=this._client,h=this._client.middleware,m=(v,S)=>d.sendRequest(ke.CompletionResolveRequest.type,d.code2ProtocolConverter.asCompletionItem(v,!!this.labelDetailsSupport.get(t)),S).then(y=>S.isCancellationRequested?null:d.protocol2CodeConverter.asCompletionItem(y),y=>d.handleFailedRequest(ke.CompletionResolveRequest.type,S,y,v));return h.resolveCompletionItem?h.resolveCompletionItem(a,c,m):m(a,c)}:void 0};return[Z_.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};ma.CompletionItemFeature=Ll});var kb=I(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.HoverFeature=void 0;var nT=require("vscode"),Os=me(),Ml=Ie(),rT=ot(),Nl=class extends Ml.TextDocumentLanguageFeature{constructor(e){super(e,Os.HoverRequest.type)}fillClientCapabilities(e){let t=(0,Ml.ensure)((0,Ml.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[Os.MarkupKind.Markdown,Os.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:rT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(Os.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asHover(S),S=>a.handleFailedRequest(Os.HoverRequest.type,v,S,null)),d=a.middleware;return d.provideHover?d.provideHover(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return nT.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};va.HoverFeature=Nl});var Eb=I(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.DefinitionFeature=void 0;var iT=require("vscode"),Al=me(),jl=Ie(),sT=ot(),$l=class extends jl.TextDocumentLanguageFeature{constructor(e){super(e,Al.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,jl.ensure)((0,jl.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:sT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(Al.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,v),S=>a.handleFailedRequest(Al.DefinitionRequest.type,v,S,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return iT.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ya.DefinitionFeature=$l});var Ib=I(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.SignatureHelpFeature=void 0;var xb=require("vscode"),Fs=me(),Ul=Ie(),oT=ot(),Wl=class extends Ul.TextDocumentLanguageFeature{constructor(e){super(e,Fs.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,Ul.ensure)((0,Ul.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[Fs.MarkupKind.Markdown,Fs.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:oT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,i,s,o)=>{let a=this._client,c=(h,m,v,S)=>a.sendRequest(Fs.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(h,m,v),S).then(y=>S.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(y,S),y=>a.handleFailedRequest(Fs.SignatureHelpRequest.type,S,y,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(n,i,o,s,c):c(n,i,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let i=e.triggerCharacters||[];return xb.languages.registerSignatureHelpProvider(n,t,...i)}else{let i={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return xb.languages.registerSignatureHelpProvider(n,t,i)}}};ba.SignatureHelpFeature=Wl});var qb=I(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.DocumentHighlightFeature=void 0;var aT=require("vscode"),Hl=me(),Vl=Ie(),cT=ot(),Kl=class extends Vl.TextDocumentLanguageFeature{constructor(e){super(e,Hl.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,Vl.ensure)((0,Vl.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:cT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(Hl.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(S,v),S=>a.handleFailedRequest(Hl.DocumentHighlightRequest.type,v,S,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(i,s,o,c):c(i,s,o)}};return[aT.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};wa.DocumentHighlightFeature=Kl});var Gl=I(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.DocumentSymbolFeature=vr.SupportedSymbolTags=vr.SupportedSymbolKinds=void 0;var uT=require("vscode"),Le=me(),zl=Ie(),dT=ot();vr.SupportedSymbolKinds=[Le.SymbolKind.File,Le.SymbolKind.Module,Le.SymbolKind.Namespace,Le.SymbolKind.Package,Le.SymbolKind.Class,Le.SymbolKind.Method,Le.SymbolKind.Property,Le.SymbolKind.Field,Le.SymbolKind.Constructor,Le.SymbolKind.Enum,Le.SymbolKind.Interface,Le.SymbolKind.Function,Le.SymbolKind.Variable,Le.SymbolKind.Constant,Le.SymbolKind.String,Le.SymbolKind.Number,Le.SymbolKind.Boolean,Le.SymbolKind.Array,Le.SymbolKind.Object,Le.SymbolKind.Key,Le.SymbolKind.Null,Le.SymbolKind.EnumMember,Le.SymbolKind.Struct,Le.SymbolKind.Event,Le.SymbolKind.Operator,Le.SymbolKind.TypeParameter];vr.SupportedSymbolTags=[Le.SymbolTag.Deprecated];var Bl=class extends zl.TextDocumentLanguageFeature{constructor(e){super(e,Le.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,zl.ensure)((0,zl.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:vr.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:vr.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:dT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(h,m)=>{try{let v=await a.sendRequest(Le.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(h),m);if(m.isCancellationRequested||v===void 0||v===null)return null;if(v.length===0)return[];{let S=v[0];return Le.DocumentSymbol.is(S)?await a.protocol2CodeConverter.asDocumentSymbols(v,m):await a.protocol2CodeConverter.asSymbolInformations(v,m)}}catch(v){return a.handleFailedRequest(Le.DocumentSymbolRequest.type,m,v,null)}},d=a.middleware;return d.provideDocumentSymbols?d.provideDocumentSymbols(s,o,c):c(s,o)}},i=e.label!==void 0?{label:e.label}:void 0;return[uT.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,i),n]}};vr.DocumentSymbolFeature=Bl});var Fb=I(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.WorkspaceSymbolFeature=void 0;var lT=require("vscode"),Ls=me(),Jl=Ie(),Ob=Gl(),fT=ot(),Xl=class extends Jl.WorkspaceFeature{constructor(e){super(e,Ls.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Jl.ensure)((0,Jl.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Ob.SupportedSymbolKinds},t.tagSupport={valueSet:Ob.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:fT.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ls.WorkspaceSymbolRequest.type,{query:c},d).then(h=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(h,d),h=>s.handleFailedRequest(Ls.WorkspaceSymbolRequest.type,d,h,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,i,o):o(n,i)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ls.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(h=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(h),h=>s.handleFailedRequest(Ls.WorkspaceSymbolResolveRequest.type,d,h,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,i,o):o(n,i)}:void 0};return[lT.languages.registerWorkspaceSymbolProvider(t),t]}};Ca.WorkspaceSymbolFeature=Xl});var Lb=I(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.ReferencesFeature=void 0;var hT=require("vscode"),Ql=me(),Yl=Ie(),pT=ot(),Zl=class extends Yl.TextDocumentLanguageFeature{constructor(e){super(e,Ql.ReferencesRequest.type)}fillClientCapabilities(e){(0,Yl.ensure)((0,Yl.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:pT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(i,s,o,a)=>{let c=this._client,d=(m,v,S,y)=>c.sendRequest(Ql.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(m,v,S),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(P,y),P=>c.handleFailedRequest(Ql.ReferencesRequest.type,y,P,null)),h=c.middleware;return h.provideReferences?h.provideReferences(i,s,o,a,d):d(i,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return hT.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ra.ReferencesFeature=Zl});var Mb=I(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.CodeActionFeature=void 0;var gT=require("vscode"),qn=me(),mT=ot(),ef=Ie(),tf=class extends ef.TextDocumentLanguageFeature{constructor(e){super(e,qn.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,ef.ensure)((0,ef.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[qn.CodeActionKind.Empty,qn.CodeActionKind.QuickFix,qn.CodeActionKind.Refactor,qn.CodeActionKind.RefactorExtract,qn.CodeActionKind.RefactorInline,qn.CodeActionKind.RefactorRewrite,qn.CodeActionKind.Source,qn.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:mT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(i,s,o,a)=>{let c=this._client,d=async(m,v,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(v),context:c.code2ProtocolConverter.asCodeActionContextSync(S)};return c.sendRequest(qn.CodeActionRequest.type,P,y).then(x=>y.isCancellationRequested||x===null||x===void 0?null:c.protocol2CodeConverter.asCodeActionResult(x,y),x=>c.handleFailedRequest(qn.CodeActionRequest.type,y,x,null))},h=c.middleware;return h.provideCodeActions?h.provideCodeActions(i,s,o,a,d):d(i,s,o,a)},resolveCodeAction:e.resolveProvider?(i,s)=>{let o=this._client,a=this._client.middleware,c=async(d,h)=>o.sendRequest(qn.CodeActionResolveRequest.type,o.code2ProtocolConverter.asCodeActionSync(d),h).then(m=>h.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(m,h),m=>o.handleFailedRequest(qn.CodeActionResolveRequest.type,h,m,d));return a.resolveCodeAction?a.resolveCodeAction(i,s,c):c(i,s)}:void 0};return[gT.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};Sa.CodeActionFeature=tf});var Ab=I(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.CodeLensFeature=void 0;var Nb=require("vscode"),Xi=me(),vT=ot(),Ms=Ie(),nf=class extends Ms.TextDocumentLanguageFeature{constructor(e){super(e,Xi.CodeLensRequest.type)}fillClientCapabilities(e){(0,Ms.ensure)((0,Ms.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,Ms.ensure)((0,Ms.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(Xi.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let i=this.getRegistrationOptions(t,e.codeLensProvider);i&&this.register({id:vT.generateUuid(),registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Nb.EventEmitter,i={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(h,m)=>a.sendRequest(Xi.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(h),m).then(v=>m.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(v,m),v=>a.handleFailedRequest(Xi.CodeLensRequest.type,m,v,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(h,m)=>a.sendRequest(Xi.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(h),m).then(v=>m.isCancellationRequested?h:a.protocol2CodeConverter.asCodeLens(v),v=>a.handleFailedRequest(Xi.CodeLensResolveRequest.type,m,v,h)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[Nb.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeCodeLensEmitter:n}]}};_a.CodeLensFeature=nf});var jb=I(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.DocumentOnTypeFormattingFeature=Kr.DocumentRangeFormattingFeature=Kr.DocumentFormattingFeature=void 0;var Ta=require("vscode"),rr=me(),af=ot(),Dr=Ie(),Qi;(function(r){function e(t){let n=Ta.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}r.fromConfiguration=e})(Qi||(Qi={}));var rf=class extends Dr.TextDocumentLanguageFeature{constructor(e){super(e,rr.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,Dr.ensure)((0,Dr.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:af.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(i,s,o)=>{let a=this._client,c=(h,m,v)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(h),options:a.code2ProtocolConverter.asFormattingOptions(m,Qi.fromConfiguration(h))};return a.sendRequest(rr.DocumentFormattingRequest.type,S,v).then(y=>v.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(y,v),y=>a.handleFailedRequest(rr.DocumentFormattingRequest.type,v,y,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(i,s,o,c):c(i,s,o)}};return[Ta.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Kr.DocumentFormattingFeature=rf;var sf=class extends Dr.TextDocumentLanguageFeature{constructor(e){super(e,rr.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){let t=(0,Dr.ensure)((0,Dr.ensure)(e,"textDocument"),"rangeFormatting");t.dynamicRegistration=!0,t.rangesSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:af.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(i,s,o,a)=>{let c=this._client,d=(m,v,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(v),options:c.code2ProtocolConverter.asFormattingOptions(S,Qi.fromConfiguration(m))};return c.sendRequest(rr.DocumentRangeFormattingRequest.type,P,y).then(x=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,y),x=>c.handleFailedRequest(rr.DocumentRangeFormattingRequest.type,y,x,null))},h=c.middleware;return h.provideDocumentRangeFormattingEdits?h.provideDocumentRangeFormattingEdits(i,s,o,a,d):d(i,s,o,a)}};return e.rangesSupport&&(n.provideDocumentRangesFormattingEdits=(i,s,o,a)=>{let c=this._client,d=(m,v,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),ranges:c.code2ProtocolConverter.asRanges(v),options:c.code2ProtocolConverter.asFormattingOptions(S,Qi.fromConfiguration(m))};return c.sendRequest(rr.DocumentRangesFormattingRequest.type,P,y).then(x=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,y),x=>c.handleFailedRequest(rr.DocumentRangesFormattingRequest.type,y,x,null))},h=c.middleware;return h.provideDocumentRangesFormattingEdits?h.provideDocumentRangesFormattingEdits(i,s,o,a,d):d(i,s,o,a)}),[Ta.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Kr.DocumentRangeFormattingFeature=sf;var of=class extends Dr.TextDocumentLanguageFeature{constructor(e){super(e,rr.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,Dr.ensure)((0,Dr.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:af.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{let h=this._client,m=(S,y,P,x,$)=>{let U={textDocument:h.code2ProtocolConverter.asTextDocumentIdentifier(S),position:h.code2ProtocolConverter.asPosition(y),ch:P,options:h.code2ProtocolConverter.asFormattingOptions(x,Qi.fromConfiguration(S))};return h.sendRequest(rr.DocumentOnTypeFormattingRequest.type,U,$).then(M=>$.isCancellationRequested?null:h.protocol2CodeConverter.asTextEdits(M,$),M=>h.handleFailedRequest(rr.DocumentOnTypeFormattingRequest.type,$,M,null))},v=h.middleware;return v.provideOnTypeFormattingEdits?v.provideOnTypeFormattingEdits(s,o,a,c,d,m):m(s,o,a,c,d)}},i=e.moreTriggerCharacter||[];return[Ta.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...i),n]}};Kr.DocumentOnTypeFormattingFeature=of});var Ub=I(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.RenameFeature=void 0;var yT=require("vscode"),li=me(),bT=ot(),$b=Hn(),cf=Ie(),uf=class extends cf.TextDocumentLanguageFeature{constructor(e){super(e,li.RenameRequest.type)}fillClientCapabilities(e){let t=(0,cf.ensure)((0,cf.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=li.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&($b.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:bT.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(i,s,o,a)=>{let c=this._client,d=(m,v,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),position:c.code2ProtocolConverter.asPosition(v),newName:S};return c.sendRequest(li.RenameRequest.type,P,y).then(x=>y.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(x,y),x=>c.handleFailedRequest(li.RenameRequest.type,y,x,null,!1))},h=c.middleware;return h.provideRenameEdits?h.provideRenameEdits(i,s,o,a,d):d(i,s,o,a)},prepareRename:e.prepareProvider?(i,s,o)=>{let a=this._client,c=(h,m,v)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(h),position:a.code2ProtocolConverter.asPosition(m)};return a.sendRequest(li.PrepareRenameRequest.type,S,v).then(y=>v.isCancellationRequested?null:li.Range.is(y)?a.protocol2CodeConverter.asRange(y):this.isDefaultBehavior(y)?y.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):y&&li.Range.is(y.range)?{range:a.protocol2CodeConverter.asRange(y.range),placeholder:y.placeholder}:Promise.reject(new Error("The element can't be renamed.")),y=>{throw typeof y.message=="string"?new Error(y.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(i,s,o,c):c(i,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return yT.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&$b.boolean(t.defaultBehavior)}};Da.RenameFeature=uf});var Wb=I(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.DocumentLinkFeature=void 0;var wT=require("vscode"),Ns=me(),df=Ie(),CT=ot(),lf=class extends df.TextDocumentLanguageFeature{constructor(e){super(e,Ns.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,df.ensure)((0,df.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:CT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(i,s)=>{let o=this._client,a=(d,h)=>o.sendRequest(Ns.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),h).then(m=>h.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(m,h),m=>o.handleFailedRequest(Ns.DocumentLinkRequest.type,h,m,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(i,s,a):a(i,s)},resolveDocumentLink:e.resolveProvider?(i,s)=>{let o=this._client,a=(d,h)=>o.sendRequest(Ns.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),h).then(m=>h.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(m),m=>o.handleFailedRequest(Ns.DocumentLinkResolveRequest.type,h,m,d)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(i,s,a):a(i,s)}:void 0};return[wT.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Pa.DocumentLinkFeature=lf});var Vb=I(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.ExecuteCommandFeature=void 0;var RT=require("vscode"),ff=me(),ST=ot(),Hb=Ie(),hf=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return ff.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,Hb.ensure)((0,Hb.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:ST.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,i=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(ff.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(ff.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(RT.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,i):i(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}clear(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};ka.ExecuteCommandFeature=hf});var Kb=I(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.FileSystemWatcherFeature=void 0;var _T=require("vscode"),fi=me(),Ea=Ie(),pf=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return fi.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let i=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(i===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&fi.WatchKind.Create)!==0,o=(n.kind&fi.WatchKind.Change)!==0,a=(n.kind&fi.WatchKind.Delete)!==0);let c=_T.workspace.createFileSystemWatcher(i,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let i of t)this.hookListeners(i,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,i,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:fi.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:fi.FileChangeType.Changed}),null,s),i&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:fi.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}clear(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};xa.FileSystemWatcherFeature=pf});var zb=I(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.ColorProviderFeature=void 0;var TT=require("vscode"),As=me(),gf=Ie(),mf=class extends gf.TextDocumentLanguageFeature{constructor(e){super(e,As.DocumentColorRequest.type)}fillClientCapabilities(e){(0,gf.ensure)((0,gf.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.colorProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(i,s,o)=>{let a=this._client,c=(h,m,v)=>{let S={color:h,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(m.document),range:a.code2ProtocolConverter.asRange(m.range)};return a.sendRequest(As.ColorPresentationRequest.type,S,v).then(y=>v.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(y,v),y=>a.handleFailedRequest(As.ColorPresentationRequest.type,v,y,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(i,s,o,c):c(i,s,o)},provideDocumentColors:(i,s)=>{let o=this._client,a=(d,h)=>{let m={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest(As.DocumentColorRequest.type,m,h).then(v=>h.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(v,h),v=>o.handleFailedRequest(As.DocumentColorRequest.type,h,v,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(i,s,a):a(i,s)}};return[TT.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ia.ColorProviderFeature=mf});var Bb=I(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.ImplementationFeature=void 0;var DT=require("vscode"),vf=me(),yf=Ie(),bf=class extends yf.TextDocumentLanguageFeature{constructor(e){super(e,vf.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,yf.ensure)((0,yf.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.implementationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(vf.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,v),S=>a.handleFailedRequest(vf.ImplementationRequest.type,v,S,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return DT.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};qa.ImplementationFeature=bf});var Gb=I(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.TypeDefinitionFeature=void 0;var PT=require("vscode"),wf=me(),js=Ie(),Cf=class extends js.TextDocumentLanguageFeature{constructor(e){super(e,wf.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,js.ensure)((0,js.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,js.ensure)((0,js.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeDefinitionProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(wf.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,v),S=>a.handleFailedRequest(wf.TypeDefinitionRequest.type,v,S,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return PT.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Oa.TypeDefinitionFeature=Cf});var Jb=I(Yi=>{"use strict";Object.defineProperty(Yi,"__esModule",{value:!0});Yi.WorkspaceFoldersFeature=Yi.arrayDiff=void 0;var kT=ot(),Fa=require("vscode"),$s=me();function Rf(r,e){if(r!=null)return r[e]}function Sf(r,e){return r.filter(t=>e.indexOf(t)<0)}Yi.arrayDiff=Sf;var _f=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return $s.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Fa.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest($s.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Fa.workspace.workspaceFolders;return c===void 0?null:c.map(h=>this.asProtocol(h))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=Rf(Rf(Rf(e,"workspace"),"workspaceFolders"),"changeNotifications"),i;typeof n=="string"?i=n:n===!0&&(i=kT.generateUuid()),i&&this.register({id:i,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=Sf(this._initialFolders,e),i=Sf(e,this._initialFolders);(i.length>0||n.length>0)&&(t=this.doSendEvent(i,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${$s.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(i=>this.asProtocol(i)),removed:t.map(i=>this.asProtocol(i))}};return this._client.sendNotification($s.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,i=Fa.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${$s.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,i),this.sendInitialEvent(Fa.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};Yi.WorkspaceFoldersFeature=_f});var Qb=I(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.FoldingRangeFeature=void 0;var Xb=require("vscode"),hi=me(),Us=Ie(),Tf=class extends Us.TextDocumentLanguageFeature{constructor(e){super(e,hi.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Us.ensure)((0,Us.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[hi.FoldingRangeKind.Comment,hi.FoldingRangeKind.Imports,hi.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1},(0,Us.ensure)((0,Us.ensure)(e,"workspace"),"foldingRange").refreshSupport=!0}initialize(e,t){this._client.onRequest(hi.FoldingRangeRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeFoldingRange.fire()});let[n,i]=this.getRegistration(t,e.foldingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Xb.EventEmitter,i={onDidChangeFoldingRanges:n.event,provideFoldingRanges:(s,o,a)=>{let c=this._client,d=(m,v,S)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m)};return c.sendRequest(hi.FoldingRangeRequest.type,y,S).then(P=>S.isCancellationRequested?null:c.protocol2CodeConverter.asFoldingRanges(P,S),P=>c.handleFailedRequest(hi.FoldingRangeRequest.type,S,P,null))},h=c.middleware;return h.provideFoldingRanges?h.provideFoldingRanges(s,o,a,d):d(s,o,a)}};return[Xb.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeFoldingRange:n}]}};La.FoldingRangeFeature=Tf});var Yb=I(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.DeclarationFeature=void 0;var ET=require("vscode"),Df=me(),Pf=Ie(),kf=class extends Pf.TextDocumentLanguageFeature{constructor(e){super(e,Df.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,Pf.ensure)((0,Pf.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.declarationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(Df.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(S,v),S=>a.handleFailedRequest(Df.DeclarationRequest.type,v,S,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return ET.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ma.DeclarationFeature=kf});var Zb=I(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});Na.SelectionRangeFeature=void 0;var xT=require("vscode"),Ef=me(),xf=Ie(),If=class extends xf.TextDocumentLanguageFeature{constructor(e){super(e,Ef.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,xf.ensure)((0,xf.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.selectionRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(i,s,o)=>{let a=this._client,c=async(h,m,v)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(h),positions:a.code2ProtocolConverter.asPositionsSync(m,v)};return a.sendRequest(Ef.SelectionRangeRequest.type,S,v).then(y=>v.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(y,v),y=>a.handleFailedRequest(Ef.SelectionRangeRequest.type,v,y,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return xT.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Na.SelectionRangeFeature=If});var tw=I(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.ProgressFeature=void 0;var ew=me(),IT=rl();function qT(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}var qf=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:ew.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){qT(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=i=>{this.activeParts.delete(i)},n=i=>{this.activeParts.add(new IT.ProgressPart(this._client,i.token,t))};e.onRequest(ew.WorkDoneProgressCreateRequest.type,n)}clear(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};Aa.ProgressFeature=qf});var nw=I(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.CallHierarchyFeature=void 0;var OT=require("vscode"),pi=me(),Of=Ie(),Ff=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let h=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(pi.CallHierarchyPrepareRequest.type,h,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyItems(m,d),m=>i.handleFailedRequest(pi.CallHierarchyPrepareRequest.type,d,m,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(pi.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>n.handleFailedRequest(pi.CallHierarchyIncomingCallsRequest.type,a,d,null))};return i.provideCallHierarchyIncomingCalls?i.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(pi.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>n.handleFailedRequest(pi.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return i.provideCallHierarchyOutgoingCalls?i.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},Lf=class extends Of.TextDocumentLanguageFeature{constructor(e){super(e,pi.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Of.ensure)((0,Of.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.callHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Ff(t);return[OT.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};ja.CallHierarchyFeature=Lf});var rw=I(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.SemanticTokensFeature=void 0;var $a=require("vscode"),be=me(),Ws=Ie(),FT=Hn(),Mf=class extends Ws.TextDocumentLanguageFeature{constructor(e){super(e,be.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,Ws.ensure)((0,Ws.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[be.SemanticTokenTypes.namespace,be.SemanticTokenTypes.type,be.SemanticTokenTypes.class,be.SemanticTokenTypes.enum,be.SemanticTokenTypes.interface,be.SemanticTokenTypes.struct,be.SemanticTokenTypes.typeParameter,be.SemanticTokenTypes.parameter,be.SemanticTokenTypes.variable,be.SemanticTokenTypes.property,be.SemanticTokenTypes.enumMember,be.SemanticTokenTypes.event,be.SemanticTokenTypes.function,be.SemanticTokenTypes.method,be.SemanticTokenTypes.macro,be.SemanticTokenTypes.keyword,be.SemanticTokenTypes.modifier,be.SemanticTokenTypes.comment,be.SemanticTokenTypes.string,be.SemanticTokenTypes.number,be.SemanticTokenTypes.regexp,be.SemanticTokenTypes.operator,be.SemanticTokenTypes.decorator],t.tokenModifiers=[be.SemanticTokenModifiers.declaration,be.SemanticTokenModifiers.definition,be.SemanticTokenModifiers.readonly,be.SemanticTokenModifiers.static,be.SemanticTokenModifiers.deprecated,be.SemanticTokenModifiers.abstract,be.SemanticTokenModifiers.async,be.SemanticTokenModifiers.modification,be.SemanticTokenModifiers.documentation,be.SemanticTokenModifiers.defaultLibrary],t.formats=[be.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,Ws.ensure)((0,Ws.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(be.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[i,s]=this.getRegistration(t,e.semanticTokensProvider);!i||!s||this.register({id:i,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=FT.boolean(e.full)?e.full:e.full!==void 0,i=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new $a.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(S,y)=>{let P=this._client,x=P.middleware,$=(U,M)=>{let K={textDocument:P.code2ProtocolConverter.asTextDocumentIdentifier(U)};return P.sendRequest(be.SemanticTokensRequest.type,K,M).then(B=>M.isCancellationRequested?null:P.protocol2CodeConverter.asSemanticTokens(B,M),B=>P.handleFailedRequest(be.SemanticTokensRequest.type,M,B,null))};return x.provideDocumentSemanticTokens?x.provideDocumentSemanticTokens(S,y,$):$(S,y)},provideDocumentSemanticTokensEdits:i?(S,y,P)=>{let x=this._client,$=x.middleware,U=(M,K,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),previousResultId:K};return x.sendRequest(be.SemanticTokensDeltaRequest.type,pe,B).then(async J=>B.isCancellationRequested?null:be.SemanticTokens.is(J)?await x.protocol2CodeConverter.asSemanticTokens(J,B):await x.protocol2CodeConverter.asSemanticTokensEdits(J,B),J=>x.handleFailedRequest(be.SemanticTokensDeltaRequest.type,B,J,null))};return $.provideDocumentSemanticTokensEdits?$.provideDocumentSemanticTokensEdits(S,y,P,U):U(S,y,P)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(S,y,P)=>{let x=this._client,$=x.middleware,U=(M,K,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),range:x.code2ProtocolConverter.asRange(K)};return x.sendRequest(be.SemanticTokensRangeRequest.type,pe,B).then(J=>B.isCancellationRequested?null:x.protocol2CodeConverter.asSemanticTokens(J,B),J=>x.handleFailedRequest(be.SemanticTokensRangeRequest.type,B,J,null))};return $.provideDocumentRangeSemanticTokens?$.provideDocumentRangeSemanticTokens(S,y,P,U):U(S,y,P)}}:void 0,d=[],h=this._client,m=h.protocol2CodeConverter.asSemanticTokensLegend(e.legend),v=h.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push($a.languages.registerDocumentSemanticTokensProvider(v,o,m)),c!==void 0&&d.push($a.languages.registerDocumentRangeSemanticTokensProvider(v,c,m)),[new $a.Disposable(()=>d.forEach(S=>S.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};Ua.SemanticTokensFeature=Mf});var ow=I(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.WillDeleteFilesFeature=hn.WillRenameFilesFeature=hn.WillCreateFilesFeature=hn.DidDeleteFilesFeature=hn.DidRenameFilesFeature=hn.DidCreateFilesFeature=void 0;var Jn=require("vscode"),LT=ua(),Pr=me(),MT=ot();function iw(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function NT(r,e){return r[e]}function sw(r,e,t){r[e]=t}var Hs=class r{constructor(e,t,n,i,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=i,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=iw(iw(e,"workspace"),"fileOperations");sw(t,"dynamicRegistration",!0),sw(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?NT(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:MT.generateUuid(),registerOptions:{filters:n.filters}})}catch(i){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${i}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let i=new LT.Minimatch(n.pattern.glob,r.asMinimatchOptions(n.pattern.options));if(!i.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:i,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return r.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;let h=await this.getFileType(o);if(h===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(h===Jn.FileType.File&&d.kind===Pr.FileOperationPatternKind.file||h===Jn.FileType.Directory&&d.kind===Pr.FileOperationPatternKind.folder)return!0}else if(d.kind===Pr.FileOperationPatternKind.folder&&await r.getFileType(o)===Jn.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),i=e.files.filter((s,o)=>n[o]);return{...e,files:i}}static async getFileType(e){try{return(await Jn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){let t={dot:!0};return e?.ignoreCase===!0&&(t.nocase=!0),t}},Wa=class extends Hs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async i=>this._client.sendNotification(this._notificationType,this._createParams(i));return this.doSend(t,n)}}},Ha=class extends Wa{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await Hs.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}clear(){super.clear(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},Nf=class extends Wa{constructor(e){super(e,Jn.workspace.onDidCreateFiles,Pr.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};hn.DidCreateFilesFeature=Nf;var Af=class extends Ha{constructor(e){super(e,Jn.workspace.onDidRenameFiles,Pr.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=Jn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};hn.DidRenameFilesFeature=Af;var jf=class extends Ha{constructor(e){super(e,Jn.workspace.onDidDeleteFiles,Pr.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=Jn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};hn.DidDeleteFilesFeature=jf;var Vs=class extends Hs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=i=>this._client.sendRequest(this._requestType,this._createParams(i),i.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},$f=class extends Vs{constructor(e){super(e,Jn.workspace.onWillCreateFiles,Pr.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};hn.WillCreateFilesFeature=$f;var Uf=class extends Vs{constructor(e){super(e,Jn.workspace.onWillRenameFiles,Pr.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};hn.WillRenameFilesFeature=Uf;var Wf=class extends Vs{constructor(e){super(e,Jn.workspace.onWillDeleteFiles,Pr.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};hn.WillDeleteFilesFeature=Wf});var aw=I(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.LinkedEditingFeature=void 0;var AT=require("vscode"),Hf=me(),Vf=Ie(),Kf=class extends Vf.TextDocumentLanguageFeature{constructor(e){super(e,Hf.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Vf.ensure)((0,Vf.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(i,s,o)=>{let a=this._client,c=(h,m,v)=>a.sendRequest(Hf.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(h,m),v).then(S=>v.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(S,v),S=>a.handleFailedRequest(Hf.LinkedEditingRangeRequest.type,v,S,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return AT.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Va.LinkedEditingFeature=Kf});var cw=I(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.TypeHierarchyFeature=void 0;var jT=require("vscode"),gi=me(),zf=Ie(),Bf=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let h=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(gi.TypeHierarchyPrepareRequest.type,h,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(m,d),m=>i.handleFailedRequest(gi.TypeHierarchyPrepareRequest.type,d,m,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(gi.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(gi.TypeHierarchySupertypesRequest.type,a,d,null))};return i.provideTypeHierarchySupertypes?i.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(gi.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(gi.TypeHierarchySubtypesRequest.type,a,d,null))};return i.provideTypeHierarchySubtypes?i.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},Gf=class extends zf.TextDocumentLanguageFeature{constructor(e){super(e,gi.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,zf.ensure)((0,zf.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Bf(t);return[jT.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};Ka.TypeHierarchyFeature=Gf});var dw=I(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});Ba.InlineValueFeature=void 0;var uw=require("vscode"),za=me(),Ks=Ie(),Jf=class extends Ks.TextDocumentLanguageFeature{constructor(e){super(e,za.InlineValueRequest.type)}fillClientCapabilities(e){(0,Ks.ensure)((0,Ks.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,Ks.ensure)((0,Ks.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(za.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,i]=this.getRegistration(t,e.inlineValueProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new uw.EventEmitter,i={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let d=this._client,h=(v,S,y,P)=>{let x={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(v),range:d.code2ProtocolConverter.asRange(S),context:d.code2ProtocolConverter.asInlineValueContext(y)};return d.sendRequest(za.InlineValueRequest.type,x,P).then($=>P.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues($,P),$=>d.handleFailedRequest(za.InlineValueRequest.type,P,$,null))},m=d.middleware;return m.provideInlineValues?m.provideInlineValues(s,o,a,c,h):h(s,o,a,c)}};return[this.registerProvider(t,i),{provider:i,onDidChangeInlineValues:n}]}registerProvider(e,t){return uw.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ba.InlineValueFeature=Jf});var fw=I(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.InlayHintsFeature=void 0;var lw=require("vscode"),Zi=me(),zs=Ie(),Xf=class extends zs.TextDocumentLanguageFeature{constructor(e){super(e,Zi.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,zs.ensure)((0,zs.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,zs.ensure)((0,zs.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(Zi.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,i]=this.getRegistration(t,e.inlayHintProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new lw.EventEmitter,i={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,d=async(m,v,S)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(v)};try{let P=await c.sendRequest(Zi.InlayHintRequest.type,y,S);return S.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(P,S)}catch(P){return c.handleFailedRequest(Zi.InlayHintRequest.type,S,P,null)}},h=c.middleware;return h.provideInlayHints?h.provideInlayHints(s,o,a,d):d(s,o,a)}};return i.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(h,m)=>{try{let v=await a.sendRequest(Zi.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(h),m);if(m.isCancellationRequested)return null;let S=a.protocol2CodeConverter.asInlayHint(v,m);return m.isCancellationRequested?null:S}catch(v){return a.handleFailedRequest(Zi.InlayHintResolveRequest.type,m,v,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,i),{provider:i,onDidChangeInlayHints:n}]}registerProvider(e,t){return lw.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ga.InlayHintsFeature=Xf});var hw=I(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.InlineCompletionItemFeature=void 0;var $T=require("vscode"),Qf=me(),Yf=Ie(),UT=ot(),Zf=class extends Yf.TextDocumentLanguageFeature{constructor(e){super(e,Qf.InlineCompletionRequest.type)}fillClientCapabilities(e){let t=(0,Yf.ensure)((0,Yf.ensure)(e,"textDocument"),"inlineCompletion");t.dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.inlineCompletionProvider);n&&this.register({id:UT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideInlineCompletionItems:(i,s,o,a)=>{let c=this._client,d=this._client.middleware,h=(m,v,S,y)=>c.sendRequest(Qf.InlineCompletionRequest.type,c.code2ProtocolConverter.asInlineCompletionParams(m,v,S),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asInlineCompletionResult(P,y),P=>c.handleFailedRequest(Qf.InlineCompletionRequest.type,y,P,null));return d.provideInlineCompletionItems?d.provideInlineCompletionItems(i,s,o,a,h):h(i,s,o,a)}};return[$T.languages.registerInlineCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ja.InlineCompletionItemFeature=Zf});var sh=I(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.ProposedFeatures=Lt.BaseLanguageClient=Lt.MessageTransports=Lt.SuspendMode=Lt.State=Lt.CloseAction=Lt.ErrorAction=Lt.RevealOutputChannelOn=void 0;var Ne=require("vscode"),H=me(),WT=Hy(),HT=zy(),sr=Hn(),Xa=na(),pw=ot(),VT=rl(),ir=Ie(),KT=Sl(),gw=Sb(),mw=Tb(),es=Db(),zT=Pb(),BT=kb(),GT=Eb(),JT=Ib(),XT=qb(),QT=Gl(),YT=Fb(),ZT=Lb(),eD=Mb(),tD=Ab(),eh=jb(),nD=Ub(),rD=Wb(),iD=Vb(),sD=Kb(),oD=zb(),aD=Bb(),cD=Gb(),uD=Jb(),dD=Qb(),lD=Yb(),fD=Zb(),hD=tw(),pD=nw(),gD=rw(),ts=ow(),mD=aw(),vD=cw(),yD=dw(),bD=fw(),wD=hw(),mi;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Never=4]="Never"})(mi||(Lt.RevealOutputChannelOn=mi={}));var Gs;(function(r){r[r.Continue=1]="Continue",r[r.Shutdown=2]="Shutdown"})(Gs||(Lt.ErrorAction=Gs={}));var zr;(function(r){r[r.DoNotRestart=1]="DoNotRestart",r[r.Restart=2]="Restart"})(zr||(Lt.CloseAction=zr={}));var Bs;(function(r){r[r.Stopped=1]="Stopped",r[r.Starting=3]="Starting",r[r.Running=2]="Running"})(Bs||(Lt.State=Bs={}));var vw;(function(r){r.off="off",r.on="on"})(vw||(Lt.SuspendMode=vw={}));var th;(function(r){function e(t){return t==null?!1:typeof t=="boolean"||typeof t=="object"&&t!==null&&sr.stringArray(t.enabledCommands)?t:!1}r.sanitizeIsTrusted=e})(th||(th={}));var nh=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:Gs.Continue}:{action:Gs.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:zr.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=3*60*1e3?{action:zr.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:zr.Restart})}},Te;(function(r){r.Initial="initial",r.Starting="starting",r.StartFailed="startFailed",r.Running="running",r.Stopping="stopping",r.Stopped="stopped"})(Te||(Te={}));var yw;(function(r){function e(t){return t&&H.MessageReader.is(t.reader)&&H.MessageWriter.is(t.writer)}r.is=e})(yw||(Lt.MessageTransports=yw={}));var Js=class r{constructor(e,t,n){this._traceFormat=H.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new Xa.Semaphore(1),this._id=e,this._name=t,n=n||{};let i={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(i.isTrusted=th.sanitizeIsTrusted(n.markdown.isTrusted),i.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??mi.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:i,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=Te.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new Xa.Semaphore(1),this._pendingChangeDelayer=new Xa.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new Xa.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new H.Emitter,this._stateChangeEmitter=new H.Emitter,this._trace=H.Trace.Off,this._tracer={log:(s,o)=>{sr.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=WT.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=HT.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=Ne.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case Te.Starting:return Bs.Starting;case Te.Running:return Bs.Running;default:return Bs.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n);let i=this._clientOptions.middleware?.sendRequest;if(i!==void 0){let s,o;return t.length===1?H.CancellationToken.is(t[0])?o=t[0]:s=t[0]:t.length===2&&(s=t[0],o=t[1]),i(e,s,o,(a,c,d)=>{let h=[];return c!==void 0&&h.push(c),d!==void 0&&h.push(d),n.sendRequest(a,...h)})}else return n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._requestDisposables.set(n,i.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full,i;n&&typeof e!="string"&&e.method===H.DidOpenTextDocumentNotification.method&&(i=t?.textDocument.uri,this._pendingOpenNotifications.add(i));let s=await this.$start();n&&await this.sendPendingFullTextDocumentChanges(s),i!==void 0&&this._pendingOpenNotifications.delete(i);let o=this._clientOptions.middleware?.sendNotification;return o?o(e,s.sendNotification.bind(s),t):s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._notificationDisposables.set(n,i.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(i){throw this.error(`Sending progress for token ${t} failed.`,i),i}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let i=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=H.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return i!==void 0?(this._progressDisposables.set(t,i.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new nh(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof H.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?sr.string(e.stack)?e.stack:e.message:sr.string(e)?e:e.toString()}debug(e,t,n=!0){this.logOutputMessage(H.MessageType.Debug,mi.Debug,"Debug",e,t,n)}info(e,t,n=!0){this.logOutputMessage(H.MessageType.Info,mi.Info,"Info",e,t,n)}warn(e,t,n=!0){this.logOutputMessage(H.MessageType.Warning,mi.Warn,"Warn",e,t,n)}error(e,t,n=!0){this.logOutputMessage(H.MessageType.Error,mi.Error,"Error",e,t,n)}logOutputMessage(e,t,n,i,s,o){this.outputChannel.appendLine(`[${n.padEnd(5)} - ${new Date().toLocaleTimeString()}] ${i}`),s!=null&&this.outputChannel.appendLine(this.data2String(s)),(o==="force"||o&&this._clientOptions.revealOutputChannelOn<=t)&&this.showNotificationMessage(e,i)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===H.MessageType.Error?Ne.window.showErrorMessage:e===H.MessageType.Warning?Ne.window.showWarningMessage:Ne.window.showInformationMessage)(t,"Go to output").then(i=>{i!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===Te.Initial||this.$state===Te.Stopping||this.$state===Te.Stopped}needsStop(){return this.$state===Te.Starting||this.$state===Te.Running}activeConnection(){return this.$state===Te.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===Te.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===Te.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?Ne.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):Ne.languages.createDiagnosticCollection());for(let[i,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(i)||this._pendingNotificationHandlers.set(i,s);for(let[i,s]of this._requestHandlers)this._pendingRequestHandlers.has(i)||this._pendingRequestHandlers.set(i,s);for(let[i,s]of this._progressHandlers)this._pendingProgressHandlers.has(i)||this._pendingProgressHandlers.set(i,s);this.$state=Te.Starting;try{let i=await this.createConnection();i.onNotification(H.LogMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:this.error(s.message,void 0,!1);break;case H.MessageType.Warning:this.warn(s.message,void 0,!1);break;case H.MessageType.Info:this.info(s.message,void 0,!1);break;case H.MessageType.Debug:this.debug(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),i.onNotification(H.ShowMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:Ne.window.showErrorMessage(s.message);break;case H.MessageType.Warning:Ne.window.showWarningMessage(s.message);break;case H.MessageType.Info:Ne.window.showInformationMessage(s.message);break;default:Ne.window.showInformationMessage(s.message)}}),i.onRequest(H.ShowMessageRequest.type,s=>{let o;switch(s.type){case H.MessageType.Error:o=Ne.window.showErrorMessage;break;case H.MessageType.Warning:o=Ne.window.showWarningMessage;break;case H.MessageType.Info:o=Ne.window.showInformationMessage;break;default:o=Ne.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),i.onNotification(H.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),i.onRequest(H.ShowDocumentRequest.type,async s=>{let o=async c=>{let d=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await Ne.env.openExternal(d)};{let h={};return c.selection!==void 0&&(h.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?h.preserveFocus=!0:c.takeFocus===!0&&(h.preserveFocus=!1),await Ne.window.showTextDocument(d,h),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),i.listen(),await this.initialize(i),t()}catch(i){this.$state=Te.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,i,"force"),n(i)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((i,s)=>{e=i,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,i]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:Ne.env.appName,version:Ne.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(Ne.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:sr.func(t)?t():t,trace:H.Trace.toString(this._trace),workspaceFolders:i};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=pw.generateUuid(),a=new VT.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==H.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=Te.Running;let i;sr.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===H.TextDocumentSyncKind.None?i={openClose:!1,change:H.TextDocumentSyncKind.None,save:void 0}:i={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(i=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:i}),e.onNotification(H.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest(H.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest(H.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest(H.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification(H.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof H.ResponseError&&n.data&&n.data.retry?Ne.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(i=>{i&&i.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&Ne.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=Ne.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===Te.Stopped||this.$state===Te.Initial)return;if(this.$state===Te.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==Te.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=Te.Stopping,this.cleanUp(e);let i=new Promise(o=>{(0,H.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([i,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=Te.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(i=>i[1]).reverse())n.clear();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification(H.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let i=this.clientOptions.middleware?.workspace;(i?.didChangeWatchedFile?i.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let i=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification(H.DidChangeTextDocumentNotification.type,i),this._didChangeTextDocumentFeature.notificationSent(n,H.DidChangeTextDocumentNotification.type,i)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,H.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let i=new Ne.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:i},this._p2c.asDiagnostics(n,i.token).then(s=>{if(!i.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,d)=>this.setDiagnostics(c,d)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return Ne.env.language}async $start(){if(this.$state===Te.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(i,s,o)=>{this.handleConnectionError(i,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(i=>this.error("Handling connection close failed",i))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=CD(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===Te.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:zr.DoNotRestart};if(this.$state!==Te.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===zr.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===Te.Starting?this.$state=Te.StartFailed:this.$state=Te.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===zr.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=Te.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let i=await this._clientOptions.errorHandler.error(e,t,n);i.action===Gs.Shutdown?(this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}
Shutting down server.`,void 0,i.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)})):this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}`,void 0,i.handled===!0?!1:"force")}hookConfigurationChanged(e){this._listeners.push(Ne.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=Ne.workspace.getConfiguration(this._id),i=H.Trace.Off,s=H.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?i=H.Trace.fromString(o):(i=H.Trace.fromString(n.get("trace.server.verbosity","off")),s=H.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=i,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;sr.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get(H.DidChangeWatchedFilesNotification.type.method).registerRaw(pw.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),ir.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature(H.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof gw.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new mw.ConfigurationFeature(this)),this.registerFeature(new es.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new es.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new es.WillSaveFeature(this)),this.registerFeature(new es.WillSaveWaitUntilFeature(this)),this.registerFeature(new es.DidSaveTextDocumentFeature(this)),this.registerFeature(new es.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new sD.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new zT.CompletionItemFeature(this)),this.registerFeature(new BT.HoverFeature(this)),this.registerFeature(new JT.SignatureHelpFeature(this)),this.registerFeature(new GT.DefinitionFeature(this)),this.registerFeature(new ZT.ReferencesFeature(this)),this.registerFeature(new XT.DocumentHighlightFeature(this)),this.registerFeature(new QT.DocumentSymbolFeature(this)),this.registerFeature(new YT.WorkspaceSymbolFeature(this)),this.registerFeature(new eD.CodeActionFeature(this)),this.registerFeature(new tD.CodeLensFeature(this)),this.registerFeature(new eh.DocumentFormattingFeature(this)),this.registerFeature(new eh.DocumentRangeFormattingFeature(this)),this.registerFeature(new eh.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new nD.RenameFeature(this)),this.registerFeature(new rD.DocumentLinkFeature(this)),this.registerFeature(new iD.ExecuteCommandFeature(this)),this.registerFeature(new mw.SyncConfigurationFeature(this)),this.registerFeature(new cD.TypeDefinitionFeature(this)),this.registerFeature(new aD.ImplementationFeature(this)),this.registerFeature(new oD.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new uD.WorkspaceFoldersFeature(this)),this.registerFeature(new dD.FoldingRangeFeature(this)),this.registerFeature(new lD.DeclarationFeature(this)),this.registerFeature(new fD.SelectionRangeFeature(this)),this.registerFeature(new hD.ProgressFeature(this)),this.registerFeature(new pD.CallHierarchyFeature(this)),this.registerFeature(new gD.SemanticTokensFeature(this)),this.registerFeature(new mD.LinkedEditingFeature(this)),this.registerFeature(new ts.DidCreateFilesFeature(this)),this.registerFeature(new ts.DidRenameFilesFeature(this)),this.registerFeature(new ts.DidDeleteFilesFeature(this)),this.registerFeature(new ts.WillCreateFilesFeature(this)),this.registerFeature(new ts.WillRenameFilesFeature(this)),this.registerFeature(new ts.WillDeleteFilesFeature(this)),this.registerFeature(new vD.TypeHierarchyFeature(this)),this.registerFeature(new yD.InlineValueFeature(this)),this.registerFeature(new bD.InlayHintsFeature(this)),this.registerFeature(new KT.DiagnosticFeature(this)),this.registerFeature(new gw.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(ih.createAll(this))}fillInitializeParams(e){for(let t of this._features)sr.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,ir.ensure)(e,"workspace").applyEdit=!0;let t=(0,ir.ensure)((0,ir.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[H.ResourceOperationKind.Create,H.ResourceOperationKind.Rename,H.ResourceOperationKind.Delete],t.failureHandling=H.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,ir.ensure)((0,ir.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[H.DiagnosticTag.Unnecessary,H.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let i=(0,ir.ensure)(e,"window"),s=(0,ir.ensure)(i,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,ir.ensure)(i,"showDocument");o.support=!0;let a=(0,ir.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(r.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)sr.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){let t=this.clientOptions.middleware?.handleRegisterCapability;return t?t(e,n=>this.doRegisterCapability(n)):this.doRegisterCapability(e)}async doRegisterCapability(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let i=t.registerOptions??{};i.documentSelector=i.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:i};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){let t=this.clientOptions.middleware?.handleUnregisterCapability;return t?t(e,n=>this.doUnregisterCapability(n)):this.doUnregisterCapability(e)}async doUnregisterCapability(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),i=new Map;Ne.workspace.textDocuments.forEach(o=>i.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if(H.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=i.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):sr.asPromise(Ne.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,i,s=!0){if(n instanceof H.ResponseError){if(n.code===H.ErrorCodes.PendingResponseRejected||n.code===H.ErrorCodes.ConnectionInactive)return i;if(n.code===H.LSPErrorCodes.RequestCancelled||n.code===H.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return i;throw n.data!==void 0?new ir.LSPCancellationError(n.data):new Ne.CancellationError}else if(n.code===H.LSPErrorCodes.ContentModified){if(r.RequestsToCancelOnContentModified.has(e.method)||r.CancellableResolveCalls.has(e.method))throw new Ne.CancellationError;return i}}throw this.error(`Request ${e.method} failed.`,n,s),n}};Lt.BaseLanguageClient=Js;Js.RequestsToCancelOnContentModified=new Set([H.SemanticTokensRequest.method,H.SemanticTokensRangeRequest.method,H.SemanticTokensDeltaRequest.method]);Js.CancellableResolveCalls=new Set([H.CompletionResolveRequest.method,H.CodeLensResolveRequest.method,H.CodeActionResolveRequest.method,H.InlayHintResolveRequest.method,H.DocumentLinkResolveRequest.method,H.WorkspaceSymbolResolveRequest.method]);var rh=class{error(e){(0,H.RAL)().console.error(e)}warn(e){(0,H.RAL)().console.warn(e)}info(e){(0,H.RAL)().console.info(e)}log(e){(0,H.RAL)().console.log(e)}};function CD(r,e,t,n,i){let s=new rh,o=(0,H.createProtocolConnection)(r,e,s,i);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,d,h)=>{let m={sendNotification:!1,traceFormat:H.TraceFormat.Text};return h===void 0?o.trace(c,d,m):(sr.boolean(h),o.trace(c,d,h))},initialize:c=>o.sendRequest(H.InitializeRequest.type,c),shutdown:()=>o.sendRequest(H.ShutdownRequest.type,void 0),exit:()=>o.sendNotification(H.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var ih;(function(r){function e(t){return[new wD.InlineCompletionItemFeature(t)]}r.createAll=e})(ih||(Lt.ProposedFeatures=ih={}))});var ww=I(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.terminate=void 0;var bw=require("child_process"),RD=require("path"),SD=process.platform==="win32",_D=process.platform==="darwin",TD=process.platform==="linux";function DD(r,e){if(SD)try{let i={stdio:["pipe","pipe","ignore"]};return e&&(i.cwd=e),bw.execFileSync("taskkill",["/T","/F","/PID",r.pid.toString()],i),!0}catch{return!1}else if(TD||_D)try{var t=(0,RD.join)(__dirname,"terminateProcess.sh"),n=bw.spawnSync(t,[r.pid.toString()]);return!n.error}catch{return!1}else return r.kill("SIGKILL"),!0}Qa.terminate=DD});var oh=I((Ox,Cw)=>{"use strict";Cw.exports=me()});var Xs=I((Fx,Rw)=>{var PD=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Rw.exports=PD});var Ya=I((Lx,Sw)=>{var kD="2.0.0",ED=Number.MAX_SAFE_INTEGER||9007199254740991,xD=16,ID=250,qD=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Sw.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:xD,MAX_SAFE_BUILD_LENGTH:ID,MAX_SAFE_INTEGER:ED,RELEASE_TYPES:qD,SEMVER_SPEC_VERSION:kD,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Za=I((kr,_w)=>{var{MAX_SAFE_COMPONENT_LENGTH:ah,MAX_SAFE_BUILD_LENGTH:OD,MAX_LENGTH:FD}=Ya(),LD=Xs();kr=_w.exports={};var MD=kr.re=[],ND=kr.safeRe=[],X=kr.src=[],Q=kr.t={},AD=0,ch="[a-zA-Z0-9-]",jD=[["\\s",1],["\\d",FD],[ch,OD]],$D=r=>{for(let[e,t]of jD)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},we=(r,e,t)=>{let n=$D(e),i=AD++;LD(r,i,e),Q[r]=i,X[i]=e,MD[i]=new RegExp(e,t?"g":void 0),ND[i]=new RegExp(n,t?"g":void 0)};we("NUMERICIDENTIFIER","0|[1-9]\\d*");we("NUMERICIDENTIFIERLOOSE","\\d+");we("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${ch}*`);we("MAINVERSION",`(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})`);we("MAINVERSIONLOOSE",`(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})`);we("PRERELEASEIDENTIFIER",`(?:${X[Q.NUMERICIDENTIFIER]}|${X[Q.NONNUMERICIDENTIFIER]})`);we("PRERELEASEIDENTIFIERLOOSE",`(?:${X[Q.NUMERICIDENTIFIERLOOSE]}|${X[Q.NONNUMERICIDENTIFIER]})`);we("PRERELEASE",`(?:-(${X[Q.PRERELEASEIDENTIFIER]}(?:\\.${X[Q.PRERELEASEIDENTIFIER]})*))`);we("PRERELEASELOOSE",`(?:-?(${X[Q.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${X[Q.PRERELEASEIDENTIFIERLOOSE]})*))`);we("BUILDIDENTIFIER",`${ch}+`);we("BUILD",`(?:\\+(${X[Q.BUILDIDENTIFIER]}(?:\\.${X[Q.BUILDIDENTIFIER]})*))`);we("FULLPLAIN",`v?${X[Q.MAINVERSION]}${X[Q.PRERELEASE]}?${X[Q.BUILD]}?`);we("FULL",`^${X[Q.FULLPLAIN]}$`);we("LOOSEPLAIN",`[v=\\s]*${X[Q.MAINVERSIONLOOSE]}${X[Q.PRERELEASELOOSE]}?${X[Q.BUILD]}?`);we("LOOSE",`^${X[Q.LOOSEPLAIN]}$`);we("GTLT","((?:<|>)?=?)");we("XRANGEIDENTIFIERLOOSE",`${X[Q.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);we("XRANGEIDENTIFIER",`${X[Q.NUMERICIDENTIFIER]}|x|X|\\*`);we("XRANGEPLAIN",`[v=\\s]*(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:${X[Q.PRERELEASE]})?${X[Q.BUILD]}?)?)?`);we("XRANGEPLAINLOOSE",`[v=\\s]*(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:${X[Q.PRERELEASELOOSE]})?${X[Q.BUILD]}?)?)?`);we("XRANGE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAIN]}$`);we("XRANGELOOSE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAINLOOSE]}$`);we("COERCEPLAIN",`(^|[^\\d])(\\d{1,${ah}})(?:\\.(\\d{1,${ah}}))?(?:\\.(\\d{1,${ah}}))?`);we("COERCE",`${X[Q.COERCEPLAIN]}(?:$|[^\\d])`);we("COERCEFULL",X[Q.COERCEPLAIN]+`(?:${X[Q.PRERELEASE]})?(?:${X[Q.BUILD]})?(?:$|[^\\d])`);we("COERCERTL",X[Q.COERCE],!0);we("COERCERTLFULL",X[Q.COERCEFULL],!0);we("LONETILDE","(?:~>?)");we("TILDETRIM",`(\\s*)${X[Q.LONETILDE]}\\s+`,!0);kr.tildeTrimReplace="$1~";we("TILDE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAIN]}$`);we("TILDELOOSE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAINLOOSE]}$`);we("LONECARET","(?:\\^)");we("CARETTRIM",`(\\s*)${X[Q.LONECARET]}\\s+`,!0);kr.caretTrimReplace="$1^";we("CARET",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAIN]}$`);we("CARETLOOSE",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAINLOOSE]}$`);we("COMPARATORLOOSE",`^${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]})$|^$`);we("COMPARATOR",`^${X[Q.GTLT]}\\s*(${X[Q.FULLPLAIN]})$|^$`);we("COMPARATORTRIM",`(\\s*)${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]}|${X[Q.XRANGEPLAIN]})`,!0);kr.comparatorTrimReplace="$1$2$3";we("HYPHENRANGE",`^\\s*(${X[Q.XRANGEPLAIN]})\\s+-\\s+(${X[Q.XRANGEPLAIN]})\\s*$`);we("HYPHENRANGELOOSE",`^\\s*(${X[Q.XRANGEPLAINLOOSE]})\\s+-\\s+(${X[Q.XRANGEPLAINLOOSE]})\\s*$`);we("STAR","(<|>)?=?\\s*\\*");we("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");we("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ec=I((Mx,Tw)=>{var UD=Object.freeze({loose:!0}),WD=Object.freeze({}),HD=r=>r?typeof r!="object"?UD:r:WD;Tw.exports=HD});var Ew=I((Nx,kw)=>{var Dw=/^[0-9]+$/,Pw=(r,e)=>{let t=Dw.test(r),n=Dw.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},VD=(r,e)=>Pw(e,r);kw.exports={compareIdentifiers:Pw,rcompareIdentifiers:VD}});var Qs=I((Ax,Ow)=>{var tc=Xs(),{MAX_LENGTH:xw,MAX_SAFE_INTEGER:nc}=Ya(),{safeRe:Iw,t:qw}=Za(),KD=ec(),{compareIdentifiers:ns}=Ew(),uh=class r{constructor(e,t){if(t=KD(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>xw)throw new TypeError(`version is longer than ${xw} characters`);tc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Iw[qw.LOOSE]:Iw[qw.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>nc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>nc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>nc||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<nc)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(tc("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),ns(this.major,e.major)||ns(this.minor,e.minor)||ns(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(tc("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ns(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(tc("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return ns(n,i)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),ns(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Ow.exports=uh});var Mw=I((jx,Lw)=>{var Fw=Qs(),zD=(r,e,t=!1)=>{if(r instanceof Fw)return r;try{return new Fw(r,e)}catch(n){if(!t)return null;throw n}};Lw.exports=zD});var Aw=I(($x,Nw)=>{var dh=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Nw.exports=dh});var vi=I((Ux,$w)=>{var jw=Qs(),BD=(r,e,t)=>new jw(r,t).compare(new jw(e,t));$w.exports=BD});var Ww=I((Wx,Uw)=>{var GD=vi(),JD=(r,e,t)=>GD(r,e,t)===0;Uw.exports=JD});var Vw=I((Hx,Hw)=>{var XD=vi(),QD=(r,e,t)=>XD(r,e,t)!==0;Hw.exports=QD});var zw=I((Vx,Kw)=>{var YD=vi(),ZD=(r,e,t)=>YD(r,e,t)>0;Kw.exports=ZD});var Gw=I((Kx,Bw)=>{var eP=vi(),tP=(r,e,t)=>eP(r,e,t)>=0;Bw.exports=tP});var Xw=I((zx,Jw)=>{var nP=vi(),rP=(r,e,t)=>nP(r,e,t)<0;Jw.exports=rP});var Yw=I((Bx,Qw)=>{var iP=vi(),sP=(r,e,t)=>iP(r,e,t)<=0;Qw.exports=sP});var eC=I((Gx,Zw)=>{var oP=Ww(),aP=Vw(),cP=zw(),uP=Gw(),dP=Xw(),lP=Yw(),fP=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return oP(r,t,n);case"!=":return aP(r,t,n);case">":return cP(r,t,n);case">=":return uP(r,t,n);case"<":return dP(r,t,n);case"<=":return lP(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Zw.exports=fP});var aC=I((Jx,oC)=>{var Ys=Symbol("SemVer ANY"),hh=class r{static get ANY(){return Ys}constructor(e,t){if(t=tC(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),fh("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ys?this.value="":this.value=this.operator+this.semver.version,fh("comp",this)}parse(e){let t=this.options.loose?nC[rC.COMPARATORLOOSE]:nC[rC.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new iC(n[2],this.options.loose):this.semver=Ys}toString(){return this.value}test(e){if(fh("Comparator.test",e,this.options.loose),this.semver===Ys||e===Ys)return!0;if(typeof e=="string")try{e=new iC(e,this.options)}catch{return!1}return lh(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new sC(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new sC(this.value,t).test(e.semver):(t=tC(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||lh(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||lh(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};oC.exports=hh;var tC=ec(),{safeRe:nC,t:rC}=Za(),lh=eC(),fh=Xs(),iC=Qs(),sC=ph()});var ph=I((Xx,lC)=>{var hP=/\s+/g,gh=class r{constructor(e,t){if(t=gP(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof mh)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(hP," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!uC(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&RP(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&wP)|(this.options.loose&&CP))+":"+e,i=cC.get(n);if(i)return i;let s=this.options.loose,o=s?pn[rn.HYPHENRANGELOOSE]:pn[rn.HYPHENRANGE];e=e.replace(o,qP(this.options.includePrerelease)),tt("hyphen replace",e),e=e.replace(pn[rn.COMPARATORTRIM],vP),tt("comparator trim",e),e=e.replace(pn[rn.TILDETRIM],yP),tt("tilde trim",e),e=e.replace(pn[rn.CARETTRIM],bP),tt("caret trim",e);let a=e.split(" ").map(m=>SP(m,this.options)).join(" ").split(/\s+/).map(m=>IP(m,this.options));s&&(a=a.filter(m=>(tt("loose invalid filter",m,this.options),!!m.match(pn[rn.COMPARATORLOOSE])))),tt("range list",a);let c=new Map,d=a.map(m=>new mh(m,this.options));for(let m of d){if(uC(m))return[m];c.set(m.value,m)}c.size>1&&c.has("")&&c.delete("");let h=[...c.values()];return cC.set(n,h),h}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>dC(n,t)&&e.set.some(i=>dC(i,t)&&n.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new mP(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(OP(this.set[t],e,this.options))return!0;return!1}};lC.exports=gh;var pP=Aw(),cC=new pP,gP=ec(),mh=aC(),tt=Xs(),mP=Qs(),{safeRe:pn,t:rn,comparatorTrimReplace:vP,tildeTrimReplace:yP,caretTrimReplace:bP}=Za(),{FLAG_INCLUDE_PRERELEASE:wP,FLAG_LOOSE:CP}=Ya(),uC=r=>r.value==="<0.0.0-0",RP=r=>r.value==="",dC=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},SP=(r,e)=>(tt("comp",r,e),r=DP(r,e),tt("caret",r),r=_P(r,e),tt("tildes",r),r=kP(r,e),tt("xrange",r),r=xP(r,e),tt("stars",r),r),sn=r=>!r||r.toLowerCase()==="x"||r==="*",_P=(r,e)=>r.trim().split(/\s+/).map(t=>TP(t,e)).join(" "),TP=(r,e)=>{let t=e.loose?pn[rn.TILDELOOSE]:pn[rn.TILDE];return r.replace(t,(n,i,s,o,a)=>{tt("tilde",r,n,i,s,o,a);let c;return sn(i)?c="":sn(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:sn(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(tt("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,tt("tilde return",c),c})},DP=(r,e)=>r.trim().split(/\s+/).map(t=>PP(t,e)).join(" "),PP=(r,e)=>{tt("caret",r,e);let t=e.loose?pn[rn.CARETLOOSE]:pn[rn.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,o,a,c)=>{tt("caret",r,i,s,o,a,c);let d;return sn(s)?d="":sn(o)?d=`>=${s}.0.0${n} <${+s+1}.0.0-0`:sn(a)?s==="0"?d=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(tt("replaceCaret pr",c),s==="0"?o==="0"?d=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(tt("no pr"),s==="0"?o==="0"?d=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),tt("caret return",d),d})},kP=(r,e)=>(tt("replaceXRanges",r,e),r.split(/\s+/).map(t=>EP(t,e)).join(" ")),EP=(r,e)=>{r=r.trim();let t=e.loose?pn[rn.XRANGELOOSE]:pn[rn.XRANGE];return r.replace(t,(n,i,s,o,a,c)=>{tt("xRange",r,n,i,s,o,a,c);let d=sn(s),h=d||sn(o),m=h||sn(a),v=m;return i==="="&&v&&(i=""),c=e.includePrerelease?"-0":"",d?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&v?(h&&(o=0),a=0,i===">"?(i=">=",h?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",h?s=+s+1:o=+o+1),i==="<"&&(c="-0"),n=`${i+s}.${o}.${a}${c}`):h?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:m&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),tt("xRange return",n),n})},xP=(r,e)=>(tt("replaceStars",r,e),r.trim().replace(pn[rn.STAR],"")),IP=(r,e)=>(tt("replaceGTE0",r,e),r.trim().replace(pn[e.includePrerelease?rn.GTE0PRE:rn.GTE0],"")),qP=r=>(e,t,n,i,s,o,a,c,d,h,m,v)=>(sn(n)?t="":sn(i)?t=`>=${n}.0.0${r?"-0":""}`:sn(s)?t=`>=${n}.${i}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,sn(d)?c="":sn(h)?c=`<${+d+1}.0.0-0`:sn(m)?c=`<${d}.${+h+1}.0-0`:v?c=`<=${d}.${h}.${m}-${v}`:r?c=`<${d}.${h}.${+m+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),OP=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(tt(r[n].semver),r[n].semver!==mh.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var hC=I((Qx,fC)=>{var FP=ph(),LP=(r,e,t)=>{try{e=new FP(e,t)}catch{return!1}return e.test(r)};fC.exports=LP});var gC=I(On=>{"use strict";var MP=On&&On.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vh=On&&On.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&MP(e,r,t)};Object.defineProperty(On,"__esModule",{value:!0});On.DiagnosticPullMode=On.vsdiag=void 0;vh(me(),On);vh(Ie(),On);var pC=Sl();Object.defineProperty(On,"vsdiag",{enumerable:!0,get:function(){return pC.vsdiag}});Object.defineProperty(On,"DiagnosticPullMode",{enumerable:!0,get:function(){return pC.DiagnosticPullMode}});vh(sh(),On)});var rc=I(gn=>{"use strict";var NP=gn&&gn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yC=gn&&gn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&NP(e,r,t)};Object.defineProperty(gn,"__esModule",{value:!0});gn.SettingMonitor=gn.LanguageClient=gn.TransportKind=void 0;var Er=require("child_process"),yh=require("fs"),bh=require("path"),Gr=require("vscode"),at=Hn(),mC=sh(),AP=ww(),lt=oh(),jP=Mw(),$P=hC();yC(oh(),gn);yC(gC(),gn);var vC="^1.82.0",ft;(function(r){r[r.stdio=0]="stdio",r[r.ipc=1]="ipc",r[r.pipe=2]="pipe",r[r.socket=3]="socket"})(ft||(gn.TransportKind=ft={}));var Br;(function(r){function e(t){let n=t;return n&&n.kind===ft.socket&&at.number(n.port)}r.isSocket=e})(Br||(Br={}));var wh;(function(r){function e(t){return at.string(t.command)}r.is=e})(wh||(wh={}));var Ch;(function(r){function e(t){return at.string(t.module)}r.is=e})(Ch||(Ch={}));var Rh;(function(r){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}r.is=e})(Rh||(Rh={}));var Sh;(function(r){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}r.is=e})(Sh||(Sh={}));var _h=class extends mC.BaseLanguageClient{constructor(e,t,n,i,s){let o,a,c,d,h;at.string(t)?(o=e,a=t,c=n,d=i,h=!!s):(o=e.toLowerCase(),a=e,c=t,d=n,h=i),h===void 0&&(h=!1),super(o,a,d),this._serverOptions=c,this._forceDebug=h,this._isInDebugMode=h;try{this.checkVersion()}catch(m){throw at.string(m.message)&&this.outputChannel.appendLine(m.message),m}}checkVersion(){let e=jP(Gr.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${Gr.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!$P(e,vC))throw new Error(`The language client requires VS Code version ${vC} but received version ${Gr.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,AP.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(h,m){if(!h&&!m)return;let v=Object.create(null);return Object.keys(process.env).forEach(S=>v[S]=process.env[S]),m&&(v.ELECTRON_RUN_AS_NODE="1",v.ELECTRON_NO_ASAR="1"),h&&Object.keys(h).forEach(S=>v[S]=h[S]),v}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],i=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let h=process.execArgv;return h?h.some(m=>n.some(v=>m.startsWith(v))||i.some(v=>m===v)):!1}function o(h){if(h.stdin===null||h.stdout===null||h.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(at.func(a))return a().then(h=>{if(mC.MessageTransports.is(h))return this._isDetached=!!h.detached,h;if(Rh.is(h))return this._isDetached=!!h.detached,{reader:new lt.StreamMessageReader(h.reader),writer:new lt.StreamMessageWriter(h.writer)};{let m;return Sh.is(h)?(m=h.process,this._isDetached=h.detached):(m=h,this._isDetached=!1),m.stderr.on("data",v=>this.outputChannel.append(at.string(v)?v:v.toString(e))),{reader:new lt.StreamMessageReader(m.stdout),writer:new lt.StreamMessageWriter(m.stdin)}}});let c,d=a;return d.run||d.debug?this._forceDebug||s()?(c=d.debug,this._isInDebugMode=!0):(c=d.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(h=>{if(Ch.is(c)&&c.module){let m=c,v=m.transport||ft.stdio;if(m.runtime){let S=[],y=m.options??Object.create(null);y.execArgv&&y.execArgv.forEach(U=>S.push(U)),S.push(m.module),m.args&&m.args.forEach(U=>S.push(U));let P=Object.create(null);P.cwd=h,P.env=t(y.env,!1);let x=this._getRuntimePath(m.runtime,h),$;if(v===ft.ipc?(P.stdio=[null,null,null,"ipc"],S.push("--node-ipc")):v===ft.stdio?S.push("--stdio"):v===ft.pipe?($=(0,lt.generateRandomPipeName)(),S.push(`--pipe=${$}`)):Br.isSocket(v)&&S.push(`--socket=${v.port}`),S.push(`--clientProcessId=${process.pid.toString()}`),v===ft.ipc||v===ft.stdio){let U=Er.spawn(x,S,P);return!U||!U.pid?rs(U,`Launching server using runtime ${x} failed.`):(this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(at.string(M)?M:M.toString(e))),v===ft.ipc?(U.stdout.on("data",M=>this.outputChannel.append(at.string(M)?M:M.toString(e))),Promise.resolve({reader:new lt.IPCMessageReader(U),writer:new lt.IPCMessageWriter(U)})):Promise.resolve({reader:new lt.StreamMessageReader(U.stdout),writer:new lt.StreamMessageWriter(U.stdin)}))}else{if(v===ft.pipe)return(0,lt.createClientPipeTransport)($).then(U=>{let M=Er.spawn(x,S,P);return!M||!M.pid?rs(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),M.stdout.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),U.onConnected().then(K=>({reader:K[0],writer:K[1]})))});if(Br.isSocket(v))return(0,lt.createClientSocketTransport)(v.port).then(U=>{let M=Er.spawn(x,S,P);return!M||!M.pid?rs(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),M.stdout.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),U.onConnected().then(K=>({reader:K[0],writer:K[1]})))})}}else{let S;return new Promise((y,P)=>{let x=(m.args&&m.args.slice())??[];v===ft.ipc?x.push("--node-ipc"):v===ft.stdio?x.push("--stdio"):v===ft.pipe?(S=(0,lt.generateRandomPipeName)(),x.push(`--pipe=${S}`)):Br.isSocket(v)&&x.push(`--socket=${v.port}`),x.push(`--clientProcessId=${process.pid.toString()}`);let $=m.options??Object.create(null);if($.env=t($.env,!0),$.execArgv=$.execArgv||[],$.cwd=h,$.silent=!0,v===ft.ipc||v===ft.stdio){let U=Er.fork(m.module,x||[],$);o(U),this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(at.string(M)?M:M.toString(e))),v===ft.ipc?(U.stdout.on("data",M=>this.outputChannel.append(at.string(M)?M:M.toString(e))),y({reader:new lt.IPCMessageReader(this._serverProcess),writer:new lt.IPCMessageWriter(this._serverProcess)})):y({reader:new lt.StreamMessageReader(U.stdout),writer:new lt.StreamMessageWriter(U.stdin)})}else v===ft.pipe?(0,lt.createClientPipeTransport)(S).then(U=>{let M=Er.fork(m.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),M.stdout.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),U.onConnected().then(K=>{y({reader:K[0],writer:K[1]})},P)},P):Br.isSocket(v)&&(0,lt.createClientSocketTransport)(v.port).then(U=>{let M=Er.fork(m.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),M.stdout.on("data",K=>this.outputChannel.append(at.string(K)?K:K.toString(e))),U.onConnected().then(K=>{y({reader:K[0],writer:K[1]})},P)},P)})}}else if(wh.is(c)&&c.command){let m=c,v=c.args!==void 0?c.args.slice(0):[],S,y=c.transport;if(y===ft.stdio)v.push("--stdio");else if(y===ft.pipe)S=(0,lt.generateRandomPipeName)(),v.push(`--pipe=${S}`);else if(Br.isSocket(y))v.push(`--socket=${y.port}`);else if(y===ft.ipc)throw new Error("Transport kind ipc is not support for command executable");let P=Object.assign({},m.options);if(P.cwd=P.cwd||h,y===void 0||y===ft.stdio){let x=Er.spawn(m.command,v,P);return!x||!x.pid?rs(x,`Launching server using command ${m.command} failed.`):(x.stderr.on("data",$=>this.outputChannel.append(at.string($)?$:$.toString(e))),this._serverProcess=x,this._isDetached=!!P.detached,Promise.resolve({reader:new lt.StreamMessageReader(x.stdout),writer:new lt.StreamMessageWriter(x.stdin)}))}else{if(y===ft.pipe)return(0,lt.createClientPipeTransport)(S).then(x=>{let $=Er.spawn(m.command,v,P);return!$||!$.pid?rs($,`Launching server using command ${m.command} failed.`):(this._serverProcess=$,this._isDetached=!!P.detached,$.stderr.on("data",U=>this.outputChannel.append(at.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(at.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))});if(Br.isSocket(y))return(0,lt.createClientSocketTransport)(y.port).then(x=>{let $=Er.spawn(m.command,v,P);return!$||!$.pid?rs($,`Launching server using command ${m.command} failed.`):(this._serverProcess=$,this._isDetached=!!P.detached,$.stderr.on("data",U=>this.outputChannel.append(at.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(at.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))}).finally(()=>{this._serverProcess!==void 0&&this._serverProcess.on("exit",(h,m)=>{h!==null&&this.error(`Server process exited with code ${h}.`,void 0,!1),m!==null&&this.error(`Server process exited with signal ${m}.`,void 0,!1)})})}_getRuntimePath(e,t){if(bh.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let i=bh.join(n,e);if(yh.existsSync(i))return i}if(t!==void 0){let i=bh.join(t,e);if(yh.existsSync(i))return i}return e}_mainGetRootPath(){let e=Gr.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{yh.lstat(t,(i,s)=>{n(!i&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};gn.LanguageClient=_h;var Th=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return Gr.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new Gr.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,i=n?Gr.workspace.getConfiguration(t).get(n,!1):Gr.workspace.getConfiguration(t);i&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!i&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};gn.SettingMonitor=Th;function rs(r,e){return r===null?Promise.reject(e):new Promise((t,n)=>{r.on("error",i=>{n(`${e} ${i}`)}),setImmediate(()=>n(e))})}});var ic=I((eI,bC)=>{"use strict";bC.exports=rc()});var as=I(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.stringArray=Xt.array=Xt.func=Xt.error=Xt.number=Xt.string=Xt.boolean=void 0;function BP(r){return r===!0||r===!1}Xt.boolean=BP;function FC(r){return typeof r=="string"||r instanceof String}Xt.string=FC;function GP(r){return typeof r=="number"||r instanceof Number}Xt.number=GP;function JP(r){return r instanceof Error}Xt.error=JP;function XP(r){return typeof r=="function"}Xt.func=XP;function LC(r){return Array.isArray(r)}Xt.array=LC;function QP(r){return LC(r)&&r.every(e=>FC(e))}Xt.stringArray=QP});var up=I(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.Message=se.NotificationType9=se.NotificationType8=se.NotificationType7=se.NotificationType6=se.NotificationType5=se.NotificationType4=se.NotificationType3=se.NotificationType2=se.NotificationType1=se.NotificationType0=se.NotificationType=se.RequestType9=se.RequestType8=se.RequestType7=se.RequestType6=se.RequestType5=se.RequestType4=se.RequestType3=se.RequestType2=se.RequestType1=se.RequestType=se.RequestType0=se.AbstractMessageSignature=se.ParameterStructures=se.ResponseError=se.ErrorCodes=void 0;var Ci=as(),jh;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(jh||(se.ErrorCodes=jh={}));var $h=class r extends Error{constructor(e,t,n){super(t),this.code=Ci.number(e)?e:jh.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};se.ResponseError=$h;var vn=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};se.ParameterStructures=vn;vn.auto=new vn("auto");vn.byPosition=new vn("byPosition");vn.byName=new vn("byName");var nt=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return vn.auto}};se.AbstractMessageSignature=nt;var Uh=class extends nt{constructor(e){super(e,0)}};se.RequestType0=Uh;var Wh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType=Wh;var Hh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType1=Hh;var Vh=class extends nt{constructor(e){super(e,2)}};se.RequestType2=Vh;var Kh=class extends nt{constructor(e){super(e,3)}};se.RequestType3=Kh;var zh=class extends nt{constructor(e){super(e,4)}};se.RequestType4=zh;var Bh=class extends nt{constructor(e){super(e,5)}};se.RequestType5=Bh;var Gh=class extends nt{constructor(e){super(e,6)}};se.RequestType6=Gh;var Jh=class extends nt{constructor(e){super(e,7)}};se.RequestType7=Jh;var Xh=class extends nt{constructor(e){super(e,8)}};se.RequestType8=Xh;var Qh=class extends nt{constructor(e){super(e,9)}};se.RequestType9=Qh;var Yh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType=Yh;var Zh=class extends nt{constructor(e){super(e,0)}};se.NotificationType0=Zh;var ep=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType1=ep;var tp=class extends nt{constructor(e){super(e,2)}};se.NotificationType2=tp;var np=class extends nt{constructor(e){super(e,3)}};se.NotificationType3=np;var rp=class extends nt{constructor(e){super(e,4)}};se.NotificationType4=rp;var ip=class extends nt{constructor(e){super(e,5)}};se.NotificationType5=ip;var sp=class extends nt{constructor(e){super(e,6)}};se.NotificationType6=sp;var op=class extends nt{constructor(e){super(e,7)}};se.NotificationType7=op;var ap=class extends nt{constructor(e){super(e,8)}};se.NotificationType8=ap;var cp=class extends nt{constructor(e){super(e,9)}};se.NotificationType9=cp;var MC;(function(r){function e(i){let s=i;return s&&Ci.string(s.method)&&(Ci.string(s.id)||Ci.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&Ci.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(Ci.string(s.id)||Ci.number(s.id)||s.id===null)}r.isResponse=n})(MC||(se.Message=MC={}))});var lp=I(Yr=>{"use strict";var NC;Object.defineProperty(Yr,"__esModule",{value:!0});Yr.LRUCache=Yr.LinkedMap=Yr.Touch=void 0;var Qt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Qt||(Yr.Touch=Qt={}));var Rc=class{constructor(){this[NC]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Qt.None){let n=this._map.get(e);if(n)return t!==Qt.None&&this.touch(n,t),n.value}set(e,t,n=Qt.None){let i=this._map.get(e);if(i)i.value=t,n!==Qt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Qt.None:this.addItemLast(i);break;case Qt.First:this.addItemFirst(i);break;case Qt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(NC=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Qt.First&&t!==Qt.Last)){if(t===Qt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Qt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};Yr.LinkedMap=Rc;var dp=class extends Rc{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Qt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Qt.None)}set(e,t){return super.set(e,t,Qt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Yr.LRUCache=dp});var jC=I(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.Disposable=void 0;var AC;(function(r){function e(t){return{dispose:t}}r.create=e})(AC||(Sc.Disposable=AC={}))});var Zr=I(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});var fp;function hp(){if(fp===void 0)throw new Error("No runtime abstraction layer installed");return fp}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");fp=t}r.install=e})(hp||(hp={}));pp.default=hp});var us=I(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.Emitter=cs.Event=void 0;var YP=Zr(),$C;(function(r){let e={dispose(){}};r.None=function(){return e}})($C||(cs.Event=$C={}));var gp=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,YP.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},_c=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new gp),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};cs.Emitter=_c;_c._noop=function(){}});var Pc=I(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.CancellationTokenSource=ds.CancellationToken=void 0;var ZP=Zr(),ek=as(),mp=us(),Tc;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:mp.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:mp.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||ek.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(Tc||(ds.CancellationToken=Tc={}));var tk=Object.freeze(function(r,e){let t=(0,ZP.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),Dc=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?tk:(this._emitter||(this._emitter=new mp.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},vp=class{get token(){return this._token||(this._token=new Dc),this._token}cancel(){this._token?this._token.cancel():this._token=Tc.Cancelled}dispose(){this._token?this._token instanceof Dc&&this._token.dispose():this._token=Tc.None}};ds.CancellationTokenSource=vp});var UC=I(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.SharedArrayReceiverStrategy=ls.SharedArraySenderStrategy=void 0;var nk=Pc(),oo;(function(r){r.Continue=0,r.Cancelled=1})(oo||(oo={}));var yp=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=oo.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,oo.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};ls.SharedArraySenderStrategy=yp;var bp=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===oo.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},wp=class{constructor(e){this.token=new bp(e)}cancel(){}dispose(){}},Cp=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new nk.CancellationTokenSource:new wp(t)}};ls.SharedArrayReceiverStrategy=Cp});var Sp=I(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.Semaphore=void 0;var rk=Zr(),Rp=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,rk.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};kc.Semaphore=Rp});var HC=I(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.ReadableStreamMessageReader=ei.AbstractMessageReader=ei.MessageReader=void 0;var Tp=Zr(),fs=as(),_p=us(),ik=Sp(),WC;(function(r){function e(t){let n=t;return n&&fs.func(n.listen)&&fs.func(n.dispose)&&fs.func(n.onError)&&fs.func(n.onClose)&&fs.func(n.onPartialMessage)}r.is=e})(WC||(ei.MessageReader=WC={}));var Ec=class{constructor(){this.errorEmitter=new _p.Emitter,this.closeEmitter=new _p.Emitter,this.partialMessageEmitter=new _p.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${fs.string(e.message)?e.message:"unknown"}`)}};ei.AbstractMessageReader=Ec;var Dp;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,Tp.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Dp||(Dp={}));var Pp=class extends Ec{constructor(e,t){super(),this.readable=e,this.options=Dp.fromOptions(t),this.buffer=(0,Tp.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new ik.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Tp.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};ei.ReadableStreamMessageReader=Pp});var GC=I(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.WriteableStreamMessageWriter=ti.AbstractMessageWriter=ti.MessageWriter=void 0;var VC=Zr(),ao=as(),sk=Sp(),KC=us(),ok="Content-Length: ",zC=`\r
`,BC;(function(r){function e(t){let n=t;return n&&ao.func(n.dispose)&&ao.func(n.onClose)&&ao.func(n.onError)&&ao.func(n.write)}r.is=e})(BC||(ti.MessageWriter=BC={}));var xc=class{constructor(){this.errorEmitter=new KC.Emitter,this.closeEmitter=new KC.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ao.string(e.message)?e.message:"unknown"}`)}};ti.AbstractMessageWriter=xc;var kp;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,VC.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,VC.default)().applicationJson.encoder}}r.fromOptions=e})(kp||(kp={}));var Ep=class extends xc{constructor(e,t){super(),this.writable=e,this.options=kp.fromOptions(t),this.errorCount=0,this.writeSemaphore=new sk.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(ok,n.byteLength.toString(),zC),i.push(zC),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};ti.WriteableStreamMessageWriter=Ep});var JC=I(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.AbstractMessageBuffer=void 0;var ak=13,ck=10,uk=`\r
`,xp=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case ak:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case ck:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(uk);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let h=c[d],m=h.indexOf(":");if(m===-1)throw new Error(`Message header must separate key and value using ':'
${h}`);let v=h.substr(0,m),S=h.substr(m+1).trim();a.set(e?v.toLowerCase():v,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};Ic.AbstractMessageBuffer=xp});var eR=I(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.createMessageConnection=Ce.ConnectionOptions=Ce.MessageStrategy=Ce.CancellationStrategy=Ce.CancellationSenderStrategy=Ce.CancellationReceiverStrategy=Ce.RequestCancellationReceiverStrategy=Ce.IdCancellationReceiverStrategy=Ce.ConnectionStrategy=Ce.ConnectionError=Ce.ConnectionErrors=Ce.LogTraceNotification=Ce.SetTraceNotification=Ce.TraceFormat=Ce.TraceValues=Ce.Trace=Ce.NullLogger=Ce.ProgressType=Ce.ProgressToken=void 0;var XC=Zr(),pt=as(),fe=up(),QC=lp(),co=us(),Ip=Pc(),fo;(function(r){r.type=new fe.NotificationType("$/cancelRequest")})(fo||(fo={}));var qp;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(qp||(Ce.ProgressToken=qp={}));var uo;(function(r){r.type=new fe.NotificationType("$/progress")})(uo||(uo={}));var Op=class{constructor(){}};Ce.ProgressType=Op;var Fp;(function(r){function e(t){return pt.func(t)}r.is=e})(Fp||(Fp={}));Ce.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Me;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Me||(Ce.Trace=Me={}));var YC;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(YC||(Ce.TraceValues=YC={}));(function(r){function e(n){if(!pt.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Me||(Ce.Trace=Me={}));var Fn;(function(r){r.Text="text",r.JSON="json"})(Fn||(Ce.TraceFormat=Fn={}));(function(r){function e(t){return pt.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(Fn||(Ce.TraceFormat=Fn={}));var Lp;(function(r){r.type=new fe.NotificationType("$/setTrace")})(Lp||(Ce.SetTraceNotification=Lp={}));var qc;(function(r){r.type=new fe.NotificationType("$/logTrace")})(qc||(Ce.LogTraceNotification=qc={}));var lo;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(lo||(Ce.ConnectionErrors=lo={}));var hs=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};Ce.ConnectionError=hs;var Mp;(function(r){function e(t){let n=t;return n&&pt.func(n.cancelUndispatched)}r.is=e})(Mp||(Ce.ConnectionStrategy=Mp={}));var Oc;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Oc||(Ce.IdCancellationReceiverStrategy=Oc={}));var Np;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Np||(Ce.RequestCancellationReceiverStrategy=Np={}));var Fc;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Ip.CancellationTokenSource}});function e(t){return Oc.is(t)||Np.is(t)}r.is=e})(Fc||(Ce.CancellationReceiverStrategy=Fc={}));var Lc;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(fo.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&pt.func(n.sendCancellation)&&pt.func(n.cleanup)}r.is=e})(Lc||(Ce.CancellationSenderStrategy=Lc={}));var Mc;(function(r){r.Message=Object.freeze({receiver:Fc.Message,sender:Lc.Message});function e(t){let n=t;return n&&Fc.is(n.receiver)&&Lc.is(n.sender)}r.is=e})(Mc||(Ce.CancellationStrategy=Mc={}));var Nc;(function(r){function e(t){let n=t;return n&&pt.func(n.handleMessage)}r.is=e})(Nc||(Ce.MessageStrategy=Nc={}));var ZC;(function(r){function e(t){let n=t;return n&&(Mc.is(n.cancellationStrategy)||Mp.is(n.connectionStrategy)||Nc.is(n.messageStrategy))}r.is=e})(ZC||(Ce.ConnectionOptions=ZC={}));var or;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(or||(or={}));function dk(r,e,t,n){let i=t!==void 0?t:Ce.NullLogger,s=0,o=0,a=0,c="2.0",d,h=new Map,m,v=new Map,S=new Map,y,P=new QC.LinkedMap,x=new Map,$=new Set,U=new Map,M=Me.Off,K=Fn.Text,B,pe=or.New,J=new co.Emitter,ae=new co.Emitter,Re=new co.Emitter,rt=new co.Emitter,Ze=new co.Emitter,je=n&&n.cancellationStrategy?n.cancellationStrategy:Mc.Message;function Zt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function Nt(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function Dt(){return"not-"+(++o).toString()}function Pt(l,C){fe.Message.isRequest(C)?l.set(Zt(C.id),C):fe.Message.isResponse(C)?l.set(Nt(C.id),C):l.set(Dt(),C)}function bn(l){}function wn(){return pe===or.Listening}function $e(){return pe===or.Closed}function wt(){return pe===or.Disposed}function It(){(pe===or.New||pe===or.Listening)&&(pe=or.Closed,ae.fire(void 0))}function kt(l){J.fire([l,void 0,void 0])}function cr(l){J.fire(l)}r.onClose(It),r.onError(kt),e.onClose(It),e.onError(cr);function Cn(){y||P.size===0||(y=(0,XC.default)().timer.setImmediate(()=>{y=void 0,Qn()}))}function Rn(l){fe.Message.isRequest(l)?An(l):fe.Message.isNotification(l)?_n(l):fe.Message.isResponse(l)?Sn(l):jn(l)}function Qn(){if(P.size===0)return;let l=P.shift();try{let C=n?.messageStrategy;Nc.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let ur=l=>{try{if(fe.Message.isNotification(l)&&l.method===fo.type.method){let C=l.params.id,k=Zt(C),O=P.get(k);if(fe.Message.isRequest(O)){let ee=n?.connectionStrategy,oe=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(oe&&(oe.error!==void 0||oe.result!==void 0)){P.delete(k),U.delete(C),oe.id=O.id,At(oe,l.method,Date.now()),e.write(oe).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Wt(l);return}else $.add(C)}Pt(P,l)}finally{Cn()}};function An(l){if(wt())return;function C(G,re,Z){let he={jsonrpc:c,id:l.id};G instanceof fe.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function k(G,re,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,re,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};At(he,re,Z),e.write(he).catch(()=>i.error("Sending response failed."))}dr(l);let ne=h.get(l.method),ee,oe;ne&&(ee=ne.type,oe=ne.handler);let ce=Date.now();if(oe||d){let G=l.id??String(Date.now()),re=Oc.is(je.receiver)?je.receiver.createCancellationTokenSource(G):je.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&re.cancel(),l.id!==null&&U.set(G,re);try{let Z;if(oe)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){k(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ce);return}Z=oe(re.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byName){k(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ce);return}Z=oe(...l.params,re.token)}else{if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byPosition){k(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ce);return}Z=oe(l.params,re.token)}else d&&(Z=d(l.method,l.params,re.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ce)},_e=>{U.delete(G),_e instanceof fe.ResponseError?k(_e,l.method,ce):_e&&pt.string(_e.message)?k(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ce):k(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ce)}):(U.delete(G),C(Z,l.method,ce)):(U.delete(G),O(Z,l.method,ce))}catch(Z){U.delete(G),Z instanceof fe.ResponseError?C(Z,l.method,ce):Z&&pt.string(Z.message)?k(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ce):k(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ce)}}else k(new fe.ResponseError(fe.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ce)}function Sn(l){if(!wt())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,k=x.get(C);if($n(l,k),k!==void 0){x.delete(C);try{if(l.error){let O=l.error;k.reject(new fe.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)k.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${k.method}' failed with message: ${O.message}`):i.error(`Response handler '${k.method}' failed unexpectedly.`)}}}}function _n(l){if(wt())return;let C,k;if(l.method===fo.type.method){let O=l.params.id;$.delete(O),Wt(l);return}else{let O=v.get(l.method);O&&(k=O.handler,C=O.type)}if(k||m)try{if(Wt(l),k)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),k();else if(Array.isArray(l.params)){let O=l.params;l.method===uo.type.method&&O.length===2&&qp.is(O[0])?k({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),k(...O))}else C!==void 0&&C.parameterStructures===fe.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),k(l.params);else m&&m(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function jn(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(pt.string(C.id)||pt.number(C.id)){let k=C.id,O=x.get(k);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function Ue(l){if(l!=null)switch(M){case Me.Verbose:return JSON.stringify(l,null,4);case Me.Compact:return JSON.stringify(l);default:return}}function Yn(l){if(!(M===Me.Off||!B))if(K===Fn.Text){let C;(M===Me.Verbose||M===Me.Compact)&&l.params&&(C=`Params: ${Ue(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Me.Off||!B))if(K===Fn.Text){let C;(M===Me.Verbose||M===Me.Compact)&&(l.params?C=`Params: ${Ue(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function At(l,C,k){if(!(M===Me.Off||!B))if(K===Fn.Text){let O;(M===Me.Verbose||M===Me.Compact)&&(l.error&&l.error.data?O=`Error data: ${Ue(l.error.data)}

`:l.result?O=`Result: ${Ue(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-k}ms`,O)}else Ke("send-response",l)}function dr(l){if(!(M===Me.Off||!B))if(K===Fn.Text){let C;(M===Me.Verbose||M===Me.Compact)&&l.params&&(C=`Params: ${Ue(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Wt(l){if(!(M===Me.Off||!B||l.method===qc.type.method))if(K===Fn.Text){let C;(M===Me.Verbose||M===Me.Compact)&&(l.params?C=`Params: ${Ue(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function $n(l,C){if(!(M===Me.Off||!B))if(K===Fn.Text){let k;if((M===Me.Verbose||M===Me.Compact)&&(l.error&&l.error.data?k=`Error data: ${Ue(l.error.data)}

`:l.result?k=`Result: ${Ue(l.result)}

`:l.error===void 0&&(k=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,k)}else B.log(`Received response ${l.id} without active response promise.`,k)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Me.Off)return;let k={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(k)}function gt(){if($e())throw new hs(lo.Closed,"Connection is closed.");if(wt())throw new hs(lo.Disposed,"Connection is disposed.")}function Et(){if(wn())throw new hs(lo.AlreadyListening,"Connection is already listening")}function en(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Dn(l){if(l!==null)return l}function Un(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function tn(l,C){switch(l){case fe.ParameterStructures.auto:return Un(C)?Dn(C):[Rt(C)];case fe.ParameterStructures.byName:if(!Un(C))throw new Error("Received parameters by name but param is not an object literal.");return Dn(C);case fe.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Wn(l,C){let k,O=l.numberOfParams;switch(O){case 0:k=void 0;break;case 1:k=tn(l.parameterStructures,C[0]);break;default:k=[];for(let ne=0;ne<C.length&&ne<O;ne++)k.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)k.push(null);break}return k}let mt={sendNotification:(l,...C)=>{gt();let k,O;if(pt.string(l)){k=l;let ee=C[0],oe=0,ce=fe.ParameterStructures.auto;fe.ParameterStructures.is(ee)&&(oe=1,ce=ee);let G=C.length,re=G-oe;switch(re){case 0:O=void 0;break;case 1:O=tn(ce,C[oe]);break;default:if(ce===fe.ParameterStructures.byName)throw new Error(`Received ${re} parameters for 'by Name' notification parameter structure.`);O=C.slice(oe,G).map(Z=>Rt(Z));break}}else{let ee=C;k=l.method,O=Wn(l,ee)}let ne={jsonrpc:c,method:k,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let k;return pt.func(l)?m=l:C&&(pt.string(l)?(k=l,v.set(l,{type:void 0,handler:C})):(k=l.method,v.set(l.method,{type:l,handler:C}))),{dispose:()=>{k!==void 0?v.delete(k):m=void 0}}},onProgress:(l,C,k)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,k),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,k)=>mt.sendNotification(uo.type,{token:C,value:k}),onUnhandledProgress:rt.event,sendRequest:(l,...C)=>{gt(),en();let k,O,ne;if(pt.string(l)){k=l;let G=C[0],re=C[C.length-1],Z=0,he=fe.ParameterStructures.auto;fe.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Ip.CancellationToken.is(re)&&(_e=_e-1,ne=re);let We=_e-Z;switch(We){case 0:O=void 0;break;case 1:O=tn(he,C[Z]);break;default:if(he===fe.ParameterStructures.byName)throw new Error(`Received ${We} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(lr=>Rt(lr));break}}else{let G=C;k=l.method,O=Wn(l,G);let re=l.numberOfParams;ne=Ip.CancellationToken.is(G[re])?G[re]:void 0}let ee=s++,oe;ne&&(oe=ne.onCancellationRequested(()=>{let G=je.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ce={jsonrpc:c,id:ee,method:k,params:O};return Yn(ce),typeof je.sender.enableCancellation=="function"&&je.sender.enableCancellation(ce),new Promise(async(G,re)=>{let Z=We=>{G(We),je.sender.cleanup(ee),oe?.dispose()},he=We=>{re(We),je.sender.cleanup(ee),oe?.dispose()},_e={method:k,timerStart:Date.now(),resolve:Z,reject:he};try{x.set(ee,_e),await e.write(ce)}catch(We){throw x.delete(ee),_e.reject(new fe.ResponseError(fe.ErrorCodes.MessageWriteError,We.message?We.message:"Unknown reason")),i.error("Sending request failed."),We}})},onRequest:(l,C)=>{gt();let k=null;return Fp.is(l)?(k=void 0,d=l):pt.string(l)?(k=null,C!==void 0&&(k=l,h.set(l,{handler:C,type:void 0}))):C!==void 0&&(k=l.method,h.set(l.method,{type:l,handler:C})),{dispose:()=>{k!==null&&(k!==void 0?h.delete(k):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,k)=>{let O=!1,ne=Fn.Text;k!==void 0&&(pt.boolean(k)?O=k:(O=k.sendNotification||!1,ne=k.traceFormat||Fn.Text)),M=l,K=ne,M===Me.Off?B=void 0:B=C,O&&!$e()&&!wt()&&await mt.sendNotification(Lp.type,{value:Me.toString(l)})},onError:J.event,onClose:ae.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(wt())return;pe=or.Disposed,Ze.fire(void 0);let l=new fe.ResponseError(fe.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,P=new QC.LinkedMap,pt.func(e.dispose)&&e.dispose(),pt.func(r.dispose)&&r.dispose()},listen:()=>{gt(),Et(),pe=or.Listening,r.listen(ur)},inspect:()=>{(0,XC.default)().console.log("inspect")}};return mt.onNotification(qc.type,l=>{if(M===Me.Off||!B)return;let C=M===Me.Verbose||M===Me.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(uo.type,l=>{let C=S.get(l.token);C?C(l.value):rt.fire(l)}),mt}Ce.createMessageConnection=dk});var Ac=I(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.ProgressType=L.ProgressToken=L.createMessageConnection=L.NullLogger=L.ConnectionOptions=L.ConnectionStrategy=L.AbstractMessageBuffer=L.WriteableStreamMessageWriter=L.AbstractMessageWriter=L.MessageWriter=L.ReadableStreamMessageReader=L.AbstractMessageReader=L.MessageReader=L.SharedArrayReceiverStrategy=L.SharedArraySenderStrategy=L.CancellationToken=L.CancellationTokenSource=L.Emitter=L.Event=L.Disposable=L.LRUCache=L.Touch=L.LinkedMap=L.ParameterStructures=L.NotificationType9=L.NotificationType8=L.NotificationType7=L.NotificationType6=L.NotificationType5=L.NotificationType4=L.NotificationType3=L.NotificationType2=L.NotificationType1=L.NotificationType0=L.NotificationType=L.ErrorCodes=L.ResponseError=L.RequestType9=L.RequestType8=L.RequestType7=L.RequestType6=L.RequestType5=L.RequestType4=L.RequestType3=L.RequestType2=L.RequestType1=L.RequestType0=L.RequestType=L.Message=L.RAL=void 0;L.MessageStrategy=L.CancellationStrategy=L.CancellationSenderStrategy=L.CancellationReceiverStrategy=L.ConnectionError=L.ConnectionErrors=L.LogTraceNotification=L.SetTraceNotification=L.TraceFormat=L.TraceValues=L.Trace=void 0;var Qe=up();Object.defineProperty(L,"Message",{enumerable:!0,get:function(){return Qe.Message}});Object.defineProperty(L,"RequestType",{enumerable:!0,get:function(){return Qe.RequestType}});Object.defineProperty(L,"RequestType0",{enumerable:!0,get:function(){return Qe.RequestType0}});Object.defineProperty(L,"RequestType1",{enumerable:!0,get:function(){return Qe.RequestType1}});Object.defineProperty(L,"RequestType2",{enumerable:!0,get:function(){return Qe.RequestType2}});Object.defineProperty(L,"RequestType3",{enumerable:!0,get:function(){return Qe.RequestType3}});Object.defineProperty(L,"RequestType4",{enumerable:!0,get:function(){return Qe.RequestType4}});Object.defineProperty(L,"RequestType5",{enumerable:!0,get:function(){return Qe.RequestType5}});Object.defineProperty(L,"RequestType6",{enumerable:!0,get:function(){return Qe.RequestType6}});Object.defineProperty(L,"RequestType7",{enumerable:!0,get:function(){return Qe.RequestType7}});Object.defineProperty(L,"RequestType8",{enumerable:!0,get:function(){return Qe.RequestType8}});Object.defineProperty(L,"RequestType9",{enumerable:!0,get:function(){return Qe.RequestType9}});Object.defineProperty(L,"ResponseError",{enumerable:!0,get:function(){return Qe.ResponseError}});Object.defineProperty(L,"ErrorCodes",{enumerable:!0,get:function(){return Qe.ErrorCodes}});Object.defineProperty(L,"NotificationType",{enumerable:!0,get:function(){return Qe.NotificationType}});Object.defineProperty(L,"NotificationType0",{enumerable:!0,get:function(){return Qe.NotificationType0}});Object.defineProperty(L,"NotificationType1",{enumerable:!0,get:function(){return Qe.NotificationType1}});Object.defineProperty(L,"NotificationType2",{enumerable:!0,get:function(){return Qe.NotificationType2}});Object.defineProperty(L,"NotificationType3",{enumerable:!0,get:function(){return Qe.NotificationType3}});Object.defineProperty(L,"NotificationType4",{enumerable:!0,get:function(){return Qe.NotificationType4}});Object.defineProperty(L,"NotificationType5",{enumerable:!0,get:function(){return Qe.NotificationType5}});Object.defineProperty(L,"NotificationType6",{enumerable:!0,get:function(){return Qe.NotificationType6}});Object.defineProperty(L,"NotificationType7",{enumerable:!0,get:function(){return Qe.NotificationType7}});Object.defineProperty(L,"NotificationType8",{enumerable:!0,get:function(){return Qe.NotificationType8}});Object.defineProperty(L,"NotificationType9",{enumerable:!0,get:function(){return Qe.NotificationType9}});Object.defineProperty(L,"ParameterStructures",{enumerable:!0,get:function(){return Qe.ParameterStructures}});var Ap=lp();Object.defineProperty(L,"LinkedMap",{enumerable:!0,get:function(){return Ap.LinkedMap}});Object.defineProperty(L,"LRUCache",{enumerable:!0,get:function(){return Ap.LRUCache}});Object.defineProperty(L,"Touch",{enumerable:!0,get:function(){return Ap.Touch}});var lk=jC();Object.defineProperty(L,"Disposable",{enumerable:!0,get:function(){return lk.Disposable}});var tR=us();Object.defineProperty(L,"Event",{enumerable:!0,get:function(){return tR.Event}});Object.defineProperty(L,"Emitter",{enumerable:!0,get:function(){return tR.Emitter}});var nR=Pc();Object.defineProperty(L,"CancellationTokenSource",{enumerable:!0,get:function(){return nR.CancellationTokenSource}});Object.defineProperty(L,"CancellationToken",{enumerable:!0,get:function(){return nR.CancellationToken}});var rR=UC();Object.defineProperty(L,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return rR.SharedArraySenderStrategy}});Object.defineProperty(L,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return rR.SharedArrayReceiverStrategy}});var jp=HC();Object.defineProperty(L,"MessageReader",{enumerable:!0,get:function(){return jp.MessageReader}});Object.defineProperty(L,"AbstractMessageReader",{enumerable:!0,get:function(){return jp.AbstractMessageReader}});Object.defineProperty(L,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return jp.ReadableStreamMessageReader}});var $p=GC();Object.defineProperty(L,"MessageWriter",{enumerable:!0,get:function(){return $p.MessageWriter}});Object.defineProperty(L,"AbstractMessageWriter",{enumerable:!0,get:function(){return $p.AbstractMessageWriter}});Object.defineProperty(L,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return $p.WriteableStreamMessageWriter}});var fk=JC();Object.defineProperty(L,"AbstractMessageBuffer",{enumerable:!0,get:function(){return fk.AbstractMessageBuffer}});var Ut=eR();Object.defineProperty(L,"ConnectionStrategy",{enumerable:!0,get:function(){return Ut.ConnectionStrategy}});Object.defineProperty(L,"ConnectionOptions",{enumerable:!0,get:function(){return Ut.ConnectionOptions}});Object.defineProperty(L,"NullLogger",{enumerable:!0,get:function(){return Ut.NullLogger}});Object.defineProperty(L,"createMessageConnection",{enumerable:!0,get:function(){return Ut.createMessageConnection}});Object.defineProperty(L,"ProgressToken",{enumerable:!0,get:function(){return Ut.ProgressToken}});Object.defineProperty(L,"ProgressType",{enumerable:!0,get:function(){return Ut.ProgressType}});Object.defineProperty(L,"Trace",{enumerable:!0,get:function(){return Ut.Trace}});Object.defineProperty(L,"TraceValues",{enumerable:!0,get:function(){return Ut.TraceValues}});Object.defineProperty(L,"TraceFormat",{enumerable:!0,get:function(){return Ut.TraceFormat}});Object.defineProperty(L,"SetTraceNotification",{enumerable:!0,get:function(){return Ut.SetTraceNotification}});Object.defineProperty(L,"LogTraceNotification",{enumerable:!0,get:function(){return Ut.LogTraceNotification}});Object.defineProperty(L,"ConnectionErrors",{enumerable:!0,get:function(){return Ut.ConnectionErrors}});Object.defineProperty(L,"ConnectionError",{enumerable:!0,get:function(){return Ut.ConnectionError}});Object.defineProperty(L,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Ut.CancellationReceiverStrategy}});Object.defineProperty(L,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Ut.CancellationSenderStrategy}});Object.defineProperty(L,"CancellationStrategy",{enumerable:!0,get:function(){return Ut.CancellationStrategy}});Object.defineProperty(L,"MessageStrategy",{enumerable:!0,get:function(){return Ut.MessageStrategy}});var hk=Zr();L.RAL=hk.default});var oR=I(Vp=>{"use strict";Object.defineProperty(Vp,"__esModule",{value:!0});var iR=require("util"),Ir=Ac(),jc=class r extends Ir.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new iR.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};jc.emptyBuffer=Buffer.allocUnsafe(0);var Up=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Ir.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Ir.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Ir.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Ir.Disposable.create(()=>this.stream.off("data",e))}},Wp=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Ir.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Ir.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Ir.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},sR=Object.freeze({messageBuffer:Object.freeze({create:r=>new jc(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new iR.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new Up(r),asWritableStream:r=>new Wp(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function Hp(){return sR}(function(r){function e(){Ir.RAL.install(sR)}r.install=e})(Hp||(Hp={}));Vp.default=Hp});var uR=I(xe=>{"use strict";var pk=xe&&xe.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),gk=xe&&xe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&pk(e,r,t)};Object.defineProperty(xe,"__esModule",{value:!0});xe.createMessageConnection=xe.createServerSocketTransport=xe.createClientSocketTransport=xe.createServerPipeTransport=xe.createClientPipeTransport=xe.generateRandomPipeName=xe.StreamMessageWriter=xe.StreamMessageReader=xe.SocketMessageWriter=xe.SocketMessageReader=xe.PortMessageWriter=xe.PortMessageReader=xe.IPCMessageWriter=xe.IPCMessageReader=void 0;var ps=oR();ps.default.install();var aR=require("path"),mk=require("os"),vk=require("crypto"),Wc=require("net"),Ln=Ac();gk(Ac(),xe);var Kp=class extends Ln.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),Ln.Disposable.create(()=>this.process.off("message",e))}};xe.IPCMessageReader=Kp;var zp=class extends Ln.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.IPCMessageWriter=zp;var Bp=class extends Ln.AbstractMessageReader{constructor(e){super(),this.onData=new Ln.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};xe.PortMessageReader=Bp;var Gp=class extends Ln.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.PortMessageWriter=Gp;var Ri=class extends Ln.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,ps.default)().stream.asReadableStream(e),t)}};xe.SocketMessageReader=Ri;var Si=class extends Ln.WriteableStreamMessageWriter{constructor(e,t){super((0,ps.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};xe.SocketMessageWriter=Si;var $c=class extends Ln.ReadableStreamMessageReader{constructor(e,t){super((0,ps.default)().stream.asReadableStream(e),t)}};xe.StreamMessageReader=$c;var Uc=class extends Ln.WriteableStreamMessageWriter{constructor(e,t){super((0,ps.default)().stream.asWritableStream(e),t)}};xe.StreamMessageWriter=Uc;var cR=process.env.XDG_RUNTIME_DIR,yk=new Map([["linux",107],["darwin",103]]);function bk(){let r=(0,vk.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;cR?e=aR.join(cR,`vscode-ipc-${r}.sock`):e=aR.join(mk.tmpdir(),`vscode-${r}.sock`);let t=yk.get(process.platform);return t!==void 0&&e.length>t&&(0,ps.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}xe.generateRandomPipeName=bk;function wk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Wc.createServer)(a=>{o.close(),t([new Ri(a,e),new Si(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientPipeTransport=wk;function Ck(r,e="utf-8"){let t=(0,Wc.createConnection)(r);return[new Ri(t,e),new Si(t,e)]}xe.createServerPipeTransport=Ck;function Rk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Wc.createServer)(a=>{o.close(),t([new Ri(a,e),new Si(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientSocketTransport=Rk;function Sk(r,e="utf-8"){let t=(0,Wc.createConnection)(r,"127.0.0.1");return[new Ri(t,e),new Si(t,e)]}xe.createServerSocketTransport=Sk;function _k(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function Tk(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function Dk(r,e,t,n){t||(t=Ln.NullLogger);let i=_k(r)?new $c(r):r,s=Tk(e)?new Uc(e):e;return Ln.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Ln.createMessageConnection)(i,s,t,n)}xe.createMessageConnection=Dk});var lR=I(($q,dR)=>{"use strict";dR.exports=uR()});var Nk={};jR(Nk,{activate:()=>Ok,deactivate:()=>Fk});module.exports=$R(Nk);var qR=ue(require("os")),Yt=ue(require("vscode"));var j=ue(require("vscode")),Zp=ue(ic());var Zs=class{provideTextDocumentContent(e){let t="Not a valid Ruby LSP document";switch(e.path){case"show-syntax-tree":t=e.query;break;case"show-diagnose-state":t=e.query;break}return t}};var IC=require("crypto"),ht=ue(require("vscode")),yc=ue(ic());var os=ue(require("path")),pc=ue(require("os")),Be=ue(require("vscode"));var wC=require("child_process"),CC=require("crypto"),RC=require("util"),Jr=ue(require("vscode"));var Xn=new Jr.EventEmitter,Jt=(0,RC.promisify)(wC.exec),sc="Ruby LSP",yr=Jr.window.createOutputChannel(sc,{log:!0}),Xr=["ruby","erb"],Dh={tapiocaAddon:1,launcher:.1,fullTestDiscovery:-1};function SC(r,e){let t=null;return function(...n){return t&&clearTimeout(t),new Promise((i,s)=>{t=setTimeout(()=>{r(...n).then(o=>i(o)).catch(o=>s(o))},e)})}}function eo(r){let e=Jr.workspace.getConfiguration("rubyLsp").get("featureFlags");if(e[r]===!1||e.all===!1)return!1;let t=Dh[r];if(e.all&&t!==-1||e[r])return!0;let n=Jr.env.machineId,i=(0,CC.createHash)("sha256").update(`${n}-${r}`).digest("hex");return parseInt(i.substring(0,8),16)/4294967295<t}var yi=ue(require("vscode"));var to=ue(require("path")),_C=ue(require("os")),br=ue(require("vscode"));var no="RUBY_LSP_ACTIVATION_SEPARATOR",UP="RUBY_LSP_VS",WP="RUBY_LSP_FS",Mt=class{constructor(e,t,n,i){this.workspaceFolder=e,this.outputChannel=t,this.context=n,this.manuallySelectRuby=i;let s=br.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=to.default.isAbsolute(s)?s:to.default.resolve(to.default.join(this.workspaceFolder.uri.fsPath,s))),this.bundleUri=this.customBundleGemfile?br.Uri.file(to.default.dirname(this.customBundleGemfile)):e.uri}async runEnvActivationScript(e){let t=br.Uri.joinPath(this.context.extensionUri,"activation.rb"),n=await this.runScript(`${e} -EUTF-8:UTF-8 '${t.fsPath}'`),i=new RegExp(`${no}([^]*)${no}`).exec(n.stderr),[s,o,a,...c]=i[1].split(WP);return{version:s,gemPath:o.split(","),yjit:a==="true",env:Object.fromEntries(c.map(d=>d.split(UP)))}}runScript(e){let t;return br.env.shell.length>0&&_C.default.platform()!=="win32"&&(t=br.env.shell),this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath} using shell: ${t}`),Jt(e,{cwd:this.bundleUri.fsPath,shell:t,env:process.env,encoding:"utf-8"})}async findExec(e,t){for(let n of e)try{let i=br.Uri.joinPath(n,t);return await br.workspace.fs.stat(i),this.outputChannel.info(`Found ${t} executable at ${n.fsPath}`),i.fsPath}catch{}return t}};var ro=class extends Error{},oc=class extends Mt{async activate(){try{await yi.workspace.fs.stat(yi.Uri.joinPath(this.bundleUri,".shadowenv.d"))}catch{throw new Error("The Ruby LSP version manager is configured to be shadowenv,         but no .shadowenv.d directory was found in the workspace")}let e=await this.findExec([yi.Uri.file("/opt/homebrew/bin")],"shadowenv");try{let t=await this.runEnvActivationScript(`${e} exec -- ruby`);return delete t.env.BUNDLE_GEMFILE,{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}catch(t){if(t.message.includes("untrusted shadowenv program")){if(await yi.window.showErrorMessage(`Tried to activate Shadowenv, but the workspace is untrusted.
           Workspaces must be trusted to before allowing Shadowenv to load the environment for security reasons.`,"Trust workspace","Shutdown Ruby LSP")==="Trust workspace")return await Jt("shadowenv trust",{cwd:this.bundleUri.fsPath}),this.activate();throw new ro("Cannot activate Ruby environment in an untrusted workspace")}try{await Jt("shadowenv --version")}catch{throw new Error(`Shadowenv executable not found. Ensure it is installed and available in the PATH.
           This error may happen if your shell configuration is failing to be sourced from the editor or if
           another extension is mutating the process PATH.`)}throw new Error(`Failed to activate Ruby environment with Shadowenv: ${t.message}`)}}};var Ph=ue(require("os")),wr=ue(require("path")),Ae=ue(require("vscode"));var io=class extends Error{},is=class extends Mt{constructor(t,n,i,s){super(t,n,i,s);this.rubyInstallationUris=[Ae.Uri.joinPath(Ae.Uri.file(Ph.default.homedir()),".rubies"),Ae.Uri.joinPath(Ae.Uri.file("/"),"opt","rubies")];let o=Ae.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.chrubyRubies");o&&this.rubyInstallationUris.push(...o.map(a=>Ae.Uri.file(a)))}async activate(){let t=await this.discoverRubyVersion(),n;try{if(t)n=await this.findRubyUri(t);else{let d=await this.fallbackWithCancellation("No .ruby-version file found. Trying to fall back to latest installed Ruby in 10 seconds","You can create a .ruby-version file in a parent directory to configure a fallback",this.findFallbackRuby.bind(this),this.rubyVersionError.bind(this));t=d.rubyVersion,n=d.uri}}catch(d){if(d instanceof io)return this.activate();throw d}try{if(!n){let d={...t},h=await this.fallbackWithCancellation(`Couldn't find installation for ${t.version}. Trying to fall back to other Ruby in 10 seconds`,"You can cancel this fallback and install the required Ruby",async()=>this.findClosestRubyInstallation(d),()=>this.missingRubyError(d.version));t=h.rubyVersion,n=h.uri}}catch(d){if(d instanceof io)return this.activate();throw d}this.outputChannel.info(`Discovered Ruby installation at ${n.fsPath}`);let{defaultGems:i,gemHome:s,yjit:o,version:a}=await this.runActivationScript(n,t);this.outputChannel.info(`Activated Ruby environment: defaultGems=${i} gemHome=${s} yjit=${o}`);let c={GEM_HOME:s,GEM_PATH:`${s}${wr.default.delimiter}${i}`,PATH:`${wr.default.join(s,"bin")}${wr.default.delimiter}${wr.default.join(i,"bin")}${wr.default.delimiter}${wr.default.dirname(n.fsPath)}${wr.default.delimiter}${this.getProcessPath()}`};return{env:{...process.env,...c},yjit:o,version:a,gemPath:[s,i]}}getProcessPath(){return process.env.PATH}async findRubyUri(t){let n=t.engine?[`${t.engine}-${t.version}`,t.version]:[t.version,`ruby-${t.version}`];for(let i of this.rubyInstallationUris){let s;try{s=(await Ae.workspace.fs.readDirectory(i)).sort((o,a)=>a[0].localeCompare(o[0]))}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${i.fsPath} but it doesn't exist`);continue}for(let o of n){let a=s.find(([c])=>c.startsWith(o));if(a)return Ae.Uri.joinPath(i,a[0],"bin","ruby")}}}async runActivationScript(t,n){let i=["user_dir = Gem.user_dir","paths = Gem.path","if paths.length > 2","  paths.delete(Gem.default_dir)","  paths.delete(Gem.user_dir)","  if paths[0]","    user_dir = paths[0] if Dir.exist?(paths[0])","  end","end",`newer_gem_home = File.join(File.dirname(user_dir), "${n.version}")`,"gems = (Dir.exist?(newer_gem_home) ? newer_gem_home : user_dir)",`STDERR.print([Gem.default_dir, gems, !!defined?(RubyVM::YJIT), RUBY_VERSION].join("${no}"))`].join(";"),s=await this.runScript(`${t.fsPath} -EUTF-8:UTF-8 -e '${i}'`),[o,a,c,d]=s.stderr.split(no);return{defaultGems:o,gemHome:a,yjit:c==="true",version:d}}async findClosestRubyInstallation(t){let[n,i,s]=t.version.split("."),o=[];for(let c of this.rubyInstallationUris)try{(await Ae.workspace.fs.readDirectory(c)).forEach(([d])=>{let h=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(d);h?.groups&&h.groups.version.startsWith(n)&&o.push({uri:Ae.Uri.joinPath(c,d,"bin","ruby"),rubyVersion:{engine:h.groups.engine,version:h.groups.version}})})}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${c.fsPath} but it doesn't exist`);continue}let a=o.sort((c,d)=>{let h=c.rubyVersion.version.split("."),m=d.rubyVersion.version.split("."),v=Math.abs(Number(h[1])-Number(i)),S=Math.abs(Number(m[1])-Number(i));return v===S?Number(m[2]||0)-Number(h[2]||0):v-S})[0];if(a)return a;throw new Error("Cannot find any Ruby installations")}async discoverRubyVersion(){let t=this.bundleUri,n=wr.default.parse(t.fsPath).root,i,s;for(;t.fsPath!==n;){try{s=Ae.Uri.joinPath(t,".ruby-version"),i=(await Ae.workspace.fs.readFile(s)).toString().trim()}catch{t=Ae.Uri.file(wr.default.dirname(t.fsPath));continue}if(i==="")throw new Error(`Ruby version file ${s} is empty`);let o=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(i);if(!o?.groups)throw new Error(`Ruby version file ${s} contains invalid format. Expected (engine-)?version, got ${i}`);return this.outputChannel.info(`Discovered Ruby version ${i} from ${s.fsPath}`),{engine:o.groups.engine,version:o.groups.version}}}async fallbackWithCancellation(t,n,i,s){let o;try{o=await Ae.workspace.fs.readFile(Ae.Uri.joinPath(this.workspaceFolder.uri,"Gemfile"))}catch{}if(o&&/^ruby(\s|\()("|')[\d.]+/.test(o.toString()))throw s();return await Ae.window.withProgress({title:t,location:Ae.ProgressLocation.Notification,cancellable:!0},async(c,d)=>{if(c.report({message:n}),await new Promise(h=>{setTimeout(h,1e4),d.onCancellationRequested(()=>{h()})}),d.isCancellationRequested)throw await this.handleCancelledFallback(s),new io;return i()})}async handleCancelledFallback(t){let n=await Ae.window.showInformationMessage(`The Ruby LSP requires a Ruby version to launch.
      You can define a fallback for the system or for the Ruby LSP only`,"System","Ruby LSP only");throw n==="System"?await this.createParentRubyVersionFile(t):n==="Ruby LSP only"&&await this.manuallySelectRuby(),t()}async createParentRubyVersionFile(t){let n=[];for(let o of this.rubyInstallationUris){let a;try{a=(await Ae.workspace.fs.readDirectory(o)).sort((c,d)=>d[0].localeCompare(c[0])),a.forEach(c=>{n.push({label:c[0]})})}catch{continue}}let i=await Ae.window.showQuickPick(n,{title:"Select a Ruby version to use as fallback",ignoreFocusOut:!0});if(!i)throw t();let s=await Ae.window.showOpenDialog({defaultUri:Ae.Uri.file(Ph.default.homedir()),openLabel:"Add fallback in this directory",canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select the directory to create the .ruby-version fallback in"});if(!s)throw t();await Ae.workspace.fs.writeFile(Ae.Uri.joinPath(s[0],".ruby-version"),Buffer.from(i.label))}async findFallbackRuby(){for(let t of this.rubyInstallationUris){let n;try{n=(await Ae.workspace.fs.readDirectory(t)).sort((o,a)=>a[0].localeCompare(o[0]));let i,s;for(let o of n){let a=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(o[0]);if(a?.groups){i=a.groups,s=o;break}}if(s)return{uri:Ae.Uri.joinPath(t,s[0],"bin","ruby"),rubyVersion:{engine:i.engine,version:i.version}}}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${t.fsPath} but it doesn't exist`);continue}}throw new Error("Cannot find any Ruby installations")}missingRubyError(t){return new Error(`Cannot find Ruby installation for version ${t}`)}rubyVersionError(){return new Error(`Cannot find .ruby-version file. Please specify the Ruby version in a
           .ruby-version either in ${this.bundleUri.fsPath} or in a parent directory`)}};var TC=ue(require("os")),Cr=ue(require("vscode"));var ac=class extends Mt{async activate(){let e=await this.findMiseUri(),t=await this.runEnvActivationScript(`${e.fsPath} x -- ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findMiseUri(){let t=Cr.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.miseExecutablePath");if(t){let i=Cr.Uri.file(t);try{return await Cr.workspace.fs.stat(i),i}catch{throw new Error(`Mise executable configured as ${i}, but that file doesn't exist`)}}let n=[Cr.Uri.joinPath(Cr.Uri.file(TC.default.homedir()),".local","bin","mise"),Cr.Uri.joinPath(Cr.Uri.file("/"),"opt","homebrew","bin","mise")];for(let i of n)try{return await Cr.workspace.fs.stat(i),i}catch{}throw new Error(`The Ruby LSP version manager is configured to be Mise, but could not find Mise installation. Searched in
        ${n.join(", ")}`)}};var cc=ue(require("os")),Qr=ue(require("vscode"));var uc=class extends is{getProcessPath(){return process.env.Path??process.env.PATH??process.env.path}async findRubyUri(e){let[t,n,i]=e.version.split(".").map(Number),s=[Qr.Uri.joinPath(Qr.Uri.file("C:"),`Ruby${t}${n}-${cc.default.arch()}`),Qr.Uri.joinPath(Qr.Uri.file(cc.default.homedir()),`Ruby${t}${n}-${cc.default.arch()}`)];for(let o of s)try{return await Qr.workspace.fs.stat(o),Qr.Uri.joinPath(o,"bin","ruby")}catch{}throw new Error(`Cannot find installation directory for Ruby version ${e.version}.         Searched in ${s.map(o=>o.fsPath).join(", ")}`)}async runActivationScript(e,t){let n=await super.runActivationScript(e,t);return n.gemHome=n.gemHome.replace(/\//g,"\\"),n.defaultGems=n.defaultGems.replace(/\//g,"\\"),n}runScript(e){return this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath}`),this.outputChannel.debug(`Environment used for command: ${JSON.stringify(process.env)}`),Jt(e,{cwd:this.bundleUri.fsPath,env:process.env})}};var bi=ue(require("vscode"));var dc=class extends Mt{async activate(){let e=await this.findRbenv(),t=await this.runEnvActivationScript(`${e} exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRbenv(){let t=bi.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rbenvExecutablePath");return t?this.ensureRbenvExistsAt(t):this.findExec([bi.Uri.file("/opt/homebrew/bin"),bi.Uri.file("/usr/local/bin")],"rbenv")}async ensureRbenvExistsAt(e){try{return await bi.workspace.fs.stat(bi.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rbenv, but ${e} does not exist`)}}};var DC=ue(require("os")),xr=ue(require("vscode"));var lc=class extends Mt{async activate(){let e=await this.findRvmInstallation(),t=await this.runEnvActivationScript(e.fsPath),n=Object.entries(t.env).map(([i,s])=>`${i}=${s}`).join(" ");return this.outputChannel.info(`Activated Ruby environment: ${n}`),{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRvmInstallation(){let e=[xr.Uri.joinPath(xr.Uri.file(DC.default.homedir()),".rvm","bin","rvm-auto-ruby"),xr.Uri.joinPath(xr.Uri.file("/"),"usr","local","rvm","bin","rvm-auto-ruby"),xr.Uri.joinPath(xr.Uri.file("/"),"usr","share","rvm","bin","rvm-auto-ruby")];for(let t of e)try{return await xr.workspace.fs.stat(t),t}catch{}throw new Error(`Cannot find RVM installation directory. Searched in ${e.map(t=>t.fsPath).join(",")}`)}};var ss=class extends Mt{constructor(e,t,n,i,s){super(e,t,n,i),this.rubyPath=s??"ruby"}async activate(){let e=await this.runEnvActivationScript(this.rubyPath);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}};var PC=ue(require("vscode"));var fc=class extends Mt{async activate(){let e=await this.runEnvActivationScript(`${this.customCommand()} && ruby`);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}customCommand(){let t=PC.workspace.getConfiguration("rubyLsp").get("customRubyCommand");if(t===void 0)throw new Error("The customRubyCommand configuration must be set when 'custom' is selected as the version manager.         See the [README](https://shopify.github.io/ruby-lsp/version-managers.html) for instructions.");return t}};var kC=ue(require("os")),kh=ue(require("path")),Tt=ue(require("vscode"));var hc=class extends Mt{async activate(){let e=[Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","homebrew","bin"),Tt.Uri.joinPath(Tt.Uri.file("/"),"usr","local","bin")],t=await this.getConfiguredAsdfPath()??await this.findAsdfInstallation()??await this.findExec(e,"asdf"),n=kh.default.extname(t)===""?t:`. ${t} && asdf`,i=await this.runEnvActivationScript(`${n} exec ruby`);return{env:{...process.env,...i.env},yjit:i.yjit,version:i.version,gemPath:i.gemPath}}async findAsdfInstallation(){let e=kh.default.basename(Tt.env.shell)==="fish"?"asdf.fish":"asdf.sh",t=[Tt.Uri.joinPath(Tt.Uri.file(kC.default.homedir()),".asdf",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","asdf-vm",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","homebrew","opt","asdf","libexec",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"usr","local","opt","asdf","libexec",e)];for(let n of t)try{return await Tt.workspace.fs.stat(n),n.fsPath}catch{}this.outputChannel.info(`Could not find installation for ASDF < v0.16. Searched in ${t.join(", ")}`)}async getConfiguredAsdfPath(){let t=Tt.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.asdfExecutablePath");if(!t)return;let n=Tt.Uri.file(t);try{return await Tt.workspace.fs.stat(n),this.outputChannel.info(`Using configured ASDF executable path: ${t}`),n.fsPath}catch{throw new Error(`ASDF executable configured as ${n}, but that file doesn't exist`)}}};async function HP(){let r=[Be.Uri.joinPath(Be.Uri.file(pc.default.homedir()),".local","bin","mise"),Be.Uri.joinPath(Be.Uri.file("/"),"opt","homebrew","bin","mise")];for(let e of r)try{return await Be.workspace.fs.stat(e),!0}catch{}return!1}var Eh=(h=>(h.Asdf="asdf",h.Auto="auto",h.Chruby="chruby",h.Rbenv="rbenv",h.Rvm="rvm",h.Shadowenv="shadowenv",h.Mise="mise",h.RubyInstaller="rubyInstaller",h.None="none",h.Custom="custom",h))(Eh||{}),gc=class{constructor(e,t,n,i){this.gemPath=[];this.#e=Be.workspace.getConfiguration("rubyLsp").get("rubyVersionManager");this.shell=process.env.SHELL?.replace(/(\s+)/g,"\\$1");this._env={};this._error=!1;this.context=e,this.workspaceFolder=t,this.outputChannel=n,this.telemetry=i;let s=Be.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=os.default.isAbsolute(s)?s:os.default.resolve(os.default.join(this.workspaceFolder.uri.fsPath,s)))}#e;get versionManager(){return this.#e}set versionManager(e){typeof e=="string"?this.#e.identifier=e:this.#e=e}get env(){return this._env}get error(){return this._error}async activateRuby(e=Be.workspace.getConfiguration("rubyLsp").get("rubyVersionManager")){this.versionManager=e,this._error=!1;let t=this.context.workspaceState.get(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`);if(t)await this.runActivation(new ss(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),t));else{this.versionManager.identifier==="auto"&&(await this.discoverVersionManager(),this.outputChannel.info(`Discovered version manager ${this.versionManager.identifier}`));try{await this.runManagerActivation()}catch(n){n instanceof ro||this.telemetry.logError(n,{versionManager:this.versionManager.identifier,workspace:new Be.TelemetryTrustedValue(this.workspaceFolder.name)});let i=Be.workspace.getConfiguration("rubyLsp").get("rubyExecutablePath");if(i)await this.runActivation(new ss(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),i));else{if(this._error=!0,this.context.extensionMode===Be.ExtensionMode.Test)throw n;await this.handleRubyError(n.message)}}}if(!this.error&&(this.fetchRubyVersionInfo(),await this.setupBundlePath(),os.default.basename(this.workspaceFolder.uri.fsPath)==="ruby-lsp"&&pc.default.platform()!=="win32")){let n=Be.Uri.joinPath(this.workspaceFolder.uri,"exe");this._env.PATH=`${n.fsPath}${os.default.delimiter}${this._env.PATH}`}}async manuallySelectRuby(){let e=await Be.window.showInformationMessage("Configure global or workspace specific fallback for the Ruby LSP?","global","workspace","clear previous workspace selection");if(!e)return;if(e==="clear previous workspace selection")return await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0),this.activateRuby();let t=await Be.window.showOpenDialog({title:`Select Ruby binary path for ${e} configuration`,openLabel:"Select Ruby binary",canSelectMany:!1});if(!t)return;let n=t[0].fsPath;return e==="global"?await Be.workspace.getConfiguration("rubyLsp").update("rubyExecutablePath",n,!0):await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,n),this.activateRuby()}mergeComposedEnvironment(e){this._env={...this._env,...e}}async runActivation(e){let{env:t,version:n,yjit:i,gemPath:s}=await e.activate(),[o,a,c]=n.split(".").map(Number);this.sanitizeEnvironment(t),this.context.extensionMode!==Be.ExtensionMode.Test&&(process.env=t),this._env=t,this.rubyVersion=n,this.yjitEnabled=i&&o>3||o===3&&a>=2,this.gemPath.push(...s)}fetchRubyVersionInfo(){let[e,t,n]=this.rubyVersion.split(".").map(Number);if(e<3)throw new Error(`The Ruby LSP requires Ruby 3.0 or newer to run. This project is using ${this.rubyVersion}.         [See alternatives](https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#ruby-version-requirement)`);this.yjitEnabled&&e===3&&t===2&&(this._env.RUBYOPT?this._env.RUBYOPT.concat(" --yjit"):this._env.RUBYOPT="--yjit")}sanitizeEnvironment(e){Object.keys(e).forEach(t=>{t.startsWith("RUBY_GC")&&delete e[t]}),delete e.VERBOSE,delete e.DEBUG}async runManagerActivation(){switch(this.versionManager.identifier){case"asdf":await this.runActivation(new hc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"chruby":await this.runActivation(new is(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rbenv":await this.runActivation(new dc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rvm":await this.runActivation(new lc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"mise":await this.runActivation(new ac(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rubyInstaller":await this.runActivation(new uc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"custom":await this.runActivation(new fc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"none":await this.runActivation(new ss(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;default:await this.runActivation(new oc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break}}async setupBundlePath(){if(this.customBundleGemfile)try{await Be.workspace.fs.stat(Be.Uri.file(this.customBundleGemfile)),this._env.BUNDLE_GEMFILE=this.customBundleGemfile}catch{throw new Error(`The configured bundle gemfile ${this.customBundleGemfile} does not exist`)}}async discoverVersionManager(){try{await Be.workspace.fs.stat(Be.Uri.joinPath(this.workspaceFolder.uri,".shadowenv.d")),this.versionManager.identifier="shadowenv";return}catch{}let e=["chruby","rbenv","rvm","asdf"];for(let t of e)if(await this.toolExists(t)){this.versionManager=t;return}if(await HP()){this.versionManager="mise";return}if(pc.default.platform()==="win32"){this.versionManager="rubyInstaller";return}this.versionManager="none"}async toolExists(e){try{let t=this.shell?`${this.shell} -i -c '`:"";return t+=`${e} --version`,this.shell&&(t+="'"),this.outputChannel.info(`Checking if ${e} is available on the path with command: ${t}`),await Jt(t,{cwd:this.workspaceFolder.uri.fsPath,timeout:1e3}),!0}catch{return!1}}async handleRubyError(e){let t=await Be.window.showErrorMessage(`Automatic Ruby environment activation with ${this.versionManager.identifier} failed: ${e}`,"Retry","Select Ruby manually");if(t)return t==="Retry"&&await Be.commands.executeCommand("workbench.action.reloadWindow"),this.manuallySelectRuby()}};var xh=ue(require("path")),EC=ue(require("os")),mc=require("perf_hooks"),Se=ue(require("vscode")),on=ue(ic());function VP(){let r=Object.keys(Dh);return Object.fromEntries(r.map(e=>[e,eo(e)]))}function KP(r,e){let t,n,i=Se.workspace.getConfiguration("rubyLsp"),s=i.get("branch"),o=i.get("bundleGemfile"),a=i.get("useBundlerCompose"),c=i.get("bypassTypechecker"),d={cwd:r.uri.fsPath,env:c?{...e,RUBY_LSP_BYPASS_TYPECHECKER:"true"}:e,shell:!0};if(o.length>0)t={command:"bundle",args:["exec","ruby-lsp"],options:d},n={command:"bundle",args:["exec","ruby-lsp","--debug"],options:d};else if(a)t={command:"bundle",args:["compose","gem","ruby-lsp"],options:d},n={command:"bundle",args:["compose","gem","ruby-lsp","--","--debug"],options:d};else{let h=[];s.length>0&&h.push("--branch",s),eo("launcher")&&h.push("--use-launcher"),t={command:"ruby-lsp",args:h,options:d},n={command:"ruby-lsp",args:h.concat(["--debug"]),options:d}}return{run:t,debug:n}}function zP(r,e,t,n,i,s){let o=r.get("pullDiagnosticsOn"),a={onChange:o==="change"||o==="both",onSave:o==="save"||o==="both"},c=r.get("enabledFeatures"),d=Object.keys(c).filter(S=>c[S]),h=["file","git"],m=e.uri.fsPath.replace(/\/$/,""),v=Xr.flatMap(S=>h.map(y=>({scheme:y,language:S,pattern:`${m}/**/*`})));return i&&Xr.forEach(S=>{v.push({language:S,scheme:"untitled"})}),n.gemPath.forEach(S=>{h.forEach(y=>{let P=S.replace(/\\/g,"/");v.push({scheme:y,language:"ruby",pattern:`${P}/**/*`}),/lib\/ruby\/gems\/(?=\d)/.test(P)&&v.push({scheme:y,language:"ruby",pattern:`${P.replace(/lib\/ruby\/gems\/(?=\d)/,"lib/ruby/")}/**/*`})})}),r.get("erbSupport")||(v=v.filter(S=>S.language!=="erb")),{documentSelector:v,workspaceFolder:e,diagnosticCollectionName:sc,outputChannel:t,revealOutputChannelOn:on.RevealOutputChannelOn.Never,diagnosticPullOptions:a,errorHandler:new Ih(e,s),initializationOptions:{enabledFeatures:d,featuresConfiguration:r.get("featuresConfiguration"),formatter:r.get("formatter"),linters:r.get("linters"),indexing:r.get("indexing"),addonSettings:r.get("addonSettings"),enabledFeatureFlags:VP(),telemetryMachineId:Se.env.machineId}}}var Ih=class{constructor(e,t){this.workspaceFolder=e,this.telemetry=t}error(e,t,n){return{action:on.ErrorAction.Shutdown,handled:!0}}async closed(){let e=Se.workspace.getConfiguration("rubyLsp").get("useLauncher")?"launcher":"direct";return this.telemetry.logUsage("ruby_lsp.launch_failure",{type:"counter",attributes:{label:e}}),await Se.window.showErrorMessage(`Launching the Ruby LSP failed. This typically happens due to an error with version manager
      integration or Bundler issues.

      [Logs](command:workbench.action.output.toggleOutput) |
      [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) |
      [Run bundle install](command:rubyLsp.bundleInstall?"${this.workspaceFolder.uri.toString()}")`,"Retry","Shutdown")==="Retry"?{action:on.CloseAction.Restart,handled:!0}:{action:on.CloseAction.DoNotRestart,handled:!0}}},qh=class{fillClientCapabilities(e){e.experimental={requestDelegation:!0}}initialize(e,t){}getState(){return{kind:"static"}}clear(){}},so=class extends on.LanguageClient{constructor(t,n,i,s,o,a,c,d=!1,h){super(sc,KP(o,i.env),zP(Se.workspace.getConfiguration("rubyLsp"),o,a,i,d,n),h);this.degraded=!1;this.virtualDocuments=new Map;this.subscriptions=[];this.registerFeature(new qh),this.workspaceOutputChannel=a,this.virtualDocuments=c,this.registerMiddleware(),this.workingDirectory=o.uri.fsPath,this.baseFolder=xh.default.basename(this.workingDirectory),this.telemetry=n,this.createTestItems=s,this.#e=t,this.ruby=i,this.#t="",this.subscriptions.push(this.onNotification("delegate/textDocument/virtualState",m=>{this.virtualDocuments.set(m.textDocument.uri,m.textDocument.text)}),this.onTelemetry(m=>{m.type==="error"?this.telemetry.logError({message:m.errorMessage,name:m.errorClass,stack:m.stack},{serverVersion:this.serverVersion}):m.type==="data"&&this.validServerTelemetry(m)&&this.telemetry.logUsage(m.eventName,m.data)})),this.indexingPromise=new Promise(m=>{let v=this.onProgress(on.WorkDoneProgress.type,"indexing-progress",S=>{S.kind==="end"&&(v.dispose(),m())})})}#e;#t;async afterStart(){this.#t=this.initializeResult?.formatter,this.serverVersion=this.initializeResult?.serverInfo?.version,this.initializeResult?.degraded_mode&&(this.degraded=this.initializeResult?.degraded_mode),this.initializeResult?.bundle_env&&this.ruby.mergeComposedEnvironment(this.initializeResult.bundle_env),await this.fetchAddons()}async fetchAddons(){if(this.initializeResult?.capabilities.experimental?.addon_detection)try{this.addons=await this.sendRequest("rubyLsp/workspace/addons",{})}catch(t){this.workspaceOutputChannel.error(`Error while fetching addons: ${t.data.errorMessage}`)}}async waitForIndexing(){return this.indexingPromise}get formatter(){return this.#t}get context(){return this.#e}set context(t){this.#e=t}async sendShowSyntaxTreeRequest(t,n){return this.sendRequest("rubyLsp/textDocument/showSyntaxTree",{textDocument:{uri:t.toString()},range:n})}async discoverTests(t){return this.sendRequest("rubyLsp/discoverTests",{textDocument:{uri:t.toString()}})}async resolveTestCommands(t){return this.sendRequest("rubyLsp/resolveTestCommands",{items:t})}async dispose(t){return this.subscriptions.forEach(n=>n.dispose()),this.subscriptions=[],super.dispose(t)}async sendGoToRelevantFileRequest(t){return this.sendRequest("experimental/goToRelevantFile",{textDocument:{uri:t.toString()}})}async benchmarkMiddleware(t,n,i){if(this.state!==on.State.Running)return i();let s=typeof t=="string"?t:t.method;try{mc.performance.mark(`${s}.start`);let o=await i();mc.performance.mark(`${s}.end`);let a=mc.performance.measure("benchmarks",`${s}.start`,`${s}.end`);return this.logResponseTime(a.duration,s),o}catch(o){if(o.code===-32900)return this.executeDelegateRequest(t,n);if(o.data)if(this.baseFolder==="ruby-lsp"||this.baseFolder==="ruby-lsp-rails")await Se.window.showErrorMessage(`Ruby LSP error ${o.data.errorClass}: ${o.data.errorMessage}

${o.data.backtrace}`);else{let{errorMessage:a,errorClass:c,backtrace:d}=o.data;if(a&&c&&d&&o.code===on.ErrorCodes.InternalError){let h=new Se.TelemetryTrustedValue(d.split(`
`).map(m=>m.replace(EC.default.homedir(),"~")).join(`
`));this.telemetry.logError({message:a,name:c,stack:h},{...o.data,serverVersion:this.serverVersion,workspace:new Se.TelemetryTrustedValue(xh.default.basename(this.workingDirectory))})}}throw o}}async executeDelegateRequest(t,n){let i=typeof t=="string"?t:t.method,s=n.textDocument.uri;if(!s)return null;let o=this.virtualDocumentUri(s);switch(i){case"textDocument/completion":return Se.commands.executeCommand("vscode.executeCompletionItemProvider",Se.Uri.parse(o),n.position,n.context.triggerCharacter).then(a=>(a.items.forEach(c=>{c.documentation&&typeof c.documentation!="string"&&"value"in c.documentation&&(c.documentation.kind="markdown"),c.data={...c.data,delegateCompletion:!0}}),a));case"textDocument/hover":return Se.commands.executeCommand("vscode.executeHoverProvider",Se.Uri.parse(o),n.position);case"textDocument/definition":return Se.commands.executeCommand("vscode.executeDefinitionProvider",Se.Uri.parse(o),n.position);case"textDocument/signatureHelp":return Se.commands.executeCommand("vscode.executeSignatureHelpProvider",Se.Uri.parse(o),n.position,n.context?.triggerCharacter);case"textDocument/documentHighlight":return Se.commands.executeCommand("vscode.executeDocumentHighlights",Se.Uri.parse(o),n.position);default:return this.workspaceOutputChannel.warn(`Attempted to delegate unsupported request ${i}`),null}}registerMiddleware(){this.clientOptions.middleware={provideCodeLenses:async(t,n,i)=>{let s=await i(t,n);if(s){let o=s.filter(a=>a.data.type==="test");o.length&&this.createTestItems(o)}return s},provideOnTypeFormattingEdits:async(t,n,i,s,o,a)=>{let c=await this.sendRequest("textDocument/onTypeFormatting",{textDocument:{uri:t.uri.toString()},position:n,ch:i,options:s},o);if(!c)return null;let d=c.find(x=>x.newText==="$0");if(!d)return c;c.splice(c.indexOf(d),1);let h=new Se.WorkspaceEdit;h.set(t.uri,c);let v=Se.window.activeTextEditor.document.lineAt(d.range.start.line).text;await Se.workspace.applyEdit(h);let S=Se.window.activeTextEditor?.options.insertSpaces?" ":"	",y=0;/^\s*$/.exec(v)&&(y=d.range.end.character);let P=S.repeat(y);return await Se.window.activeTextEditor.insertSnippet(new Se.SnippetString(`${P}${d.newText}`),new Se.Selection(d.range.start,d.range.end)),null},sendRequest:async(t,n,i,s)=>this.benchmarkMiddleware(t,n,()=>s(t,n,i)),sendNotification:async(t,n,i)=>this.benchmarkMiddleware(t,i,()=>n(t,i)),didClose:(t,n)=>(this.virtualDocuments.delete(t.uri.toString(!0)),n(t)),provideFoldingRanges:async(t,n,i,s)=>{if(t.languageId==="erb"){let o=this.virtualDocumentUri(t.uri.toString(!0)),a=await Se.commands.executeCommand("vscode.executeFoldingRangeProvider",Se.Uri.parse(o)),c=await s(t,n,i);return a.concat(c??[])}return s(t,n,i)},provideDocumentLinks:async(t,n,i)=>{if(t.languageId==="erb"){let s=this.virtualDocumentUri(t.uri.toString(!0)),o=await Se.commands.executeCommand("vscode.executeLinkProvider",Se.Uri.parse(s)),a=await i(t,n);return o.concat(a??[])}return i(t,n)}}}virtualDocumentUri(t){let n=/\.([^.]+)\.erb$/.exec(t)?.[1]||"html";return`embedded-content://${n}/${encodeURIComponent(t)}.${n}`}logResponseTime(t,n){this.telemetry.logUsage("ruby_lsp.response_time",{type:"histogram",value:t,attributes:{message:new Se.TelemetryTrustedValue(n),lspVersion:this.serverVersion,rubyVersion:this.ruby.rubyVersion}})}validServerTelemetry(t){let{eventName:n,data:{type:i,value:s}}=t;return typeof n=="string"&&(i==="histogram"&&typeof s=="number"||i==="counter"&&(typeof s=="number"||!s))}};var vc=class{constructor(e,t){this.prefix=`(${e})`,this.actualChannel=t,this.onDidChangeLogLevel=this.actualChannel.onDidChangeLogLevel}get name(){return this.actualChannel.name}get logLevel(){return this.actualChannel.logLevel}trace(e,...t){this.actualChannel.trace(`${this.prefix} ${e}`,...t)}debug(e,...t){this.actualChannel.debug(`${this.prefix} ${e}`,...t)}info(e,...t){this.actualChannel.info(`${this.prefix} ${e}`,...t)}warn(e,...t){this.actualChannel.warn(`${this.prefix} ${e}`,...t)}error(e,...t){this.actualChannel.error(`${this.prefix} ${e}`,...t)}append(e){this.actualChannel.append(`${this.prefix} ${e}`)}appendLine(e){this.actualChannel.appendLine(`${this.prefix} ${e}`)}replace(e){this.actualChannel.replace(`${this.prefix} ${e}`)}clear(){this.actualChannel.clear()}show(e,t){this.actualChannel.show(t)}hide(){this.actualChannel.hide()}dispose(){this.actualChannel.dispose()}};var xC=["Gemfile.lock","gems.locked"],bc=class{constructor(e,t,n,i,s,o=!1){this.virtualDocuments=new Map;this.restartDocumentShas=new Map;this.needsRestart=!1;this.subscriptions=[];this.#e=!1;this.#t=!1;this.debouncedRestart=SC(async e=>{this.outputChannel.info(`Restarting the Ruby LSP because ${e}`),await this.restart()},5e3);this.context=e,this.workspaceFolder=t,this.outputChannel=new vc(t.name,yr),this.telemetry=n,this.ruby=new gc(e,t,this.outputChannel,n),this.createTestItems=i,this.isMainWorkspace=o,this.virtualDocuments=s}#e;#t;async activate(){let e=ht.extensions.getExtension("vscode.git"),t=this.workspaceFolder.uri;if(e){let i=await e.exports.getAPI(1).openRepository(this.workspaceFolder.uri);i&&(t=i.rootUri)}this.registerCreateDeleteWatcher(t,".git/{rebase-merge,rebase-apply,BISECT_START,CHERRY_PICK_HEAD}"),this.registerRestarts();for(let n of xC){let i=ht.Uri.joinPath(this.workspaceFolder.uri,n),s=await this.fileContentsSha(i);s&&this.restartDocumentShas.set(i.fsPath,s)}}async start(e){if(await this.ruby.activateRuby(),this.ruby.error){this.error=!0;return}try{if((await ht.workspace.fs.stat(this.workspaceFolder.uri)).permissions)throw new Error(`Directory ${this.workspaceFolder.uri.fsPath} is readonly.`)}catch{this.error=!0,await ht.window.showErrorMessage(`Directory ${this.workspaceFolder.uri.fsPath} is not writable. The Ruby LSP server needs to be able to create a
        .ruby-lsp directory to function appropriately. Consider switching to a directory for which VS Code has write
        permissions`);return}try{await this.installOrUpdateServer(!1)}catch(t){this.error=!0,await ht.window.showErrorMessage(`Failed to setup the bundle: ${t.message}.         See [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) for help`);return}this.lspClient&&await this.stop(),this.lspClient=new so(this.context,this.telemetry,this.ruby,this.createTestItems,this.workspaceFolder,this.outputChannel,this.virtualDocuments,this.isMainWorkspace,e);try{Xn.fire(this),await ht.window.withProgress({location:ht.ProgressLocation.Window,title:"Initializing Ruby LSP"},async()=>{await this.lspClient.start(),await this.lspClient.afterStart()}),Xn.fire(this),this.needsRestart&&(this.needsRestart=!1,await this.debouncedRestart("a restart was requested while the server was still booting"))}catch(t){this.error=!0,this.outputChannel.error(`Error starting the server: ${t.message}`)}}async stop(){await this.lspClient?.dispose()}async restart(){try{if(this.#e)return;if(this.error=!1,!this.lspClient)return this.start();let e=!1;switch(this.lspClient.state){case yc.State.Starting:this.needsRestart=!0;break;case yc.State.Running:e=!this.lspClient.initializeResult?.capabilities.experimental.compose_bundle||await this.composingBundleSucceeds(),e&&(await this.stop(),this.lspClient=void 0,await this.start());break;case yc.State.Stopped:await this.stop(),this.lspClient=void 0,await this.start();break}}catch(e){this.error=!0,this.outputChannel.error(`Error restarting the server: ${e.message}`)}}async dispose(){this.subscriptions.forEach(e=>e.dispose()),await this.lspClient?.dispose()}async installOrUpdateServer(e){if(ht.workspace.getConfiguration("rubyLsp").get("bundleGemfile").length>0)return;let n=24*60*60*1e3,i=this.context.workspaceState.get("rubyLsp.lastGemUpdate"),s=["ruby-lsp","language_server-protocol","prism","rbs","sorbet-runtime"],{stdout:o}=await Jt(`gem list ${s.join(" ")}`,{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env});if(!s.every(a=>new RegExp(`${a}\\s`).exec(o))){await Jt("gem install ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now());return}if(e)try{await ht.workspace.fs.delete(ht.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp"),{recursive:!0})}catch{this.outputChannel.info(`Tried deleting ${ht.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp")}, but it doesn't exist`)}if(e||i===void 0||Date.now()-i>n)try{await Jt("gem update ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now())}catch(a){this.outputChannel.error(`Failed to update global ruby-lsp gem: ${a}`)}}get error(){return this.#t}set error(e){Xn.fire(this),this.#t=e}get inhibitRestart(){return this.#e}async execute(e,t=!1){t&&(this.outputChannel.show(),this.outputChannel.info(`Running "${e}"`));let n=await Jt(e,{env:this.ruby.env,cwd:this.workspaceFolder.uri.fsPath});return t&&(n.stderr.length>0?this.outputChannel.error(n.stderr):this.outputChannel.info(n.stdout)),n}registerRestarts(){this.createRestartWatcher(`{${xC.join(",")}}`),this.subscriptions.push(ht.workspace.onDidChangeConfiguration(async e=>{e.affectsConfiguration("rubyLsp")&&await this.debouncedRestart("configuration changed")}))}createRestartWatcher(e){let t=ht.workspace.createFileSystemWatcher(new ht.RelativePattern(this.workspaceFolder,e)),n=async s=>{let o=s.fsPath,a=await this.fileContentsSha(s);a&&this.restartDocumentShas.get(o)!==a&&(this.restartDocumentShas.set(o,a),await this.debouncedRestart(`${o} changed, matching ${e}`))},i=async s=>{this.restartDocumentShas.delete(s.fsPath),await this.debouncedRestart(`${s.fsPath} changed, matching ${e}`)};this.subscriptions.push(t,t.onDidChange(n),t.onDidCreate(n),t.onDidDelete(i))}registerCreateDeleteWatcher(e,t){let n=ht.workspace.createFileSystemWatcher(new ht.RelativePattern(e,t)),i=()=>{this.#e=!0},s=async o=>{this.#e=!1,await this.debouncedRestart(`${o.fsPath} changed, matching ${t}`)};this.subscriptions.push(n,n.onDidCreate(i),n.onDidDelete(s))}async fileContentsSha(e){let t;try{t=await ht.workspace.fs.readFile(e)}catch{return}let n=(0,IC.createHash)("sha256");return n.update(t.toString()),n.digest("hex")}async composingBundleSucceeds(){if(!this.lspClient)return!1;try{return(await this.lspClient.sendRequest("rubyLsp/composeBundle")).success}catch{return!1}}};var mn=ue(require("vscode")),wc=ue(rc());var qC=[{label:"Ruby LSP: Start",description:"rubyLsp.start"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"}],Oh=[{label:"Ruby LSP: Stop",description:"rubyLsp.stop"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"},{label:"Ruby LSP: Open server changelog in browser",description:"rubyLsp.showServerChangelog"}],wi=class{constructor(e){let t=Xr.map(n=>({language:n}));this.item=mn.languages.createLanguageStatusItem(e,t)}dispose(){this.item.dispose()}},Fh=class extends wi{constructor(){super("rubyVersion"),this.item.name="Ruby Version",this.item.command={title:"Configure",command:"rubyLsp.selectRubyVersionManager"},this.item.text="Activating Ruby environment",this.item.severity=mn.LanguageStatusSeverity.Information}refresh(e){e.ruby.error?(this.item.text="Failed to activate Ruby",this.item.severity=mn.LanguageStatusSeverity.Error):(this.item.text=`Using Ruby ${e.ruby.rubyVersion} with ${e.ruby.versionManager.identifier}`,this.item.severity=mn.LanguageStatusSeverity.Information)}},Lh=class extends wi{constructor(){super("server"),this.item.name="Ruby LSP Server Status",this.item.text="Ruby LSP: Starting",this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command={title:"Configure",command:"rubyLsp.serverOptions",arguments:[Oh]}}refresh(e){if(e.error){this.item.text="Ruby LSP: Error",this.item.command.arguments=[qC],this.item.severity=mn.LanguageStatusSeverity.Error;return}if(e.lspClient)switch(e.lspClient.state){case wc.State.Running:{this.item.text=e.lspClient.serverVersion?`Ruby LSP server v${e.lspClient.serverVersion}: Running`:"Ruby LSP: Running",e.lspClient.degraded?(this.item.text+=" (degraded)",this.item.severity=mn.LanguageStatusSeverity.Warning):this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command.arguments=[Oh];break}case wc.State.Starting:{this.item.text="Ruby LSP: Starting",this.item.command.arguments=[Oh],this.item.severity=mn.LanguageStatusSeverity.Information;break}case wc.State.Stopped:{this.item.text="Ruby LSP: Stopped",this.item.command.arguments=[qC],this.item.severity=mn.LanguageStatusSeverity.Information;break}}}},Mh=class extends wi{constructor(){super("features"),this.item.name="Ruby LSP Features",this.item.command={title:"Manage",command:"rubyLsp.toggleFeatures"},this.item.text="Fetching feature information"}refresh(e){let n=mn.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),i=Object.keys(n).filter(s=>n[s]);this.item.text=`${i.length}/${Object.keys(n).length} features enabled`}},Nh=class extends wi{constructor(){super("formatter"),this.item.name="Ruby LSP Formatter",this.item.command={title:"Help",command:"rubyLsp.formatterHelp"},this.item.text="Fetching formatter information"}refresh(e){e.lspClient&&(e.lspClient.formatter?this.item.text=`Formatter: ${e.lspClient.formatter}`:this.item.text="Formatter: requires server to be v0.12.4 or higher to display this field")}},Ah=class extends wi{constructor(){super("addons"),this.item.name="Ruby LSP Add-ons",this.item.text="Fetching add-on information"}refresh(e){e.lspClient&&(e.lspClient.addons===void 0?this.item.text="Addons: requires server to be v0.17.4 or higher to display this field":e.lspClient.addons.length===0?this.item.text="Addons: none":(this.item.text=`Addons: ${e.lspClient.addons.length}`,this.item.command={title:"Details",command:"rubyLsp.displayAddons"}))}},Cc=class{constructor(){this.items=[];this.items=[new Fh,new Lh,new Mh,new Nh,new Ah],Xn.event(e=>{e&&this.items.forEach(t=>t.refresh(e))})}dispose(){this.items.forEach(e=>e.dispose())}};var Vc=require("child_process"),yR=require("util"),_i=ue(require("path")),Mn=ue(lR()),W=ue(require("vscode"));var Pk=(0,yR.promisify)(Vc.exec),bR="**/{test,spec,features}/**/",fR=`${bR}{*_test.rb,test_*.rb,*_spec.rb,*.feature}`,hR=new W.TestTag("workspace"),pR=new W.TestTag("test_dir"),gR=new W.TestTag("test_group"),ni=new W.TestTag("debug"),kk=new W.TestTag("test_file"),gs={start:new Mn.NotificationType("start"),pass:new Mn.NotificationType("pass"),skip:new Mn.NotificationType("skip"),fail:new Mn.NotificationType("fail"),error:new Mn.NotificationType("error"),appendOutput:new Mn.NotificationType("append_output")},Jp="Run",mR="Debug",vR="Coverage",Hc=class{constructor(e,t,n,i){this.testTimeout=W.workspace.getConfiguration("rubyLsp").get("testTimeout");this.fullDiscovery=eo("fullTestDiscovery");this.coverageData=new WeakMap;this.telemetry=t,this.currentWorkspace=n,this.getOrActivateWorkspace=i,this.testController=W.tests.createTestController("rubyTests","Ruby Tests"),this.fullDiscovery&&(this.testController.resolveHandler=this.resolveHandler.bind(this)),this.testCommands=new WeakMap,this.testRunProfile=this.testController.createRunProfile(Jp,W.TestRunProfileKind.Run,this.fullDiscovery?this.runTest.bind(this):this.runHandler.bind(this),!0),this.testDebugProfile=this.testController.createRunProfile(mR,W.TestRunProfileKind.Debug,this.fullDiscovery?this.runTest.bind(this):this.debugHandler.bind(this),!1,ni),this.coverageProfile=this.testController.createRunProfile(vR,W.TestRunProfileKind.Coverage,this.fullDiscovery?this.runTest.bind(this):async()=>{await W.window.showInformationMessage(`Running tests with coverage requires the new explorer implementation,
               which is currently under development.
               If you wish to enable it, set the "fullTestDiscovery" feature flag to "true"`)},!1),this.coverageProfile.loadDetailedCoverage=async(a,c,d)=>this.coverageData.get(c);let s=W.workspace.createFileSystemWatcher(fR),o=W.workspace.createFileSystemWatcher(bR,!0,!0,!1);e.subscriptions.push(this.testController,this.testDebugProfile,this.testRunProfile,this.coverageProfile,W.window.onDidCloseTerminal(a=>{a===this.terminal&&(this.terminal=void 0)}),s,o,s.onDidCreate(async a=>{let c=W.workspace.getWorkspaceFolder(a);if(!c||!W.workspace.workspaceFolders)return;let d=W.workspace.workspaceFolders.length===1?this.testController.items:this.testController.items.get(c.uri.toString())?.children;d&&await this.addTestItemsForFile(a,c,d)}),s.onDidChange(async a=>{let c=await this.getParentTestItem(a);if(c){let d=c.children.get(a.toString());d&&(d.children.replace([]),await this.resolveHandler(d))}}),o.onDidDelete(async a=>{if(a.fsPath.split(_i.default.sep).includes(".git"))return;let d=await this.getParentTestItem(a);d&&d.children.delete(a.toString())}),s.onDidDelete(async a=>{let c=await this.getParentTestItem(a);c&&c.children.delete(a.toString())}))}createTestItems(e){if(this.fullDiscovery)return;this.testController.items.forEach(i=>{this.testController.items.delete(i.id),this.testCommands.delete(i)});let t=new Map,n=W.Uri.from({scheme:"file",path:e[0].command.arguments[0]});e.forEach(i=>{let[s,o,a,c,d]=i.command.arguments,h=this.testController.createTestItem(o,d||o,n),m=i.data;if(h.tags=[new W.TestTag(m.kind)],this.testCommands.set(h,a),h.range=new W.Range(new W.Position(c.start_line,c.start_column),new W.Position(c.end_line,c.end_column)),m.id?(t.set(m.id,h),h.canResolveChildren=!0):h.tags=[...h.tags,ni],m.group_id){let v=t.get(m.group_id);v?v.children.add(h):this.currentWorkspace()?.outputChannel.error(`Test example "${o}" is attached to group_id ${m.group_id}, but that group does not exist`)}else this.testController.items.add(h)})}runTestInTerminal(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"",this.terminal===void 0&&(this.terminal=this.getTerminal()),this.terminal.show(),this.terminal.sendText(n),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test_in_terminal",vscodemachineid:W.env.machineId}})}async runOnClick(e){let t=this.findTestById(e);if(!t)return;await W.commands.executeCommand("vscode.revealTestInExplorer",t);let n=new W.CancellationTokenSource;n.token.onCancellationRequested(async()=>{n?.dispose(),n=null,await W.window.showInformationMessage("Cancelled the progress")});let i=new W.TestRunRequest([t],[],this.testRunProfile);return this.testRunProfile.runHandler(i,n.token)}debugTest(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"";let i=this.currentWorkspace();if(!i)throw new Error("No workspace found. Debugging requires a workspace to be opened");return W.debug.startDebugging(i.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:n,env:{...i.ruby.env,DISABLE_SPRING:"1"}})}buildRequestTestItems(e,t){if(!t)return e.map(i=>this.testItemToServerItem(i));let n=[];return e.forEach(i=>{let s=this.recursivelyFilter(i,t);s&&n.push(s)}),n}async runTest(e,t){this.telemetry.logUsage("ruby_lsp.test_explorer",{type:"counter",attributes:{label:e.profile?.label||Jp,vscodemachineid:W.env.machineId,continuousMode:e.continuous??!1}});let n=this.testController.createTestRun(e,void 0,!0),i=[];e.include?e.include.forEach(o=>i.push(o)):this.testController.items.forEach(o=>i.push(o));let s=new Map;i.forEach(o=>{let a=W.workspace.getWorkspaceFolder(o.uri),c=s.get(a);c?c.push(o):s.set(a,[o])});for(let[o,a]of s){if(t.isCancellationRequested)break;let c=this.buildRequestTestItems(a,e.exclude),d=await this.getOrActivateWorkspace(o),h=await d.lspClient?.resolveTestCommands(c);if(!h){a.forEach(v=>n.errored(v,new W.TestMessage("Could not resolve test command to run selected tests")));continue}let m=e.profile;!m||m.label===Jp||m.label===vR?(a.forEach(v=>n.enqueued(v)),await this.executeTestCommands(h,d,n,m,t)):m.label===mR&&await this.debugTestCommands(h,d,n,t)}n.end()}async findTestItem(e,t){let n=await this.getParentTestItem(t);if(!n)return;if(n.id===e)return n;let i=n.children.get(t.toString());if(!i)return;if(i.id===e)return i;i.children.size===0&&await this.resolveHandler(i);let s=i.children.get(e);return s||this.findTestInGroup(e,i)}async executeTestCommands(e,t,n,i,s){let o=t.ruby.env.RUBYOPT?`${t.ruby.env.RUBYOPT} ${e.reporterPaths?.map(c=>`-r${c}`).join(" ")}`:e.reporterPaths?.map(c=>`-r${c}`).join(" "),a=i===this.coverageProfile?"coverage":"run";for(let c of e.commands)try{t.outputChannel.debug(`Running tests: "RUBYOPT=${o} ${c}"`),await this.runCommandWithStreamingUpdates(n,c,{...t.ruby.env,RUBY_LSP_TEST_RUNNER:a,RUBYOPT:o},t.workspaceFolder.uri.fsPath,s)}catch(d){await W.window.showErrorMessage(`Running ${c} failed: ${d.message}`)}i===this.coverageProfile&&(n.appendOutput(`Processing test coverage results...\r
\r
`),await this.processTestCoverageResults(n,t.workspaceFolder))}async debugTestCommands(e,t,n,i){for(let s of e.commands){if(i.isCancellationRequested)break;let o=[];await new Promise((a,c)=>(o.push(i.onCancellationRequested(W.debug.stopDebugging),W.debug.onDidTerminateDebugSession(()=>{o.forEach(d=>d.dispose()),a()})),W.debug.startDebugging(t.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:s,env:{...t.ruby.env,DISABLE_SPRING:"1",RUBY_LSP_TEST_RUNNER:"debug"}},{testRun:n}).then(d=>{d||c()})))}}findTestInGroup(e,t){let n;if(t.children.forEach(i=>{(e.startsWith(`${i.id}#`)||e.startsWith(`${i.id}::`))&&(n=i)}),!!n)return n.children.get(e)??this.findTestInGroup(e,n)}getTerminal(){let e=this.currentWorkspace(),t=e?`${e.workspaceFolder.name}: test`:"Ruby LSP: test",n=W.window.terminals.find(i=>i.name===t);return n||W.window.createTerminal({name:t})}async debugHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=e.include[0],s=Date.now();await this.debugTest("","",this.testCommands.get(i)),n.passed(i,Date.now()-s),n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"debug",vscodemachineid:W.env.machineId}})}async runHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=[],s=a=>{i.push(a),n.enqueued(a)};e.include?e.include.forEach(s):this.testController.items.forEach(s);let o=this.currentWorkspace();for(;i.length>0&&!t.isCancellationRequested;){let a=i.pop();if(e.exclude?.includes(a)){n.skipped(a);continue}if(n.started(a),a.tags.find(c=>c.id==="example")){let c=Date.now();try{if(!o){n.errored(a,new W.TestMessage("No workspace found"));continue}let d=await this.assertTestPasses(a,o.workspaceFolder.uri.fsPath,o.ruby.env);n.appendOutput(d.replace(/\r?\n/g,`\r
`),void 0,a),n.passed(a,Date.now()-c)}catch(d){n.appendOutput(d.message.replace(/\r?\n/g,`\r
`),void 0,a);let h=Date.now()-c;if(d.killed){n.errored(a,new W.TestMessage(`Test timed out after ${this.testTimeout} seconds`),h);continue}let m=d.message.split(`
`),v=m[0]===""?m.slice(10,m.length-2).join(`
`):m.slice(4,m.length-9).join(`
`),S=[new W.TestMessage(d.message),new W.TestMessage(v)];m.find(y=>y==="F")?n.failed(a,S,h):n.errored(a,S,h)}}a.children.forEach(s)}n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test",vscodemachineid:W.env.machineId}})}async assertTestPasses(e,t,n){try{return(await Pk(this.testCommands.get(e),{cwd:t,env:n,timeout:this.testTimeout*1e3})).stdout}catch(i){throw i.killed?i:new Error(i.stdout)}}findTestById(e,t=this.testController.items){if(!e)return this.findTestByActiveLine();let n=t.get(e);return n||(t.forEach(i=>{let s=this.findTestById(e,i.children);s&&(n=s)}),n)}findTestByActiveLine(e=W.window.activeTextEditor,t=this.testController.items){if(!e)return;let n=e.selection.active.line,i;return t.forEach(s=>{if(!i&&(s.uri?.toString()===e.document.uri.toString()&&s.range?.start.line<=n&&s.range?.end.line>=n&&(i=s),s.children.size>0)){let o=this.findTestByActiveLine(e,s.children);o&&(i=o)}}),i}async resolveHandler(e){let t=W.workspace.workspaceFolders;if(t)if(e){let n=W.workspace.getWorkspaceFolder(e.uri);if(e.tags.some(i=>i===hR))await this.gatherWorkspaceTests(n,e);else if(!e.tags.some(i=>i===gR)){let s=(await this.getOrActivateWorkspace(n)).lspClient;if(s){await s.waitForIndexing();let o=await s.discoverTests(e.uri);o&&this.addDiscoveredItems(o,e)}}}else if(t.length===1)await W.commands.executeCommand("testing.clearTestResults"),await this.gatherWorkspaceTests(t[0],void 0);else{await W.commands.executeCommand("testing.clearTestResults");for(let n of t){let i=this.testPattern(n);if((await W.workspace.findFiles(i,void 0,1)).length===0)continue;let o=n.uri,a=this.testController.createTestItem(o.toString(),n.name,o);a.canResolveChildren=!0,a.tags=[hR,ni],this.testController.items.add(a)}}}async gatherWorkspaceTests(e,t){let n=t?t.children:this.testController.items,i=this.testPattern(e),s,o;for(let a of await W.workspace.findFiles(i)){let c=await this.addTestItemsForFile(a,e,n);if(!c)continue;let{firstLevel:d,secondLevel:h,testItem:m}=c;(!o||o.id!==d.id)&&(await this.resolveHandler(m),s=m.tags.find(v=>v.id.startsWith("framework")),o=d),this.addFrameworkTag(d,s),h&&this.addFrameworkTag(h,s)}}addFrameworkTag(e,t){e.tags.some(n=>n.id.startsWith("framework"))||(e.tags=[...e.tags,t])}async addTestItemsForFile(e,t,n){let i=_i.default.basename(e.fsPath),o=W.workspace.asRelativePath(e,!1).split(_i.default.sep);if(this.shouldSkipTestFile(i,o))return;let{firstLevel:a,secondLevel:c}=await this.getOrCreateHierarchyLevels(e,t,n),d=c?c.children:a.children,h=this.testController.createTestItem(e.toString(),i,e);return h.canResolveChildren=!0,h.tags=[kk,ni],d.add(h),{firstLevel:a,secondLevel:c,testItem:h}}async detectHierarchyLevels(e,t){let i=W.workspace.asRelativePath(e,!1).split(_i.default.sep),s=this.testDirectoryPosition(i),o=i.slice(0,s+1).join(_i.default.sep),a=W.Uri.joinPath(t.uri,o),c=i.slice(s+1,s+2).join(_i.default.sep);if(c.length>0){let d=W.Uri.joinPath(a,c);try{if((await W.workspace.fs.stat(d)).type===W.FileType.Directory)return{firstLevel:{name:o,uri:a},secondLevel:{name:c,uri:d}}}catch{}}return{firstLevel:{name:o,uri:a}}}async getOrCreateHierarchyLevels(e,t,n){let{firstLevel:i,secondLevel:s}=await this.detectHierarchyLevels(e,t),o=n.get(i.uri.toString());if(o||(o=this.testController.createTestItem(i.uri.toString(),i.name,i.uri),o.tags=[pR,ni],n.add(o)),s){let a=o.children.get(s.uri.toString());return a||(a=this.testController.createTestItem(s.uri.toString(),s.name,s.uri),a.tags=[pR,ni],o.children.add(a)),{firstLevel:o,secondLevel:a}}return{firstLevel:o,secondLevel:o}}shouldSkipTestFile(e,t){return!!(e==="test_helper.rb"||t.some(n=>n==="fixtures"))}testPattern(e){return new W.RelativePattern(e,fR)}testDirectoryPosition(e){let t=e.indexOf("test");return t!==-1||(t=e.indexOf("spec"),t!==-1)?t:e.indexOf("features")}async getParentTestItem(e){let t=W.workspace.workspaceFolders;if(!t)return;let n=this.testController.items,i=t[0];t.length>1&&(i=W.workspace.getWorkspaceFolder(e),n=n.get(i.uri.toString()).children);let{firstLevel:s,secondLevel:o}=await this.detectHierarchyLevels(e,i),a=n.get(s.uri.toString());return o&&(a=a?.children.get(o.uri.toString())),a}addDiscoveredItems(e,t){if(e.length===0)return;e.forEach(i=>{let s=this.testController.createTestItem(i.id,i.label,W.Uri.parse(i.uri));s.canResolveChildren=i.children.length>0;let o=i.range.start,a=i.range.end;s.range=new W.Range(new W.Position(o.line,o.character),new W.Position(a.line,a.character));let c=i.tags.map(d=>new W.TestTag(d));s.tags=s.canResolveChildren?[gR,ni,...c]:[ni,...c],t.children.add(s),s.canResolveChildren&&this.addDiscoveredItems(i.children,s)});let n=e[0].tags.find(i=>i.startsWith("framework"));n&&(t.tags.some(i=>i.id.startsWith("framework"))||(t.tags=[...t.tags,new W.TestTag(n)]))}recursivelyFilter(e,t){if(t.includes(e))return null;let n=[];if(e.children.forEach(s=>{let o=this.recursivelyFilter(s,t);o&&n.push(o)}),e.children.size>0&&n.length===0)return null;let i={id:e.id,label:e.label,uri:e.uri.toString(),tags:e.tags.map(s=>s.id),children:[]};return e.range&&(i.range={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),e.children.size!==n.length&&(i.children=n),i}testItemToServerItem(e){let t=[];e.children.forEach(i=>{t.push(this.testItemToServerItem(i))});let n;return e.range&&(n={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),{id:e.id,label:e.label,uri:e.uri.toString(),range:n,children:t,tags:e.tags.map(i=>i.id)}}async runCommandWithStreamingUpdates(e,t,n,i,s){await new Promise((o,a)=>{let c=[],d=new AbortController;s.onCancellationRequested(()=>{e.appendOutput(`\r
Test run cancelled.`),d.abort()});let h=(0,Vc.spawn)(t,{env:n,stdio:["pipe","pipe","pipe"],shell:!0,signal:d.signal,cwd:i}),m=Mn.createMessageConnection(new Mn.StreamMessageReader(h.stdout),new Mn.StreamMessageWriter(h.stdin)),v=[],S="";h.stderr.on("data",y=>{let P=y.toString();S+=P,e.appendOutput(P)}),h.on("exit",()=>{Promise.all(c).then(()=>{v.forEach(y=>y.dispose()),m.end(),m.dispose(),o()}).catch(y=>{a(y)})}),v.push(m.onNotification(gs.start,y=>{c.push(this.findTestItem(y.id,W.Uri.parse(y.uri)).then(P=>{P&&e.started(P)}))})),v.push(m.onNotification(gs.pass,y=>{c.push(this.findTestItem(y.id,W.Uri.parse(y.uri)).then(P=>{P&&e.passed(P)}))})),v.push(m.onNotification(gs.fail,y=>{c.push(this.findTestItem(y.id,W.Uri.parse(y.uri)).then(P=>{P&&e.failed(P,new W.TestMessage(y.message))}))})),v.push(m.onNotification(gs.error,y=>{c.push(this.findTestItem(y.id,W.Uri.parse(y.uri)).then(P=>{P&&e.errored(P,new W.TestMessage(y.message))}))})),v.push(m.onNotification(gs.skip,y=>{c.push(this.findTestItem(y.id,W.Uri.parse(y.uri)).then(P=>{P&&e.skipped(P)}))})),v.push(m.onNotification(gs.appendOutput,y=>{e.appendOutput(y.message)})),m.listen()})}async processTestCoverageResults(e,t){try{let n=await W.workspace.fs.readFile(W.Uri.joinPath(t.uri,".ruby-lsp","coverage_result.json")),i=JSON.parse(n.toString());Object.entries(i).forEach(([s,o])=>{let a=W.FileCoverage.fromDetails(W.Uri.parse(s),o);e.addCoverage(a),this.coverageData.set(a,o)})}catch(n){e.appendOutput(`Failed to process coverage results: ${n.message}`)}}};var wR=ue(require("path")),Ye=ue(require("vscode"));async function CR(r,e,t){let{file:n,...i}=t,{line:s,character:o=0,endLine:a=s,endCharacter:c=o}=i,d=new Ye.Range(s,o,a,c),h=Ye.Uri.parse(`file://${n}`),m=await Ye.workspace.openTextDocument(h);await Ye.window.showTextDocument(m,{selection:d}),e?.lspClient?.serverVersion&&r.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"open_file",vscodemachineid:Ye.env.machineId}})}async function Xp(r){if(r.length===1){await Ye.commands.executeCommand("vscode.open",Ye.Uri.parse(r[0]));return}let e=r.map(n=>{let i=Ye.Uri.parse(n);return{label:wR.default.basename(i.fsPath),iconPath:new Ye.ThemeIcon("go-to-file"),uri:i}}),t=await Ye.window.showQuickPick(e,{title:"Select a file to jump to"});t&&await Ye.commands.executeCommand("vscode.open",t.uri)}async function RR(){let r=await Ye.workspace.openTextDocument({language:"ruby"}),e=await Ye.window.showTextDocument(r,{preview:!1}),t=new Ye.Position(0,0);await e.insertSnippet(new Ye.SnippetString(`require "test_helper"

class $1Test < Minitest::Test
  def test_$2
    $3
  end
end
`),new Ye.Selection(t,t))}var SR=ue(require("net")),_R=ue(require("os")),TR=require("child_process"),Ct=ue(require("vscode"));var Qp=class{append(e){console.log(e)}appendLine(e){console.log(e)}},Kc=class{constructor(e,t){this.console=process.env.CI?new Qp:Ct.debug.activeDebugConsole;this.workspaceResolver=t,e.subscriptions.push(Ct.debug.registerDebugConfigurationProvider("ruby_lsp",this),Ct.debug.registerDebugAdapterDescriptorFactory("ruby_lsp",this))}async createDebugAdapterDescriptor(e,t){return e.configuration.request==="launch"?this.spawnDebuggeeForLaunch(e):e.configuration.request==="attach"?this.attachDebuggee(e):new Promise((n,i)=>i(new Error(`Unknown request type: ${e.configuration.request}. Please review your launch configurations`)))}provideDebugConfigurations(e,t){return[{type:"ruby_lsp",name:"Debug script",request:"launch",program:"ruby ${file}"},{type:"ruby_lsp",name:"Debug test",request:"launch",program:"ruby -Itest ${relativeFile}"},{type:"ruby_lsp",name:"Attach debugger",request:"attach"}]}resolveDebugConfiguration(e,t,n){let i=this.workspaceResolver(e?.uri);if(!i)throw new Error(`Couldn't find a workspace for URI: ${e?.uri} or editor: ${Ct.window.activeTextEditor}`);t.env?t.env=Object.assign(i.ruby.env,t.env):t.env=i.ruby.env;let s=i.workspaceFolder.uri;if(t.targetFolder={path:s.fsPath,name:i.workspaceFolder.name},t.env.BUNDLE_GEMFILE)return t;let o=Ct.Uri.joinPath(s,".ruby-lsp");return Ct.workspace.fs.readDirectory(o).then(a=>(a.some(c=>c[0]==="Gemfile")?t.env.BUNDLE_GEMFILE=Ct.Uri.joinPath(o,"Gemfile").fsPath:a.some(c=>c[0]==="gems.rb")&&(t.env.BUNDLE_GEMFILE=Ct.Uri.joinPath(o,"gems.rb").fsPath),t),()=>t)}dispose(){this.debugProcess&&this.debugProcess.kill("SIGTERM")}async getSockets(e){let t=e.configuration,n=e.configuration.debugSocketPath;if(n)return[n];let i=[];try{i=(await Jt("bundle exec rdbg --util=list-socks",{cwd:e.workspaceFolder?.uri.fsPath,env:t.env})).stdout.toString().split(`
`).filter(o=>o.length>0)}catch(s){this.console.append(`Error listing sockets: ${s.message}`)}return i}async attachDebuggee(e){let t=e.configuration.debugPort;if(t){let s=e.configuration.debugHost;return s?new Ct.DebugAdapterServer(t,s):new Ct.DebugAdapterServer(t)}let n=await this.getSockets(e);if(n.length===0)throw new Error("No debuggee processes found. Is the process running?");if(n.length===1)return new Ct.DebugAdapterNamedPipeServer(n[0]);let i=await Ct.window.showQuickPick(n,{placeHolder:"Select a debuggee",ignoreFocusOut:!0}).then(s=>{if(s===void 0)throw new Error("No debuggee selected");return s});return new Ct.DebugAdapterNamedPipeServer(i)}async spawnDebuggeeForLaunch(e){let t="",n=!1,i=e.configuration,o=i.targetFolder.path,a=_R.default.platform()==="win32"?await this.availablePort():void 0;return new Promise((c,d)=>{let h=["exec","rdbg"];a&&h.push("--port",a.toString()),h.push("--open","--command","--",i.program),this.logDebuggerMessage(`Spawning debugger in directory ${o}`),this.logDebuggerMessage(`   Command bundle ${h.join(" ")}`),this.debugProcess=(0,TR.spawn)("bundle",h,{shell:!0,env:i.env,cwd:o}),this.debugProcess.stderr.on("data",m=>{let v=m.toString();if(this.logDebuggerMessage(v),n||(t+=v),t.includes("DEBUGGER: wait for debugger connection...")){n=!0;let y=RegExp(/DEBUGGER: Debugger can attach via UNIX domain socket \((.*)\)/).exec(t);a?c(new Ct.DebugAdapterServer(a)):y&&y.length===2?c(new Ct.DebugAdapterNamedPipeServer(y[1])):d(new Error("Debugger not found on UNIX socket"))}}),this.debugProcess.stdout.on("data",m=>{this.logDebuggerMessage(m.toString())}),this.debugProcess.on("error",m=>{this.logDebuggerMessage(m.message),d(m)}),this.debugProcess.on("close",m=>{if(m){let v=`Debugger exited with status ${m}.
Please make sure \`bundle ${h.join(" ")}\` runs without errors in the terminal.
Check the Ruby LSP output channel for more information.
`;this.logDebuggerMessage(v),d(new Error(v))}})})}async availablePort(){return new Promise((e,t)=>{let n=SR.default.createServer();n.unref(),n.on("error",t),n.listen(0,()=>{let i=n.address(),s=typeof i=="string"?Number(i):i?.port;n.close(()=>{e(s)})})})}logDebuggerMessage(e){yr.info(`[debugger]: ${e.trimEnd()}`),this.console.append(e)}};var DR=ue(require("path")),Ve=ue(require("vscode")),PR=ue(rc());var zc=class{constructor(){this._onDidChangeTreeData=new Ve.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.subscriptions=[];this.gemRootFolders={};this.treeView=Ve.window.createTreeView("dependencies",{treeDataProvider:this,showCollapseAll:!0}),this.subscriptions.push(Xn.event(this.workspaceDidChange.bind(this)),Ve.window.onDidChangeActiveTextEditor(this.activeEditorDidChange.bind(this)),this.treeView.onDidChangeVisibility(this.treeVisibilityDidChange.bind(this)))}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.treeView.dispose()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.fetchDependencies()}getParent(e){let t=Ve.Uri.joinPath(e.resourceUri,".."),n=DR.default.parse(t.path).root;if(t.path!==n)if(e instanceof ho||e instanceof ms){let i=this.gemRootFolders[t.toString()];return i||new ho(t)}else return}async refresh(){await this.fetchDependencies(),this._onDidChangeTreeData.fire(void 0)}async workspaceDidChange(e){if(!(!e||e===this.currentWorkspace))return this.currentWorkspace=e,this.refresh()}async activeEditorDidChange(e){let t=e?.document.uri;t&&(this.currentVisibleItem=new ms(t),this.treeView.visible&&await this.revealElement(this.currentVisibleItem))}async treeVisibilityDidChange(e){this.currentVisibleItem&&e.visible&&await this.revealElement(this.currentVisibleItem)}async revealElement(e){Ve.workspace.getConfiguration("explorer").get("autoReveal")&&await this.treeView.reveal(e,{select:!0,focus:!1,expand:!0}),this.currentVisibleItem=void 0}async fetchDependencies(){if(this.gemRootFolders={},!this.currentWorkspace)return[];let e=this.currentWorkspace.lspClient;if(!e||e.state!==PR.State.Running)return[];let n=(await e.sendRequest("rubyLsp/workspace/dependencies",{})).sort((i,s)=>i.dependency===s.dependency?i.name.localeCompare(s.name):s.dependency?1:-1).map(i=>{let s=Ve.Uri.file(i.path),o=new Yp(i.name,i.version,s);return this.gemRootFolders[s.toString()]=o,o});return n.forEach(i=>{this.gemRootFolders[i.resourceUri.toString()]=i}),n}},Yp=class extends Ve.TreeItem{constructor(t,n,i){super(`${t} (${n})`,Ve.TreeItemCollapsibleState.Collapsed);this.resourceUri=i;this.contextValue="dependency",this.iconPath=new Ve.ThemeIcon("ruby")}async getChildren(){let t=this.resourceUri;return(await Ve.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ve.FileType.Directory?new ho(Ve.Uri.joinPath(t,i)):new ms(Ve.Uri.joinPath(t,i)))}},ho=class r extends Ve.TreeItem{constructor(t){super(t,Ve.TreeItemCollapsibleState.Collapsed);this.resourceUri=t;this.contextValue="gem-directory-path",this.description=!0,this.command={command:"list.toggleExpand",title:"Toggle"}}async getChildren(){let t=this.resourceUri;return(await Ve.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ve.FileType.Directory?new r(Ve.Uri.joinPath(t,i)):new ms(Ve.Uri.joinPath(t,i)))}},ms=class extends Ve.TreeItem{constructor(t){super(t,Ve.TreeItemCollapsibleState.None);this.resourceUri=t;this.contextValue="gem-file-path",this.description=!0,this.command={command:"vscode.open",title:"Open",arguments:[t]}}getChildren(){}};var ER=ue(require("os")),yn=ue(require("vscode")),kR=ER.default.platform()==="win32"?"ruby bin/rails":"bin/rails",Bc=class{constructor(e){this.showWorkspacePick=e}async generate(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${kR} generate ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails generate"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/create\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Revealing generated files"}),await this.revealFormattedFiles(n,i)})}async destroy(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${kR} destroy ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails destroy"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/remove\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Closing deleted files"});for(let c of i)await yn.commands.executeCommand("workbench.action.closeActiveEditor",yn.Uri.joinPath(n.workspaceFolder.uri,c))})}async revealFormattedFiles(e,t){for(let n of t){let i=yn.Uri.joinPath(e.workspaceFolder.uri,n);await yn.window.showTextDocument(i,{preview:!1}),await yn.commands.executeCommand("editor.action.formatDocument",i),await yn.commands.executeCommand("workbench.action.files.save",i)}}};var ct=ue(require("vscode"));var xR="rubyLsp.chatAgent",Ek=`
  You are a domain driven design and Ruby on Rails expert.
  The user will provide you with details about their Rails application.
  The user will ask you to help model a single specific concept.

  Analyze the provided concept carefully and think step by step. Consider the following aspects:
  1. The core purpose of the concept
  2. Its relationships with other potential entities in the system
  3. The attributes that would best represent this concept in a database

  Based on your analysis, suggest an appropriate model name and attributes to effectively model the concept.
  Follow these guidelines:

  1. Choose a clear, singular noun for the model name that accurately represents the concept
  2. Select attributes that capture the essential characteristics of the concept
  3. Use appropriate data types for each attribute (e.g. string, integer, datetime, boolean)
  4. Consider adding foreign keys for relationships with other models, if applicable

  After determining the model structure, generate the Rails commands to create the model and any associated resources.
  Include all relevant \`generate\` commands in a single Markdown shell code block at the end of your response.

  The \`generate\` commands should ONLY include the type of generator and arguments, not the \`rails generate\` part
  (e.g.: \`model User name:string\` but not \`rails generate model User name:string\`).
  NEVER include commands to migrate the database as part of the code block.
  NEVER include redundant commands (e.g. including the migration and model generation commands for the same model).
`.trim(),Gc=class{constructor(e,t){this.agent=ct.chat.createChatParticipant(xR,this.handler.bind(this)),this.agent.iconPath=ct.Uri.joinPath(e.extensionUri,"icon.png"),this.showWorkspacePick=t}dispose(){this.agent.dispose()}async handler(e,t,n,i){return this.withinConversation("design",e,t)?this.runDesignCommand(e,t,n,i):(n.markdown("Please indicate which command you would like to use for our chat."),{metadata:{command:""}})}async runDesignCommand(e,t,n,i){let s=this.previousInteractions(t),o=[ct.LanguageModelChatMessage.User(`User prompt: ${e.prompt}`),ct.LanguageModelChatMessage.User(Ek),ct.LanguageModelChatMessage.User(`Previous interactions with the user: ${s}`)],a=await this.showWorkspacePick();if(e.command&&a){let c=await this.schema(a);c&&o.push(ct.LanguageModelChatMessage.User(`Existing application schema: ${c}`))}try{let[c]=await ct.lm.selectChatModels({vendor:"copilot",family:"gpt-4o"});n.progress("Designing the models for the requested concept...");let d=await c.sendRequest(o,{},i),h="";for await(let v of d.text)n.markdown(v),h+=v;let m=/(?<=```shell)[^.$]*(?=```)/.exec(h);if(a&&m&&m[0]){let v=m[0].trim().split(`
`).map(S=>S.replace(/\s*(bin\/rails|rails) generate\s*/,""));n.button({command:"rubyLsp.railsGenerate",title:"Generate with Rails",arguments:[v,a]}),n.button({command:"rubyLsp.railsDestroy",title:"Revert previous generation",arguments:[v,a]})}}catch(c){this.handleError(c,n)}return{metadata:{command:"design"}}}async schema(e){try{return(await ct.workspace.fs.readFile(ct.Uri.joinPath(e.workspaceFolder.uri,"db/schema.rb"))).toString()}catch{}try{return(await ct.workspace.fs.readFile(ct.Uri.joinPath(e.workspaceFolder.uri,"db/structure.sql"))).toString()}catch{}}withinConversation(e,t,n){return t.command===e||!t.command&&n.history.some(i=>i instanceof ct.ChatRequestTurn&&i.command===e)}handleError(e,t){if(e instanceof ct.LanguageModelError)e.cause instanceof Error&&e.cause.message.includes("off_topic")&&t.markdown("Sorry, I can only help you with Ruby related questions");else throw e}previousInteractions(e){let t="";return e.history.forEach(n=>{if(n instanceof ct.ChatResponseTurn){if(n.participant===xR){let i="";n.response.forEach(s=>{s instanceof ct.ChatResponseMarkdownPart&&(i+=s.value.value)}),t+=`Response: ${i}`}}else t+=`Request: ${n.prompt}`}),t}};var Nn=ue(require("vscode"));async function IR(r){if(!r){await Nn.window.showErrorMessage("No active Ruby workspace found.");return}let e=await xk(r),t=Nn.window.createWebviewPanel("rubyLspInfo","Ruby LSP Information",Nn.ViewColumn.One,{enableScripts:!0});t.webview.html=qk(e)}async function xk(r){let e=Nn.version,n=Nn.extensions.getExtension("Shopify.ruby-lsp").packageJSON.version,i=r.lspClient?.serverVersion??"Unknown",s=r.lspClient?.addons?.map(h=>h.name)??[],o=await Ik(),a=Nn.workspace.getConfiguration("rubyLsp",r.workspaceFolder),c=Nn.workspace.getConfiguration("rubyLsp"),d={};for(let h of Object.keys(a))a.inspect(h)?.workspaceValue!==void 0&&(d[h]=a.get(h));return{"VS Code Version":e,"Ruby LSP Extension Version":n,"Ruby LSP Server Version":i,"Ruby LSP Add-ons":s,"Ruby Version":r.ruby.rubyVersion??"Unknown","Ruby Version Manager":r.ruby.versionManager.identifier,"Installed Extensions":o.sort(),"Ruby LSP Settings":{Workspace:d,User:c}}}async function Ik(){return Nn.extensions.all.filter(r=>!(r.packageJSON.isBuiltin||r.packageJSON.license==="UNLICENSED"||!r.packageJSON.license)).map(r=>`${r.packageJSON.name} (${r.packageJSON.version})`)}function qk(r){let e=`
### Ruby LSP Information

`;for(let[n,i]of Object.entries(r)){if(e+=`#### ${n}

`,Array.isArray(i))n==="Installed Extensions"?(e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`,e+=`${i.map(s=>`- ${s}`).join(`
`)}
`,e+=`&lt;/details&gt;
`):e+=`${i.map(s=>`- ${s}`).join(`
`)}
`;else if(typeof i=="object"&&i!==null){e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`;for(let[s,o]of Object.entries(i))e+=`##### ${s}

`,e+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`;e+=`&lt;/details&gt;
`}else e+=`${i}
`;e+=`
`}return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ruby LSP Information</title>
      <style>
        body { font-family: var(--vscode-font-family); padding: 20px; }
        h1, h2, h3, p, li { color: var(--vscode-editor-foreground); }
        pre {
          background-color: var(--vscode-textBlockQuote-background);
          padding: 16px;
          overflow-x: auto;
          position: relative;
        }
        code { font-family: var(--vscode-editor-font-family); }
        #copyButton {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--vscode-button-background);
          color: var(--vscode-button-foreground);
          border: none;
          padding: 5px 10px;
          cursor: pointer;
        }
        #copyButton:hover { background-color: var(--vscode-button-hoverBackground); }
      </style>
    </head>
    <body>
      <h1>Ruby LSP Information</h1>
      <p>Please copy the content below and paste it into the issue you're opening:</p>
      <pre><button id="copyButton">Copy</button><code id="diagnosticContent">${e}</code></pre>
      <script>
        const copyButton = document.getElementById('copyButton');
        const diagnosticContent = document.getElementById('diagnosticContent');

        copyButton.addEventListener('click', () => {
          const range = document.createRange();
          range.selectNode(diagnosticContent);
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
          document.execCommand('copy');
          window.getSelection().removeAllRanges();

          copyButton.textContent = 'Copied!';
          setTimeout(() => {
            copyButton.textContent = 'Copy';
          }, 2000);
        });
      </script>
    </body>
    </html>
  `}var Jc=class{constructor(e,t){this.workspaces=new Map;this.virtualDocuments=new Map;this.workspacesBeingLaunched=new Map;this.context=e,this.telemetry=t,this.testController=new Hc(e,this.telemetry,this.currentActiveWorkspace.bind(this),this.getOrActivateWorkspace.bind(this)),this.debug=new Kc(e,this.workspaceResolver.bind(this)),this.rails=new Bc(this.showWorkspacePick.bind(this)),this.statusItems=new Cc;let n=new zc;e.subscriptions.push(this.statusItems,this.debug,n,new Gc(e,this.showWorkspacePick.bind(this)),j.window.onDidChangeActiveTextEditor(i=>{Xn.fire(this.currentActiveWorkspace(i))}),j.workspace.onDidChangeWorkspaceFolders(async i=>{for(let s of i.removed){let o=this.getWorkspace(s.uri);o&&(await o.stop(),await o.dispose(),this.workspaces.delete(s.uri.toString()))}}),j.workspace.onDidOpenTextDocument(async i=>{if(!Xr.includes(i.languageId))return;let s=j.workspace.getWorkspaceFolder(i.uri);if(!s)return;this.getWorkspace(s.uri)||await this.activateWorkspace(s,!1)}),j.workspace.registerTextDocumentContentProvider("embedded-content",{provideTextDocumentContent:i=>{let s=/^\/(.*)\.[^.]+$/.exec(i.path)?.[1];if(!s)return"";let o=decodeURIComponent(s);return this.virtualDocuments.get(o)}}),yr,j.workspace.registerTextDocumentContentProvider("ruby-lsp",new Zs),...this.registerCommands())}async activate(){await j.commands.executeCommand("testing.clearTestResults");let e=j.workspace.workspaceFolders?.[0];e&&await this.activateWorkspace(e,!0);let t=j.window.activeTextEditor?.document;if(t&&Xr.includes(t.languageId)){let n=j.workspace.getWorkspaceFolder(t.uri);n&&(this.workspaces.get(n.uri.toString())||await this.activateWorkspace(n,!1))}Xn.fire(this.currentActiveWorkspace())}async deactivate(){for(let e of this.workspaces.values())await e.stop(),await e.dispose()}async activateWorkspace(e,t){let n=this.workspacesBeingLaunched.get(e.index);if(n)return n;let i=this.runActivation(e,t);return this.workspacesBeingLaunched.set(e.index,i),i}async runActivation(e,t){let n=j.workspace.getConfiguration("rubyLsp").get("bundleGemfile"),i=await this.lockfileExists(e.uri);if(t&&!i){this.workspacesBeingLaunched.delete(e.index);return}n.length===0&&!i&&await this.showStandaloneWarning(e.uri.fsPath);let s=new bc(this.context,e,this.telemetry,this.testController.createTestItems.bind(this.testController),this.virtualDocuments,this.workspaces.size===0);return await s.activate(),await s.start(),this.workspaces.set(e.uri.toString(),s),await j.commands.executeCommand("setContext","rubyLsp.activated",!0),await this.showFormatOnSaveModeWarning(s),this.workspacesBeingLaunched.delete(e.index),s}registerCommands(){return[j.commands.registerCommand("rubyLsp.update",async()=>{let e=await this.showWorkspacePick();e&&(await e.installOrUpdateServer(!0),await e.restart())}),j.commands.registerCommand("rubyLsp.start",async()=>{await(await this.showWorkspacePick())?.start()}),j.commands.registerCommand("rubyLsp.restart",async()=>{await(await this.showWorkspacePick())?.restart()}),j.commands.registerCommand("rubyLsp.stop",async()=>{await(await this.showWorkspacePick())?.dispose()}),j.commands.registerCommand("rubyLsp.showSyntaxTree",this.showSyntaxTree.bind(this)),j.commands.registerCommand("rubyLsp.diagnoseState",this.diagnoseState.bind(this)),j.commands.registerCommand("rubyLsp.showServerChangelog",()=>{let e=this.currentActiveWorkspace()?.lspClient?.serverVersion;if(e)return j.env.openExternal(j.Uri.parse(`https://github.com/Shopify/ruby-lsp/releases/tag/v${e}`))}),j.commands.registerCommand("rubyLsp.formatterHelp",()=>j.env.openExternal(j.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#formatting"))),j.commands.registerCommand("rubyLsp.displayAddons",async()=>{let e=this.currentActiveWorkspace()?.lspClient;if(!e||!e.addons)return;let t=e.addons.sort(i=>i.errored?1:-1).map(i=>({label:`${i.errored?"$(error)":"$(pass)"} ${i.name} ${i.version?`v${i.version}`:""}`})),n=j.window.createQuickPick();n.items=t,n.placeholder="Addons (click to view output)",n.onDidAccept(()=>{n.selectedItems[0]&&this.currentActiveWorkspace()?.outputChannel.show(),n.hide()}),n.onDidHide(()=>{n.dispose()}),n.show()}),j.commands.registerCommand("rubyLsp.toggleFeatures",async()=>{let e=j.extensions.getExtension("Shopify.ruby-lsp").packageJSON.contributes.configuration.properties["rubyLsp.enabledFeatures"].properties,t={};Object.entries(e).forEach(([c,d])=>{t[c]=d.description});let i=j.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),s=Object.keys(i),o=s.map(c=>({label:c,picked:i[c],description:t[c]})),a=await j.window.showQuickPick(o,{canPickMany:!0,placeHolder:"Select the features you would like to enable"});a!==void 0&&(s.forEach(c=>{i[c]=a.some(d=>d.label===c)}),await j.workspace.getConfiguration("rubyLsp").update("enabledFeatures",i,!0,!0))}),j.commands.registerCommand("rubyLsp.toggleExperimentalFeatures",async()=>{let e=j.workspace.getConfiguration("rubyLsp"),t=e.get("enableExperimentalFeatures");await e.update("enableExperimentalFeatures",!t,!0,!0),Xn.fire(this.currentActiveWorkspace())}),j.commands.registerCommand("rubyLsp.serverOptions",async e=>{let t=await j.window.showQuickPick(e,{placeHolder:"Select server action"});t!==void 0&&await j.commands.executeCommand(t.description)}),j.commands.registerCommand("rubyLsp.selectRubyVersionManager",async()=>{let e=await j.window.showQuickPick(["Change version manager","Change manual Ruby configuration"],{placeHolder:"What would you like to do?"});if(!e)return;if(e==="Change version manager"){let n=j.workspace.getConfiguration("rubyLsp"),i=n.get("rubyVersionManager"),s=Object.values(Eh),o=await j.window.showQuickPick(s,{placeHolder:`Current: ${i.identifier}`});o!==void 0&&(i.identifier=o,await n.update("rubyVersionManager",i,!0));return}let t=await this.showWorkspacePick();t&&await t.ruby.manuallySelectRuby()}),j.commands.registerCommand("rubyLsp.runTest",(e,t,n)=>this.testController.runOnClick(t)),j.commands.registerCommand("rubyLsp.runTestInTerminal",this.testController.runTestInTerminal.bind(this.testController)),j.commands.registerCommand("rubyLsp.debugTest",this.testController.debugTest.bind(this.testController)),j.commands.registerCommand("rubyLsp.runTask",async e=>{let t=this.currentActiveWorkspace();t||(t=await this.showWorkspacePick()),t&&await t.execute(e,!0)}),j.commands.registerCommand("rubyLsp.bundleInstall",e=>{let t=this.workspaces.get(e);if(!t)return;let n=j.window.createTerminal({name:"Bundle install",cwd:t.workspaceFolder.uri.fsPath,env:t.ruby.env});n.show(),n.sendText("bundle install")}),j.commands.registerCommand("rubyLsp.openFile",e=>{if(typeof e[0]=="string")return Xp(e);let[t,n]=e,i=this.currentActiveWorkspace();return CR(this.telemetry,i,{file:t,line:parseInt(n,10)-1})}),j.commands.registerCommand("rubyLsp.railsGenerate",async(e,t)=>{let n=e??await j.window.showInputBox({title:"Rails generate arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.generate(n,t);return}for(let i of n)await this.rails.generate(i,t)}}),j.commands.registerCommand("rubyLsp.railsDestroy",async(e,t)=>{let n=e??await j.window.showInputBox({title:"Rails destroy arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.destroy(n,t);return}for(let i of n)await this.rails.destroy(i,t)}}),j.commands.registerCommand("rubyLsp.fileOperation",async()=>{let e=await this.showWorkspacePick();if(!e)return;let t=[{label:"Minitest test",description:"Create a new Minitest test",iconPath:new j.ThemeIcon("new-file"),command:"rubyLsp.newMinitestFile",args:[]}];e.lspClient?.addons?.some(i=>i.name==="Ruby LSP Rails")&&t.push({label:"Rails generate",description:"Run Rails generate",iconPath:new j.ThemeIcon("new-file"),command:"rubyLsp.railsGenerate",args:[void 0,e]},{label:"Rails destroy",description:"Run Rails destroy",iconPath:new j.ThemeIcon("trash"),command:"rubyLsp.railsDestroy",args:[void 0,e]});let n=await j.window.showQuickPick(t,{title:"Select a Ruby file operation"});n&&await j.commands.executeCommand(n.command,...n.args)}),j.commands.registerCommand("rubyLsp.newMinitestFile",RR),j.commands.registerCommand("rubyLsp.collectRubyLspInfo",async()=>{let e=await this.showWorkspacePick();await IR(e)}),j.commands.registerCommand("rubyLsp.startServerInDebugMode",async()=>{await(await this.showWorkspacePick())?.start(!0)}),j.commands.registerCommand("rubyLsp.showOutput",async()=>{yr.show()}),j.commands.registerCommand("rubyLsp.migrateLaunchConfiguration",async()=>{if(!await this.showWorkspacePick())return;let n=(j.workspace.getConfiguration("launch")?.get("configurations")||[]).map(i=>{if(i.type==="rdbg"){if(i.request==="launch"){let s={...i};if(s.type="ruby_lsp",s.askParameters!==!0){delete s.rdbgPath,delete s.cwd,delete s.useBundler;let o=(s.command||"").replace("${workspaceRoot}/",""),a=s.script||"",c=(s.args||[]).join(" ");s.program=`${o} ${a} ${c}`.trim(),delete s.command,delete s.script,delete s.args,delete s.askParameters}return s}else if(i.request==="attach"){let s={...i};return s.type="ruby_lsp",s.debugSocketPath=i.debugPort,s}}return i});await j.workspace.getConfiguration("launch").update("configurations",n,j.ConfigurationTarget.Workspace)}),j.commands.registerCommand("rubyLsp.goToRelevantFile",async()=>{let e=j.window.activeTextEditor?.document.uri;if(!e)return;let t=await this.currentActiveWorkspace()?.lspClient?.sendGoToRelevantFileRequest(e);if(t)return Xp(t.locations)})]}currentActiveWorkspace(e=j.window.activeTextEditor){let t;if(e?t=j.workspace.getWorkspaceFolder(e.document.uri):t=j.workspace.workspaceFolders?.find(n=>n.name===j.workspace.name),!!t)return this.getWorkspace(t.uri)}async getOrActivateWorkspace(e){let t=this.getWorkspace(e.uri);return t||j.window.withProgress({location:j.ProgressLocation.Notification,title:`Workspace ${e.name} is not activated yet.`},async n=>(n.report({message:"Activating workspace..."}),this.activateWorkspace(e,!1)))}getWorkspace(e){return this.workspaces.get(e.toString())}workspaceResolver(e){if(!e)return this.currentActiveWorkspace();let t=this.workspaces.get(e.toString());return t||this.currentActiveWorkspace()}async showWorkspacePick(){if(this.workspaces.size===1)return this.workspaces.values().next().value;let e=await j.window.showWorkspaceFolderPick();if(e)return this.getWorkspace(e.uri)}async diagnoseState(){let t=await(await this.showWorkspacePick())?.lspClient?.sendRequest("rubyLsp/diagnoseState");if(t){let n=Object.entries(t.documents),i=[`Worker alive: ${t.workerAlive}`,`Incoming queue size: ${t.incomingQueueSize}`,`Backtrace:
${t.backtrace.join(`
`)}
`,`=========== Documents (${n.length}) ===========`,...n.map(([o,a])=>`URI: ${o}

${a}
===========`)].join(`
`),s=await j.workspace.openTextDocument(j.Uri.from({scheme:"ruby-lsp",path:"show-diagnose-state",query:i}));await j.window.showTextDocument(s,{viewColumn:j.ViewColumn.Beside,preserveFocus:!0})}}async showSyntaxTree(){let e=j.window.activeTextEditor;if(e){let t=e.document;if(t.languageId!=="ruby"){await j.window.showErrorMessage("Show syntax tree: not a Ruby file");return}let n=j.workspace.getWorkspaceFolder(t.uri);if(!n)return;let i=this.getWorkspace(n.uri),s=e.selection,o;s.active.isEqual(s.anchor)||(s.isReversed?o=Zp.Range.create(s.active.line,s.active.character,s.anchor.line,s.anchor.character):o=Zp.Range.create(s.anchor.line,s.anchor.character,s.active.line,s.active.character));let a=await i?.lspClient?.sendShowSyntaxTreeRequest(t.uri,o);if(a){let c=await j.workspace.openTextDocument(j.Uri.from({scheme:"ruby-lsp",path:"show-syntax-tree",query:a.ast}));await j.window.showTextDocument(c,{viewColumn:j.ViewColumn.Beside,preserveFocus:!0})}}}async showFormatOnSaveModeWarning(e){let t=j.workspace.getConfiguration("editor",{languageId:"ruby"}),n=t.get("formatOnSaveMode");if(n==="file")return;await j.window.showWarningMessage(`The "editor.formatOnSaveMode" setting is set to ${n} in workspace ${e.workspaceFolder.name}, which
      is currently unsupported by the Ruby LSP. If you'd like to have formatting enabled, please set it to 'file'`,"Change setting to 'file'","Use without formatting")==="Change setting to 'file'"&&await t.update("formatOnSaveMode","file",j.ConfigurationTarget.Global)}async lockfileExists(e){try{return await j.workspace.fs.stat(j.Uri.joinPath(e,"Gemfile.lock")),!0}catch{}try{return await j.workspace.fs.stat(j.Uri.joinPath(e,"gems.locked")),!0}catch{}return!1}async showStandaloneWarning(e){await j.window.withProgress({location:j.ProgressLocation.Notification,title:"No bundle found. Launching in standalone mode in 5 seconds",cancellable:!0},async(t,n)=>{if(t.report({message:"If working in a monorepo, cancel to see configuration instructions"}),await new Promise(i=>{n.onCancellationRequested(()=>{i()}),setTimeout(i,5e3)}),n.isCancellationRequested&&await j.window.showWarningMessage(`Could not find a lockfile in ${e}. Are you using a monorepo setup?`,"See the multi-root workspace docs","Launch anyway")==="See the multi-root workspace docs"){let s=j.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md?tab=readme-ov-file#multi-root-workspaces");await j.env.openExternal(s)}})}};var ar=ue(require("vscode")),Xc=class{constructor(){this.disposables=[];this.decorationType=ar.window.createTextEditorDecorationType({opacity:ar.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel")}),this.disposables.push(ar.window.onDidChangeActiveTextEditor(()=>this.updateDecorations()),ar.workspace.onDidChangeTextDocument(()=>this.updateDecorations())),this.updateDecorations()}reload(){let e=ar.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel");this.decorationType.dispose(),this.decorationType=ar.window.createTextEditorDecorationType({opacity:e}),this.updateDecorations()}dispose(){this.decorationType.dispose(),this.disposables.forEach(e=>e.dispose())}updateDecorations(){let e=ar.window.activeTextEditor;if(!e||e.document.languageId!=="ruby")return;let t=e.document.getText(),n=[],i=t.split(`
`);for(let s=0;s<i.length;s++){let o=i[s];o.trim().startsWith("#:")&&n.push({range:new ar.Range(s,0,s,o.length)})}e.setDecorations(this.decorationType,n)}};var eg;async function Ok(r){if(!Yt.workspace.workspaceFolders){await Yt.window.showWarningMessage(`Using the Ruby LSP without any workspaces opened is currently not supported
      ([learn more](https://github.com/Shopify/ruby-lsp/issues/1780))`,"Open a workspace","Continue anyway")==="Open a workspace"&&await Yt.commands.executeCommand("workbench.action.files.openFolder");return}await Lk();let e=new Xc;r.subscriptions.push(e,Yt.workspace.onDidChangeConfiguration(async n=>{n.affectsConfiguration("rubyLsp.sigOpacityLevel")&&e.reload()}));let t=await Mk(r);r.subscriptions.push(t),eg=new Jc(r,t),await eg.activate()}async function Fk(){await eg.deactivate()}async function Lk(){let r=Yt.workspace.getConfiguration("rubyLsp");r.get("enableExperimentalFeatures")&&(await r.update("enableExperimentalFeatures",void 0,!0),await r.update("featureFlags",{all:!0},!0))}async function Mk(r){let e;switch(r.extensionMode){case Yt.ExtensionMode.Development:e={sendEventData:(t,n)=>{yr.debug(t,n)},sendErrorData:(t,n)=>{yr.error(t,n)}};break;case Yt.ExtensionMode.Test:e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}};break;default:try{let t=0;for(;!e&&t<5;)await Yt.commands.executeCommand("getTelemetrySenderObject"),e=await Yt.commands.executeCommand("getTelemetrySenderObject"),t++}catch{e={sendEventData:(n,i)=>{},sendErrorData:(n,i)=>{}}}break}return e||(e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}}),Yt.env.createTelemetryLogger(e,{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0,additionalCommonProperties:{extensionVersion:r.extension.packageJSON.version,environment:qR.default.platform(),machineId:Yt.env.machineId}})}0&&(module.exports={activate,deactivate});
